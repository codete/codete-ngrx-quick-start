"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[667],{45667:(st,z,h)=>{h.r(z),h.d(z,{SubtasksComponent:()=>$.b,TasksAppComponent:()=>x,TasksAppModule1:()=>R,TasksContainer:()=>V.W,TasksEngineComponent:()=>E.A,TasksEngineModule:()=>f.c,TasksEngineService:()=>F.u});var c=h(60105),E=h(77444);let x=(()=>{class P{constructor(){}ngOnInit(){}}return P.\u0275fac=function(b){return new(b||P)},P.\u0275cmp=c.Xpm({type:P,selectors:[["app-tasks-app"]],decls:1,vars:0,template:function(b,I){1&b&&c._UZ(0,"app-tasks-engine")},directives:[E.A],styles:[""]}),P})();var u=h(41380),B=h(26983),f=h(9450);const k=[{path:"",component:x}];let R=(()=>{class P{}return P.\u0275fac=function(b){return new(b||P)},P.\u0275mod=c.oAB({type:P}),P.\u0275inj=c.cJS({imports:[[u.ez,B.Bz.forChild(k),f.c.forRoot()]]}),P})();var F=h(97140),$=h(82932),V=h(31267)},82932:(st,z,h)=>{h.d(z,{b:()=>Y});var c=h(58485),E=h(60105),u=(h(24817),h(12777)),B=h(23355),f=h(97140),k=h(55605),R=h(52649),F=h(41380),$=h(98582),V=h(65941),P=h(52988),D=h(55831),b=h(16612);function I(N,K){1&N&&E._UZ(0,"mat-progress-bar",4)}function C(N,K){if(1&N){const O=E.EpF();E.TgZ(0,"app-task",8),E.NdJ("remove",function(){const H=E.CHM(O).$implicit;return E.oxw(2).onRemove(H)})("isDone",function(w){const W=E.CHM(O).$implicit;return E.oxw(2).onSave(w,W)})("saveName",function(w){const W=E.CHM(O).$implicit;return E.oxw(2).onSaveName(w,W)}),E.qZA()}2&N&&E.Q6J("task",K.$implicit)("isSubtask",!0)("editable",!0)}function M(N,K){if(1&N){const O=E.EpF();E.YNc(0,C,1,3,"app-task",5),E.ALo(1,"async"),E.TgZ(2,"mat-form-field",6)(3,"input",7),E.NdJ("ngModelChange",function(w){return E.CHM(O),E.oxw().tempSubtask=w})("keypress",function(w){return E.CHM(O),E.oxw().onNewSubtask(w)},!1,E.Jf7),E.ALo(4,"async"),E.qZA()(),E._UZ(5,"br")}if(2&N){const O=E.oxw();E.Q6J("ngForOf",E.lcZ(1,3,O.subtasks$)),E.xp6(3),E.Q6J("disabled",E.lcZ(4,5,O.isAddingSubtask$))("ngModel",O.tempSubtask)}}let Y=(()=>{class N{constructor(O){this.engine=O,this.close=new E.vpe,this.removeTask=new E.vpe,this.removeSubtask=new E.vpe,this.newSubtask=new E.vpe,this.tasksLoaded=!1,this.isLoadingSubtasks$=this.engine.isProcessingSubtaskRequestSelector,this.isAddingSubtask$=this.engine.isProcessingSubtaskRequestSelector,this.subtasks$=this.engine.allSubtasks(this).pipe((0,u.U)(U=>this.taskId?U.filter(w=>w.taskId===this.taskId):[]),(0,B.b)(()=>{this.tasksLoaded=!0}))}ngOnChanges(O){this.taskId&&(this.tasksLoaded=!1,this.engine.fetchSubtaskAction(this.taskId))}onSaveName(O,U){this.engine.onSaveSubTaskAction({name:O},U)}onNewSubtask(O){this.engine.addSubTaskAction(O,this)}onRemove(O){var U=this;return(0,c.Z)(function*(){U.engine.removeSubTaskAction(O)})()}onSave(O,U){this.engine.onSaveSubTaskAction({isDone:O},U)}ngOnInit(){}}return N.\u0275fac=function(O){return new(O||N)(E.Y36(f.u))},N.\u0275cmp=E.Xpm({type:N,selectors:[["app-subtasks"]],inputs:{taskId:"taskId"},outputs:{close:"close",removeTask:"removeTask",removeSubtask:"removeSubtask",newSubtask:"newSubtask"},features:[E.TTD],decls:11,vars:4,consts:[["mat-icon-button","",3,"click"],["mat-icon-button","",1,"delete",3,"click"],["mode","indeterminate",4,"ngIf","ngIfElse"],["tasksList",""],["mode","indeterminate"],[3,"task","isSubtask","editable","remove","isDone","saveName",4,"ngFor","ngForOf"],[1,"new-subtask-input"],["matInput","","placeholder","+ Add new subtask..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isSubtask","editable","remove","isDone","saveName"]],template:function(O,U){if(1&O&&(E.TgZ(0,"button",0),E.NdJ("click",function(){return U.close.emit()}),E.TgZ(1,"mat-icon"),E._uU(2,"close"),E.qZA()(),E.TgZ(3,"button",1),E.NdJ("click",function(){return U.removeTask.emit(U.taskId)}),E.TgZ(4,"mat-icon"),E._uU(5," delete_forever "),E.qZA()(),E._UZ(6,"br"),E.YNc(7,I,1,0,"mat-progress-bar",2),E.ALo(8,"async"),E.YNc(9,M,6,7,"ng-template",null,3,E.W1O)),2&O){const w=E.MAs(10);E.xp6(7),E.Q6J("ngIf",!U.tasksLoaded&&E.lcZ(8,2,U.isLoadingSubtasks$))("ngIfElse",w)}},directives:[k.lW,R.Hw,F.O5,$.pW,F.sg,V.m,P.KE,D.Nt,b.Fj,b.JJ,b.On],pipes:[F.Ov],styles:["[_nghost-%COMP%]{width:400px;display:block;padding:5px}.new-subtask-input[_ngcontent-%COMP%]{width:100%}.delete[_ngcontent-%COMP%]{float:right}"]}),N})()},31267:(st,z,h)=>{h.d(z,{W:()=>T});var c=h(58485),E=h(24817),x=h(97140),u=h(60105),B=h(46251),f=h(1036),k=h(41380),R=h(82932),F=h(94235),$=h(16246),V=h(55605),P=h(52649),D=h(23822);function b(p,S){1&p&&(u.TgZ(0,"button",3)(1,"mat-icon"),u._uU(2,"sync"),u.qZA()())}function I(p,S){1&p&&(u.TgZ(0,"button",4)(1,"mat-icon"),u._uU(2,"sync_problem"),u.qZA()())}function C(p,S){1&p&&(u.TgZ(0,"button",4),u._UZ(1,"mat-spinner",5),u.qZA()),2&p&&(u.xp6(1),u.Q6J("diameter",20))}function M(p,S){1&p&&(u.TgZ(0,"button",4)(1,"mat-icon"),u._uU(2,"done"),u.qZA()())}function Y(p,S){if(1&p&&(u.ynx(0),u.YNc(1,b,3,0,"button",1),u.YNc(2,I,3,0,"button",2),u.YNc(3,C,2,1,"button",2),u.YNc(4,M,3,0,"button",2),u.BQk()),2&p){const d=S.ngIf;u.xp6(1),u.Q6J("ngIf","idle"===d),u.xp6(1),u.Q6J("ngIf","sync-problem"===d),u.xp6(1),u.Q6J("ngIf","syncing"===d),u.xp6(1),u.Q6J("ngIf","syncing-done"===d)}}let N=(()=>{class p{constructor(d){this.engine=d,this.state$=this.engine.synchonizationSateSelector()}}return p.\u0275fac=function(d){return new(d||p)(u.Y36(x.u))},p.\u0275cmp=u.Xpm({type:p,selectors:[["app-synchonization"]],decls:2,vars:3,consts:[[4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer",4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer-blocked",4,"ngIf"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer-blocked"],[3,"diameter"]],template:function(d,i){1&d&&(u.YNc(0,Y,5,4,"ng-container",0),u.ALo(1,"async")),2&d&&u.Q6J("ngIf",u.lcZ(1,1,i.state$))},directives:[k.O5,V.lW,P.Hw,D.Ou],pipes:[k.Ov],styles:["[_nghost-%COMP%]{position:absolute;right:20px}.pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:pointer}.pointer-blocked[_ngcontent-%COMP%]{pointer-events:none;cursor:not-allowed}.pointer-blocked[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:not-allowed}.sync-button[_ngcontent-%COMP%]{z-index:999;float:right;opacity:.7}.sync-button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{left:10px}.sync-button[_ngcontent-%COMP%]:hover{opacity:1}"]}),p})();var K=h(52988),O=h(55831),U=h(16612),w=h(65941);const H=["drawer"];function W(p,S){if(1&p){const d=u.EpF();u.TgZ(0,"app-subtasks",9),u.NdJ("close",function(){return u.CHM(d),u.oxw().onCloseSubtaskMenu()})("removeTask",function(g){return u.CHM(d),u.oxw().onRemoveTask(g)}),u.qZA()}if(2&p){const d=u.oxw();u.Q6J("taskId",d.toogled.id)}}function X(p,S){if(1&p){const d=u.EpF();u.TgZ(0,"app-task",10),u.NdJ("isDone",function(g){const j=u.CHM(d).$implicit;return u.oxw().onSave(g,j)})("click",function(g){const j=u.CHM(d).$implicit;return u.oxw().toogle(g,j)})("focused",function(g){const j=u.CHM(d).$implicit;return u.oxw().focus(g,j)})("saveName",function(g){const j=u.CHM(d).$implicit;return u.oxw().onSaveName(g,j)}),u.qZA()}2&p&&u.Q6J("task",S.$implicit)}let T=(()=>{class p{constructor(d,i){this.engine=d,this.breakpointObserver=i,this.tasks$=this.engine.allTasksSelector(),this.title$=this.engine.title(),this.isAddingTasks$=this.engine.isProcessingTaskRequestSelector,this.focusFired=0}ngOnInit(){var d=this;return(0,c.Z)(function*(){d.engine.initAction()})()}onRemoveTask(d){var i;null===(i=this.drawer)||void 0===i||i.close(),this.engine.removeTaskAction(d)}onRemoveSubTask(d){this.engine.removeSubTaskAction(d)}onCloseSubtaskMenu(){var d;null===(d=this.drawer)||void 0===d||d.close()}ngAfterViewInit(){}add(d){this.engine.addTaskAction(d,this)}onSave(d,i){this.engine.onSaveTaskAction({isDone:d},i)}onSaveName(d,i){this.engine.onSaveTaskAction({name:d},i)}focus(){this.focusFired=2}toogle(d,i){setTimeout(()=>{this.focusFired>0?(this.focusFired--,d.stopImmediatePropagation(),d.stopPropagation(),0===this.focusFired&&this.tasks.find(_=>_.task.id===i.id).focusTriggered.next()):this.engine.toogleSubtasksAction(d,i,this)},200)}}return p.\u0275fac=function(d){return new(d||p)(u.Y36(x.u),u.Y36(B.Yg))},p.\u0275cmp=u.Xpm({type:p,selectors:[["app-tasks"]],viewQuery:function(d,i){if(1&d&&(u.Gf(H,5),u.Gf(E.mk,5)),2&d){let g;u.iGM(g=u.CRH())&&(i.drawer=g.first),u.iGM(g=u.CRH())&&(i.tasks=g)}},decls:18,vars:14,consts:[[1,"container",3,"hasBackdrop"],["position","end",3,"mode"],["drawer",""],[3,"taskId","close","removeTask",4,"ngIf"],["grow","",1,"title"],[1,"background",3,"width"],[1,"new-task-input"],["matInput","","autocomplete","off","placeholder","+ Add new task..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isDone","click","focused","saveName",4,"ngFor","ngForOf"],[3,"taskId","close","removeTask"],[3,"task","isDone","click","focused","saveName"]],template:function(d,i){1&d&&(u.TgZ(0,"mat-drawer-container",0)(1,"mat-drawer",1,2),u.YNc(3,W,1,1,"app-subtasks",3),u.qZA(),u.TgZ(4,"mat-drawer-content")(5,"mat-card")(6,"columns-container")(7,"column",4),u._uU(8),u.ALo(9,"async"),u.qZA(),u.TgZ(10,"column",5),u._UZ(11,"app-synchonization"),u.qZA()(),u.TgZ(12,"mat-form-field",6)(13,"input",7),u.NdJ("ngModelChange",function(_){return i.newTaskModel=_})("keypress",function(_){return i.add(_)},!1,u.Jf7),u.ALo(14,"async"),u.qZA()(),u._UZ(15,"br"),u.YNc(16,X,1,1,"app-task",8),u.ALo(17,"async"),u.qZA()()()),2&d&&(u.Q6J("hasBackdrop",!1),u.xp6(1),u.Q6J("mode","side"),u.xp6(2),u.Q6J("ngIf",i.toogled),u.xp6(5),u.hij(" ",u.lcZ(9,8,i.title$)," "),u.xp6(2),u.Q6J("width",60),u.xp6(3),u.Q6J("disabled",u.lcZ(14,10,i.isAddingTasks$))("ngModel",i.newTaskModel),u.xp6(3),u.Q6J("ngForOf",u.lcZ(17,12,i.tasks$)))},directives:[f.kh,f.jA,k.O5,R.b,f.LW,F.a8,$.a_,$.bg,$.iB,N,K.KE,O.Nt,U.Fj,U.JJ,U.On,k.sg,w.m],pipes:[k.Ov],styles:["[_nghost-%COMP%]{--max-container-size: 1200px;white-space:nowrap}.container[_ngcontent-%COMP%]{height:100%}.new-task-input[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{text-align:center;margin:0}.title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.background[_ngcontent-%COMP%]{background-color:#fff}"]}),p})()},77444:(st,z,h)=>{h.d(z,{A:()=>R});var c=h(83070),E=h(85089),x=h(12038),u=h(97140),B=h(60105),f=h(22051),k=h(31267);let R=(()=>{class F{constructor(V,P,D){this.engine=V,this.store=P,this.actionListener$=D,this.$destroy=new c.x}ngOnDestroy(){this.$destroy.next(void 0),this.$destroy.unsubscribe()}ngOnInit(){this.message=this.engine.helloWorld(),this.activeteSynchonization()}activeteSynchonization(){this.actionListener$.pipe((0,E.T)(1),(0,x.R)(this.$destroy)).subscribe(V=>{})}}return F.\u0275fac=function(V){return new(V||F)(B.Y36(u.u),B.Y36(f.yh),B.Y36(f.UO))},F.\u0275cmp=B.Xpm({type:F,selectors:[["app-tasks-engine"]],decls:1,vars:0,template:function(V,P){1&V&&B._UZ(0,"app-tasks")},directives:[k.W],styles:[""]}),F})()},9450:(st,z,h)=>{h.d(z,{c:()=>d});var c=h(41380),E=h(97140),x=h(89670),u=h(71036),B=h(16612),f=h(24817),k=h(54227),R=h(60105);let F=(()=>{class i{}return i.\u0275fac=function(_){return new(_||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[c.ez,f.qX,f.hd,B.u5]]}),i})();var $=h(22051),V=h(27565),P=h(87036),D=h(79049);const b={Task:{},SubTask:{}},I={entityHttpResourceUrls:{Task:f.iQ.URLS,SubTask:f.Mp.URLS},timeout:3e3};let C=(()=>{class i{}return i.\u0275fac=function(_){return new(_||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({providers:[{provide:D.jh,useValue:I}],imports:[[D.ov.forRoot({entityMetadata:b})]]}),i})();const M=(0,$.PH)("[tasks] sync"),Y=(0,$.PH)("[tasks] sync idle"),N=(0,$.PH)("[tasks] sync success",(0,$.Ky)()),K=(0,$.PH)("[tasks] sync problem"),w=(0,$.Lq)({syncState:"idle"},(0,$.on)(M,i=>Object.assign(Object.assign({},i),{syncState:"syncing"})),(0,$.on)(Y,i=>Object.assign(Object.assign({},i),{syncState:"idle"})),(0,$.on)(N,i=>Object.assign(Object.assign({},i),{syncState:"syncing-done"})),(0,$.on)(K,i=>Object.assign(Object.assign({},i),{syncState:"sync-problem"})));var W=h(12777);let X=(()=>{class i{constructor(_,j){this.actions$=_,this.engine=j,this.syncingDone=(0,V.GW)(()=>this.actions$.pipe((0,V.l4)(N),(0,W.U)(()=>Y())))}}return i.\u0275fac=function(_){return new(_||i)(R.LFG(V.eX),R.LFG(E.u))},i.\u0275prov=R.Yz7({token:i,factory:i.\u0275fac}),i})();const tt=[function H(i){return function(g,_){return i(g,_)}}];let q=(()=>{class i{}return i.\u0275fac=function(_){return new(_||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[$.Aw.forRoot({},{metaReducers:tt}),V.sQ.forRoot([X]),$.Aw.forFeature("appConfig",w),P.FT.instrument(),C]]}),i})(),T=(()=>{class i{}return i.\u0275fac=function(_){return new(_||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[c.ez,f.qX]]}),i})();var p=h(16246);let S=(()=>{class i{}return i.\u0275fac=function(_){return new(_||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[c.ez,B.u5,f.qX,p.m0,F,f.hd,k.JF,q,T]]}),i})(),d=(()=>{class i{static forRoot(_){return{ngModule:i,providers:[{provide:E.u,useClass:_&&_.customEngineService||E.u}]}}}return i.\u0275fac=function(_){return new(_||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({providers:[x.x,u.C,E.u],imports:[[c.ez,S]]}),i})()},97140:(st,z,h)=>{h.d(z,{u:()=>D});var c=h(58485),E=h(95991),x=h(18801),B=h(24817),f=h(4393),k=h(53030),R=h(12777),F=h(10925),$=h(89670),V=h(71036),P=h(60105);let D=(()=>{class b{constructor(C,M){this.subtasksService=C,this.tasksService=M}helloWorld(){return"Hello from ngrx/data application"}title(){return(0,f.of)('TASKS ("ngrx/data" application)')}allTasksSelector(){return this.tasksService.entities$}get isProcessingSubtaskRequestSelector(){return this.subtasksService.loading$}get isProcessingTaskRequestSelector(){return this.tasksService.loading$}allSubtasks(C){return this.subtasksService.entities$}synchonizationSateSelector(){return this.tasksService.loading$.pipe((0,k.M)(this.subtasksService.loading$),(0,R.U)(([C,M])=>C||M?"syncing":"idle"))}initAction(){var C=this;return(0,c.Z)(function*(){if(E.ZH.isWebSQL){const M=yield B.iQ.ctrl.getAll().received;C.tasksService.clearCache(),C.tasksService.addManyToCache(M.body.json)}else C.tasksService.getAll()})()}fetchSubtaskAction(C){var M=this;return(0,c.Z)(function*(){if(E.ZH.isWebSQL){const Y=yield B.Mp.ctrl.getAll(C).received;M.subtasksService.clearCache(),M.subtasksService.addManyToCache(Y.body.json)}else M.subtasksService.getWithQuery({taskId:null==C?void 0:C.toString()})})()}addTaskAction(C,M){var Y=this;return(0,c.Z)(function*(){"Enter"===C.code&&M.newTaskModel&&(yield(0,F.z)(Y.tasksService.add(B.iQ.from({name:M.newTaskModel}))),M.newTaskModel="")})()}addSubTaskAction(C,M){if(C.stopImmediatePropagation(),C.stopPropagation(),"Enter"===C.code&&M.tempSubtask){const Y=B.Mp.from({name:M.tempSubtask,taskId:M.taskId}),N=x.cloneDeep(Y);this.subtasksService.add(N),M.tempSubtask=""}}removeTaskAction(C){this.tasksService.delete({id:C})}removeSubTaskAction(C){this.subtasksService.delete(x.cloneDeep(C))}onSaveTaskAction(C,M){M=x.cloneDeep(M),x.merge(M,C),this.tasksService.update(M)}onSaveSubTaskAction(C,M){M=x.cloneDeep(M),x.merge(M,C),this.subtasksService.update(M)}toogleSubtasksAction(C,M,Y){var N=this;Y.toogled=M,setTimeout((0,c.Z)(function*(){var K,O;(M=x.cloneDeep(M)).selected=!M.selected,N.tasksService.updateManyInCache((yield(0,F.z)(N.tasksService.entities$)).map(U=>((U=x.cloneDeep(U)).selected=!1,U))),M.selected?(N.tasksService.updateOneInCache(M),null===(K=Y.drawer)||void 0===K||K.open()):null===(O=Y.drawer)||void 0===O||O.close(),C.stopPropagation()}))}}return b.\u0275fac=function(C){return new(C||b)(P.LFG($.x),P.LFG(V.C))},b.\u0275prov=P.Yz7({token:b,factory:b.\u0275fac}),b})()},89670:(st,z,h)=>{h.d(z,{x:()=>B});var c=h(24817),E=h(79049),x=h(28125),u=h(60105);let B=(()=>{class f extends E.c8{constructor(R){super(x._i.getName(c.Mp),R)}}return f.\u0275fac=function(R){return new(R||f)(u.LFG(E.yV))},f.\u0275prov=u.Yz7({token:f,factory:f.\u0275fac}),f})()},71036:(st,z,h)=>{h.d(z,{C:()=>B});var c=h(79049),E=h(28125),x=h(24817),u=h(60105);let B=(()=>{class f extends c.c8{constructor(R){super(E._i.getName(x.iQ),R)}}return f.\u0275fac=function(R){return new(R||f)(u.LFG(c.yV))},f.\u0275prov=u.Yz7({token:f,factory:f.\u0275fac}),f})()},79049:(st,z,h)=>{h.d(z,{jh:()=>ft,c8:()=>wt,yV:()=>Dt,ov:()=>me});var c=h(60105),E=h(98832),x=h(12777),u=h(46984),B=h(3747),f=h(12866),k=h(31487),R=h(64839);function F(n,e,t){let s,r=!1;return n&&"object"==typeof n?({bufferSize:s=1/0,windowTime:e=1/0,refCount:r=!1,scheduler:t}=n):s=null!=n?n:1/0,(0,R.B)({connector:()=>new k.t(s,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}var $=h(39693),V=h(6568),P=h(53030),D=h(85781),b=h(54227),I=h(40553),C=h(4393),M=h(5579),Y=h(40964),N=h(15249),K=h(12834),O=h(22051),U=h(27565);let w=(()=>{class n{create(t,s,r,a){const o="string"==typeof t?Object.assign(Object.assign({},a||{}),{entityName:t,entityOp:s,data:r}):t;return this.createCore(o)}createCore(t){const{entityName:s,entityOp:r,tag:a}=t;if(!s)throw new Error("Missing entity name for new action");if(null==r)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(r,a||s),payload:t}}createFromAction(t,s){return this.create(Object.assign(Object.assign({},t.payload),s))}formatActionType(t,s){return`[${s}] ${t}`}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class H{constructor(e,t){this.entityName=e,this.selectId=t}mustBeEntity(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should have a single entity.");const s=this.selectId(t);return this.isNotKeyType(s)&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeEntities(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const a=this.selectId(s);this.isNotKeyType(a)&&this.throwError(e,`, item ${r+1}, does not have a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entities")}mustBeKey(e){const t=this.extractData(e);if(!t)throw new Error("should be a single entity key");if(this.isNotKeyType(t))throw new Error("is not a valid key (id)");return t}mustBeKeys(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{this.isNotKeyType(s)&&this.throwError(e,`${this.entityName} ', item ${r+1}, is not a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entity keys (id)")}mustBeUpdate(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdates(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:o}=s,l=this.selectId(o);(this.isNotKeyType(a)||this.isNotKeyType(l))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}mustBeUpdateResponse(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdateResponses(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:o}=s,l=this.selectId(o);(this.isNotKeyType(a)||this.isNotKeyType(l))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}extractData(e){return e.payload&&e.payload.data}isNotKeyType(e){return"string"!=typeof e&&"number"!=typeof e}throwError(e,t){throw new Error(`${this.entityName} EntityAction guard for "${e.type}": payload ${t}`)}}function W(n){return null==n?void 0:n.id}function X(n){if(null==n)return[];if(Array.isArray(n[0])){const[e,...t]=n;n=[...e,...t]}return n}function tt(n){return n=n||W,function(t){const s=n(t);if(null==s)throw new Error("Primary key may not be null/undefined.");return t&&{id:s,changes:t}}}function q(...n){const e=X(n);switch(e.length){case 0:return(0,E.h)(s=>s.payload&&null!=s.payload.entityOp);case 1:const t=e[0];return(0,E.h)(s=>s.payload&&t===s.payload.entityOp);default:return(0,E.h)(s=>{const r=s.payload&&s.payload.entityOp;return r&&e.some(a=>a===r)})}}function T(...n){const e=X(n);switch(e.length){case 0:return(0,E.h)(s=>s.payload&&null!=s.payload.entityName);case 1:const t=e[0];return(0,E.h)(s=>s.payload&&t===s.payload.entityName);default:return(0,E.h)(s=>{const r=s.payload&&s.payload.entityName;return!!r&&e.some(a=>a===r)})}}var p=(()=>{return(n=p||(p={})).Add="Add",n.Delete="Delete",n.Update="Update",n.Upsert="Upsert",p;var n})();function i(n){const e=(n=n&&n.changes?n:{changes:[]}).changes.filter(t=>null!=t&&t.entities&&t.entities.length>0);return Object.assign(Object.assign({},n),{changes:e})}new class S{add(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:p.Add,entities:t}}delete(e,t){const s=Array.isArray(t)?t:t?[t]:[];return{entityName:e,op:p.Delete,entities:s}}update(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:p.Update,entities:t}}upsert(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:p.Upsert,entities:t}}};var g=(()=>{return(n=g||(g={}))[n.IgnoreChanges=0]="IgnoreChanges",n[n.PreserveChanges=1]="PreserveChanges",n[n.OverwriteChanges=2]="OverwriteChanges",g;var n})(),_=(()=>{return(n=_||(_={})).CLEAR_COLLECTIONS="@ngrx/data/entity-cache/clear-collections",n.LOAD_COLLECTIONS="@ngrx/data/entity-cache/load-collections",n.MERGE_QUERY_SET="@ngrx/data/entity-cache/merge-query-set",n.SET_ENTITY_CACHE="@ngrx/data/entity-cache/set-cache",n.SAVE_ENTITIES="@ngrx/data/entity-cache/save-entities",n.SAVE_ENTITIES_CANCEL="@ngrx/data/entity-cache/save-entities-cancel",n.SAVE_ENTITIES_CANCELED="@ngrx/data/entity-cache/save-entities-canceled",n.SAVE_ENTITIES_ERROR="@ngrx/data/entity-cache/save-entities-error",n.SAVE_ENTITIES_SUCCESS="@ngrx/data/entity-cache/save-entities-success",_;var n})();class j{constructor(e,t){this.type=_.CLEAR_COLLECTIONS,this.payload={collections:e,tag:t}}}class J{constructor(e,t){this.type=_.LOAD_COLLECTIONS,this.payload={collections:e,tag:t}}}class nt{constructor(e,t,s){this.type=_.MERGE_QUERY_SET,this.payload={querySet:e,mergeStrategy:null===t?g.PreserveChanges:t,tag:s}}}class yt{constructor(e,t){this.cache=e,this.type=_.SET_ENTITY_CACHE,this.payload={cache:e,tag:t}}}class Ht{constructor(e,t,s){this.type=_.SAVE_ENTITIES,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}class Zt{constructor(e,t,s,r){this.type=_.SAVE_ENTITIES_CANCEL,this.payload={correlationId:e,reason:t,entityNames:s,tag:r}}}class Jt{constructor(e,t,s){this.type=_.SAVE_ENTITIES_CANCELED,this.payload={correlationId:e,reason:t,tag:s}}}class Xt{constructor(e,t){this.type=_.SAVE_ENTITIES_ERROR,this.payload={error:e,originalAction:t,correlationId:t.payload.correlationId}}}class pt{constructor(e,t,s){this.type=_.SAVE_ENTITIES_SUCCESS,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}var y=(()=>{return(n=y||(y={})).CANCEL_PERSIST="@ngrx/data/cancel-persist",n.CANCELED_PERSIST="@ngrx/data/canceled-persist",n.QUERY_ALL="@ngrx/data/query-all",n.QUERY_ALL_SUCCESS="@ngrx/data/query-all/success",n.QUERY_ALL_ERROR="@ngrx/data/query-all/error",n.QUERY_LOAD="@ngrx/data/query-load",n.QUERY_LOAD_SUCCESS="@ngrx/data/query-load/success",n.QUERY_LOAD_ERROR="@ngrx/data/query-load/error",n.QUERY_MANY="@ngrx/data/query-many",n.QUERY_MANY_SUCCESS="@ngrx/data/query-many/success",n.QUERY_MANY_ERROR="@ngrx/data/query-many/error",n.QUERY_BY_KEY="@ngrx/data/query-by-key",n.QUERY_BY_KEY_SUCCESS="@ngrx/data/query-by-key/success",n.QUERY_BY_KEY_ERROR="@ngrx/data/query-by-key/error",n.SAVE_ADD_MANY="@ngrx/data/save/add-many",n.SAVE_ADD_MANY_ERROR="@ngrx/data/save/add-many/error",n.SAVE_ADD_MANY_SUCCESS="@ngrx/data/save/add-many/success",n.SAVE_ADD_ONE="@ngrx/data/save/add-one",n.SAVE_ADD_ONE_ERROR="@ngrx/data/save/add-one/error",n.SAVE_ADD_ONE_SUCCESS="@ngrx/data/save/add-one/success",n.SAVE_DELETE_MANY="@ngrx/data/save/delete-many",n.SAVE_DELETE_MANY_SUCCESS="@ngrx/data/save/delete-many/success",n.SAVE_DELETE_MANY_ERROR="@ngrx/data/save/delete-many/error",n.SAVE_DELETE_ONE="@ngrx/data/save/delete-one",n.SAVE_DELETE_ONE_SUCCESS="@ngrx/data/save/delete-one/success",n.SAVE_DELETE_ONE_ERROR="@ngrx/data/save/delete-one/error",n.SAVE_UPDATE_MANY="@ngrx/data/save/update-many",n.SAVE_UPDATE_MANY_SUCCESS="@ngrx/data/save/update-many/success",n.SAVE_UPDATE_MANY_ERROR="@ngrx/data/save/update-many/error",n.SAVE_UPDATE_ONE="@ngrx/data/save/update-one",n.SAVE_UPDATE_ONE_SUCCESS="@ngrx/data/save/update-one/success",n.SAVE_UPDATE_ONE_ERROR="@ngrx/data/save/update-one/error",n.SAVE_UPSERT_MANY="@ngrx/data/save/upsert-many",n.SAVE_UPSERT_MANY_SUCCESS="@ngrx/data/save/upsert-many/success",n.SAVE_UPSERT_MANY_ERROR="@ngrx/data/save/upsert-many/error",n.SAVE_UPSERT_ONE="@ngrx/data/save/upsert-one",n.SAVE_UPSERT_ONE_SUCCESS="@ngrx/data/save/upsert-one/success",n.SAVE_UPSERT_ONE_ERROR="@ngrx/data/save/upsert-one/error",n.ADD_ALL="@ngrx/data/add-all",n.ADD_MANY="@ngrx/data/add-many",n.ADD_ONE="@ngrx/data/add-one",n.REMOVE_ALL="@ngrx/data/remove-all",n.REMOVE_MANY="@ngrx/data/remove-many",n.REMOVE_ONE="@ngrx/data/remove-one",n.UPDATE_MANY="@ngrx/data/update-many",n.UPDATE_ONE="@ngrx/data/update-one",n.UPSERT_MANY="@ngrx/data/upsert-many",n.UPSERT_ONE="@ngrx/data/upsert-one",n.COMMIT_ALL="@ngrx/data/commit-all",n.COMMIT_MANY="@ngrx/data/commit-many",n.COMMIT_ONE="@ngrx/data/commit-one",n.UNDO_ALL="@ngrx/data/undo-all",n.UNDO_MANY="@ngrx/data/undo-many",n.UNDO_ONE="@ngrx/data/undo-one",n.SET_CHANGE_STATE="@ngrx/data/set-change-state",n.SET_COLLECTION="@ngrx/data/set-collection",n.SET_FILTER="@ngrx/data/set-filter",n.SET_LOADED="@ngrx/data/set-loaded",n.SET_LOADING="@ngrx/data/set-loading",y;var n})();const gt="/success",Et="/error";function Tt(n){return n+gt}class rt{constructor(e,t){this.error=e,this.requestData=t,this.message="string"==typeof e?e:function te(n){const{error:e,body:t,message:s}=n;let r=null;return e?r="string"==typeof e?e:e.message:s?r=s:t&&(r="string"==typeof t?t:t.error),"string"==typeof r?r:r?JSON.stringify(r):null}(e)}}class ft{}class ct{}const _t=new c.OlP("@ngrx/data Plural Names");class kt{}class bt{}let ee=(()=>{class n{constructor(t){this.pluralizer=t,this.knownHttpResourceUrls={}}getResourceUrls(t,s){let r=this.knownHttpResourceUrls[t];if(!r){const a=function se(n){return n.replace(/^[/\s]+|[/\s]+$/g,"")}(s);r={entityResourceUrl:`${a}/${t}/`.toLowerCase(),collectionResourceUrl:`${a}/${this.pluralizer.pluralize(t)}/`.toLowerCase()},this.registerHttpResourceUrls({[t]:r})}return r}entityResource(t,s){return this.getResourceUrls(t,s).entityResourceUrl}collectionResource(t,s){return this.getResourceUrls(t,s).collectionResourceUrl}registerHttpResourceUrls(t){this.knownHttpResourceUrls=Object.assign(Object.assign({},this.knownHttpResourceUrls),t||{})}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(kt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class ne{constructor(e,t,s,r){this.http=t,this.httpUrlGenerator=s,this.getDelay=0,this.saveDelay=0,this.timeout=0,this._name=`${e} DefaultDataService`,this.entityName=e;const{root:a="api",delete404OK:o=!0,getDelay:l=0,saveDelay:m=0,timeout:v=0}=r||{};this.delete404OK=o,this.entityUrl=s.entityResource(e,a),this.entitiesUrl=s.collectionResource(e,a),this.getDelay=l,this.saveDelay=m,this.timeout=v}get name(){return this._name}add(e){const t=e||new Error(`No "${this.entityName}" entity to add`);return this.execute("POST",this.entityUrl,t)}delete(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to delete`)),this.execute("DELETE",this.entityUrl+e,t).pipe((0,x.U)(s=>e))}getAll(){return this.execute("GET",this.entitiesUrl)}getById(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to get`)),this.execute("GET",this.entityUrl+e,t)}getWithQuery(e){const s=new b.LE("string"==typeof e?{fromString:e}:{fromObject:e});return this.execute("GET",this.entitiesUrl,void 0,{params:s})}update(e){const t=e&&e.id,s=null==t?new Error(`No "${this.entityName}" update data or id`):e.changes;return this.execute("PUT",this.entityUrl+t,s)}upsert(e){const t=e||new Error(`No "${this.entityName}" entity to upsert`);return this.execute("POST",this.entityUrl,t)}execute(e,t,s,r){const a={method:e,url:t,data:s,options:r};if(s instanceof Error)return this.handleError(a)(s);let o;switch(e){case"DELETE":o=this.http.delete(t,r),this.saveDelay&&(o=o.pipe((0,u.g)(this.saveDelay)));break;case"GET":o=this.http.get(t,r),this.getDelay&&(o=o.pipe((0,u.g)(this.getDelay)));break;case"POST":o=this.http.post(t,s,r),this.saveDelay&&(o=o.pipe((0,u.g)(this.saveDelay)));break;case"PUT":o=this.http.put(t,s,r),this.saveDelay&&(o=o.pipe((0,u.g)(this.saveDelay)));break;default:{const l=new Error("Unimplemented HTTP method, "+e);o=(0,I._)(l)}}return this.timeout&&(o=o.pipe((0,B.V)(this.timeout+this.saveDelay))),o.pipe((0,f.K)(this.handleError(a)))}handleError(e){return t=>{const s=this.handleDelete404(t,e);if(s)return s;const r=new rt(t,e);return(0,I._)(r)}}handleDelete404(e,t){if(404===e.status&&"DELETE"===t.method&&this.delete404OK)return(0,C.of)({})}}let Rt=(()=>{class n{constructor(t,s,r){this.http=t,this.httpUrlGenerator=s,this.config=r,s.registerHttpResourceUrls((r=r||{}).entityHttpResourceUrls)}create(t){return new ne(t,this.http,this.httpUrlGenerator,this.config)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(b.eN),c.LFG(bt),c.LFG(ft,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const Ut=new c.OlP("@ngrx/data Entity Metadata");let at=(()=>{class n{constructor(t){this.definitions={},t&&t.forEach(s=>this.registerMetadataMap(s))}getDefinition(t,s=!0){t=t.trim();const r=this.definitions[t];if(!r&&s)throw new Error(`No EntityDefinition for entity type "${t}".`);return r}registerMetadata(t){if(t){const s=function re(n){let e=n.entityName;if(!e)throw new Error("Missing required entityName");n.entityName=e=e.trim();const t=n.selectId||W,s=n.sortComparer=n.sortComparer||!1,r=(0,K.H)({selectId:t,sortComparer:s}),a=n.entityDispatcherOptions||{},o=r.getInitialState(Object.assign({entityName:e,filter:"",loaded:!1,loading:!1,changeState:{}},n.additionalCollectionState||{}));return{entityName:e,entityAdapter:r,entityDispatcherOptions:a,initialState:o,metadata:n,noChangeTracking:!0===n.noChangeTracking,selectId:t,sortComparer:s}}(t);this.registerDefinition(s)}}registerMetadataMap(t={}){Object.keys(t||{}).forEach(s=>this.registerMetadata(Object.assign({entityName:s},t[s])))}registerDefinition(t){this.definitions[t.entityName]=t}registerDefinitions(t){Object.assign(this.definitions,t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Ut,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const Lt=p.Update;let xt=(()=>{class n{constructor(t,s,r){this.entityDefinitionService=t,this.http=s,this.idSelectors={},this.saveDelay=0,this.timeout=0;const{saveDelay:a=0,timeout:o=0}=r||{};this.saveDelay=a,this.timeout=o}saveEntities(t,s){t=this.filterChangeSet(t),t=this.flattenUpdates(t);let r=this.http.post(s,t).pipe((0,x.U)(a=>this.restoreUpdates(a)),(0,f.K)(this.handleError({method:"POST",url:s,data:t})));return this.timeout&&(r=r.pipe((0,B.V)(this.timeout))),this.saveDelay&&(r=r.pipe((0,u.g)(this.saveDelay))),r}handleError(t){return s=>{const r=new rt(s,t);return(0,I._)(r)}}filterChangeSet(t){return i(t)}flattenUpdates(t){let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>a.op===Lt&&a.entities.length>0?(r=!0,Object.assign(Object.assign({},a),{entities:a.entities.map(o=>o.changes)})):a),r?Object.assign(Object.assign({},t),{changes:s}):t}restoreUpdates(t){if(null==t)return t;let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>{if(a.op===Lt){r=!0;const o=this.getIdSelector(a.entityName);return Object.assign(Object.assign({},a),{entities:a.entities.map(l=>({id:o(l),changes:l}))})}return a}),r?Object.assign(Object.assign({},t),{changes:s}):t}getIdSelector(t){let s=this.idSelectors[t];return s||(s=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=s),s}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(at),c.LFG(b.eN),c.LFG(ft,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Nt=(()=>{class n{constructor(t){this.defaultDataServiceFactory=t,this.services={}}getService(t){t=t.trim();let s=this.services[t];return s||(s=this.defaultDataServiceFactory.create(t),this.services[t]=s),s}registerService(t,s){this.services[t.trim()]=s}registerServices(t){this.services=Object.assign(Object.assign({},this.services),t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Rt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class It{}let ae=(()=>{class n{constructor(t,s){this.logger=t,this.entityActionFactory=s}handleSuccess(t){const s=Tt(t.payload.entityOp);return r=>this.entityActionFactory.createFromAction(t,{entityOp:s,data:r})}handleError(t){const s=function qt(n){return n+Et}(t.payload.entityOp);return r=>{const o={error:r instanceof rt?r:new rt(r,null),originalAction:t};return this.logger.error(o),this.entityActionFactory.createFromAction(t,{entityOp:s,data:o})}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(ct),c.LFG(w))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class Ft{constructor(e){this.message=e,this.message=e||"Canceled by user"}}let St=(()=>{class n{constructor(){this.seed=0,this.prefix="CRID"}next(){return this.seed+=1,this.prefix+this.seed}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),vt=(()=>{class n{constructor(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),ie=(()=>{class n{constructor(t,s,r,a){this.correlationIdGenerator=t,this.defaultDispatcherOptions=s,this.store=a,this.reducedActions$=r.pipe(F(1)),this.raSubscription=this.reducedActions$.subscribe()}dispatch(t){return this.store.dispatch(t),t}cancelSaveEntities(t,s,r,a){if(!t)throw new Error("Missing correlationId");const o=new Zt(t,s,r,a);this.dispatch(o)}clearCollections(t,s){this.dispatch(new j(t,s))}loadCollections(t,s){this.dispatch(new J(t,s))}mergeQuerySet(t,s,r){this.dispatch(new nt(t,s,r))}setEntityCache(t,s){this.dispatch(new yt(t,s))}saveEntities(t,s,r){const a=Array.isArray(t)?{changes:t}:t,o=null==(r=r||{}).correlationId?this.correlationIdGenerator.next():r.correlationId,l=null==r.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===r.isOptimistic,m=r.tag||"Save Entities";r=Object.assign(Object.assign({},r),{correlationId:o,isOptimistic:l,tag:m});const v=new Ht(a,s,r);return this.dispatch(v),this.getSaveEntitiesResponseData$(r.correlationId).pipe(F(1))}getSaveEntitiesResponseData$(t){return this.reducedActions$.pipe((0,E.h)(s=>s.type===_.SAVE_ENTITIES_SUCCESS||s.type===_.SAVE_ENTITIES_ERROR||s.type===_.SAVE_ENTITIES_CANCEL),(0,E.h)(s=>t===s.payload.correlationId),(0,$.q)(1),(0,V.z)(s=>s.type===_.SAVE_ENTITIES_CANCEL?(0,I._)(new Ft(s.payload.reason)):s.type===_.SAVE_ENTITIES_SUCCESS?(0,C.of)(s.payload.changeSet):(0,I._)(s.payload)))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(St),c.LFG(vt),c.LFG(O.Y$),c.LFG(O.yh))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class oe{constructor(e,t,s,r=W,a,o,l,m){this.entityName=e,this.entityActionFactory=t,this.store=s,this.selectId=r,this.defaultDispatcherOptions=a,this.reducedActions$=o,this.correlationIdGenerator=m,this.guard=new H(e,r),this.toUpdate=tt(r);const v=(0,O.P1)(l,A=>A[e]);this.entityCollection$=s.select(v)}createEntityAction(e,t,s){return this.entityActionFactory.create(Object.assign({entityName:this.entityName,entityOp:e,data:t},s))}createAndDispatch(e,t,s){const r=this.createEntityAction(e,t,s);return this.dispatch(r),r}dispatch(e){return this.store.dispatch(e),e}add(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticAdd);const s=this.createEntityAction(y.SAVE_ADD_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,x.U)(([r,a])=>a.entities[this.selectId(r)]),F(1))}cancel(e,t,s){if(!e)throw new Error("Missing correlationId");this.createAndDispatch(y.CANCEL_PERSIST,t,{correlationId:e})}delete(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticDelete);const s=this.getKey(e),r=this.createEntityAction(y.SAVE_DELETE_ONE,s,t);return this.guard.mustBeKey(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,x.U)(()=>s),F(1))}getAll(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(y.QUERY_ALL,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe((0,P.M)(this.entityCollection$),(0,x.U)(([s,r])=>s.reduce((a,o)=>{const l=r.entities[this.selectId(o)];return l&&a.push(l),a},[])),F(1))}getByKey(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(y.QUERY_BY_KEY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,x.U)(([r,a])=>a.entities[this.selectId(r)]),F(1))}getWithQuery(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(y.QUERY_MANY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,x.U)(([r,a])=>r.reduce((o,l)=>{const m=a.entities[this.selectId(l)];return m&&o.push(m),o},[])),F(1))}load(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(y.QUERY_LOAD,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(F(1))}update(e,t){const s=this.toUpdate(e);t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpdate);const r=this.createEntityAction(y.SAVE_UPDATE_ONE,s,t);return t.isOptimistic&&this.guard.mustBeUpdate(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,x.U)(a=>a.changes),(0,P.M)(this.entityCollection$),(0,x.U)(([a,o])=>o.entities[this.selectId(a)]),F(1))}upsert(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpsert);const s=this.createEntityAction(y.SAVE_UPSERT_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,x.U)(([r,a])=>a.entities[this.selectId(r)]),F(1))}addAllToCache(e,t){this.createAndDispatch(y.ADD_ALL,e,t)}addOneToCache(e,t){this.createAndDispatch(y.ADD_ONE,e,t)}addManyToCache(e,t){this.createAndDispatch(y.ADD_MANY,e,t)}clearCache(e){this.createAndDispatch(y.REMOVE_ALL,void 0,e)}removeOneFromCache(e,t){this.createAndDispatch(y.REMOVE_ONE,this.getKey(e),t)}removeManyFromCache(e,t){if(!e||0===e.length)return;const s="object"==typeof e[0]?e.map(r=>this.getKey(r)):e;this.createAndDispatch(y.REMOVE_MANY,s,t)}updateOneInCache(e,t){const s=this.toUpdate(e);this.createAndDispatch(y.UPDATE_ONE,s,t)}updateManyInCache(e,t){if(!e||0===e.length)return;const s=e.map(r=>this.toUpdate(r));this.createAndDispatch(y.UPDATE_MANY,s,t)}upsertOneInCache(e,t){this.createAndDispatch(y.UPSERT_ONE,e,t)}upsertManyInCache(e,t){!e||0===e.length||this.createAndDispatch(y.UPSERT_MANY,e,t)}setFilter(e){this.createAndDispatch(y.SET_FILTER,e)}setLoaded(e){this.createAndDispatch(y.SET_LOADED,!!e)}setLoading(e){this.createAndDispatch(y.SET_LOADING,!!e)}getKey(e){return"object"==typeof e?this.selectId(e):e}getResponseData$(e){return this.reducedActions$.pipe((0,E.h)(t=>!!t.payload),(0,E.h)(t=>{const{correlationId:s,entityName:r,entityOp:a}=t.payload;return r===this.entityName&&s===e&&(a.endsWith(gt)||a.endsWith(Et)||a===y.CANCEL_PERSIST)}),(0,$.q)(1),(0,V.z)(t=>{const{entityOp:s}=t.payload;return s===y.CANCEL_PERSIST?(0,I._)(new Ft(t.payload.data)):s.endsWith(gt)?(0,C.of)(t.payload.data):(0,I._)(t.payload.data.error)}))}setQueryEntityActionOptions(e){const t=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId;return Object.assign(Object.assign({},e),{correlationId:t})}setSaveEntityActionOptions(e,t){const s=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId,r=null==e.isOptimistic?t||!1:!0===e.isOptimistic;return Object.assign(Object.assign({},e),{correlationId:s,isOptimistic:r})}}const dt="entityCache",mt=new c.OlP("@ngrx/data Entity Cache Name"),At=new c.OlP("@ngrx/data Entity Cache Meta Reducers"),Ct=new c.OlP("@ngrx/data Entity Collection Meta Reducers"),ce=new c.OlP("@ngrx/data Initial Entity Cache State"),ut=new c.OlP("@ngrx/data Entity Cache Selector"),de={provide:ut,useFactory:Pt,deps:[[new c.FiY,mt]]};function Pt(n){return(0,O.ZF)(n=n||dt)}let Ot=(()=>{class n{constructor(t,s,r,a,o,l){this.entityActionFactory=t,this.store=s,this.entityDispatcherDefaultOptions=r,this.entityCacheSelector=o,this.correlationIdGenerator=l,this.reducedActions$=a.pipe(F(1)),this.raSubscription=this.reducedActions$.subscribe()}create(t,s=W,r={}){const a=Object.assign(Object.assign({},this.entityDispatcherDefaultOptions),r);return new oe(t,this.entityActionFactory,this.store,s,a,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)}ngOnDestroy(){this.raSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(w),c.LFG(O.yh),c.LFG(vt),c.LFG(O.Y$),c.LFG(ut),c.LFG(St))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const Yt=new c.OlP("@ngrx/data Entity Effects Scheduler");let jt=(()=>{class n{constructor(t,s,r,a,o){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.logger=a,this.scheduler=o,this.responseDelay=10,this.saveEntitiesCancel$=(0,U.GW)(()=>this.actions.pipe((0,U.l4)(_.SAVE_ENTITIES_CANCEL),(0,E.h)(l=>null!=l.payload.correlationId)),{dispatch:!1}),this.saveEntities$=(0,U.GW)(()=>this.actions.pipe((0,U.l4)(_.SAVE_ENTITIES),(0,V.z)(l=>this.saveEntities(l))))}saveEntities(t){const s=t.payload.error;if(s)return this.handleSaveEntitiesError$(t)(s);try{const r=i(t.payload.changeSet),{correlationId:a,mergeStrategy:o,tag:l,url:m}=t.payload,v={correlationId:a,mergeStrategy:o,tag:l};if(0===r.changes.length)return(0,C.of)(new pt(r,m,v));const A=this.saveEntitiesCancel$.pipe((0,E.h)(G=>a===G.payload.correlationId),(0,x.U)(G=>new Jt(a,G.payload.reason,G.payload.tag))),L=this.dataService.saveEntities(r,m).pipe((0,D.b)(G=>this.handleSaveEntitiesSuccess$(t,this.entityActionFactory)(G)),(0,f.K)(this.handleSaveEntitiesError$(t)));return(0,M.S)(A,L)}catch(r){return this.handleSaveEntitiesError$(t)(r)}}handleSaveEntitiesError$(t){return s=>{const r=s instanceof rt?s:new rt(s,null);return(0,C.of)(new Xt(r,t)).pipe((0,u.g)(this.responseDelay,this.scheduler||Y.z))}}handleSaveEntitiesSuccess$(t,s){const{url:r,correlationId:a,mergeStrategy:o,tag:l}=t.payload,m={correlationId:a,mergeStrategy:o,tag:l};return v=>{if(v)return(0,C.of)(new pt(v,r,m));if(v=t.payload.changeSet,!t.payload.isOptimistic)return(0,C.of)(new pt(v,r,m));const A=v.changes.reduce((L,G)=>-1===L.indexOf(G.entityName)?L.concat(G.entityName):L,[]);return(0,N.T)(A.map(L=>s.create(L,y.SET_LOADING,!1)))}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(U.eX),c.LFG(xt),c.LFG(w),c.LFG(ct),c.LFG(Yt,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const ue=[y.QUERY_ALL,y.QUERY_LOAD,y.QUERY_BY_KEY,y.QUERY_MANY,y.SAVE_ADD_ONE,y.SAVE_DELETE_ONE,y.SAVE_UPDATE_ONE,y.SAVE_UPSERT_ONE];let $t=(()=>{class n{constructor(t,s,r,a,o){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.resultHandler=a,this.scheduler=o,this.responseDelay=10,this.cancel$=(0,U.GW)(()=>this.actions.pipe(q(y.CANCEL_PERSIST),(0,x.U)(l=>l.payload.correlationId),(0,E.h)(l=>null!=l)),{dispatch:!1}),this.persist$=(0,U.GW)(()=>this.actions.pipe(q(ue),(0,V.z)(l=>this.persist(l))))}persist(t){if(t.payload.skip)return this.handleSkipSuccess$(t);if(t.payload.error)return this.handleError$(t)(t.payload.error);try{const s=this.cancel$.pipe((0,E.h)(a=>t.payload.correlationId===a),(0,x.U)(a=>this.entityActionFactory.createFromAction(t,{entityOp:y.CANCELED_PERSIST}))),r=this.callDataService(t).pipe((0,x.U)(this.resultHandler.handleSuccess(t)),(0,f.K)(this.handleError$(t)));return(0,M.S)(s,r)}catch(s){return this.handleError$(t)(s)}}callDataService(t){const{entityName:s,entityOp:r,data:a}=t.payload,o=this.dataService.getService(s);switch(r){case y.QUERY_ALL:case y.QUERY_LOAD:return o.getAll();case y.QUERY_BY_KEY:return o.getById(a);case y.QUERY_MANY:return o.getWithQuery(a);case y.SAVE_ADD_ONE:return o.add(a);case y.SAVE_DELETE_ONE:return o.delete(a);case y.SAVE_UPDATE_ONE:const{id:l,changes:m}=a;return o.update(a).pipe((0,x.U)(v=>v&&Object.keys(v).length>0?{id:l,changes:Object.assign(Object.assign({},m),v),changed:!0}:{id:l,changes:m,changed:!1}));case y.SAVE_UPSERT_ONE:return o.upsert(a).pipe((0,x.U)(v=>v&&Object.keys(v).length>0?v:a));default:throw new Error(`Persistence action "${r}" is not implemented.`)}}handleError$(t){return s=>(0,C.of)(this.resultHandler.handleError(t)(s)).pipe((0,u.g)(this.responseDelay,this.scheduler||Y.z))}handleSkipSuccess$(t){const s=Tt(t.payload.entityOp),r=this.entityActionFactory.createFromAction(t,{entityOp:s});return(0,C.of)(r).pipe((0,u.g)(this.responseDelay,this.scheduler||Y.z))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(U.eX),c.LFG(Nt),c.LFG(w),c.LFG(It),c.LFG(Yt,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class wt{constructor(e,t){this.entityName=e,e=e.trim();const{dispatcher:s,selectors:r,selectors$:a}=t.create(e);this.entityName=e,this.dispatcher=s,this.guard=s.guard,this.selectId=s.selectId,this.toUpdate=s.toUpdate,this.selectors=r,this.selectors$=a,this.collection$=a.collection$,this.count$=a.count$,this.entities$=a.entities$,this.entityActions$=a.entityActions$,this.entityMap$=a.entityMap$,this.errors$=a.errors$,this.filter$=a.filter$,this.filteredEntities$=a.filteredEntities$,this.keys$=a.keys$,this.loaded$=a.loaded$,this.loading$=a.loading$,this.changeState$=a.changeState$}createEntityAction(e,t,s){return this.dispatcher.createEntityAction(e,t,s)}createAndDispatch(e,t,s){return this.dispatcher.createAndDispatch(e,t,s)}dispatch(e){return this.dispatcher.dispatch(e)}get store(){return this.dispatcher.store}add(e,t){return this.dispatcher.add(e,t)}cancel(e,t,s){this.dispatcher.cancel(e,t,s)}delete(e,t){return this.dispatcher.delete(e,t)}getAll(e){return this.dispatcher.getAll(e)}getByKey(e,t){return this.dispatcher.getByKey(e,t)}getWithQuery(e,t){return this.dispatcher.getWithQuery(e,t)}load(e){return this.dispatcher.load(e)}update(e,t){return this.dispatcher.update(e,t)}upsert(e,t){return this.dispatcher.upsert(e,t)}addAllToCache(e,t){this.dispatcher.addAllToCache(e,t)}addOneToCache(e,t){this.dispatcher.addOneToCache(e,t)}addManyToCache(e,t){this.dispatcher.addManyToCache(e,t)}clearCache(){this.dispatcher.clearCache()}removeOneFromCache(e,t){this.dispatcher.removeOneFromCache(e,t)}removeManyFromCache(e,t){this.dispatcher.removeManyFromCache(e,t)}updateOneInCache(e,t){this.dispatcher.updateOneInCache(e,t)}updateManyInCache(e,t){this.dispatcher.updateManyInCache(e,t)}upsertOneInCache(e,t){this.dispatcher.upsertOneInCache(e,t)}upsertManyInCache(e,t){this.dispatcher.upsertManyInCache(e,t)}setFilter(e){this.dispatcher.setFilter(e)}setLoaded(e){this.dispatcher.setLoaded(!!e)}setLoading(e){this.dispatcher.setLoading(!!e)}}let ht=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return s&&s.initialState||function he(n){return{entityName:n,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}(t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(at,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Bt=(()=>{class n{constructor(t,s){this.entityCollectionCreator=t||new ht,this.selectEntityCache=s||Pt(dt)}createCollectionSelector(t){return(0,O.P1)(this.selectEntityCache,(r={})=>r[t]||this.entityCollectionCreator.create(t))}createCollectionSelectors(t){const s="string"==typeof t?{entityName:t}:t,r=Q=>Q.ids,a=Q=>Q.entities,o=(0,O.P1)(r,a,(Q,ot)=>Q.map(Ae=>ot[Ae])),l=(0,O.P1)(r,Q=>Q.length),m=Q=>Q.filter,v=s.filterFn,A=v?(0,O.P1)(o,m,(Q,ot)=>v(Q,ot)):o,it={};return Object.keys(s.additionalCollectionState||{}).forEach(Q=>{it["select"+Q[0].toUpperCase()+Q.slice(1)]=ot=>ot[Q]}),Object.assign({selectCount:l,selectEntities:o,selectEntityMap:a,selectFilter:m,selectFilteredEntities:A,selectKeys:r,selectLoaded:Q=>Q.loaded,selectLoading:Q=>Q.loading,selectChangeState:Q=>Q.changeState},it)}create(t){const s="string"==typeof t?{entityName:t}:t,r=s.entityName,a=this.createCollectionSelector(r),o=this.createCollectionSelectors(s),l={};return Object.keys(o).forEach(m=>{l[m]=(0,O.P1)(a,o[m])}),Object.assign({entityName:r,selectCollection:a,selectEntityCache:this.selectEntityCache},l)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(ht,8),c.LFG(ut,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Mt=(()=>{class n{constructor(t,s,r){this.store=t,this.actions=s,this.selectEntityCache=r,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=s.pipe((0,E.h)(a=>a.payload&&a.payload.entityOp&&a.payload.entityOp.endsWith(Et)),F(1))}create(t,s){const r={entityName:t};return Object.keys(s).forEach(a=>{if(a.startsWith("select")){const o=a[6].toLowerCase()+a.substr(7)+"$";r[o]=this.store.select(s[a])}}),r.entityActions$=this.actions.pipe(T(t)),r.errors$=this.entityActionErrors$.pipe(T(t)),r}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(O.yh),c.LFG(U.eX),c.LFG(ut))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Dt=(()=>{class n{constructor(t,s,r,a){this.entityDispatcherFactory=t,this.entityDefinitionService=s,this.entitySelectorsFactory=r,this.entitySelectors$Factory=a}create(t){t=t.trim();const s=this.entityDefinitionService.getDefinition(t),r=this.entityDispatcherFactory.create(t,s.selectId,s.entityDispatcherOptions),a=this.entitySelectorsFactory.create(s.metadata);return{dispatcher:r,entityName:t,selectors:a,selectors$:this.entitySelectors$Factory.create(t,a)}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Ot),c.LFG(at),c.LFG(Bt),c.LFG(Mt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Vt=(()=>{class n{constructor(t){this.entityCollectionServiceElementsFactory=t}create(t){return new wt(t,this.entityCollectionServiceElementsFactory)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Dt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Gt=(()=>{class n{constructor(t,s,r,a){this.entityCollectionServiceFactory=t,this.store=a,this.entityActionErrors$=r.entityActionErrors$,this.entityCache$=r.entityCache$,this.reducedActions$=s.reducedActions$}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Vt),c.LFG(Ot),c.LFG(Mt),c.LFG(O.yh))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),le=(()=>{class n{constructor(t){this.entityServicesElements=t,this.EntityCollectionServices={}}get entityActionErrors$(){return this.entityServicesElements.entityActionErrors$}get entityCache$(){return this.entityServicesElements.entityCache$}get entityCollectionServiceFactory(){return this.entityServicesElements.entityCollectionServiceFactory}get reducedActions$(){return this.entityServicesElements.reducedActions$}get store(){return this.entityServicesElements.store}dispatch(t){this.store.dispatch(t)}createEntityCollectionService(t){return this.entityCollectionServiceFactory.create(t)}getEntityCollectionService(t){let s=this.EntityCollectionServices[t];return s||(s=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=s),s}registerEntityCollectionService(t,s){this.EntityCollectionServices[s||t.entityName]=t}registerEntityCollectionServices(t){Array.isArray(t)?t.forEach(s=>this.registerEntityCollectionService(s)):Object.keys(t||{}).forEach(s=>{this.registerEntityCollectionService(t[s],s)})}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Gt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class ye{}var Z=(()=>{return(n=Z||(Z={}))[n.Unchanged=0]="Unchanged",n[n.Added=1]="Added",n[n.Deleted=2]="Deleted",n[n.Updated=3]="Updated",Z;var n})();class pe{constructor(e,t){this.adapter=e,this.selectId=t,this.selectId=t||W}commitAll(e){return 0===Object.keys(e.changeState).length?e:Object.assign(Object.assign({},e),{changeState:{}})}commitMany(e,t){if(null==e||0===e.length)return t;let s=!1;const r=e.reduce((a,o)=>{const l="object"==typeof o?this.selectId(o):o;return a[l]&&(s||(a=Object.assign({},a),s=!0),delete a[l]),a},t.changeState);return s?Object.assign(Object.assign({},t),{changeState:r}):t}commitOne(e,t){return null==e?t:this.commitMany([e],t)}mergeQueryResults(e,t,s){return this.mergeServerUpserts(e,t,g.PreserveChanges,s)}mergeSaveAdds(e,t,s){return this.mergeServerUpserts(e,t,g.OverwriteChanges,s)}mergeSaveDeletes(e,t,s){const r=e;return t=(s=null==s?g.OverwriteChanges:s)===g.IgnoreChanges?t:this.commitMany(r,t),this.adapter.removeMany(r,t)}mergeSaveUpdates(e,t,s,r=!1){if(null==e||0===e.length)return t;let l,a=!1,o=t.changeState;switch(s=null==s?g.OverwriteChanges:s){case g.IgnoreChanges:return l=m(e),this.adapter.updateMany(l,t);case g.OverwriteChanges:return o=e.reduce((v,A)=>{const L=A.id;return v[L]&&(a||(v=Object.assign({},v),a=!0),delete v[L]),v},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:o}):t,l=m(e),this.adapter.updateMany(l,t);case g.PreserveChanges:{const v=[];return o=e.reduce((A,L)=>{const G=L.id,et=A[G];if(et){a||(A=Object.assign({},A),a=!0);const lt=this.selectId(L.changes),it=et;lt!==G&&delete A[G];const Q=Object.assign(Object.assign({},it.originalValue),L.changes);A[lt]=Object.assign(Object.assign({},it),{originalValue:Q})}else v.push(L);return A},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:o}):t,l=m(v),this.adapter.updateMany(l,t)}}function m(v){return!0===r&&(v=v.filter(A=>!0===A.changed)),v.map(A=>({id:A.id,changes:A.changes}))}}mergeSaveUpserts(e,t,s){return this.mergeServerUpserts(e,t,g.OverwriteChanges,s)}mergeServerUpserts(e,t,s,r){if(null==e||0===e.length)return t;let a=!1,o=t.changeState;switch(r=null==r?s:r){case g.IgnoreChanges:return this.adapter.upsertMany(e,t);case g.OverwriteChanges:return t=this.adapter.upsertMany(e,t),o=e.reduce((l,m)=>{const v=this.selectId(m);return l[v]&&(a||(l=Object.assign({},l),a=!0),delete l[v]),l},t.changeState),a?Object.assign(Object.assign({},t),{changeState:o}):t;case g.PreserveChanges:{const l=[];return o=e.reduce((m,v)=>{const A=this.selectId(v);return m[A]?a||(m=Object.assign(Object.assign({},m),{[A]:Object.assign(Object.assign({},m[A]),{originalValue:v})}),a=!0):l.push(v),m},t.changeState),t=this.adapter.upsertMany(l,t),a?Object.assign(Object.assign({},t),{changeState:o}):t}}}trackAddMany(e,t,s){if(s===g.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=e.reduce((o,l)=>{const m=this.selectId(l);if(null==m||""===m)throw new Error(`${t.entityName} entity add requires a key to be tracked`);return o[m]||(r||(r=!0,o=Object.assign({},o)),o[m]={changeType:Z.Added}),o},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:a}):t}trackAddOne(e,t,s){return null==e?t:this.trackAddMany([e],t,s)}trackDeleteMany(e,t,s){if(s===g.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((l,m)=>{const v=a[m];if(v){const L=l[m];L?L.changeType===Z.Added?(A(),delete l[m]):L.changeType===Z.Updated&&(A(),l[m]=Object.assign(Object.assign({},l[m]),{changeType:Z.Deleted})):(A(),l[m]={changeType:Z.Deleted,originalValue:v})}return l;function A(){r||(r=!0,l=Object.assign({},l))}},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackDeleteOne(e,t,s){return null==e?t:this.trackDeleteMany([e],t,s)}trackUpdateMany(e,t,s){if(s===g.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((l,m)=>{const{id:v}=m;if(null==v||""===v)throw new Error(`${t.entityName} entity update requires a key to be tracked`);const L=a[v];return L&&(l[v]||(r||(r=!0,l=Object.assign({},l)),l[v]={changeType:Z.Updated,originalValue:L})),l},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackUpdateOne(e,t,s){return null==e?t:this.trackUpdateMany([e],t,s)}trackUpsertMany(e,t,s){if(s===g.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((l,m)=>{const v=this.selectId(m);if(null==v||""===v)throw new Error(`${t.entityName} entity upsert requires a key to be tracked`);if(!l[v]){r||(r=!0,l=Object.assign({},l));const L=a[v];l[v]=null==L?{changeType:Z.Added}:{changeType:Z.Updated,originalValue:L}}return l},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackUpsertOne(e,t,s){return null==e?t:this.trackUpsertMany([e],t,s)}undoAll(e){const t=Object.keys(e.changeState),{remove:s,upsert:r}=t.reduce((a,o)=>{const l=a.chgState[o];switch(l.changeType){case Z.Added:a.remove.push(o);break;case Z.Deleted:const m=l.originalValue;m&&a.upsert.push(m);break;case Z.Updated:a.upsert.push(l.originalValue)}return a},{remove:[],upsert:[],chgState:e.changeState});return e=this.adapter.removeMany(s,e),e=this.adapter.upsertMany(r,e),Object.assign(Object.assign({},e),{changeState:{}})}undoMany(e,t){if(null==e||0===e.length)return t;let s=!1;const{changeState:r,remove:a,upsert:o}=e.reduce((l,m)=>{let v=l.changeState;const A="object"==typeof m?this.selectId(m):m,L=v[A];if(L)switch(s||(v=Object.assign({},v),s=!0),delete v[A],l.changeState=v,L.changeType){case Z.Added:l.remove.push(A);break;case Z.Deleted:const G=L.originalValue;G&&l.upsert.push(G);break;case Z.Updated:l.upsert.push(L.originalValue)}return l},{remove:[],upsert:[],changeState:t.changeState});return t=this.adapter.removeMany(a,t),t=this.adapter.upsertMany(o,t),s?Object.assign(Object.assign({},t),{changeState:r}):t}undoOne(e,t){return null==e?t:this.undoMany([e],t)}}class ge{constructor(e,t,s){this.entityName=e,this.definition=t,this.methods={[y.CANCEL_PERSIST]:this.cancelPersist.bind(this),[y.QUERY_ALL]:this.queryAll.bind(this),[y.QUERY_ALL_ERROR]:this.queryAllError.bind(this),[y.QUERY_ALL_SUCCESS]:this.queryAllSuccess.bind(this),[y.QUERY_BY_KEY]:this.queryByKey.bind(this),[y.QUERY_BY_KEY_ERROR]:this.queryByKeyError.bind(this),[y.QUERY_BY_KEY_SUCCESS]:this.queryByKeySuccess.bind(this),[y.QUERY_LOAD]:this.queryLoad.bind(this),[y.QUERY_LOAD_ERROR]:this.queryLoadError.bind(this),[y.QUERY_LOAD_SUCCESS]:this.queryLoadSuccess.bind(this),[y.QUERY_MANY]:this.queryMany.bind(this),[y.QUERY_MANY_ERROR]:this.queryManyError.bind(this),[y.QUERY_MANY_SUCCESS]:this.queryManySuccess.bind(this),[y.SAVE_ADD_MANY]:this.saveAddMany.bind(this),[y.SAVE_ADD_MANY_ERROR]:this.saveAddManyError.bind(this),[y.SAVE_ADD_MANY_SUCCESS]:this.saveAddManySuccess.bind(this),[y.SAVE_ADD_ONE]:this.saveAddOne.bind(this),[y.SAVE_ADD_ONE_ERROR]:this.saveAddOneError.bind(this),[y.SAVE_ADD_ONE_SUCCESS]:this.saveAddOneSuccess.bind(this),[y.SAVE_DELETE_MANY]:this.saveDeleteMany.bind(this),[y.SAVE_DELETE_MANY_ERROR]:this.saveDeleteManyError.bind(this),[y.SAVE_DELETE_MANY_SUCCESS]:this.saveDeleteManySuccess.bind(this),[y.SAVE_DELETE_ONE]:this.saveDeleteOne.bind(this),[y.SAVE_DELETE_ONE_ERROR]:this.saveDeleteOneError.bind(this),[y.SAVE_DELETE_ONE_SUCCESS]:this.saveDeleteOneSuccess.bind(this),[y.SAVE_UPDATE_MANY]:this.saveUpdateMany.bind(this),[y.SAVE_UPDATE_MANY_ERROR]:this.saveUpdateManyError.bind(this),[y.SAVE_UPDATE_MANY_SUCCESS]:this.saveUpdateManySuccess.bind(this),[y.SAVE_UPDATE_ONE]:this.saveUpdateOne.bind(this),[y.SAVE_UPDATE_ONE_ERROR]:this.saveUpdateOneError.bind(this),[y.SAVE_UPDATE_ONE_SUCCESS]:this.saveUpdateOneSuccess.bind(this),[y.SAVE_UPSERT_MANY]:this.saveUpsertMany.bind(this),[y.SAVE_UPSERT_MANY_ERROR]:this.saveUpsertManyError.bind(this),[y.SAVE_UPSERT_MANY_SUCCESS]:this.saveUpsertManySuccess.bind(this),[y.SAVE_UPSERT_ONE]:this.saveUpsertOne.bind(this),[y.SAVE_UPSERT_ONE_ERROR]:this.saveUpsertOneError.bind(this),[y.SAVE_UPSERT_ONE_SUCCESS]:this.saveUpsertOneSuccess.bind(this),[y.ADD_ALL]:this.addAll.bind(this),[y.ADD_MANY]:this.addMany.bind(this),[y.ADD_ONE]:this.addOne.bind(this),[y.REMOVE_ALL]:this.removeAll.bind(this),[y.REMOVE_MANY]:this.removeMany.bind(this),[y.REMOVE_ONE]:this.removeOne.bind(this),[y.UPDATE_MANY]:this.updateMany.bind(this),[y.UPDATE_ONE]:this.updateOne.bind(this),[y.UPSERT_MANY]:this.upsertMany.bind(this),[y.UPSERT_ONE]:this.upsertOne.bind(this),[y.COMMIT_ALL]:this.commitAll.bind(this),[y.COMMIT_MANY]:this.commitMany.bind(this),[y.COMMIT_ONE]:this.commitOne.bind(this),[y.UNDO_ALL]:this.undoAll.bind(this),[y.UNDO_MANY]:this.undoMany.bind(this),[y.UNDO_ONE]:this.undoOne.bind(this),[y.SET_CHANGE_STATE]:this.setChangeState.bind(this),[y.SET_COLLECTION]:this.setCollection.bind(this),[y.SET_FILTER]:this.setFilter.bind(this),[y.SET_LOADED]:this.setLoaded.bind(this),[y.SET_LOADING]:this.setLoading.bind(this)},this.adapter=t.entityAdapter,this.isChangeTracking=!0!==t.noChangeTracking,this.selectId=t.selectId,this.guard=new H(e,this.selectId),this.toUpdate=tt(this.selectId),this.entityChangeTracker=s||new pe(this.adapter,this.selectId)}cancelPersist(e){return this.setLoadingFalse(e)}queryAll(e){return this.setLoadingTrue(e)}queryAllError(e,t){return this.setLoadingFalse(e)}queryAllSuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}queryByKey(e,t){return this.setLoadingTrue(e)}queryByKeyError(e,t){return this.setLoadingFalse(e)}queryByKeySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return e=null==s?e:this.entityChangeTracker.mergeQueryResults([s],e,r),this.setLoadingFalse(e)}queryLoad(e){return this.setLoadingTrue(e)}queryLoadError(e,t){return this.setLoadingFalse(e)}queryLoadSuccess(e,t){const s=this.extractData(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}queryMany(e,t){return this.setLoadingTrue(e)}queryManyError(e,t){return this.setLoadingFalse(e)}queryManySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}saveAddMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddMany(s,e,r),e=this.adapter.addMany(s,e)}return this.setLoadingTrue(e)}saveAddManyError(e,t){return this.setLoadingFalse(e)}saveAddManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.isOptimistic(t)?this.entityChangeTracker.mergeSaveUpserts(s,e,r):this.entityChangeTracker.mergeSaveAdds(s,e,r),this.setLoadingFalse(e)}saveAddOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddOne(s,e,r),e=this.adapter.addOne(s,e)}return this.setLoadingTrue(e)}saveAddOneError(e,t){return this.setLoadingFalse(e)}saveAddOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);if(this.isOptimistic(t)){const a=this.toUpdate(s);e=this.entityChangeTracker.mergeSaveUpdates([a],e,r,!1)}else e=this.entityChangeTracker.mergeSaveAdds([s],e,r);return this.setLoadingFalse(e)}saveDeleteOne(e,t){const s=this.extractData(t),r="object"==typeof s?this.selectId(s):s,a=e.changeState[r];if(a&&(a.changeType===Z.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e)),this.isOptimistic(t)){const o=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteOne(r,e,o),e=this.adapter.removeOne(r,e)}return this.setLoadingTrue(e)}saveDeleteOneError(e,t){return this.setLoadingFalse(e)}saveDeleteOneSuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes([s],e,r)}else e=this.adapter.removeOne(s,e),e=this.entityChangeTracker.commitOne(s,e);return this.setLoadingFalse(e)}saveDeleteMany(e,t){const s=this.extractData(t).map(r=>"object"==typeof r?this.selectId(r):r);if(s.forEach(r=>{const a=e.changeState[r];a&&(a.changeType===Z.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e))}),this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteMany(s,e,r),e=this.adapter.removeMany(s,e)}return this.setLoadingTrue(e)}saveDeleteManyError(e,t){return this.setLoadingFalse(e)}saveDeleteManySuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes(s,e,r)}else e=this.adapter.removeMany(s,e),e=this.entityChangeTracker.commitMany(s,e);return this.setLoadingFalse(e)}saveUpdateOne(e,t){const s=this.guard.mustBeUpdate(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateOne(s,e,r),e=this.adapter.updateOne(s,e)}return this.setLoadingTrue(e)}saveUpdateOneError(e,t){return this.setLoadingFalse(e)}saveUpdateOneSuccess(e,t){const s=this.guard.mustBeUpdateResponse(t),r=this.isOptimistic(t),a=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpdates([s],e,a,r),this.setLoadingFalse(e)}saveUpdateMany(e,t){const s=this.guard.mustBeUpdates(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateMany(s,e,r),e=this.adapter.updateMany(s,e)}return this.setLoadingTrue(e)}saveUpdateManyError(e,t){return this.setLoadingFalse(e)}saveUpdateManySuccess(e,t){const s=this.guard.mustBeUpdateResponses(t),a=(this.isOptimistic(t),this.extractMergeStrategy(t));return e=this.entityChangeTracker.mergeSaveUpdates(s,e,a,!1),this.setLoadingFalse(e)}saveUpsertOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertOne(s,e,r),e=this.adapter.upsertOne(s,e)}return this.setLoadingTrue(e)}saveUpsertOneError(e,t){return this.setLoadingFalse(e)}saveUpsertOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts([s],e,r),this.setLoadingFalse(e)}saveUpsertMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertMany(s,e,r),e=this.adapter.upsertMany(s,e)}return this.setLoadingTrue(e)}saveUpsertManyError(e,t){return this.setLoadingFalse(e)}saveUpsertManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts(s,e,r),this.setLoadingFalse(e)}addAll(e,t){const s=this.guard.mustBeEntities(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}addMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddMany(s,e,r),this.adapter.addMany(s,e)}addOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddOne(s,e,r),this.adapter.addOne(s,e)}removeMany(e,t){const s=this.guard.mustBeKeys(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteMany(s,e,r),this.adapter.removeMany(s,e)}removeOne(e,t){const s=this.guard.mustBeKey(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteOne(s,e,r),this.adapter.removeOne(s,e)}removeAll(e,t){return Object.assign(Object.assign({},this.adapter.removeAll(e)),{loaded:!1,loading:!1,changeState:{}})}updateMany(e,t){const s=this.guard.mustBeUpdates(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateMany(s,e,r),this.adapter.updateMany(s,e)}updateOne(e,t){const s=this.guard.mustBeUpdate(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateOne(s,e,r),this.adapter.updateOne(s,e)}upsertMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertMany(s,e,r),this.adapter.upsertMany(s,e)}upsertOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertOne(s,e,r),this.adapter.upsertOne(s,e)}commitAll(e){return this.entityChangeTracker.commitAll(e)}commitMany(e,t){return this.entityChangeTracker.commitMany(this.extractData(t),e)}commitOne(e,t){return this.entityChangeTracker.commitOne(this.extractData(t),e)}undoAll(e){return this.entityChangeTracker.undoAll(e)}undoMany(e,t){return this.entityChangeTracker.undoMany(this.extractData(t),e)}undoOne(e,t){return this.entityChangeTracker.undoOne(this.extractData(t),e)}setChangeState(e,t){const s=this.extractData(t);return e.changeState===s?e:Object.assign(Object.assign({},e),{changeState:s})}setCollection(e,t){const s=this.extractData(t);return e===s?e:s}setFilter(e,t){const s=this.extractData(t);return e.filter===s?e:Object.assign(Object.assign({},e),{filter:s})}setLoaded(e,t){const s=!0===this.extractData(t)||!1;return e.loaded===s?e:Object.assign(Object.assign({},e),{loaded:s})}setLoading(e,t){return this.setLoadingFlag(e,this.extractData(t))}setLoadingFalse(e){return this.setLoadingFlag(e,!1)}setLoadingTrue(e){return this.setLoadingFlag(e,!0)}setLoadingFlag(e,t){return e.loading===(t=!0===t)?e:Object.assign(Object.assign({},e),{loading:t})}extractData(e){return e.payload&&e.payload.data}extractMergeStrategy(e){return this.isChangeTracking?e.payload&&e.payload.mergeStrategy:g.IgnoreChanges}isOptimistic(e){return e.payload&&!0===e.payload.isOptimistic}}let Kt=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService.getDefinition(t);return new ge(t,s).methods}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(at))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Qt=(()=>{class n{constructor(t){this.methodsFactory=t}create(t){const s=this.methodsFactory.create(t);return function(a,o){const l=s[o.payload.entityOp];return l?l(a,o):a}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Kt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Wt=(()=>{class n{constructor(t,s){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=O.qC.apply(null,s||[])}getOrCreateReducer(t){let s=this.entityCollectionReducers[t];return s||(s=this.entityCollectionReducerFactory.create(t),s=this.registerReducer(t,s),this.entityCollectionReducers[t]=s),s}registerReducer(t,s){return s=this.entityCollectionMetaReducer(s),this.entityCollectionReducers[t.trim()]=s}registerReducers(t){(t?Object.keys(t):[]).forEach(r=>this.registerReducer(r,t[r]))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Qt),c.LFG(Ct,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),zt=(()=>{class n{constructor(t,s,r){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=s,this.logger=r}create(){return function t(s={},r){switch(r.type){case _.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(s,r);case _.LOAD_COLLECTIONS:return this.loadCollectionsReducer(s,r);case _.MERGE_QUERY_SET:return this.mergeQuerySetReducer(s,r);case _.SAVE_ENTITIES:return this.saveEntitiesReducer(s,r);case _.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(s,r);case _.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(s,r);case _.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(s,r);case _.SET_ENTITY_CACHE:return r.payload.cache}const a=r.payload;return a&&a.entityName&&a.entityOp&&!a.error?this.applyCollectionReducer(s,r):s}.bind(this)}clearCollectionsReducer(t,s){let{collections:r}=s.payload;const o=y.REMOVE_ALL;return r||(r=Object.keys(t)),r.reduce((l,m)=>this.applyCollectionReducer(l,{type:`[${m}] ${s.type}`,payload:{entityName:m,entityOp:o}}),t)}loadCollectionsReducer(t,s){const{collections:r}=s.payload,o=y.ADD_ALL;return Object.keys(r).reduce((m,v)=>this.applyCollectionReducer(m,{type:`[${v}] ${s.type}`,payload:{entityName:v,entityOp:o,data:r[v]}}),t)}mergeQuerySetReducer(t,s){let{mergeStrategy:r,querySet:a}=s.payload;r=null===r?g.PreserveChanges:r;const l=y.QUERY_MANY_SUCCESS;return Object.keys(a).reduce((v,A)=>this.applyCollectionReducer(v,{type:`[${A}] ${s.type}`,payload:{entityName:A,entityOp:l,data:a[A],mergeStrategy:r}}),t)}saveEntitiesReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:m}=s.payload;try{r.changes.forEach(A=>{const L=A.entityName,G={entityName:L,entityOp:v(A),data:A.entities,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:m},et={type:`[${L}] ${s.type}`,payload:G};if(t=this.applyCollectionReducer(t,et),et.payload.error)throw et.payload.error})}catch(A){s.payload.error=A}return t;function v(A){switch(A.op){case p.Add:return y.SAVE_ADD_MANY;case p.Delete:return y.SAVE_DELETE_MANY;case p.Update:return y.SAVE_UPDATE_MANY;case p.Upsert:return y.SAVE_UPSERT_MANY}}}saveEntitiesCancelReducer(t,s){return this.clearLoadingFlags(t,s.payload.entityNames||[])}saveEntitiesErrorReducer(t,s){const o=s.payload.originalAction.payload.changeSet.changes.map(l=>l.entityName);return this.clearLoadingFlags(t,o)}saveEntitiesSuccessReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:m}=s.payload;return r.changes.forEach(A=>{const L=A.entityName,G={entityName:L,entityOp:v(A),data:A.entities,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:m};t=this.applyCollectionReducer(t,{type:`[${L}] ${s.type}`,payload:G})}),t;function v(A){switch(A.op){case p.Add:return y.SAVE_ADD_MANY_SUCCESS;case p.Delete:return y.SAVE_DELETE_MANY_SUCCESS;case p.Update:return y.SAVE_UPDATE_MANY_SUCCESS;case p.Upsert:return y.SAVE_UPSERT_MANY_SUCCESS}}}applyCollectionReducer(t={},s){const r=s.payload.entityName,a=t[r],o=this.entityCollectionReducerRegistry.getOrCreateReducer(r);let l;try{l=o(a||this.entityCollectionCreator.create(r),s)}catch(m){this.logger.error(m),s.payload.error=m}return s.payload.error||a===l?t:Object.assign(Object.assign({},t),{[r]:l})}clearLoadingFlags(t,s){let r=!1;return s.forEach(a=>{const o=t[a];o.loading&&(r||(t=Object.assign({},t),r=!0),t[a]=Object.assign(Object.assign({},o),{loading:!1}))}),t}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(ht),c.LFG(Wt),c.LFG(ct))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Ee=(()=>{class n{error(t,s){t&&(s?console.error(t,s):console.error(t))}log(t,s){t&&(s?console.log(t,s):console.log(t))}warn(t,s){t&&(s?console.warn(t,s):console.warn(t))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const fe=["equipment","information","money","series"];let _e=(()=>{class n{constructor(t){this.pluralNames={},t&&t.forEach(s=>this.registerPluralNames(s))}pluralize(t){return this.pluralNames[t]||(fe.indexOf(t.toLowerCase())>=0?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substr(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")}registerPluralNames(t){this.pluralNames=Object.assign(Object.assign({},this.pluralNames),t||{})}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(_t,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),ve=(()=>{class n{constructor(t,s,r,a,o,l){this.reducerManager=t,this.injector=r,this.entityCacheName=a,this.initialState=o,this.metaReducers=l;const m=a||dt;o="function"==typeof o?o():o;const v=(l||[]).map(A=>A instanceof c.OlP?r.get(A):A);this.entityCacheFeature={key:m,reducers:s.create(),reducerFactory:O.UY,initialState:o||{},metaReducers:v},t.addFeature(this.entityCacheFeature)}static forRoot(t){return{ngModule:n,providers:[{provide:At,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Ct,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:_t,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}ngOnDestroy(){this.reducerManager.removeFeature(this.entityCacheFeature)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(O.PB),c.LFG(zt),c.LFG(c.zs3),c.LFG(mt,8),c.LFG(ce,8),c.LFG(At,8))},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[St,vt,w,ie,zt,de,ht,Qt,Kt,Wt,Dt,Vt,at,Ot,Bt,Mt,Gt,{provide:mt,useValue:dt},{provide:ye,useClass:le},{provide:ct,useClass:Ee}],imports:[[O.Aw]]}),n})(),me=(()=>{class n{constructor(t,s,r){this.effectSources=t,this.addEffects(s),this.addEffects(r)}static forRoot(t){return{ngModule:n,providers:[{provide:Ut,multi:!0,useValue:t.entityMetadata?t.entityMetadata:[]},{provide:At,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Ct,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:_t,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}addEffects(t){this.effectSources.addEffects(t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(U.Ll),c.LFG(jt),c.LFG($t))},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[Rt,xt,Nt,jt,$t,{provide:bt,useClass:ee},{provide:It,useClass:ae},{provide:kt,useClass:_e}],imports:[[ve,U.sQ]]}),n})()},12834:(st,z,h)=>{h.d(z,{H:()=>V});var c=h(22051),E=h(60105),f=(()=>{return(D=f||(f={}))[D.EntitiesOnly=0]="EntitiesOnly",D[D.Both=1]="Both",D[D.None=2]="None",f;var D})();function k(D){return function(I,C){const M={ids:[...C.ids],entities:Object.assign({},C.entities)},Y=D(I,M);return Y===f.Both?Object.assign({},C,M):Y===f.EntitiesOnly?Object.assign(Object.assign({},C),{entities:M.entities}):C}}function R(D,b){const I=b(D);return(0,E.X6Q)()&&void 0===I&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",D,"The `selectId` implementation:",b.toString()),I}function F(D){function b(T,p){const S=R(T,D);return S in p.entities?f.None:(p.ids.push(S),p.entities[S]=T,f.Both)}function I(T,p){let S=!1;for(const d of T)S=b(d,p)!==f.None||S;return S?f.Both:f.None}function M(T,p){const S=R(T,D);return S in p.entities?(p.entities[S]=T,f.EntitiesOnly):(p.ids.push(S),p.entities[S]=T,f.Both)}function K(T,p){const d=(T instanceof Array?T:p.ids.filter(i=>T(p.entities[i]))).filter(i=>i in p.entities).map(i=>delete p.entities[i]).length>0;return d&&(p.ids=p.ids.filter(i=>i in p.entities)),d?f.Both:f.None}function w(T,p){return H([T],p)}function H(T,p){const S={};return(T=T.filter(i=>i.id in p.entities)).length>0?T.filter(g=>function U(T,p,S){const i=Object.assign({},S.entities[p.id],p.changes),g=R(i,D),_=g!==p.id;return _&&(T[p.id]=g,delete S.entities[p.id]),S.entities[g]=i,_}(S,g,p)).length>0?(p.ids=p.ids.map(g=>S[g]||g),f.Both):f.EntitiesOnly:f.None}function q(T,p){const S=[],d=[];for(const _ of T){const j=R(_,D);j in p.entities?d.push({id:j,changes:_}):S.push(_)}const i=H(d,p),g=I(S,p);switch(!0){case g===f.None&&i===f.None:return f.None;case g===f.Both||i===f.Both:return f.Both;default:return f.EntitiesOnly}}return{removeAll:function O(T){return Object.assign({},T,{ids:[],entities:{}})},addOne:k(b),addMany:k(I),setAll:k(function C(T,p){return p.ids=[],p.entities={},I(T,p),f.Both}),setOne:k(M),setMany:k(function Y(T,p){const S=T.map(d=>M(d,p));switch(!0){case S.some(d=>d===f.Both):return f.Both;case S.some(d=>d===f.EntitiesOnly):return f.EntitiesOnly;default:return f.None}}),updateOne:k(w),updateMany:k(H),upsertOne:k(function tt(T,p){return q([T],p)}),upsertMany:k(q),removeOne:k(function N(T,p){return K([T],p)}),removeMany:k(K),map:k(function W(T,p){return H(p.ids.reduce((i,g)=>{const _=T(p.entities[g]);return _!==p.entities[g]&&i.push({id:g,changes:_}),i},[]).filter(({id:i})=>i in p.entities),p)}),mapOne:k(function X({map:T,id:p},S){const d=S.entities[p];return d?w({id:p,changes:T(d)},S):f.None})}}function V(D={}){const{selectId:b,sortComparer:I}=Object.assign({sortComparer:!1,selectId:N=>N.id},D),C=function u(){return{getInitialState:function D(b={}){return Object.assign({ids:[],entities:{}},b)}}}(),M=function B(){return{getSelectors:function D(b){const I=N=>N.ids,C=N=>N.entities,M=(0,c.P1)(I,C,(N,K)=>N.map(O=>K[O])),Y=(0,c.P1)(I,N=>N.length);return b?{selectIds:(0,c.P1)(b,I),selectEntities:(0,c.P1)(b,C),selectAll:(0,c.P1)(b,M),selectTotal:(0,c.P1)(b,Y)}:{selectIds:I,selectEntities:C,selectAll:M,selectTotal:Y}}}}(),Y=I?function $(D,b){const{removeOne:I,removeMany:C,removeAll:M}=F(D);function Y(S,d){return N([S],d)}function N(S,d){const i=S.filter(g=>!(R(g,D)in d.entities));return 0===i.length?f.None:(p(i,d),f.Both)}function O(S,d){const i=R(S,D);return i in d.entities?(d.ids=d.ids.filter(g=>g!==i),p([S],d),f.Both):Y(S,d)}function w(S,d){return W([S],d)}function W(S,d){const i=[],g=S.filter(_=>function H(S,d,i){if(!(d.id in i.entities))return!1;const _=Object.assign({},i.entities[d.id],d.changes),j=R(_,D);return delete i.entities[d.id],S.push(_),j!==d.id}(i,_,d)).length>0;if(0===i.length)return f.None;{const _=d.ids,j=[];return d.ids=d.ids.filter((J,nt)=>J in d.entities||(j.push(nt),!1)),p(i,d),!g&&j.every(J=>d.ids[J]===_[J])?f.EntitiesOnly:f.Both}}function T(S,d){const i=[],g=[];for(const J of S){const nt=R(J,D);nt in d.entities?g.push({id:nt,changes:J}):i.push(J)}const _=W(g,d),j=N(i,d);switch(!0){case j===f.None&&_===f.None:return f.None;case j===f.Both||_===f.Both:return f.Both;default:return f.EntitiesOnly}}function p(S,d){S.sort(b);const i=[];let g=0,_=0;for(;g<S.length&&_<d.ids.length;){const j=S[g],J=R(j,D),nt=d.ids[_];b(j,d.entities[nt])<=0?(i.push(J),g++):(i.push(nt),_++)}d.ids=i.concat(g<S.length?S.slice(g).map(D):d.ids.slice(_)),S.forEach((j,J)=>{d.entities[D(j)]=j})}return{removeOne:I,removeMany:C,removeAll:M,addOne:k(Y),updateOne:k(w),upsertOne:k(function q(S,d){return T([S],d)}),setAll:k(function K(S,d){return d.entities={},d.ids=[],N(S,d),f.Both}),setOne:k(O),setMany:k(function U(S,d){const i=S.map(g=>O(g,d));switch(!0){case i.some(g=>g===f.Both):return f.Both;case i.some(g=>g===f.EntitiesOnly):return f.EntitiesOnly;default:return f.None}}),addMany:k(N),updateMany:k(W),upsertMany:k(T),map:k(function X(S,d){return W(d.ids.reduce((g,_)=>{const j=S(d.entities[_]);return j!==d.entities[_]&&g.push({id:_,changes:j}),g},[]),d)}),mapOne:k(function tt({map:S,id:d},i){const g=i.entities[d];return g?w({id:d,changes:S(g)},i):f.None})}}(b,I):F(b);return Object.assign(Object.assign(Object.assign({selectId:b,sortComparer:I},C),M),Y)}}}]);