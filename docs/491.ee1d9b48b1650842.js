"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[491],{60491:(ee,z,f)=>{f.r(z),f.d(z,{RealtimeProcessAppComponent:()=>V,RealtimeProcessAppModule:()=>fe});var R=f(41380),D=f(26983),A=f(27565),Q=f(7683),l=f(22051),r=f(87036);const W=(0,l.Lq)({loggedUser:""});var u=f(60105);const w=(0,l.PH)("[processes] INIT"),J=(0,l.PH)("[processes] FETCH_PROCESSES"),d=(0,l.PH)("[processes] FETCH_PROCESSES_SUCCESS",(0,l.Ky)()),S=((0,l.PH)("[processes] FETCH_PROCESSES_ERROR",(0,l.Ky)()),(0,l.PH)("[processes] REALTIME_CHANGES_SUBSCRIBE",(0,l.Ky)())),C=((0,l.PH)("[processes] REALTIME_CHANGES_NEW_DATA",(0,l.Ky)()),(0,l.PH)("[processes] START_PROCESS",(0,l.Ky)())),b=(0,l.PH)("[processes] START_PROCESS_SUCCESS"),m=(0,l.PH)("[processes] STOP_PROCESS",(0,l.Ky)()),x=(0,l.PH)("[processes] STOP_PROCESS_SUCCESS"),B=(0,l.PH)("[processes] UPDATE_PROCESS",(0,l.Ky)());var N=f(23554);const j="processes";var I=f(18801);const H=(0,f(12834).H)(),Z=H.getInitialState({backgroundOperation:"nothing"}),K=(0,l.Lq)(Z,(0,l.on)(w,(o,y)=>H.setAll([],Object.assign(Object.assign({},o),{isLoadingProcesses:!1}))),(0,l.on)(J,(o,y)=>H.setAll([],Object.assign(Object.assign({},o),{isLoadingProcesses:!0}))),(0,l.on)(d,(o,{processes:y})=>H.setAll(y,Object.assign(Object.assign({},o),{isLoadingProcesses:!1}))),(0,l.on)(B,(o,y)=>{const a=I.cloneDeep(y.process);let P=[];const U=o.entities[y.process.id];return"killing"===U&&(P=["killed","ended-with-error","ended-ok"]),"starting"===U&&(P=["active"]),P.length>0&&a.changes.state&&!P.includes(a.changes.state)&&(console.warn(`Changing state to ${U.state}... `),a.changes.state=U.state),H.updateOne(a,Object.assign({},o))})),{selectAll:t}=H.getSelectors(),n=(0,l.ZF)(j),i=(0,l.P1)(n,t),p=(0,l.P1)(i,o=>o.map(y=>N.An.from(y)));(0,l.P1)(n,o=>"loading-processes"===o.backgroundOperation),(0,l.P1)(n,o=>"syncing-with-db"===o.backgroundOperation);var F=f(56248),X=f(83070),te=f(94235),se=f(83316);function ne(o,y){if(1&o){const a=u.EpF();u.TgZ(0,"app-process",1),u.NdJ("processAction",function(U){const L=u.CHM(a).$implicit;return u.oxw().onProcessAction(U,L)})("subscribeRealtime",function(){const E=u.CHM(a).$implicit;return u.oxw().onProcessRealtimeSubscribe(E)}),u._uU(1),u.qZA()}if(2&o){const a=y.$implicit;u.Q6J("process",a),u.xp6(1),u.hij(" ",a.id," ")}}let oe=(()=>{class o{constructor(a){this.store=a,this.destroy$=new X.x,this.processes$=this.store.select(p)}ngOnInit(){this.store.dispatch(w())}ngOnDestroy(){this.destroy$.next(void 0),this.destroy$.unsubscribe(),F.ZH.ng.unsubscribe(this.destroy$)}onProcessRealtimeSubscribe(a){this.store.dispatch(S({process:a,destroy$:F.ZH.ng.serialize(this.destroy$)}))}onProcessAction(a,P){"start"===a&&this.store.dispatch(C({process:P})),"stop"===a&&this.store.dispatch(m({process:P}))}trackByMethod(a,P){return P.id}}return o.\u0275fac=function(a){return new(a||o)(u.Y36(l.yh))},o.\u0275cmp=u.Xpm({type:o,selectors:[["app-processes"]],decls:6,vars:4,consts:[[3,"process","processAction","subscribeRealtime",4,"ngFor","ngForOf","ngForTrackBy"],[3,"process","processAction","subscribeRealtime"]],template:function(a,P){1&a&&(u.TgZ(0,"mat-card")(1,"h2"),u._uU(2,"Processes"),u.qZA(),u._UZ(3,"br"),u.YNc(4,ne,2,2,"app-process",0),u.ALo(5,"async"),u.qZA()),2&a&&(u.xp6(4),u.Q6J("ngForOf",u.lcZ(5,2,P.processes$))("ngForTrackBy",P.trackByMethod))},directives:[te.a8,R.sg,se.H],pipes:[R.Ov],styles:[""]}),o})(),V=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(a){return new(a||o)},o.\u0275cmp=u.Xpm({type:o,selectors:[["app-realtime-process-app"]],decls:1,vars:0,template:function(a,P){1&a&&u._UZ(0,"app-processes")},directives:[oe],styles:[""]}),o})(),k=(()=>{class o{constructor(a){this.ctrl=a}}return o.\u0275fac=function(a){return new(a||o)(u.LFG(N.$8))},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac}),o})();var _=f(76808),re=f(4393),G=f(12777),q=f(23355),Y=f(6568),ie=f(12038),ce=f(5211),ae=f(20761),ue=f(78291);let le=(()=>{class o{constructor(a,P,U){this.actions$=a,this.service=P,this.store=U,this.init=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(w),(0,_.w)(()=>(0,re.of)(J())))),this.fetchProcesses=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(J),(0,_.w)(()=>this.service.ctrl.getAll().received.observable.pipe((0,G.U)(E=>E.body.rawJson),(0,G.U)(E=>d({processes:E})))))),this.startProcess=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(C),(0,q.b)(E=>{this.store.dispatch(B({process:{id:E.process.id,changes:{state:"starting"}}}))}),(0,Y.z)(E=>E.process.start().pipe((0,G.U)(()=>b()))))),this.stopProcess=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(m),(0,q.b)(E=>{this.store.dispatch(B({process:{id:E.process.id,changes:{state:"killing"}}}))}),(0,Y.z)(E=>E.process.stop().pipe((0,G.U)(()=>x()))))),this.realtimeChanges=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(S),(0,Y.z)(E=>ue.iQ.Realtime.Browser.listenChangesEntityObj(E.process).pipe((0,ie.R)(F.ZH.ng.deserialize(E.destroy$)),(0,ce.b)(500),(0,ae.z)(()=>N.An.ctrl.getBy(E.process.id).received.observable.pipe((0,G.U)(L=>L.body.rawJson))),(0,G.U)(L=>B({process:{id:L.id,changes:L}}))))))}}return o.\u0275fac=function(a){return new(a||o)(u.LFG(A.eX),u.LFG(k),u.LFG(l.yh))},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac}),o})(),de=(()=>{class o{}return o.\u0275fac=function(a){return new(a||o)},o.\u0275mod=u.oAB({type:o}),o.\u0275inj=u.cJS({providers:[k,N.$8],imports:[[R.ez,N.JT,N.qX,l.Aw.forFeature(j,K),A.sQ.forFeature([le])]]}),o})();const pe=[{path:"",component:V}];let fe=(()=>{class o{}return o.\u0275fac=function(a){return new(a||o)},o.\u0275mod=u.oAB({type:o}),o.\u0275inj=u.cJS({imports:[[R.ez,l.Aw.forRoot(W,{}),A.sQ.forRoot([]),Q.Qi.forRoot(),r.FT.instrument({maxAge:25}),D.Bz.forChild(pe),de]]}),o})()},12834:(ee,z,f)=>{f.d(z,{H:()=>w});var R=f(22051),D=f(60105),r=(()=>{return(d=r||(r={}))[d.EntitiesOnly=0]="EntitiesOnly",d[d.Both=1]="Both",d[d.None=2]="None",r;var d})();function h(d){return function(S,M){const C={ids:[...M.ids],entities:Object.assign({},M.entities)},b=d(S,C);return b===r.Both?Object.assign({},M,C):b===r.EntitiesOnly?Object.assign(Object.assign({},M),{entities:C.entities}):M}}function T(d,g){const S=g(d);return(0,D.X6Q)()&&void 0===S&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",d,"The `selectId` implementation:",g.toString()),S}function W(d){function g(c,s){const t=T(c,d);return t in s.entities?r.None:(s.ids.push(t),s.entities[t]=c,r.Both)}function S(c,s){let t=!1;for(const e of c)t=g(e,s)!==r.None||t;return t?r.Both:r.None}function C(c,s){const t=T(c,d);return t in s.entities?(s.entities[t]=c,r.EntitiesOnly):(s.ids.push(t),s.entities[t]=c,r.Both)}function x(c,s){const e=(c instanceof Array?c:s.ids.filter(n=>c(s.entities[n]))).filter(n=>n in s.entities).map(n=>delete s.entities[n]).length>0;return e&&(s.ids=s.ids.filter(n=>n in s.entities)),e?r.Both:r.None}function j(c,s){return I([c],s)}function I(c,s){const t={};return(c=c.filter(n=>n.id in s.entities)).length>0?c.filter(i=>function N(c,s,t){const n=Object.assign({},t.entities[s.id],s.changes),i=T(n,d),p=i!==s.id;return p&&(c[s.id]=i,delete t.entities[s.id]),t.entities[i]=n,p}(t,i,s)).length>0?(s.ids=s.ids.map(i=>t[i]||i),r.Both):r.EntitiesOnly:r.None}function K(c,s){const t=[],e=[];for(const p of c){const O=T(p,d);O in s.entities?e.push({id:O,changes:p}):t.push(p)}const n=I(e,s),i=S(t,s);switch(!0){case i===r.None&&n===r.None:return r.None;case i===r.Both||n===r.Both:return r.Both;default:return r.EntitiesOnly}}return{removeAll:function B(c){return Object.assign({},c,{ids:[],entities:{}})},addOne:h(g),addMany:h(S),setAll:h(function M(c,s){return s.ids=[],s.entities={},S(c,s),r.Both}),setOne:h(C),setMany:h(function b(c,s){const t=c.map(e=>C(e,s));switch(!0){case t.some(e=>e===r.Both):return r.Both;case t.some(e=>e===r.EntitiesOnly):return r.EntitiesOnly;default:return r.None}}),updateOne:h(j),updateMany:h(I),upsertOne:h(function Z(c,s){return K([c],s)}),upsertMany:h(K),removeOne:h(function m(c,s){return x([c],s)}),removeMany:h(x),map:h(function $(c,s){return I(s.ids.reduce((n,i)=>{const p=c(s.entities[i]);return p!==s.entities[i]&&n.push({id:i,changes:p}),n},[]).filter(({id:n})=>n in s.entities),s)}),mapOne:h(function H({map:c,id:s},t){const e=t.entities[s];return e?j({id:s,changes:c(e)},t):r.None})}}function w(d={}){const{selectId:g,sortComparer:S}=Object.assign({sortComparer:!1,selectId:m=>m.id},d),M=function Q(){return{getInitialState:function d(g={}){return Object.assign({ids:[],entities:{}},g)}}}(),C=function l(){return{getSelectors:function d(g){const S=m=>m.ids,M=m=>m.entities,C=(0,R.P1)(S,M,(m,x)=>m.map(B=>x[B])),b=(0,R.P1)(S,m=>m.length);return g?{selectIds:(0,R.P1)(g,S),selectEntities:(0,R.P1)(g,M),selectAll:(0,R.P1)(g,C),selectTotal:(0,R.P1)(g,b)}:{selectIds:S,selectEntities:M,selectAll:C,selectTotal:b}}}}(),b=S?function u(d,g){const{removeOne:S,removeMany:M,removeAll:C}=W(d);function b(t,e){return m([t],e)}function m(t,e){const n=t.filter(i=>!(T(i,d)in e.entities));return 0===n.length?r.None:(s(n,e),r.Both)}function B(t,e){const n=T(t,d);return n in e.entities?(e.ids=e.ids.filter(i=>i!==n),s([t],e),r.Both):b(t,e)}function j(t,e){return $([t],e)}function $(t,e){const n=[],i=t.filter(p=>function I(t,e,n){if(!(e.id in n.entities))return!1;const p=Object.assign({},n.entities[e.id],e.changes),O=T(p,d);return delete n.entities[e.id],t.push(p),O!==e.id}(n,p,e)).length>0;if(0===n.length)return r.None;{const p=e.ids,O=[];return e.ids=e.ids.filter((v,F)=>v in e.entities||(O.push(F),!1)),s(n,e),!i&&O.every(v=>e.ids[v]===p[v])?r.EntitiesOnly:r.Both}}function c(t,e){const n=[],i=[];for(const v of t){const F=T(v,d);F in e.entities?i.push({id:F,changes:v}):n.push(v)}const p=$(i,e),O=m(n,e);switch(!0){case O===r.None&&p===r.None:return r.None;case O===r.Both||p===r.Both:return r.Both;default:return r.EntitiesOnly}}function s(t,e){t.sort(g);const n=[];let i=0,p=0;for(;i<t.length&&p<e.ids.length;){const O=t[i],v=T(O,d),F=e.ids[p];g(O,e.entities[F])<=0?(n.push(v),i++):(n.push(F),p++)}e.ids=n.concat(i<t.length?t.slice(i).map(d):e.ids.slice(p)),t.forEach((O,v)=>{e.entities[d(O)]=O})}return{removeOne:S,removeMany:M,removeAll:C,addOne:h(b),updateOne:h(j),upsertOne:h(function K(t,e){return c([t],e)}),setAll:h(function x(t,e){return e.entities={},e.ids=[],m(t,e),r.Both}),setOne:h(B),setMany:h(function N(t,e){const n=t.map(i=>B(i,e));switch(!0){case n.some(i=>i===r.Both):return r.Both;case n.some(i=>i===r.EntitiesOnly):return r.EntitiesOnly;default:return r.None}}),addMany:h(m),updateMany:h($),upsertMany:h(c),map:h(function H(t,e){return $(e.ids.reduce((i,p)=>{const O=t(e.entities[p]);return O!==e.entities[p]&&i.push({id:p,changes:O}),i},[]),e)}),mapOne:h(function Z({map:t,id:e},n){const i=n.entities[e];return i?j({id:e,changes:t(i)},n):r.None})}}(g,S):W(g);return Object.assign(Object.assign(Object.assign({selectId:g,sortComparer:S},M),C),b)}}}]);