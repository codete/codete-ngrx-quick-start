"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[472],{81472:(Ce,dt,S)=>{S.r(dt),S.d(dt,{SubtasksComponent:()=>fe,TasksAppModule1:()=>ws,TasksContainer:()=>Ee,TasksEngineComponent:()=>Se,TasksEngineModule:()=>Ae,TasksEngineService:()=>W});var i=S(42520),_=S(2613),St=S(18123),G=S(66546),Z=S(68202),y=S(61038),T=S(38459),Q=S(64475),ut=S(53332),vt=S(28461),mt=S(6039),At=S(322),C=S(19345),M=S(67299),F=S(99443),D=S(34299),L=S(22975),P=S(11512),R=S(70655),J=S(56657),N=S(19746),B=S(98046),q=S(42083),z=S(93263),X=S(63593),nt=S(67793);function Y(n,e,t){let s,r=!1;return n&&"object"==typeof n?({bufferSize:s=1/0,windowTime:e=1/0,refCount:r=!1,scheduler:t}=n):s=null!=n?n:1/0,(0,nt.B)({connector:()=>new X.t(s,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}var et=S(63403),m=S(19624),f=S(39649),p=S(44441),u=S(96475),E=S(1980),v=S(89286);const{isArray:O}=Array;var V=S(49666);function K(...n){return 1===(n=function I(n){return 1===n.length&&O(n[0])?n[0]:n}(n)).length?(0,v.Xf)(n[0]):new E.y(function Ct(n){return e=>{let t=[];for(let s=0;t&&!e.closed&&s<n.length;s++)t.push((0,v.Xf)(n[s]).subscribe((0,V.x)(e,r=>{if(t){for(let a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(r)})))}}(n))}var Mt=S(93478),Me=S(64861),_e=S(71616);let rt=(()=>{class n{create(t,s,r,a){const o="string"==typeof t?Object.assign(Object.assign({},a||{}),{entityName:t,entityOp:s,data:r}):t;return this.createCore(o)}createCore(t){const{entityName:s,entityOp:r,tag:a}=t;if(!s)throw new Error("Missing entity name for new action");if(null==r)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(r,a||s),payload:t}}createFromAction(t,s){return this.create(Object.assign(Object.assign({},t.payload),s))}formatActionType(t,s){return`[${s}] ${t}`}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();class Yt{constructor(e,t){this.entityName=e,this.selectId=t}mustBeEntity(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should have a single entity.");const s=this.selectId(t);return this.isNotKeyType(s)&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeEntities(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const a=this.selectId(s);this.isNotKeyType(a)&&this.throwError(e,`, item ${r+1}, does not have a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entities")}mustBeKey(e){const t=this.extractData(e);if(!t)throw new Error("should be a single entity key");if(this.isNotKeyType(t))throw new Error("is not a valid key (id)");return t}mustBeKeys(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{this.isNotKeyType(s)&&this.throwError(e,`${this.entityName} ', item ${r+1}, is not a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entity keys (id)")}mustBeUpdate(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdates(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:o}=s,c=this.selectId(o);(this.isNotKeyType(a)||this.isNotKeyType(c))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}mustBeUpdateResponse(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdateResponses(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:o}=s,c=this.selectId(o);(this.isNotKeyType(a)||this.isNotKeyType(c))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}extractData(e){return e.payload&&e.payload.data}isNotKeyType(e){return"string"!=typeof e&&"number"!=typeof e}throwError(e,t){throw new Error(`${this.entityName} EntityAction guard for "${e.type}": payload ${t}`)}}function it(n){return null==n?void 0:n.id}function $t(n){if(null==n)return[];if(Array.isArray(n[0])){const[e,...t]=n;n=[...e,...t]}return n}function jt(n){return n=n||it,function(t){const s=n(t);if(null==s)throw new Error("Primary key may not be null/undefined.");return t&&{id:s,changes:t}}}function Pt(...n){const e=$t(n);switch(e.length){case 0:return(0,N.h)(s=>s.payload&&null!=s.payload.entityOp);case 1:const t=e[0];return(0,N.h)(s=>s.payload&&t===s.payload.entityOp);default:return(0,N.h)(s=>{const r=s.payload&&s.payload.entityOp;return r&&e.some(a=>a===r)})}}function Vt(...n){const e=$t(n);switch(e.length){case 0:return(0,N.h)(s=>s.payload&&null!=s.payload.entityName);case 1:const t=e[0];return(0,N.h)(s=>s.payload&&t===s.payload.entityName);default:return(0,N.h)(s=>{const r=s.payload&&s.payload.entityName;return!!r&&e.some(a=>a===r)})}}var $=(()=>{return(n=$||($={})).Add="Add",n.Delete="Delete",n.Update="Update",n.Upsert="Upsert",$;var n})();function Gt(n){const e=(n=n&&n.changes?n:{changes:[]}).changes.filter(t=>null!=t&&t.entities&&t.entities.length>0);return Object.assign(Object.assign({},n),{changes:e})}new class Oe{add(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:$.Add,entities:t}}delete(e,t){const s=Array.isArray(t)?t:t?[t]:[];return{entityName:e,op:$.Delete,entities:s}}update(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:$.Update,entities:t}}upsert(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:$.Upsert,entities:t}}};var x=(()=>{return(n=x||(x={}))[n.IgnoreChanges=0]="IgnoreChanges",n[n.PreserveChanges=1]="PreserveChanges",n[n.OverwriteChanges=2]="OverwriteChanges",x;var n})(),b=(()=>{return(n=b||(b={})).CLEAR_COLLECTIONS="@ngrx/data/entity-cache/clear-collections",n.LOAD_COLLECTIONS="@ngrx/data/entity-cache/load-collections",n.MERGE_QUERY_SET="@ngrx/data/entity-cache/merge-query-set",n.SET_ENTITY_CACHE="@ngrx/data/entity-cache/set-cache",n.SAVE_ENTITIES="@ngrx/data/entity-cache/save-entities",n.SAVE_ENTITIES_CANCEL="@ngrx/data/entity-cache/save-entities-cancel",n.SAVE_ENTITIES_CANCELED="@ngrx/data/entity-cache/save-entities-canceled",n.SAVE_ENTITIES_ERROR="@ngrx/data/entity-cache/save-entities-error",n.SAVE_ENTITIES_SUCCESS="@ngrx/data/entity-cache/save-entities-success",b;var n})();class De{constructor(e,t){this.type=b.CLEAR_COLLECTIONS,this.payload={collections:e,tag:t}}}class Te{constructor(e,t){this.type=b.LOAD_COLLECTIONS,this.payload={collections:e,tag:t}}}class be{constructor(e,t,s){this.type=b.MERGE_QUERY_SET,this.payload={querySet:e,mergeStrategy:null===t?x.PreserveChanges:t,tag:s}}}class ke{constructor(e,t){this.cache=e,this.type=b.SET_ENTITY_CACHE,this.payload={cache:e,tag:t}}}class Re{constructor(e,t,s){this.type=b.SAVE_ENTITIES,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}class Ue{constructor(e,t,s,r){this.type=b.SAVE_ENTITIES_CANCEL,this.payload={correlationId:e,reason:t,entityNames:s,tag:r}}}class Le{constructor(e,t,s){this.type=b.SAVE_ENTITIES_CANCELED,this.payload={correlationId:e,reason:t,tag:s}}}class Ne{constructor(e,t){this.type=b.SAVE_ENTITIES_ERROR,this.payload={error:e,originalAction:t,correlationId:t.payload.correlationId}}}class _t{constructor(e,t,s){this.type=b.SAVE_ENTITIES_SUCCESS,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}var d=(()=>{return(n=d||(d={})).CANCEL_PERSIST="@ngrx/data/cancel-persist",n.CANCELED_PERSIST="@ngrx/data/canceled-persist",n.QUERY_ALL="@ngrx/data/query-all",n.QUERY_ALL_SUCCESS="@ngrx/data/query-all/success",n.QUERY_ALL_ERROR="@ngrx/data/query-all/error",n.QUERY_LOAD="@ngrx/data/query-load",n.QUERY_LOAD_SUCCESS="@ngrx/data/query-load/success",n.QUERY_LOAD_ERROR="@ngrx/data/query-load/error",n.QUERY_MANY="@ngrx/data/query-many",n.QUERY_MANY_SUCCESS="@ngrx/data/query-many/success",n.QUERY_MANY_ERROR="@ngrx/data/query-many/error",n.QUERY_BY_KEY="@ngrx/data/query-by-key",n.QUERY_BY_KEY_SUCCESS="@ngrx/data/query-by-key/success",n.QUERY_BY_KEY_ERROR="@ngrx/data/query-by-key/error",n.SAVE_ADD_MANY="@ngrx/data/save/add-many",n.SAVE_ADD_MANY_ERROR="@ngrx/data/save/add-many/error",n.SAVE_ADD_MANY_SUCCESS="@ngrx/data/save/add-many/success",n.SAVE_ADD_ONE="@ngrx/data/save/add-one",n.SAVE_ADD_ONE_ERROR="@ngrx/data/save/add-one/error",n.SAVE_ADD_ONE_SUCCESS="@ngrx/data/save/add-one/success",n.SAVE_DELETE_MANY="@ngrx/data/save/delete-many",n.SAVE_DELETE_MANY_SUCCESS="@ngrx/data/save/delete-many/success",n.SAVE_DELETE_MANY_ERROR="@ngrx/data/save/delete-many/error",n.SAVE_DELETE_ONE="@ngrx/data/save/delete-one",n.SAVE_DELETE_ONE_SUCCESS="@ngrx/data/save/delete-one/success",n.SAVE_DELETE_ONE_ERROR="@ngrx/data/save/delete-one/error",n.SAVE_UPDATE_MANY="@ngrx/data/save/update-many",n.SAVE_UPDATE_MANY_SUCCESS="@ngrx/data/save/update-many/success",n.SAVE_UPDATE_MANY_ERROR="@ngrx/data/save/update-many/error",n.SAVE_UPDATE_ONE="@ngrx/data/save/update-one",n.SAVE_UPDATE_ONE_SUCCESS="@ngrx/data/save/update-one/success",n.SAVE_UPDATE_ONE_ERROR="@ngrx/data/save/update-one/error",n.SAVE_UPSERT_MANY="@ngrx/data/save/upsert-many",n.SAVE_UPSERT_MANY_SUCCESS="@ngrx/data/save/upsert-many/success",n.SAVE_UPSERT_MANY_ERROR="@ngrx/data/save/upsert-many/error",n.SAVE_UPSERT_ONE="@ngrx/data/save/upsert-one",n.SAVE_UPSERT_ONE_SUCCESS="@ngrx/data/save/upsert-one/success",n.SAVE_UPSERT_ONE_ERROR="@ngrx/data/save/upsert-one/error",n.ADD_ALL="@ngrx/data/add-all",n.ADD_MANY="@ngrx/data/add-many",n.ADD_ONE="@ngrx/data/add-one",n.REMOVE_ALL="@ngrx/data/remove-all",n.REMOVE_MANY="@ngrx/data/remove-many",n.REMOVE_ONE="@ngrx/data/remove-one",n.UPDATE_MANY="@ngrx/data/update-many",n.UPDATE_ONE="@ngrx/data/update-one",n.UPSERT_MANY="@ngrx/data/upsert-many",n.UPSERT_ONE="@ngrx/data/upsert-one",n.COMMIT_ALL="@ngrx/data/commit-all",n.COMMIT_MANY="@ngrx/data/commit-many",n.COMMIT_ONE="@ngrx/data/commit-one",n.UNDO_ALL="@ngrx/data/undo-all",n.UNDO_MANY="@ngrx/data/undo-many",n.UNDO_ONE="@ngrx/data/undo-one",n.SET_CHANGE_STATE="@ngrx/data/set-change-state",n.SET_COLLECTION="@ngrx/data/set-collection",n.SET_FILTER="@ngrx/data/set-filter",n.SET_LOADED="@ngrx/data/set-loaded",n.SET_LOADING="@ngrx/data/set-loading",d;var n})();const Ot="/success",Dt="/error";function Bt(n){return n+Ot}class st{constructor(e,t){this.error=e,this.requestData=t,this.message="string"==typeof e?e:function Fe(n){const{error:e,body:t,message:s}=n;let r=null;return e?r="string"==typeof e?e:e.message:s?r=s:t&&(r="string"==typeof t?t:t.error),"string"==typeof r?r:r?JSON.stringify(r):null}(e)}}class Tt{}class ht{}const bt=new i.OlP("@ngrx/data Plural Names");class Qt{}class zt{}let Ie=(()=>{class n{constructor(t){this.pluralizer=t,this.knownHttpResourceUrls={}}getResourceUrls(t,s){let r=this.knownHttpResourceUrls[t];if(!r){const a=function we(n){return n.replace(/^[/\s]+|[/\s]+$/g,"")}(s);r={entityResourceUrl:`${a}/${t}/`.toLowerCase(),collectionResourceUrl:`${a}/${this.pluralizer.pluralize(t)}/`.toLowerCase()},this.registerHttpResourceUrls({[t]:r})}return r}entityResource(t,s){return this.getResourceUrls(t,s).entityResourceUrl}collectionResource(t,s){return this.getResourceUrls(t,s).collectionResourceUrl}registerHttpResourceUrls(t){this.knownHttpResourceUrls=Object.assign(Object.assign({},this.knownHttpResourceUrls),t||{})}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(Qt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();class Ye{constructor(e,t,s,r){this.http=t,this.httpUrlGenerator=s,this.getDelay=0,this.saveDelay=0,this.timeout=0,this._name=`${e} DefaultDataService`,this.entityName=e;const{root:a="api",delete404OK:o=!0,getDelay:c=0,saveDelay:l=0,timeout:h=0}=r||{};this.delete404OK=o,this.entityUrl=s.entityResource(e,a),this.entitiesUrl=s.collectionResource(e,a),this.getDelay=c,this.saveDelay=l,this.timeout=h}get name(){return this._name}add(e){const t=e||new Error(`No "${this.entityName}" entity to add`);return this.execute("POST",this.entityUrl,t)}delete(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to delete`)),this.execute("DELETE",this.entityUrl+e,t).pipe((0,y.U)(s=>e))}getAll(){return this.execute("GET",this.entitiesUrl)}getById(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to get`)),this.execute("GET",this.entityUrl+e,t)}getWithQuery(e){const s=new p.LE("string"==typeof e?{fromString:e}:{fromObject:e});return this.execute("GET",this.entitiesUrl,void 0,{params:s})}update(e){const t=e&&e.id,s=null==t?new Error(`No "${this.entityName}" update data or id`):e.changes;return this.execute("PUT",this.entityUrl+t,s)}upsert(e){const t=e||new Error(`No "${this.entityName}" entity to upsert`);return this.execute("POST",this.entityUrl,t)}execute(e,t,s,r){const a={method:e,url:t,data:s,options:r};if(s instanceof Error)return this.handleError(a)(s);let o;switch(e){case"DELETE":o=this.http.delete(t,r),this.saveDelay&&(o=o.pipe((0,B.g)(this.saveDelay)));break;case"GET":o=this.http.get(t,r),this.getDelay&&(o=o.pipe((0,B.g)(this.getDelay)));break;case"POST":o=this.http.post(t,s,r),this.saveDelay&&(o=o.pipe((0,B.g)(this.saveDelay)));break;case"PUT":o=this.http.put(t,s,r),this.saveDelay&&(o=o.pipe((0,B.g)(this.saveDelay)));break;default:{const c=new Error("Unimplemented HTTP method, "+e);o=(0,u._)(c)}}return this.timeout&&(o=o.pipe((0,q.V)(this.timeout+this.saveDelay))),o.pipe((0,z.K)(this.handleError(a)))}handleError(e){return t=>{const s=this.handleDelete404(t,e);if(s)return s;const r=new st(t,e);return(0,u._)(r)}}handleDelete404(e,t){if(404===e.status&&"DELETE"===t.method&&this.delete404OK)return(0,G.of)({})}}let Kt=(()=>{class n{constructor(t,s,r){this.http=t,this.httpUrlGenerator=s,this.config=r,s.registerHttpResourceUrls((r=r||{}).entityHttpResourceUrls)}create(t){return new Ye(t,this.http,this.httpUrlGenerator,this.config)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(p.eN),i.LFG(zt),i.LFG(Tt,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();const Ht=new i.OlP("@ngrx/data Entity Metadata");let at=(()=>{class n{constructor(t){this.definitions={},t&&t.forEach(s=>this.registerMetadataMap(s))}getDefinition(t,s=!0){t=t.trim();const r=this.definitions[t];if(!r&&s)throw new Error(`No EntityDefinition for entity type "${t}".`);return r}registerMetadata(t){if(t){const s=function $e(n){let e=n.entityName;if(!e)throw new Error("Missing required entityName");n.entityName=e=e.trim();const t=n.selectId||it,s=n.sortComparer=n.sortComparer||!1,r=(0,_e.H)({selectId:t,sortComparer:s}),a=n.entityDispatcherOptions||{},o=r.getInitialState(Object.assign({entityName:e,filter:"",loaded:!1,loading:!1,changeState:{}},n.additionalCollectionState||{}));return{entityName:e,entityAdapter:r,entityDispatcherOptions:a,initialState:o,metadata:n,noChangeTracking:!0===n.noChangeTracking,selectId:t,sortComparer:s}}(t);this.registerDefinition(s)}}registerMetadataMap(t={}){Object.keys(t||{}).forEach(s=>this.registerMetadata(Object.assign({entityName:s},t[s])))}registerDefinition(t){this.definitions[t.entityName]=t}registerDefinitions(t){Object.assign(this.definitions,t)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(Ht,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();const Zt=$.Update;let Jt=(()=>{class n{constructor(t,s,r){this.entityDefinitionService=t,this.http=s,this.idSelectors={},this.saveDelay=0,this.timeout=0;const{saveDelay:a=0,timeout:o=0}=r||{};this.saveDelay=a,this.timeout=o}saveEntities(t,s){t=this.filterChangeSet(t),t=this.flattenUpdates(t);let r=this.http.post(s,t).pipe((0,y.U)(a=>this.restoreUpdates(a)),(0,z.K)(this.handleError({method:"POST",url:s,data:t})));return this.timeout&&(r=r.pipe((0,q.V)(this.timeout))),this.saveDelay&&(r=r.pipe((0,B.g)(this.saveDelay))),r}handleError(t){return s=>{const r=new st(s,t);return(0,u._)(r)}}filterChangeSet(t){return Gt(t)}flattenUpdates(t){let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>a.op===Zt&&a.entities.length>0?(r=!0,Object.assign(Object.assign({},a),{entities:a.entities.map(o=>o.changes)})):a),r?Object.assign(Object.assign({},t),{changes:s}):t}restoreUpdates(t){if(null==t)return t;let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>{if(a.op===Zt){r=!0;const o=this.getIdSelector(a.entityName);return Object.assign(Object.assign({},a),{entities:a.entities.map(c=>({id:o(c),changes:c}))})}return a}),r?Object.assign(Object.assign({},t),{changes:s}):t}getIdSelector(t){let s=this.idSelectors[t];return s||(s=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=s),s}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(at),i.LFG(p.eN),i.LFG(Tt,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),Wt=(()=>{class n{constructor(t){this.defaultDataServiceFactory=t,this.services={}}getService(t){t=t.trim();let s=this.services[t];return s||(s=this.defaultDataServiceFactory.create(t),this.services[t]=s),s}registerService(t,s){this.services[t.trim()]=s}registerServices(t){this.services=Object.assign(Object.assign({},this.services),t)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(Kt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();class qt{}let je=(()=>{class n{constructor(t,s){this.logger=t,this.entityActionFactory=s}handleSuccess(t){const s=Bt(t.payload.entityOp);return r=>this.entityActionFactory.createFromAction(t,{entityOp:s,data:r})}handleError(t){const s=function xe(n){return n+Dt}(t.payload.entityOp);return r=>{const o={error:r instanceof st?r:new st(r,null),originalAction:t};return this.logger.error(o),this.entityActionFactory.createFromAction(t,{entityOp:s,data:o})}}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(ht),i.LFG(rt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();class Xt{constructor(e){this.message=e,this.message=e||"Canceled by user"}}let kt=(()=>{class n{constructor(){this.seed=0,this.prefix="CRID"}next(){return this.seed+=1,this.prefix+this.seed}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),Rt=(()=>{class n{constructor(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),Pe=(()=>{class n{constructor(t,s,r,a){this.correlationIdGenerator=t,this.defaultDispatcherOptions=s,this.store=a,this.reducedActions$=r.pipe(Y(1)),this.raSubscription=this.reducedActions$.subscribe()}dispatch(t){return this.store.dispatch(t),t}cancelSaveEntities(t,s,r,a){if(!t)throw new Error("Missing correlationId");const o=new Ue(t,s,r,a);this.dispatch(o)}clearCollections(t,s){this.dispatch(new De(t,s))}loadCollections(t,s){this.dispatch(new Te(t,s))}mergeQuerySet(t,s,r){this.dispatch(new be(t,s,r))}setEntityCache(t,s){this.dispatch(new ke(t,s))}saveEntities(t,s,r){const a=Array.isArray(t)?{changes:t}:t,o=null==(r=r||{}).correlationId?this.correlationIdGenerator.next():r.correlationId,c=null==r.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===r.isOptimistic,l=r.tag||"Save Entities";r=Object.assign(Object.assign({},r),{correlationId:o,isOptimistic:c,tag:l});const h=new Re(a,s,r);return this.dispatch(h),this.getSaveEntitiesResponseData$(r.correlationId).pipe(Y(1))}getSaveEntitiesResponseData$(t){return this.reducedActions$.pipe((0,N.h)(s=>s.type===b.SAVE_ENTITIES_SUCCESS||s.type===b.SAVE_ENTITIES_ERROR||s.type===b.SAVE_ENTITIES_CANCEL),(0,N.h)(s=>t===s.payload.correlationId),(0,et.q)(1),(0,m.z)(s=>s.type===b.SAVE_ENTITIES_CANCEL?(0,u._)(new Xt(s.payload.reason)):s.type===b.SAVE_ENTITIES_SUCCESS?(0,G.of)(s.payload.changeSet):(0,u._)(s.payload)))}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(kt),i.LFG(Rt),i.LFG(_.Y$),i.LFG(_.yh))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();class Ve{constructor(e,t,s,r=it,a,o,c,l){this.entityName=e,this.entityActionFactory=t,this.store=s,this.selectId=r,this.defaultDispatcherOptions=a,this.reducedActions$=o,this.correlationIdGenerator=l,this.guard=new Yt(e,r),this.toUpdate=jt(r);const h=(0,_.P1)(c,g=>g[e]);this.entityCollection$=s.select(h)}createEntityAction(e,t,s){return this.entityActionFactory.create(Object.assign({entityName:this.entityName,entityOp:e,data:t},s))}createAndDispatch(e,t,s){const r=this.createEntityAction(e,t,s);return this.dispatch(r),r}dispatch(e){return this.store.dispatch(e),e}add(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticAdd);const s=this.createEntityAction(d.SAVE_ADD_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,Z.M)(this.entityCollection$),(0,y.U)(([r,a])=>a.entities[this.selectId(r)]),Y(1))}cancel(e,t,s){if(!e)throw new Error("Missing correlationId");this.createAndDispatch(d.CANCEL_PERSIST,t,{correlationId:e})}delete(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticDelete);const s=this.getKey(e),r=this.createEntityAction(d.SAVE_DELETE_ONE,s,t);return this.guard.mustBeKey(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,y.U)(()=>s),Y(1))}getAll(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(d.QUERY_ALL,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe((0,Z.M)(this.entityCollection$),(0,y.U)(([s,r])=>s.reduce((a,o)=>{const c=r.entities[this.selectId(o)];return c&&a.push(c),a},[])),Y(1))}getByKey(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(d.QUERY_BY_KEY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,Z.M)(this.entityCollection$),(0,y.U)(([r,a])=>a.entities[this.selectId(r)]),Y(1))}getWithQuery(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(d.QUERY_MANY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,Z.M)(this.entityCollection$),(0,y.U)(([r,a])=>r.reduce((o,c)=>{const l=a.entities[this.selectId(c)];return l&&o.push(l),o},[])),Y(1))}load(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(d.QUERY_LOAD,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(Y(1))}update(e,t){const s=this.toUpdate(e);t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpdate);const r=this.createEntityAction(d.SAVE_UPDATE_ONE,s,t);return t.isOptimistic&&this.guard.mustBeUpdate(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,y.U)(a=>a.changes),(0,Z.M)(this.entityCollection$),(0,y.U)(([a,o])=>o.entities[this.selectId(a)]),Y(1))}upsert(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpsert);const s=this.createEntityAction(d.SAVE_UPSERT_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,Z.M)(this.entityCollection$),(0,y.U)(([r,a])=>a.entities[this.selectId(r)]),Y(1))}addAllToCache(e,t){this.createAndDispatch(d.ADD_ALL,e,t)}addOneToCache(e,t){this.createAndDispatch(d.ADD_ONE,e,t)}addManyToCache(e,t){this.createAndDispatch(d.ADD_MANY,e,t)}clearCache(e){this.createAndDispatch(d.REMOVE_ALL,void 0,e)}removeOneFromCache(e,t){this.createAndDispatch(d.REMOVE_ONE,this.getKey(e),t)}removeManyFromCache(e,t){if(!e||0===e.length)return;const s="object"==typeof e[0]?e.map(r=>this.getKey(r)):e;this.createAndDispatch(d.REMOVE_MANY,s,t)}updateOneInCache(e,t){const s=this.toUpdate(e);this.createAndDispatch(d.UPDATE_ONE,s,t)}updateManyInCache(e,t){if(!e||0===e.length)return;const s=e.map(r=>this.toUpdate(r));this.createAndDispatch(d.UPDATE_MANY,s,t)}upsertOneInCache(e,t){this.createAndDispatch(d.UPSERT_ONE,e,t)}upsertManyInCache(e,t){!e||0===e.length||this.createAndDispatch(d.UPSERT_MANY,e,t)}setFilter(e){this.createAndDispatch(d.SET_FILTER,e)}setLoaded(e){this.createAndDispatch(d.SET_LOADED,!!e)}setLoading(e){this.createAndDispatch(d.SET_LOADING,!!e)}getKey(e){return"object"==typeof e?this.selectId(e):e}getResponseData$(e){return this.reducedActions$.pipe((0,N.h)(t=>!!t.payload),(0,N.h)(t=>{const{correlationId:s,entityName:r,entityOp:a}=t.payload;return r===this.entityName&&s===e&&(a.endsWith(Ot)||a.endsWith(Dt)||a===d.CANCEL_PERSIST)}),(0,et.q)(1),(0,m.z)(t=>{const{entityOp:s}=t.payload;return s===d.CANCEL_PERSIST?(0,u._)(new Xt(t.payload.data)):s.endsWith(Ot)?(0,G.of)(t.payload.data):(0,u._)(t.payload.data.error)}))}setQueryEntityActionOptions(e){const t=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId;return Object.assign(Object.assign({},e),{correlationId:t})}setSaveEntityActionOptions(e,t){const s=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId,r=null==e.isOptimistic?t||!1:!0===e.isOptimistic;return Object.assign(Object.assign({},e),{correlationId:s,isOptimistic:r})}}const lt="entityCache",Ut=new i.OlP("@ngrx/data Entity Cache Name"),Lt=new i.OlP("@ngrx/data Entity Cache Meta Reducers"),Nt=new i.OlP("@ngrx/data Entity Collection Meta Reducers"),Ge=new i.OlP("@ngrx/data Initial Entity Cache State"),yt=new i.OlP("@ngrx/data Entity Cache Selector"),Be={provide:yt,useFactory:te,deps:[[new i.FiY,Ut]]};function te(n){return(0,_.ZF)(n=n||lt)}let xt=(()=>{class n{constructor(t,s,r,a,o,c){this.entityActionFactory=t,this.store=s,this.entityDispatcherDefaultOptions=r,this.entityCacheSelector=o,this.correlationIdGenerator=c,this.reducedActions$=a.pipe(Y(1)),this.raSubscription=this.reducedActions$.subscribe()}create(t,s=it,r={}){const a=Object.assign(Object.assign({},this.entityDispatcherDefaultOptions),r);return new Ve(t,this.entityActionFactory,this.store,s,a,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)}ngOnDestroy(){this.raSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(rt),i.LFG(_.yh),i.LFG(Rt),i.LFG(_.Y$),i.LFG(yt),i.LFG(kt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();const ee=new i.OlP("@ngrx/data Entity Effects Scheduler");let se=(()=>{class n{constructor(t,s,r,a,o){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.logger=a,this.scheduler=o,this.responseDelay=10,this.saveEntitiesCancel$=(0,D.GW)(()=>this.actions.pipe((0,D.l4)(b.SAVE_ENTITIES_CANCEL),(0,N.h)(c=>null!=c.payload.correlationId)),{dispatch:!1}),this.saveEntities$=(0,D.GW)(()=>this.actions.pipe((0,D.l4)(b.SAVE_ENTITIES),(0,m.z)(c=>this.saveEntities(c))))}saveEntities(t){const s=t.payload.error;if(s)return this.handleSaveEntitiesError$(t)(s);try{const r=Gt(t.payload.changeSet),{correlationId:a,mergeStrategy:o,tag:c,url:l}=t.payload,h={correlationId:a,mergeStrategy:o,tag:c};if(0===r.changes.length)return(0,G.of)(new _t(r,l,h));return K(this.saveEntitiesCancel$.pipe((0,N.h)(k=>a===k.payload.correlationId),(0,y.U)(k=>new Le(a,k.payload.reason,k.payload.tag))),this.dataService.saveEntities(r,l).pipe((0,f.b)(k=>this.handleSaveEntitiesSuccess$(t,this.entityActionFactory)(k)),(0,z.K)(this.handleSaveEntitiesError$(t))))}catch(r){return this.handleSaveEntitiesError$(t)(r)}}handleSaveEntitiesError$(t){return s=>{const r=s instanceof st?s:new st(s,null);return(0,G.of)(new Ne(r,t)).pipe((0,B.g)(this.responseDelay,this.scheduler||Mt.z))}}handleSaveEntitiesSuccess$(t,s){const{url:r,correlationId:a,mergeStrategy:o,tag:c}=t.payload,l={correlationId:a,mergeStrategy:o,tag:c};return h=>{if(h)return(0,G.of)(new _t(h,r,l));if(h=t.payload.changeSet,!t.payload.isOptimistic)return(0,G.of)(new _t(h,r,l));const g=h.changes.reduce((A,k)=>-1===A.indexOf(k.entityName)?A.concat(k.entityName):A,[]);return(0,Me.T)(g.map(A=>s.create(A,d.SET_LOADING,!1)))}}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(D.eX),i.LFG(Jt),i.LFG(rt),i.LFG(ht),i.LFG(ee,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();const Qe=[d.QUERY_ALL,d.QUERY_LOAD,d.QUERY_BY_KEY,d.QUERY_MANY,d.SAVE_ADD_ONE,d.SAVE_DELETE_ONE,d.SAVE_UPDATE_ONE,d.SAVE_UPSERT_ONE];let ne=(()=>{class n{constructor(t,s,r,a,o){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.resultHandler=a,this.scheduler=o,this.responseDelay=10,this.cancel$=(0,D.GW)(()=>this.actions.pipe(Pt(d.CANCEL_PERSIST),(0,y.U)(c=>c.payload.correlationId),(0,N.h)(c=>null!=c)),{dispatch:!1}),this.persist$=(0,D.GW)(()=>this.actions.pipe(Pt(Qe),(0,m.z)(c=>this.persist(c))))}persist(t){if(t.payload.skip)return this.handleSkipSuccess$(t);if(t.payload.error)return this.handleError$(t)(t.payload.error);try{return K(this.cancel$.pipe((0,N.h)(a=>t.payload.correlationId===a),(0,y.U)(a=>this.entityActionFactory.createFromAction(t,{entityOp:d.CANCELED_PERSIST}))),this.callDataService(t).pipe((0,y.U)(this.resultHandler.handleSuccess(t)),(0,z.K)(this.handleError$(t))))}catch(s){return this.handleError$(t)(s)}}callDataService(t){const{entityName:s,entityOp:r,data:a}=t.payload,o=this.dataService.getService(s);switch(r){case d.QUERY_ALL:case d.QUERY_LOAD:return o.getAll();case d.QUERY_BY_KEY:return o.getById(a);case d.QUERY_MANY:return o.getWithQuery(a);case d.SAVE_ADD_ONE:return o.add(a);case d.SAVE_DELETE_ONE:return o.delete(a);case d.SAVE_UPDATE_ONE:const{id:c,changes:l}=a;return o.update(a).pipe((0,y.U)(h=>h&&Object.keys(h).length>0?{id:c,changes:Object.assign(Object.assign({},l),h),changed:!0}:{id:c,changes:l,changed:!1}));case d.SAVE_UPSERT_ONE:return o.upsert(a).pipe((0,y.U)(h=>h&&Object.keys(h).length>0?h:a));default:throw new Error(`Persistence action "${r}" is not implemented.`)}}handleError$(t){return s=>(0,G.of)(this.resultHandler.handleError(t)(s)).pipe((0,B.g)(this.responseDelay,this.scheduler||Mt.z))}handleSkipSuccess$(t){const s=Bt(t.payload.entityOp),r=this.entityActionFactory.createFromAction(t,{entityOp:s});return(0,G.of)(r).pipe((0,B.g)(this.responseDelay,this.scheduler||Mt.z))}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(D.eX),i.LFG(Wt),i.LFG(rt),i.LFG(qt),i.LFG(ee,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();class Ft{constructor(e,t){this.entityName=e,e=e.trim();const{dispatcher:s,selectors:r,selectors$:a}=t.create(e);this.entityName=e,this.dispatcher=s,this.guard=s.guard,this.selectId=s.selectId,this.toUpdate=s.toUpdate,this.selectors=r,this.selectors$=a,this.collection$=a.collection$,this.count$=a.count$,this.entities$=a.entities$,this.entityActions$=a.entityActions$,this.entityMap$=a.entityMap$,this.errors$=a.errors$,this.filter$=a.filter$,this.filteredEntities$=a.filteredEntities$,this.keys$=a.keys$,this.loaded$=a.loaded$,this.loading$=a.loading$,this.changeState$=a.changeState$}createEntityAction(e,t,s){return this.dispatcher.createEntityAction(e,t,s)}createAndDispatch(e,t,s){return this.dispatcher.createAndDispatch(e,t,s)}dispatch(e){return this.dispatcher.dispatch(e)}get store(){return this.dispatcher.store}add(e,t){return this.dispatcher.add(e,t)}cancel(e,t,s){this.dispatcher.cancel(e,t,s)}delete(e,t){return this.dispatcher.delete(e,t)}getAll(e){return this.dispatcher.getAll(e)}getByKey(e,t){return this.dispatcher.getByKey(e,t)}getWithQuery(e,t){return this.dispatcher.getWithQuery(e,t)}load(e){return this.dispatcher.load(e)}update(e,t){return this.dispatcher.update(e,t)}upsert(e,t){return this.dispatcher.upsert(e,t)}addAllToCache(e,t){this.dispatcher.addAllToCache(e,t)}addOneToCache(e,t){this.dispatcher.addOneToCache(e,t)}addManyToCache(e,t){this.dispatcher.addManyToCache(e,t)}clearCache(){this.dispatcher.clearCache()}removeOneFromCache(e,t){this.dispatcher.removeOneFromCache(e,t)}removeManyFromCache(e,t){this.dispatcher.removeManyFromCache(e,t)}updateOneInCache(e,t){this.dispatcher.updateOneInCache(e,t)}updateManyInCache(e,t){this.dispatcher.updateManyInCache(e,t)}upsertOneInCache(e,t){this.dispatcher.upsertOneInCache(e,t)}upsertManyInCache(e,t){this.dispatcher.upsertManyInCache(e,t)}setFilter(e){this.dispatcher.setFilter(e)}setLoaded(e){this.dispatcher.setLoaded(!!e)}setLoading(e){this.dispatcher.setLoading(!!e)}}let pt=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return s&&s.initialState||function ze(n){return{entityName:n,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}(t)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(at,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),re=(()=>{class n{constructor(t,s){this.entityCollectionCreator=t||new pt,this.selectEntityCache=s||te(lt)}createCollectionSelector(t){return(0,_.P1)(this.selectEntityCache,(r={})=>r[t]||this.entityCollectionCreator.create(t))}createCollectionSelectors(t){const s="string"==typeof t?{entityName:t}:t,r=U=>U.ids,a=U=>U.entities,o=(0,_.P1)(r,a,(U,ct)=>U.map(Ys=>ct[Ys])),c=(0,_.P1)(r,U=>U.length),l=U=>U.filter,h=s.filterFn,g=h?(0,_.P1)(o,l,(U,ct)=>h(U,ct)):o,ot={};return Object.keys(s.additionalCollectionState||{}).forEach(U=>{ot["select"+U[0].toUpperCase()+U.slice(1)]=ct=>ct[U]}),Object.assign({selectCount:c,selectEntities:o,selectEntityMap:a,selectFilter:l,selectFilteredEntities:g,selectKeys:r,selectLoaded:U=>U.loaded,selectLoading:U=>U.loading,selectChangeState:U=>U.changeState},ot)}create(t){const s="string"==typeof t?{entityName:t}:t,r=s.entityName,a=this.createCollectionSelector(r),o=this.createCollectionSelectors(s),c={};return Object.keys(o).forEach(l=>{c[l]=(0,_.P1)(a,o[l])}),Object.assign({entityName:r,selectCollection:a,selectEntityCache:this.selectEntityCache},c)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(pt,8),i.LFG(yt,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),It=(()=>{class n{constructor(t,s,r){this.store=t,this.actions=s,this.selectEntityCache=r,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=s.pipe((0,N.h)(a=>a.payload&&a.payload.entityOp&&a.payload.entityOp.endsWith(Dt)),Y(1))}create(t,s){const r={entityName:t};return Object.keys(s).forEach(a=>{if(a.startsWith("select")){const o=a[6].toLowerCase()+a.substr(7)+"$";r[o]=this.store.select(s[a])}}),r.entityActions$=this.actions.pipe(Vt(t)),r.errors$=this.entityActionErrors$.pipe(Vt(t)),r}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(_.yh),i.LFG(D.eX),i.LFG(yt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),gt=(()=>{class n{constructor(t,s,r,a){this.entityDispatcherFactory=t,this.entityDefinitionService=s,this.entitySelectorsFactory=r,this.entitySelectors$Factory=a}create(t){t=t.trim();const s=this.entityDefinitionService.getDefinition(t),r=this.entityDispatcherFactory.create(t,s.selectId,s.entityDispatcherOptions),a=this.entitySelectorsFactory.create(s.metadata);return{dispatcher:r,entityName:t,selectors:a,selectors$:this.entitySelectors$Factory.create(t,a)}}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(xt),i.LFG(at),i.LFG(re),i.LFG(It))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),ie=(()=>{class n{constructor(t){this.entityCollectionServiceElementsFactory=t}create(t){return new Ft(t,this.entityCollectionServiceElementsFactory)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(gt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),ae=(()=>{class n{constructor(t,s,r,a){this.entityCollectionServiceFactory=t,this.store=a,this.entityActionErrors$=r.entityActionErrors$,this.entityCache$=r.entityCache$,this.reducedActions$=s.reducedActions$}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(ie),i.LFG(xt),i.LFG(It),i.LFG(_.yh))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),Ke=(()=>{class n{constructor(t){this.entityServicesElements=t,this.EntityCollectionServices={}}get entityActionErrors$(){return this.entityServicesElements.entityActionErrors$}get entityCache$(){return this.entityServicesElements.entityCache$}get entityCollectionServiceFactory(){return this.entityServicesElements.entityCollectionServiceFactory}get reducedActions$(){return this.entityServicesElements.reducedActions$}get store(){return this.entityServicesElements.store}dispatch(t){this.store.dispatch(t)}createEntityCollectionService(t){return this.entityCollectionServiceFactory.create(t)}getEntityCollectionService(t){let s=this.EntityCollectionServices[t];return s||(s=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=s),s}registerEntityCollectionService(t,s){this.EntityCollectionServices[s||t.entityName]=t}registerEntityCollectionServices(t){Array.isArray(t)?t.forEach(s=>this.registerEntityCollectionService(s)):Object.keys(t||{}).forEach(s=>{this.registerEntityCollectionService(t[s],s)})}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(ae))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();class He{}var w=(()=>{return(n=w||(w={}))[n.Unchanged=0]="Unchanged",n[n.Added=1]="Added",n[n.Deleted=2]="Deleted",n[n.Updated=3]="Updated",w;var n})();class Ze{constructor(e,t){this.adapter=e,this.selectId=t,this.selectId=t||it}commitAll(e){return 0===Object.keys(e.changeState).length?e:Object.assign(Object.assign({},e),{changeState:{}})}commitMany(e,t){if(null==e||0===e.length)return t;let s=!1;const r=e.reduce((a,o)=>{const c="object"==typeof o?this.selectId(o):o;return a[c]&&(s||(a=Object.assign({},a),s=!0),delete a[c]),a},t.changeState);return s?Object.assign(Object.assign({},t),{changeState:r}):t}commitOne(e,t){return null==e?t:this.commitMany([e],t)}mergeQueryResults(e,t,s){return this.mergeServerUpserts(e,t,x.PreserveChanges,s)}mergeSaveAdds(e,t,s){return this.mergeServerUpserts(e,t,x.OverwriteChanges,s)}mergeSaveDeletes(e,t,s){const r=e;return t=(s=null==s?x.OverwriteChanges:s)===x.IgnoreChanges?t:this.commitMany(r,t),this.adapter.removeMany(r,t)}mergeSaveUpdates(e,t,s,r=!1){if(null==e||0===e.length)return t;let c,a=!1,o=t.changeState;switch(s=null==s?x.OverwriteChanges:s){case x.IgnoreChanges:return c=l(e),this.adapter.updateMany(c,t);case x.OverwriteChanges:return o=e.reduce((h,g)=>{const A=g.id;return h[A]&&(a||(h=Object.assign({},h),a=!0),delete h[A]),h},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:o}):t,c=l(e),this.adapter.updateMany(c,t);case x.PreserveChanges:{const h=[];return o=e.reduce((g,A)=>{const k=A.id,H=g[k];if(H){a||(g=Object.assign({},g),a=!0);const Et=this.selectId(A.changes),ot=H;Et!==k&&delete g[k];const U=Object.assign(Object.assign({},ot.originalValue),A.changes);g[Et]=Object.assign(Object.assign({},ot),{originalValue:U})}else h.push(A);return g},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:o}):t,c=l(h),this.adapter.updateMany(c,t)}}function l(h){return!0===r&&(h=h.filter(g=>!0===g.changed)),h.map(g=>({id:g.id,changes:g.changes}))}}mergeSaveUpserts(e,t,s){return this.mergeServerUpserts(e,t,x.OverwriteChanges,s)}mergeServerUpserts(e,t,s,r){if(null==e||0===e.length)return t;let a=!1,o=t.changeState;switch(r=null==r?s:r){case x.IgnoreChanges:return this.adapter.upsertMany(e,t);case x.OverwriteChanges:return t=this.adapter.upsertMany(e,t),o=e.reduce((c,l)=>{const h=this.selectId(l);return c[h]&&(a||(c=Object.assign({},c),a=!0),delete c[h]),c},t.changeState),a?Object.assign(Object.assign({},t),{changeState:o}):t;case x.PreserveChanges:{const c=[];return o=e.reduce((l,h)=>{const g=this.selectId(h);return l[g]?a||(l=Object.assign(Object.assign({},l),{[g]:Object.assign(Object.assign({},l[g]),{originalValue:h})}),a=!0):c.push(h),l},t.changeState),t=this.adapter.upsertMany(c,t),a?Object.assign(Object.assign({},t),{changeState:o}):t}}}trackAddMany(e,t,s){if(s===x.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=e.reduce((o,c)=>{const l=this.selectId(c);if(null==l||""===l)throw new Error(`${t.entityName} entity add requires a key to be tracked`);return o[l]||(r||(r=!0,o=Object.assign({},o)),o[l]={changeType:w.Added}),o},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:a}):t}trackAddOne(e,t,s){return null==e?t:this.trackAddMany([e],t,s)}trackDeleteMany(e,t,s){if(s===x.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((c,l)=>{const h=a[l];if(h){const A=c[l];A?A.changeType===w.Added?(g(),delete c[l]):A.changeType===w.Updated&&(g(),c[l]=Object.assign(Object.assign({},c[l]),{changeType:w.Deleted})):(g(),c[l]={changeType:w.Deleted,originalValue:h})}return c;function g(){r||(r=!0,c=Object.assign({},c))}},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackDeleteOne(e,t,s){return null==e?t:this.trackDeleteMany([e],t,s)}trackUpdateMany(e,t,s){if(s===x.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((c,l)=>{const{id:h}=l;if(null==h||""===h)throw new Error(`${t.entityName} entity update requires a key to be tracked`);const A=a[h];return A&&(c[h]||(r||(r=!0,c=Object.assign({},c)),c[h]={changeType:w.Updated,originalValue:A})),c},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackUpdateOne(e,t,s){return null==e?t:this.trackUpdateMany([e],t,s)}trackUpsertMany(e,t,s){if(s===x.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((c,l)=>{const h=this.selectId(l);if(null==h||""===h)throw new Error(`${t.entityName} entity upsert requires a key to be tracked`);if(!c[h]){r||(r=!0,c=Object.assign({},c));const A=a[h];c[h]=null==A?{changeType:w.Added}:{changeType:w.Updated,originalValue:A}}return c},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackUpsertOne(e,t,s){return null==e?t:this.trackUpsertMany([e],t,s)}undoAll(e){const t=Object.keys(e.changeState),{remove:s,upsert:r}=t.reduce((a,o)=>{const c=a.chgState[o];switch(c.changeType){case w.Added:a.remove.push(o);break;case w.Deleted:const l=c.originalValue;l&&a.upsert.push(l);break;case w.Updated:a.upsert.push(c.originalValue)}return a},{remove:[],upsert:[],chgState:e.changeState});return e=this.adapter.removeMany(s,e),e=this.adapter.upsertMany(r,e),Object.assign(Object.assign({},e),{changeState:{}})}undoMany(e,t){if(null==e||0===e.length)return t;let s=!1;const{changeState:r,remove:a,upsert:o}=e.reduce((c,l)=>{let h=c.changeState;const g="object"==typeof l?this.selectId(l):l,A=h[g];if(A)switch(s||(h=Object.assign({},h),s=!0),delete h[g],c.changeState=h,A.changeType){case w.Added:c.remove.push(g);break;case w.Deleted:const k=A.originalValue;k&&c.upsert.push(k);break;case w.Updated:c.upsert.push(A.originalValue)}return c},{remove:[],upsert:[],changeState:t.changeState});return t=this.adapter.removeMany(a,t),t=this.adapter.upsertMany(o,t),s?Object.assign(Object.assign({},t),{changeState:r}):t}undoOne(e,t){return null==e?t:this.undoMany([e],t)}}class Je{constructor(e,t,s){this.entityName=e,this.definition=t,this.methods={[d.CANCEL_PERSIST]:this.cancelPersist.bind(this),[d.QUERY_ALL]:this.queryAll.bind(this),[d.QUERY_ALL_ERROR]:this.queryAllError.bind(this),[d.QUERY_ALL_SUCCESS]:this.queryAllSuccess.bind(this),[d.QUERY_BY_KEY]:this.queryByKey.bind(this),[d.QUERY_BY_KEY_ERROR]:this.queryByKeyError.bind(this),[d.QUERY_BY_KEY_SUCCESS]:this.queryByKeySuccess.bind(this),[d.QUERY_LOAD]:this.queryLoad.bind(this),[d.QUERY_LOAD_ERROR]:this.queryLoadError.bind(this),[d.QUERY_LOAD_SUCCESS]:this.queryLoadSuccess.bind(this),[d.QUERY_MANY]:this.queryMany.bind(this),[d.QUERY_MANY_ERROR]:this.queryManyError.bind(this),[d.QUERY_MANY_SUCCESS]:this.queryManySuccess.bind(this),[d.SAVE_ADD_MANY]:this.saveAddMany.bind(this),[d.SAVE_ADD_MANY_ERROR]:this.saveAddManyError.bind(this),[d.SAVE_ADD_MANY_SUCCESS]:this.saveAddManySuccess.bind(this),[d.SAVE_ADD_ONE]:this.saveAddOne.bind(this),[d.SAVE_ADD_ONE_ERROR]:this.saveAddOneError.bind(this),[d.SAVE_ADD_ONE_SUCCESS]:this.saveAddOneSuccess.bind(this),[d.SAVE_DELETE_MANY]:this.saveDeleteMany.bind(this),[d.SAVE_DELETE_MANY_ERROR]:this.saveDeleteManyError.bind(this),[d.SAVE_DELETE_MANY_SUCCESS]:this.saveDeleteManySuccess.bind(this),[d.SAVE_DELETE_ONE]:this.saveDeleteOne.bind(this),[d.SAVE_DELETE_ONE_ERROR]:this.saveDeleteOneError.bind(this),[d.SAVE_DELETE_ONE_SUCCESS]:this.saveDeleteOneSuccess.bind(this),[d.SAVE_UPDATE_MANY]:this.saveUpdateMany.bind(this),[d.SAVE_UPDATE_MANY_ERROR]:this.saveUpdateManyError.bind(this),[d.SAVE_UPDATE_MANY_SUCCESS]:this.saveUpdateManySuccess.bind(this),[d.SAVE_UPDATE_ONE]:this.saveUpdateOne.bind(this),[d.SAVE_UPDATE_ONE_ERROR]:this.saveUpdateOneError.bind(this),[d.SAVE_UPDATE_ONE_SUCCESS]:this.saveUpdateOneSuccess.bind(this),[d.SAVE_UPSERT_MANY]:this.saveUpsertMany.bind(this),[d.SAVE_UPSERT_MANY_ERROR]:this.saveUpsertManyError.bind(this),[d.SAVE_UPSERT_MANY_SUCCESS]:this.saveUpsertManySuccess.bind(this),[d.SAVE_UPSERT_ONE]:this.saveUpsertOne.bind(this),[d.SAVE_UPSERT_ONE_ERROR]:this.saveUpsertOneError.bind(this),[d.SAVE_UPSERT_ONE_SUCCESS]:this.saveUpsertOneSuccess.bind(this),[d.ADD_ALL]:this.addAll.bind(this),[d.ADD_MANY]:this.addMany.bind(this),[d.ADD_ONE]:this.addOne.bind(this),[d.REMOVE_ALL]:this.removeAll.bind(this),[d.REMOVE_MANY]:this.removeMany.bind(this),[d.REMOVE_ONE]:this.removeOne.bind(this),[d.UPDATE_MANY]:this.updateMany.bind(this),[d.UPDATE_ONE]:this.updateOne.bind(this),[d.UPSERT_MANY]:this.upsertMany.bind(this),[d.UPSERT_ONE]:this.upsertOne.bind(this),[d.COMMIT_ALL]:this.commitAll.bind(this),[d.COMMIT_MANY]:this.commitMany.bind(this),[d.COMMIT_ONE]:this.commitOne.bind(this),[d.UNDO_ALL]:this.undoAll.bind(this),[d.UNDO_MANY]:this.undoMany.bind(this),[d.UNDO_ONE]:this.undoOne.bind(this),[d.SET_CHANGE_STATE]:this.setChangeState.bind(this),[d.SET_COLLECTION]:this.setCollection.bind(this),[d.SET_FILTER]:this.setFilter.bind(this),[d.SET_LOADED]:this.setLoaded.bind(this),[d.SET_LOADING]:this.setLoading.bind(this)},this.adapter=t.entityAdapter,this.isChangeTracking=!0!==t.noChangeTracking,this.selectId=t.selectId,this.guard=new Yt(e,this.selectId),this.toUpdate=jt(this.selectId),this.entityChangeTracker=s||new Ze(this.adapter,this.selectId)}cancelPersist(e){return this.setLoadingFalse(e)}queryAll(e){return this.setLoadingTrue(e)}queryAllError(e,t){return this.setLoadingFalse(e)}queryAllSuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}queryByKey(e,t){return this.setLoadingTrue(e)}queryByKeyError(e,t){return this.setLoadingFalse(e)}queryByKeySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return e=null==s?e:this.entityChangeTracker.mergeQueryResults([s],e,r),this.setLoadingFalse(e)}queryLoad(e){return this.setLoadingTrue(e)}queryLoadError(e,t){return this.setLoadingFalse(e)}queryLoadSuccess(e,t){const s=this.extractData(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}queryMany(e,t){return this.setLoadingTrue(e)}queryManyError(e,t){return this.setLoadingFalse(e)}queryManySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}saveAddMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddMany(s,e,r),e=this.adapter.addMany(s,e)}return this.setLoadingTrue(e)}saveAddManyError(e,t){return this.setLoadingFalse(e)}saveAddManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.isOptimistic(t)?this.entityChangeTracker.mergeSaveUpserts(s,e,r):this.entityChangeTracker.mergeSaveAdds(s,e,r),this.setLoadingFalse(e)}saveAddOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddOne(s,e,r),e=this.adapter.addOne(s,e)}return this.setLoadingTrue(e)}saveAddOneError(e,t){return this.setLoadingFalse(e)}saveAddOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);if(this.isOptimistic(t)){const a=this.toUpdate(s);e=this.entityChangeTracker.mergeSaveUpdates([a],e,r,!1)}else e=this.entityChangeTracker.mergeSaveAdds([s],e,r);return this.setLoadingFalse(e)}saveDeleteOne(e,t){const s=this.extractData(t),r="object"==typeof s?this.selectId(s):s,a=e.changeState[r];if(a&&(a.changeType===w.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e)),this.isOptimistic(t)){const o=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteOne(r,e,o),e=this.adapter.removeOne(r,e)}return this.setLoadingTrue(e)}saveDeleteOneError(e,t){return this.setLoadingFalse(e)}saveDeleteOneSuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes([s],e,r)}else e=this.adapter.removeOne(s,e),e=this.entityChangeTracker.commitOne(s,e);return this.setLoadingFalse(e)}saveDeleteMany(e,t){const s=this.extractData(t).map(r=>"object"==typeof r?this.selectId(r):r);if(s.forEach(r=>{const a=e.changeState[r];a&&(a.changeType===w.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e))}),this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteMany(s,e,r),e=this.adapter.removeMany(s,e)}return this.setLoadingTrue(e)}saveDeleteManyError(e,t){return this.setLoadingFalse(e)}saveDeleteManySuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes(s,e,r)}else e=this.adapter.removeMany(s,e),e=this.entityChangeTracker.commitMany(s,e);return this.setLoadingFalse(e)}saveUpdateOne(e,t){const s=this.guard.mustBeUpdate(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateOne(s,e,r),e=this.adapter.updateOne(s,e)}return this.setLoadingTrue(e)}saveUpdateOneError(e,t){return this.setLoadingFalse(e)}saveUpdateOneSuccess(e,t){const s=this.guard.mustBeUpdateResponse(t),r=this.isOptimistic(t),a=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpdates([s],e,a,r),this.setLoadingFalse(e)}saveUpdateMany(e,t){const s=this.guard.mustBeUpdates(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateMany(s,e,r),e=this.adapter.updateMany(s,e)}return this.setLoadingTrue(e)}saveUpdateManyError(e,t){return this.setLoadingFalse(e)}saveUpdateManySuccess(e,t){const s=this.guard.mustBeUpdateResponses(t),a=(this.isOptimistic(t),this.extractMergeStrategy(t));return e=this.entityChangeTracker.mergeSaveUpdates(s,e,a,!1),this.setLoadingFalse(e)}saveUpsertOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertOne(s,e,r),e=this.adapter.upsertOne(s,e)}return this.setLoadingTrue(e)}saveUpsertOneError(e,t){return this.setLoadingFalse(e)}saveUpsertOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts([s],e,r),this.setLoadingFalse(e)}saveUpsertMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertMany(s,e,r),e=this.adapter.upsertMany(s,e)}return this.setLoadingTrue(e)}saveUpsertManyError(e,t){return this.setLoadingFalse(e)}saveUpsertManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts(s,e,r),this.setLoadingFalse(e)}addAll(e,t){const s=this.guard.mustBeEntities(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}addMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddMany(s,e,r),this.adapter.addMany(s,e)}addOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddOne(s,e,r),this.adapter.addOne(s,e)}removeMany(e,t){const s=this.guard.mustBeKeys(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteMany(s,e,r),this.adapter.removeMany(s,e)}removeOne(e,t){const s=this.guard.mustBeKey(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteOne(s,e,r),this.adapter.removeOne(s,e)}removeAll(e,t){return Object.assign(Object.assign({},this.adapter.removeAll(e)),{loaded:!1,loading:!1,changeState:{}})}updateMany(e,t){const s=this.guard.mustBeUpdates(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateMany(s,e,r),this.adapter.updateMany(s,e)}updateOne(e,t){const s=this.guard.mustBeUpdate(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateOne(s,e,r),this.adapter.updateOne(s,e)}upsertMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertMany(s,e,r),this.adapter.upsertMany(s,e)}upsertOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertOne(s,e,r),this.adapter.upsertOne(s,e)}commitAll(e){return this.entityChangeTracker.commitAll(e)}commitMany(e,t){return this.entityChangeTracker.commitMany(this.extractData(t),e)}commitOne(e,t){return this.entityChangeTracker.commitOne(this.extractData(t),e)}undoAll(e){return this.entityChangeTracker.undoAll(e)}undoMany(e,t){return this.entityChangeTracker.undoMany(this.extractData(t),e)}undoOne(e,t){return this.entityChangeTracker.undoOne(this.extractData(t),e)}setChangeState(e,t){const s=this.extractData(t);return e.changeState===s?e:Object.assign(Object.assign({},e),{changeState:s})}setCollection(e,t){const s=this.extractData(t);return e===s?e:s}setFilter(e,t){const s=this.extractData(t);return e.filter===s?e:Object.assign(Object.assign({},e),{filter:s})}setLoaded(e,t){const s=!0===this.extractData(t)||!1;return e.loaded===s?e:Object.assign(Object.assign({},e),{loaded:s})}setLoading(e,t){return this.setLoadingFlag(e,this.extractData(t))}setLoadingFalse(e){return this.setLoadingFlag(e,!1)}setLoadingTrue(e){return this.setLoadingFlag(e,!0)}setLoadingFlag(e,t){return e.loading===(t=!0===t)?e:Object.assign(Object.assign({},e),{loading:t})}extractData(e){return e.payload&&e.payload.data}extractMergeStrategy(e){return this.isChangeTracking?e.payload&&e.payload.mergeStrategy:x.IgnoreChanges}isOptimistic(e){return e.payload&&!0===e.payload.isOptimistic}}let oe=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService.getDefinition(t);return new Je(t,s).methods}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(at))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),ce=(()=>{class n{constructor(t){this.methodsFactory=t}create(t){const s=this.methodsFactory.create(t);return function(a,o){const c=s[o.payload.entityOp];return c?c(a,o):a}}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(oe))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),de=(()=>{class n{constructor(t,s){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=_.qC.apply(null,s||[])}getOrCreateReducer(t){let s=this.entityCollectionReducers[t];return s||(s=this.entityCollectionReducerFactory.create(t),s=this.registerReducer(t,s),this.entityCollectionReducers[t]=s),s}registerReducer(t,s){return s=this.entityCollectionMetaReducer(s),this.entityCollectionReducers[t.trim()]=s}registerReducers(t){(t?Object.keys(t):[]).forEach(r=>this.registerReducer(r,t[r]))}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(ce),i.LFG(Nt,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),ue=(()=>{class n{constructor(t,s,r){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=s,this.logger=r}create(){return function t(s={},r){switch(r.type){case b.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(s,r);case b.LOAD_COLLECTIONS:return this.loadCollectionsReducer(s,r);case b.MERGE_QUERY_SET:return this.mergeQuerySetReducer(s,r);case b.SAVE_ENTITIES:return this.saveEntitiesReducer(s,r);case b.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(s,r);case b.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(s,r);case b.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(s,r);case b.SET_ENTITY_CACHE:return r.payload.cache}const a=r.payload;return a&&a.entityName&&a.entityOp&&!a.error?this.applyCollectionReducer(s,r):s}.bind(this)}clearCollectionsReducer(t,s){let{collections:r}=s.payload;const o=d.REMOVE_ALL;return r||(r=Object.keys(t)),r.reduce((c,l)=>this.applyCollectionReducer(c,{type:`[${l}] ${s.type}`,payload:{entityName:l,entityOp:o}}),t)}loadCollectionsReducer(t,s){const{collections:r}=s.payload,o=d.ADD_ALL;return Object.keys(r).reduce((l,h)=>this.applyCollectionReducer(l,{type:`[${h}] ${s.type}`,payload:{entityName:h,entityOp:o,data:r[h]}}),t)}mergeQuerySetReducer(t,s){let{mergeStrategy:r,querySet:a}=s.payload;r=null===r?x.PreserveChanges:r;const c=d.QUERY_MANY_SUCCESS;return Object.keys(a).reduce((h,g)=>this.applyCollectionReducer(h,{type:`[${g}] ${s.type}`,payload:{entityName:g,entityOp:c,data:a[g],mergeStrategy:r}}),t)}saveEntitiesReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:o,mergeStrategy:c,tag:l}=s.payload;try{r.changes.forEach(g=>{const A=g.entityName,k={entityName:A,entityOp:h(g),data:g.entities,correlationId:a,isOptimistic:o,mergeStrategy:c,tag:l},H={type:`[${A}] ${s.type}`,payload:k};if(t=this.applyCollectionReducer(t,H),H.payload.error)throw H.payload.error})}catch(g){s.payload.error=g}return t;function h(g){switch(g.op){case $.Add:return d.SAVE_ADD_MANY;case $.Delete:return d.SAVE_DELETE_MANY;case $.Update:return d.SAVE_UPDATE_MANY;case $.Upsert:return d.SAVE_UPSERT_MANY}}}saveEntitiesCancelReducer(t,s){return this.clearLoadingFlags(t,s.payload.entityNames||[])}saveEntitiesErrorReducer(t,s){const o=s.payload.originalAction.payload.changeSet.changes.map(c=>c.entityName);return this.clearLoadingFlags(t,o)}saveEntitiesSuccessReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:o,mergeStrategy:c,tag:l}=s.payload;return r.changes.forEach(g=>{const A=g.entityName,k={entityName:A,entityOp:h(g),data:g.entities,correlationId:a,isOptimistic:o,mergeStrategy:c,tag:l};t=this.applyCollectionReducer(t,{type:`[${A}] ${s.type}`,payload:k})}),t;function h(g){switch(g.op){case $.Add:return d.SAVE_ADD_MANY_SUCCESS;case $.Delete:return d.SAVE_DELETE_MANY_SUCCESS;case $.Update:return d.SAVE_UPDATE_MANY_SUCCESS;case $.Upsert:return d.SAVE_UPSERT_MANY_SUCCESS}}}applyCollectionReducer(t={},s){const r=s.payload.entityName,a=t[r],o=this.entityCollectionReducerRegistry.getOrCreateReducer(r);let c;try{c=o(a||this.entityCollectionCreator.create(r),s)}catch(l){this.logger.error(l),s.payload.error=l}return s.payload.error||a===c?t:Object.assign(Object.assign({},t),{[r]:c})}clearLoadingFlags(t,s){let r=!1;return s.forEach(a=>{const o=t[a];o.loading&&(r||(t=Object.assign({},t),r=!0),t[a]=Object.assign(Object.assign({},o),{loading:!1}))}),t}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(pt),i.LFG(de),i.LFG(ht))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),We=(()=>{class n{error(t,s){t&&(s?console.error(t,s):console.error(t))}log(t,s){t&&(s?console.log(t,s):console.log(t))}warn(t,s){t&&(s?console.warn(t,s):console.warn(t))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();const qe=["equipment","information","money","series"];let Xe=(()=>{class n{constructor(t){this.pluralNames={},t&&t.forEach(s=>this.registerPluralNames(s))}pluralize(t){return this.pluralNames[t]||(qe.indexOf(t.toLowerCase())>=0?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substr(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")}registerPluralNames(t){this.pluralNames=Object.assign(Object.assign({},this.pluralNames),t||{})}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(bt,8))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),es=(()=>{class n{constructor(t,s,r,a,o,c){this.reducerManager=t,this.injector=r,this.entityCacheName=a,this.initialState=o,this.metaReducers=c;const l=a||lt;o="function"==typeof o?o():o;const h=(c||[]).map(g=>g instanceof i.OlP?r.get(g):g);this.entityCacheFeature={key:l,reducers:s.create(),reducerFactory:_.UY,initialState:o||{},metaReducers:h},t.addFeature(this.entityCacheFeature)}static forRoot(t){return{ngModule:n,providers:[{provide:Lt,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Nt,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:bt,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}ngOnDestroy(){this.reducerManager.removeFeature(this.entityCacheFeature)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(_.PB),i.LFG(ue),i.LFG(i.zs3),i.LFG(Ut,8),i.LFG(Ge,8),i.LFG(Lt,8))},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({providers:[kt,Rt,rt,Pe,ue,Be,pt,ce,oe,de,gt,ie,at,xt,re,It,ae,{provide:Ut,useValue:lt},{provide:He,useClass:Ke},{provide:ht,useClass:We}],imports:[[_.Aw]]}),n})(),ss=(()=>{class n{constructor(t,s,r){this.effectSources=t,this.addEffects(s),this.addEffects(r)}static forRoot(t){return{ngModule:n,providers:[{provide:Ht,multi:!0,useValue:t.entityMetadata?t.entityMetadata:[]},{provide:Lt,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Nt,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:bt,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}addEffects(t){this.effectSources.addEffects(t)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(D.Ll),i.LFG(se),i.LFG(ne))},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({providers:[Kt,Jt,Wt,se,ne,{provide:zt,useClass:Ie},{provide:qt,useClass:je},{provide:Qt,useClass:Xe}],imports:[[es,D.sQ]]}),n})();var he=S(60272),ns=S(16338),wt=S(1903),rs=S(99414),ft=S(6081),tt=S(43166),le=S(51897),ye=S(93482),is=S(13060),j=S(50617);function as(n,e){1&n&&i._UZ(0,"mat-progress-bar",4)}function os(n,e){if(1&n){const t=i.EpF();i.TgZ(0,"app-task",8),i.NdJ("remove",function(){const a=i.CHM(t).$implicit;return i.oxw(2).onRemove(a)})("isDone",function(r){const o=i.CHM(t).$implicit;return i.oxw(2).onSave(r,o)})("saveName",function(r){const o=i.CHM(t).$implicit;return i.oxw(2).onSaveName(r,o)}),i.qZA()}2&n&&i.Q6J("task",e.$implicit)("isSubtask",!0)("editable",!0)}function cs(n,e){if(1&n){const t=i.EpF();i.YNc(0,os,1,3,"app-task",5),i.ALo(1,"async"),i.TgZ(2,"mat-form-field",6)(3,"input",7),i.NdJ("ngModelChange",function(r){return i.CHM(t),i.oxw().tempSubtask=r})("keypress",function(r){return i.CHM(t),i.oxw().onNewSubtask(r)},!1,i.Jf7),i.ALo(4,"async"),i.qZA()(),i._UZ(5,"br")}if(2&n){const t=i.oxw();i.Q6J("ngForOf",i.lcZ(1,3,t.subtasks$)),i.xp6(3),i.Q6J("disabled",i.lcZ(4,5,t.isAddingSubtask$))("ngModel",t.tempSubtask)}}function ds(n,e){1&n&&(i.TgZ(0,"button",3)(1,"mat-icon"),i._uU(2,"sync"),i.qZA()())}function us(n,e){1&n&&(i.TgZ(0,"button",4)(1,"mat-icon"),i._uU(2,"sync_problem"),i.qZA()())}function hs(n,e){1&n&&(i.TgZ(0,"button",4),i._UZ(1,"mat-spinner",5),i.qZA()),2&n&&(i.xp6(1),i.Q6J("diameter",20))}function ls(n,e){1&n&&(i.TgZ(0,"button",4)(1,"mat-icon"),i._uU(2,"done"),i.qZA()())}function ys(n,e){if(1&n&&(i.ynx(0),i.YNc(1,ds,3,0,"button",1),i.YNc(2,us,3,0,"button",2),i.YNc(3,hs,2,1,"button",2),i.YNc(4,ls,3,0,"button",2),i.BQk()),2&n){const t=e.ngIf;i.xp6(1),i.Q6J("ngIf","idle"===t),i.xp6(1),i.Q6J("ngIf","sync-problem"===t),i.xp6(1),i.Q6J("ngIf","syncing"===t),i.xp6(1),i.Q6J("ngIf","syncing-done"===t)}}const ps=["drawer"];function gs(n,e){if(1&n){const t=i.EpF();i.TgZ(0,"app-subtasks",9),i.NdJ("close",function(){return i.CHM(t),i.oxw().onCloseSubtaskMenu()})("removeTask",function(r){return i.CHM(t),i.oxw().onRemoveTask(r)}),i.qZA()}if(2&n){const t=i.oxw();i.Q6J("taskId",t.toogled.id)}}function fs(n,e){if(1&n){const t=i.EpF();i.TgZ(0,"app-task",10),i.NdJ("isDone",function(r){const o=i.CHM(t).$implicit;return i.oxw().onSave(r,o)})("click",function(r){const o=i.CHM(t).$implicit;return i.oxw().toogle(r,o)})("focused",function(r){const o=i.CHM(t).$implicit;return i.oxw().focus(r,o)})("saveName",function(r){const o=i.CHM(t).$implicit;return i.oxw().onSaveName(r,o)}),i.qZA()}2&n&&i.Q6J("task",e.$implicit)}let pe=(()=>{class n extends Ft{constructor(t){super(he._i.getName(j.Mp),t)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(gt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),ge=(()=>{class n extends Ft{constructor(t){super(he._i.getName(j.iQ),t)}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(gt))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),W=(()=>{class n{constructor(t,s){this.subtasksService=t,this.tasksService=s}helloWorld(){return"Hello from ngrx/data application"}title(){return(0,G.of)('TASKS ("ngrx/data" application)')}allTasksSelector(){return this.tasksService.entities$}get isProcessingSubtaskRequestSelector(){return this.subtasksService.loading$}get isProcessingTaskRequestSelector(){return this.tasksService.loading$}allSubtasks(t){return this.subtasksService.entities$}synchonizationSateSelector(){return this.tasksService.loading$.pipe((0,Z.M)(this.subtasksService.loading$),(0,y.U)(([t,s])=>t||s?"syncing":"idle"))}initAction(){return(0,R.mG)(this,void 0,void 0,function*(){if(J.ZH.isWebSQL){const t=yield j.iQ.ctrl.getAll().received;this.tasksService.clearCache(),this.tasksService.addManyToCache(t.body.json)}else this.tasksService.getAll()})}fetchSubtaskAction(t){return(0,R.mG)(this,void 0,void 0,function*(){if(J.ZH.isWebSQL){const s=yield j.Mp.ctrl.getAll(t).received;this.subtasksService.clearCache(),this.subtasksService.addManyToCache(s.body.json)}else this.subtasksService.getWithQuery({taskId:null==t?void 0:t.toString()})})}addTaskAction(t,s){return(0,R.mG)(this,void 0,void 0,function*(){"Enter"===t.code&&s.newTaskModel&&(yield(0,T.z)(this.tasksService.add(j.iQ.from({name:s.newTaskModel}))),s.newTaskModel="")})}addSubTaskAction(t,s){if(t.stopImmediatePropagation(),t.stopPropagation(),"Enter"===t.code&&s.tempSubtask){const r=j.Mp.from({name:s.tempSubtask,taskId:s.taskId}),a=L.cloneDeep(r);this.subtasksService.add(a),s.tempSubtask=""}}removeTaskAction(t){this.tasksService.delete({id:t})}removeSubTaskAction(t){this.subtasksService.delete(L.cloneDeep(t))}onSaveTaskAction(t,s){s=L.cloneDeep(s),L.merge(s,t),this.tasksService.update(s)}onSaveSubTaskAction(t,s){s=L.cloneDeep(s),L.merge(s,t),this.subtasksService.update(s)}toogleSubtasksAction(t,s,r){r.toogled=s,setTimeout(()=>(0,R.mG)(this,void 0,void 0,function*(){var a,o;(s=L.cloneDeep(s)).selected=!s.selected,this.tasksService.updateManyInCache((yield(0,T.z)(this.tasksService.entities$)).map(c=>((c=L.cloneDeep(c)).selected=!1,c))),s.selected?(this.tasksService.updateOneInCache(s),null===(a=r.drawer)||void 0===a||a.open()):null===(o=r.drawer)||void 0===o||o.close(),t.stopPropagation()}))}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(pe),i.LFG(ge))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})(),fe=(()=>{class n{constructor(t){this.engine=t,this.close=new i.vpe,this.removeTask=new i.vpe,this.removeSubtask=new i.vpe,this.newSubtask=new i.vpe,this.tasksLoaded=!1,this.isLoadingSubtasks$=this.engine.isProcessingSubtaskRequestSelector,this.isAddingSubtask$=this.engine.isProcessingSubtaskRequestSelector,this.subtasks$=this.engine.allSubtasks(this).pipe((0,y.U)(s=>this.taskId?s.filter(r=>r.taskId===this.taskId):[]),(0,Q.b)(()=>{this.tasksLoaded=!0}))}ngOnChanges(t){this.taskId&&(this.tasksLoaded=!1,this.engine.fetchSubtaskAction(this.taskId))}onSaveName(t,s){this.engine.onSaveSubTaskAction({name:t},s)}onNewSubtask(t){this.engine.addSubTaskAction(t,this)}onRemove(t){return(0,R.mG)(this,void 0,void 0,function*(){this.engine.removeSubTaskAction(t)})}onSave(t,s){this.engine.onSaveSubTaskAction({isDone:t},s)}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(W))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-subtasks"]],inputs:{taskId:"taskId"},outputs:{close:"close",removeTask:"removeTask",removeSubtask:"removeSubtask",newSubtask:"newSubtask"},features:[i.TTD],decls:11,vars:4,consts:[["mat-icon-button","",3,"click"],["mat-icon-button","",1,"delete",3,"click"],["mode","indeterminate",4,"ngIf","ngIfElse"],["tasksList",""],["mode","indeterminate"],[3,"task","isSubtask","editable","remove","isDone","saveName",4,"ngFor","ngForOf"],[1,"new-subtask-input"],["matInput","","placeholder","+ Add new subtask..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isSubtask","editable","remove","isDone","saveName"]],template:function(t,s){if(1&t&&(i.TgZ(0,"button",0),i.NdJ("click",function(){return s.close.emit()}),i.TgZ(1,"mat-icon"),i._uU(2,"close"),i.qZA()(),i.TgZ(3,"button",1),i.NdJ("click",function(){return s.removeTask.emit(s.taskId)}),i.TgZ(4,"mat-icon"),i._uU(5," delete_forever "),i.qZA()(),i._UZ(6,"br"),i.YNc(7,as,1,0,"mat-progress-bar",2),i.ALo(8,"async"),i.YNc(9,cs,6,7,"ng-template",null,3,i.W1O)),2&t){const r=i.MAs(10);i.xp6(7),i.Q6J("ngIf",!s.tasksLoaded&&i.lcZ(8,2,s.isLoadingSubtasks$))("ngIfElse",r)}},directives:[At.lW,C.Hw,rs.pW,j.mk,le.KE,M.O5,M.sg,ye.Nt,tt.Fj,tt.JJ,tt.On],pipes:[M.Ov],styles:["[_nghost-%COMP%]{width:400px;display:block;padding:5px}.new-subtask-input[_ngcontent-%COMP%]{width:100%}.delete[_ngcontent-%COMP%]{float:right}"]}),n})(),Es=(()=>{class n{constructor(t){this.engine=t,this.state$=this.engine.synchonizationSateSelector()}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(W))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-synchonization"]],decls:2,vars:3,consts:[[4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer",4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer-blocked",4,"ngIf"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer-blocked"],[3,"diameter"]],template:function(t,s){1&t&&(i.YNc(0,ys,5,4,"ng-container",0),i.ALo(1,"async")),2&t&&i.Q6J("ngIf",i.lcZ(1,1,s.state$))},directives:[At.lW,C.Hw,is.Ou,M.O5],pipes:[M.Ov],styles:["[_nghost-%COMP%]{position:absolute;right:20px}.pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:pointer}.pointer-blocked[_ngcontent-%COMP%]{pointer-events:none;cursor:not-allowed}.pointer-blocked[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:not-allowed}.sync-button[_ngcontent-%COMP%]{z-index:999;float:right;opacity:.7}.sync-button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{left:10px}.sync-button[_ngcontent-%COMP%]:hover{opacity:1}  .mat-progress-spinner circle, .mat-spinner[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke:gray}"]}),n})(),Ee=(()=>{class n{constructor(t,s){this.engine=t,this.breakpointObserver=s,this.tasks$=this.engine.allTasksSelector(),this.title$=this.engine.title(),this.isAddingTasks$=this.engine.isProcessingTaskRequestSelector,this.focusFired=0}ngOnInit(){return(0,R.mG)(this,void 0,void 0,function*(){this.engine.initAction()})}onRemoveTask(t){var s;null===(s=this.drawer)||void 0===s||s.close(),this.engine.removeTaskAction(t)}onRemoveSubTask(t){this.engine.removeSubTaskAction(t)}onCloseSubtaskMenu(){var t;null===(t=this.drawer)||void 0===t||t.close()}ngAfterViewInit(){}add(t){this.engine.addTaskAction(t,this)}onSave(t,s){this.engine.onSaveTaskAction({isDone:t},s)}onSaveName(t,s){this.engine.onSaveTaskAction({name:t},s)}focus(){this.focusFired=2}toogle(t,s){setTimeout(()=>{this.focusFired>0?(this.focusFired--,t.stopImmediatePropagation(),t.stopPropagation(),0===this.focusFired&&this.tasks.find(a=>a.task.id===s.id).focusTriggered.next()):this.engine.toogleSubtasksAction(t,s,this)},200)}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(W),i.Y36(ns.Yg))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-tasks"]],viewQuery:function(t,s){if(1&t&&(i.Gf(ps,5),i.Gf(j.mk,5)),2&t){let r;i.iGM(r=i.CRH())&&(s.drawer=r.first),i.iGM(r=i.CRH())&&(s.tasks=r)}},decls:18,vars:14,consts:[[1,"container",3,"hasBackdrop"],["position","end",3,"mode"],["drawer",""],[3,"taskId","close","removeTask",4,"ngIf"],["grow","",1,"title"],[1,"background",3,"width"],[1,"new-task-input"],["matInput","","autocomplete","off","placeholder","+ Add new task..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isDone","click","focused","saveName",4,"ngFor","ngForOf"],[3,"taskId","close","removeTask"],[3,"task","isDone","click","focused","saveName"]],template:function(t,s){1&t&&(i.TgZ(0,"mat-drawer-container",0)(1,"mat-drawer",1,2),i.YNc(3,gs,1,1,"app-subtasks",3),i.qZA(),i.TgZ(4,"mat-drawer-content")(5,"mat-card")(6,"columns-container")(7,"column",4),i._uU(8),i.ALo(9,"async"),i.qZA(),i.TgZ(10,"column",5),i._UZ(11,"app-synchonization"),i.qZA()(),i.TgZ(12,"mat-form-field",6)(13,"input",7),i.NdJ("ngModelChange",function(a){return s.newTaskModel=a})("keypress",function(a){return s.add(a)},!1,i.Jf7),i.ALo(14,"async"),i.qZA()(),i._UZ(15,"br"),i.YNc(16,fs,1,1,"app-task",8),i.ALo(17,"async"),i.qZA()()()),2&t&&(i.Q6J("hasBackdrop",!1),i.xp6(1),i.Q6J("mode","side"),i.xp6(2),i.Q6J("ngIf",s.toogled),i.xp6(5),i.hij(" ",i.lcZ(9,8,s.title$)," "),i.xp6(2),i.Q6J("width",60),i.xp6(3),i.Q6J("disabled",i.lcZ(14,10,s.isAddingTasks$))("ngModel",s.newTaskModel),i.xp6(3),i.Q6J("ngForOf",i.lcZ(17,12,s.tasks$)))},directives:[wt.kh,wt.jA,fe,wt.LW,St.a8,ft.a_,ft.bg,Es,le.KE,j.mk,M.O5,ft.iB,ye.Nt,tt.Fj,tt.JJ,tt.On,M.sg],pipes:[M.Ov],styles:["[_nghost-%COMP%]{--max-container-size: 1200px;white-space:nowrap}.container[_ngcontent-%COMP%]{height:100%}.new-task-input[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{text-align:center;margin:0}.title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.background[_ngcontent-%COMP%]{background-color:#fff}"]}),n})(),Se=(()=>{class n{constructor(t,s,r){this.engine=t,this.store=s,this.actionListener$=r,this.destroy$=new ut.x}ngOnDestroy(){this.destroy$.next(void 0),this.destroy$.unsubscribe()}ngOnInit(){this.message=this.engine.helloWorld(),this.activeteSynchonization()}activeteSynchonization(){this.actionListener$.pipe((0,vt.T)(1),(0,mt.R)(this.destroy$)).subscribe(t=>{})}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(W),i.Y36(_.yh),i.Y36(_.UO))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-tasks-engine"]],decls:1,vars:0,template:function(t,s){1&t&&i._UZ(0,"app-tasks")},directives:[Ee],styles:[""]}),n})(),ms=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-tasks-app"]],decls:1,vars:0,template:function(t,s){1&t&&i._UZ(0,"app-tasks-engine")},directives:[Se],styles:[""]}),n})(),As=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[M.ez,j.qX,j.hd,tt.u5]]}),n})();const Cs={Task:{},SubTask:{}},Ms={entityHttpResourceUrls:{Task:j.iQ.URLS,SubTask:j.Mp.URLS},timeout:3e3};let _s=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({providers:[{provide:Tt,useValue:Ms}],imports:[[ss.forRoot({entityMetadata:Cs})]]}),n})();const Os=(0,_.PH)("[tasks] sync"),ve=(0,_.PH)("[tasks] sync idle"),me=(0,_.PH)("[tasks] sync success",(0,_.Ky)()),Ds=(0,_.PH)("[tasks] sync problem"),ks=(0,_.Lq)({syncState:"idle"},(0,_.on)(Os,n=>Object.assign(Object.assign({},n),{syncState:"syncing"})),(0,_.on)(ve,n=>Object.assign(Object.assign({},n),{syncState:"idle"})),(0,_.on)(me,n=>Object.assign(Object.assign({},n),{syncState:"syncing-done"})),(0,_.on)(Ds,n=>Object.assign(Object.assign({},n),{syncState:"sync-problem"})));let Us=(()=>{class n{constructor(t,s){this.actions$=t,this.engine=s,this.syncingDone=(0,D.GW)(()=>this.actions$.pipe((0,D.l4)(me),(0,y.U)(()=>ve())))}}return n.\u0275fac=function(t){return new(t||n)(i.LFG(D.eX),i.LFG(W))},n.\u0275prov=i.Yz7({token:n,factory:n.\u0275fac}),n})();const Ls=[function Rs(n){return function(e,t){return n(e,t)}}];let Ns=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[_.Aw.forRoot({},{metaReducers:Ls}),D.sQ.forRoot([Us]),_.Aw.forFeature("appConfig",ks),P.FT.instrument(),_s]]}),n})(),xs=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[M.ez,j.qX]]}),n})(),Fs=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[M.ez,tt.u5,j.qX,ft.m0,As,j.hd,p.JF,Ns,xs]]}),n})(),Ae=(()=>{class n{static forRoot(t){return{ngModule:n,providers:[{provide:W,useClass:t&&t.customEngineService||W}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({providers:[pe,ge,W],imports:[[M.ez,Fs]]}),n})();const Is=[{path:"",component:ms}];let ws=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[M.ez,F.Bz.forChild(Is),Ae.forRoot()]]}),n})()},71616:(Ce,dt,S)=>{S.d(dt,{H:()=>mt});var i=S(2613),_=S(42520),y=(()=>{return(C=y||(y={}))[C.EntitiesOnly=0]="EntitiesOnly",C[C.Both=1]="Both",C[C.None=2]="None",y;var C})();function T(C){return function(F,D){const L={ids:[...D.ids],entities:Object.assign({},D.entities)},P=C(F,L);return P===y.Both?Object.assign({},D,L):P===y.EntitiesOnly?Object.assign(Object.assign({},D),{entities:L.entities}):D}}function Q(C,M){const F=M(C);return(0,_.X6Q)()&&void 0===F&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",C,"The `selectId` implementation:",M.toString()),F}function ut(C){function M(m,f){const p=Q(m,C);return p in f.entities?y.None:(f.ids.push(p),f.entities[p]=m,y.Both)}function F(m,f){let p=!1;for(const u of m)p=M(u,f)!==y.None||p;return p?y.Both:y.None}function L(m,f){const p=Q(m,C);return p in f.entities?(f.entities[p]=m,y.EntitiesOnly):(f.ids.push(p),f.entities[p]=m,y.Both)}function J(m,f){const u=(m instanceof Array?m:f.ids.filter(E=>m(f.entities[E]))).filter(E=>E in f.entities).map(E=>delete f.entities[E]).length>0;return u&&(f.ids=f.ids.filter(E=>E in f.entities)),u?y.Both:y.None}function q(m,f){return z([m],f)}function z(m,f){const p={};return(m=m.filter(E=>E.id in f.entities)).length>0?m.filter(v=>function B(m,f,p){const E=Object.assign({},p.entities[f.id],f.changes),v=Q(E,C),O=v!==f.id;return O&&(m[f.id]=v,delete p.entities[f.id]),p.entities[v]=E,O}(p,v,f)).length>0?(f.ids=f.ids.map(v=>p[v]||v),y.Both):y.EntitiesOnly:y.None}function et(m,f){const p=[],u=[];for(const O of m){const I=Q(O,C);I in f.entities?u.push({id:I,changes:O}):p.push(O)}const E=z(u,f),v=F(p,f);switch(!0){case v===y.None&&E===y.None:return y.None;case v===y.Both||E===y.Both:return y.Both;default:return y.EntitiesOnly}}return{removeAll:function N(m){return Object.assign({},m,{ids:[],entities:{}})},addOne:T(M),addMany:T(F),setAll:T(function D(m,f){return f.ids=[],f.entities={},F(m,f),y.Both}),setOne:T(L),setMany:T(function P(m,f){const p=m.map(u=>L(u,f));switch(!0){case p.some(u=>u===y.Both):return y.Both;case p.some(u=>u===y.EntitiesOnly):return y.EntitiesOnly;default:return y.None}}),updateOne:T(q),updateMany:T(z),upsertOne:T(function Y(m,f){return et([m],f)}),upsertMany:T(et),removeOne:T(function R(m,f){return J([m],f)}),removeMany:T(J),map:T(function X(m,f){return z(f.ids.reduce((E,v)=>{const O=m(f.entities[v]);return O!==f.entities[v]&&E.push({id:v,changes:O}),E},[]).filter(({id:E})=>E in f.entities),f)}),mapOne:T(function nt({map:m,id:f},p){const u=p.entities[f];return u?q({id:f,changes:m(u)},p):y.None})}}function mt(C={}){const{selectId:M,sortComparer:F}=Object.assign({sortComparer:!1,selectId:R=>R.id},C),D=function G(){return{getInitialState:function C(M={}){return Object.assign({ids:[],entities:{}},M)}}}(),L=function Z(){return{getSelectors:function C(M){const F=R=>R.ids,D=R=>R.entities,L=(0,i.P1)(F,D,(R,J)=>R.map(N=>J[N])),P=(0,i.P1)(F,R=>R.length);return M?{selectIds:(0,i.P1)(M,F),selectEntities:(0,i.P1)(M,D),selectAll:(0,i.P1)(M,L),selectTotal:(0,i.P1)(M,P)}:{selectIds:F,selectEntities:D,selectAll:L,selectTotal:P}}}}(),P=F?function vt(C,M){const{removeOne:F,removeMany:D,removeAll:L}=ut(C);function P(p,u){return R([p],u)}function R(p,u){const E=p.filter(v=>!(Q(v,C)in u.entities));return 0===E.length?y.None:(f(E,u),y.Both)}function N(p,u){const E=Q(p,C);return E in u.entities?(u.ids=u.ids.filter(v=>v!==E),f([p],u),y.Both):P(p,u)}function q(p,u){return X([p],u)}function X(p,u){const E=[],v=p.filter(O=>function z(p,u,E){if(!(u.id in E.entities))return!1;const O=Object.assign({},E.entities[u.id],u.changes),I=Q(O,C);return delete E.entities[u.id],p.push(O),I!==u.id}(E,O,u)).length>0;if(0===E.length)return y.None;{const O=u.ids,I=[];return u.ids=u.ids.filter((V,K)=>V in u.entities||(I.push(K),!1)),f(E,u),!v&&I.every(V=>u.ids[V]===O[V])?y.EntitiesOnly:y.Both}}function m(p,u){const E=[],v=[];for(const V of p){const K=Q(V,C);K in u.entities?v.push({id:K,changes:V}):E.push(V)}const O=X(v,u),I=R(E,u);switch(!0){case I===y.None&&O===y.None:return y.None;case I===y.Both||O===y.Both:return y.Both;default:return y.EntitiesOnly}}function f(p,u){p.sort(M);const E=[];let v=0,O=0;for(;v<p.length&&O<u.ids.length;){const I=p[v],V=Q(I,C),K=u.ids[O];M(I,u.entities[K])<=0?(E.push(V),v++):(E.push(K),O++)}u.ids=E.concat(v<p.length?p.slice(v).map(C):u.ids.slice(O)),p.forEach((I,V)=>{u.entities[C(I)]=I})}return{removeOne:F,removeMany:D,removeAll:L,addOne:T(P),updateOne:T(q),upsertOne:T(function et(p,u){return m([p],u)}),setAll:T(function J(p,u){return u.entities={},u.ids=[],R(p,u),y.Both}),setOne:T(N),setMany:T(function B(p,u){const E=p.map(v=>N(v,u));switch(!0){case E.some(v=>v===y.Both):return y.Both;case E.some(v=>v===y.EntitiesOnly):return y.EntitiesOnly;default:return y.None}}),addMany:T(R),updateMany:T(X),upsertMany:T(m),map:T(function nt(p,u){return X(u.ids.reduce((v,O)=>{const I=p(u.entities[O]);return I!==u.entities[O]&&v.push({id:O,changes:I}),v},[]),u)}),mapOne:T(function Y({map:p,id:u},E){const v=E.entities[u];return v?q({id:u,changes:p(v)},E):y.None})}}(M,F):ut(M);return Object.assign(Object.assign(Object.assign({selectId:M,sortComparer:F},D),L),P)}}}]);