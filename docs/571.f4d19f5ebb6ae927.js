"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[571],{8571:(nt,J,l)=>{l.r(J),l.d(J,{SubtasksComponent:()=>K.b,TasksAppComponent:()=>L,TasksAppModule1:()=>R,TasksContainer:()=>V.W,TasksEngineComponent:()=>E.A,TasksEngineModule:()=>g.c,TasksEngineService:()=>P.u});var c=l(38687),E=l(32860);let L=(()=>{class F{constructor(){}ngOnInit(){}}return F.\u0275fac=function(O){return new(O||F)},F.\u0275cmp=c.Xpm({type:F,selectors:[["app-tasks-app"]],decls:1,vars:0,template:function(O,N){1&O&&c._UZ(0,"app-tasks-engine")},dependencies:[E.A]}),F})();var d=l(18205),B=l(42363),g=l(96607);const k=[{path:"",component:L}];let R=(()=>{class F{}return F.\u0275fac=function(O){return new(O||F)},F.\u0275mod=c.oAB({type:F}),F.\u0275inj=c.cJS({imports:[d.ez,B.Bz.forChild(k),g.c.forRoot()]}),F})();var P=l(15414),K=l(79197),V=l(50035)},79197:(nt,J,l)=>{l.d(J,{b:()=>Y});var c=l(666),E=l(38687),d=(l(61941),l(52779)),B=l(97808),g=l(15414),k=l(18205),R=l(11102),P=l(48095),K=l(31888),V=l(77684),F=l(25290),x=l(19702),O=l(26332);function N(I,W){1&I&&E._UZ(0,"mat-progress-bar",4)}function C(I,W){if(1&I){const D=E.EpF();E.TgZ(0,"app-task",8),E.NdJ("remove",function(){const H=E.CHM(D).$implicit,j=E.oxw(2);return E.KtG(j.onRemove(H))})("isDone",function($){const j=E.CHM(D).$implicit,X=E.oxw(2);return E.KtG(X.onSave($,j))})("saveName",function($){const j=E.CHM(D).$implicit,X=E.oxw(2);return E.KtG(X.onSaveName($,j))}),E.qZA()}2&I&&E.Q6J("task",W.$implicit)("isSubtask",!0)("editable",!0)}function M(I,W){if(1&I){const D=E.EpF();E.YNc(0,C,1,3,"app-task",5),E.ALo(1,"async"),E.TgZ(2,"mat-form-field",6)(3,"input",7),E.NdJ("ngModelChange",function($){E.CHM(D);const H=E.oxw();return E.KtG(H.tempSubtask=$)})("keypress",function($){E.CHM(D);const H=E.oxw();return E.KtG(H.onNewSubtask($))},!1,E.Jf7),E.ALo(4,"async"),E.qZA()(),E._UZ(5,"br")}if(2&I){const D=E.oxw();E.Q6J("ngForOf",E.lcZ(1,3,D.subtasks$)),E.xp6(3),E.Q6J("disabled",E.lcZ(4,5,D.isAddingSubtask$))("ngModel",D.tempSubtask)}}let Y=(()=>{class I{constructor(D){this.engine=D,this.close=new E.vpe,this.removeTask=new E.vpe,this.removeSubtask=new E.vpe,this.newSubtask=new E.vpe,this.tasksLoaded=!1,this.isLoadingSubtasks$=this.engine.isProcessingSubtaskRequestSelector,this.isAddingSubtask$=this.engine.isProcessingSubtaskRequestSelector,this.subtasks$=this.engine.allSubtasks(this).pipe((0,d.U)(b=>this.taskId?b.filter($=>$.taskId===this.taskId):[]),(0,B.b)(()=>{this.tasksLoaded=!0}))}ngOnChanges(D){this.taskId&&(this.tasksLoaded=!1,this.engine.fetchSubtaskAction(this.taskId))}onSaveName(D,b){this.engine.onSaveSubTaskAction({name:D},b)}onNewSubtask(D){this.engine.addSubTaskAction(D,this)}onRemove(D){var b=this;return(0,c.Z)(function*(){b.engine.removeSubTaskAction(D)})()}onSave(D,b){this.engine.onSaveSubTaskAction({isDone:D},b)}ngOnInit(){}}return I.\u0275fac=function(D){return new(D||I)(E.Y36(g.u))},I.\u0275cmp=E.Xpm({type:I,selectors:[["app-subtasks"]],inputs:{taskId:"taskId"},outputs:{close:"close",removeTask:"removeTask",removeSubtask:"removeSubtask",newSubtask:"newSubtask"},features:[E.TTD],decls:11,vars:4,consts:[["mat-icon-button","",3,"click"],["mat-icon-button","",1,"delete",3,"click"],["mode","indeterminate",4,"ngIf","ngIfElse"],["tasksList",""],["mode","indeterminate"],[3,"task","isSubtask","editable","remove","isDone","saveName",4,"ngFor","ngForOf"],[1,"new-subtask-input"],["matInput","","placeholder","+ Add new subtask..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isSubtask","editable","remove","isDone","saveName"]],template:function(D,b){if(1&D&&(E.TgZ(0,"button",0),E.NdJ("click",function(){return b.close.emit()}),E.TgZ(1,"mat-icon"),E._uU(2,"close"),E.qZA()(),E.TgZ(3,"button",1),E.NdJ("click",function(){return b.removeTask.emit(b.taskId)}),E.TgZ(4,"mat-icon"),E._uU(5," delete_forever "),E.qZA()(),E._UZ(6,"br"),E.YNc(7,N,1,0,"mat-progress-bar",2),E.ALo(8,"async"),E.YNc(9,M,6,7,"ng-template",null,3,E.W1O)),2&D){const $=E.MAs(10);E.xp6(7),E.Q6J("ngIf",!b.tasksLoaded&&E.lcZ(8,2,b.isLoadingSubtasks$))("ngIfElse",$)}},dependencies:[k.sg,k.O5,R.Nt,P.KE,K.RK,V.pW,F.Hw,x.m,O.Fj,O.JJ,O.On,k.Ov],styles:["[_nghost-%COMP%]{width:400px;display:block;padding:5px}.new-subtask-input[_ngcontent-%COMP%]{width:100%}.delete[_ngcontent-%COMP%]{float:right}"]}),I})()},50035:(nt,J,l)=>{l.d(J,{W:()=>T});var c=l(666),E=l(61941),L=l(15414),d=l(38687),B=l(82885),g=l(18205),k=l(26332),R=l(76707),P=l(11102),K=l(48095),V=l(86813),F=l(8193),x=l(79197),O=l(19702),N=l(31888),C=l(77133),M=l(25290);function Y(p,_){1&p&&(d.TgZ(0,"button",3)(1,"mat-icon"),d._uU(2,"sync"),d.qZA()())}function I(p,_){1&p&&(d.TgZ(0,"button",4)(1,"mat-icon"),d._uU(2,"sync_problem"),d.qZA()())}function W(p,_){1&p&&(d.TgZ(0,"button",4),d._UZ(1,"mat-spinner",5),d.qZA()),2&p&&(d.xp6(1),d.Q6J("diameter",20))}function D(p,_){1&p&&(d.TgZ(0,"button",4)(1,"mat-icon"),d._uU(2,"done"),d.qZA()())}function b(p,_){if(1&p&&(d.ynx(0),d.YNc(1,Y,3,0,"button",1),d.YNc(2,I,3,0,"button",2),d.YNc(3,W,2,1,"button",2),d.YNc(4,D,3,0,"button",2),d.BQk()),2&p){const i=_.ngIf;d.xp6(1),d.Q6J("ngIf","idle"===i),d.xp6(1),d.Q6J("ngIf","sync-problem"===i),d.xp6(1),d.Q6J("ngIf","syncing"===i),d.xp6(1),d.Q6J("ngIf","syncing-done"===i)}}let $=(()=>{class p{constructor(i){this.engine=i,this.state$=this.engine.synchonizationSateSelector()}}return p.\u0275fac=function(i){return new(i||p)(d.Y36(L.u))},p.\u0275cmp=d.Xpm({type:p,selectors:[["app-synchonization"]],decls:2,vars:3,consts:[[4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer",4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer-blocked",4,"ngIf"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer-blocked"],[3,"diameter"]],template:function(i,f){1&i&&(d.YNc(0,b,5,4,"ng-container",0),d.ALo(1,"async")),2&i&&d.Q6J("ngIf",d.lcZ(1,1,f.state$))},dependencies:[g.O5,N.lW,N.RK,C.Ou,M.Hw,g.Ov],styles:["[_nghost-%COMP%]{position:absolute;right:20px}.pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:pointer}.pointer-blocked[_ngcontent-%COMP%]{pointer-events:none;cursor:not-allowed}.pointer-blocked[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:not-allowed}.sync-button[_ngcontent-%COMP%]{z-index:999;float:right;opacity:.7}.sync-button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{left:10px}.sync-button[_ngcontent-%COMP%]:hover{opacity:1}"]}),p})();const H=["drawer"];function j(p,_){if(1&p){const i=d.EpF();d.TgZ(0,"app-subtasks",9),d.NdJ("close",function(){d.CHM(i);const y=d.oxw();return d.KtG(y.onCloseSubtaskMenu())})("removeTask",function(y){d.CHM(i);const v=d.oxw();return d.KtG(v.onRemoveTask(y))}),d.qZA()}if(2&p){const i=d.oxw();d.Q6J("taskId",i.toogled.id)}}function X(p,_){if(1&p){const i=d.EpF();d.TgZ(0,"app-task",10),d.NdJ("isDone",function(y){const w=d.CHM(i).$implicit,Z=d.oxw();return d.KtG(Z.onSave(y,w))})("click",function(y){const w=d.CHM(i).$implicit,Z=d.oxw();return d.KtG(Z.toogle(y,w))})("focused",function(y){const w=d.CHM(i).$implicit,Z=d.oxw();return d.KtG(Z.focus(y,w))})("saveName",function(y){const w=d.CHM(i).$implicit,Z=d.oxw();return d.KtG(Z.onSaveName(y,w))}),d.qZA()}2&p&&d.Q6J("task",_.$implicit)}let T=(()=>{class p{constructor(i,f){this.engine=i,this.breakpointObserver=f,this.tasks$=this.engine.allTasksSelector(),this.title$=this.engine.title(),this.isAddingTasks$=this.engine.isProcessingTaskRequestSelector,this.focusFired=0}ngOnInit(){var i=this;return(0,c.Z)(function*(){i.engine.initAction()})()}onRemoveTask(i){this.drawer?.close(),this.engine.removeTaskAction(i)}onRemoveSubTask(i){this.engine.removeSubTaskAction(i)}onCloseSubtaskMenu(){this.drawer?.close()}ngAfterViewInit(){}add(i){this.engine.addTaskAction(i,this)}onSave(i,f){this.engine.onSaveTaskAction({isDone:i},f)}onSaveName(i,f){this.engine.onSaveTaskAction({name:i},f)}focus(){this.focusFired=2}toogle(i,f){setTimeout(()=>{this.focusFired>0?(this.focusFired--,i.stopImmediatePropagation(),i.stopPropagation(),0===this.focusFired&&this.tasks.find(v=>v.task.id===f.id).focusTriggered.next()):this.engine.toogleSubtasksAction(i,f,this)},200)}}return p.\u0275fac=function(i){return new(i||p)(d.Y36(L.u),d.Y36(B.Yg))},p.\u0275cmp=d.Xpm({type:p,selectors:[["app-tasks"]],viewQuery:function(i,f){if(1&i&&(d.Gf(H,5),d.Gf(E.mk,5)),2&i){let y;d.iGM(y=d.CRH())&&(f.drawer=y.first),d.iGM(y=d.CRH())&&(f.tasks=y)}},decls:18,vars:14,consts:[[1,"container",3,"hasBackdrop"],["position","end",3,"mode"],["drawer",""],[3,"taskId","close","removeTask",4,"ngIf"],["grow","",1,"title"],[1,"background",3,"width"],[1,"new-task-input"],["matInput","","autocomplete","off","placeholder","+ Add new task..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isDone","click","focused","saveName",4,"ngFor","ngForOf"],[3,"taskId","close","removeTask"],[3,"task","isDone","click","focused","saveName"]],template:function(i,f){1&i&&(d.TgZ(0,"mat-drawer-container",0)(1,"mat-drawer",1,2),d.YNc(3,j,1,1,"app-subtasks",3),d.qZA(),d.TgZ(4,"mat-drawer-content")(5,"mat-card")(6,"columns-container")(7,"column",4),d._uU(8),d.ALo(9,"async"),d.qZA(),d.TgZ(10,"column",5),d._UZ(11,"app-synchonization"),d.qZA()(),d.TgZ(12,"mat-form-field",6)(13,"input",7),d.NdJ("ngModelChange",function(v){return f.newTaskModel=v})("keypress",function(v){return f.add(v)},!1,d.Jf7),d.ALo(14,"async"),d.qZA()(),d._UZ(15,"br"),d.YNc(16,X,1,1,"app-task",8),d.ALo(17,"async"),d.qZA()()()),2&i&&(d.Q6J("hasBackdrop",!1),d.xp6(1),d.Q6J("mode","side"),d.xp6(2),d.Q6J("ngIf",f.toogled),d.xp6(5),d.hij(" ",d.lcZ(9,8,f.title$)," "),d.xp6(2),d.Q6J("width",60),d.xp6(3),d.Q6J("disabled",d.lcZ(14,10,f.isAddingTasks$))("ngModel",f.newTaskModel),d.xp6(3),d.Q6J("ngForOf",d.lcZ(17,12,f.tasks$)))},dependencies:[g.sg,g.O5,k.Fj,k.JJ,k.On,R.a8,P.Nt,K.KE,V.jA,V.kh,V.LW,F.a_,F.bg,F.iB,x.b,O.m,$,g.Ov],styles:["[_nghost-%COMP%]{--max-container-size: 1200px;white-space:nowrap}.container[_ngcontent-%COMP%]{height:100%}.new-task-input[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{text-align:center;margin:0}.title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.background[_ngcontent-%COMP%]{background-color:#fff}"]}),p})()},32860:(nt,J,l)=>{l.d(J,{A:()=>R});var c=l(55400),E=l(47162),L=l(57267),d=l(15414),B=l(38687),g=l(51252),k=l(50035);let R=(()=>{class P{constructor(V,F,x){this.engine=V,this.store=F,this.actionListener$=x,this.$destroy=new c.x}ngOnDestroy(){this.$destroy.next(void 0),this.$destroy.unsubscribe()}ngOnInit(){this.message=this.engine.helloWorld(),this.activeteSynchonization()}activeteSynchonization(){this.actionListener$.pipe((0,E.T)(1),(0,L.R)(this.$destroy)).subscribe(V=>{})}}return P.\u0275fac=function(V){return new(V||P)(B.Y36(d.u),B.Y36(g.yh),B.Y36(g.UO))},P.\u0275cmp=B.Xpm({type:P,selectors:[["app-tasks-engine"]],decls:1,vars:0,template:function(V,F){1&V&&B._UZ(0,"app-tasks")},dependencies:[k.W]}),P})()},96607:(nt,J,l)=>{l.d(J,{c:()=>_});var c=l(18205),E=l(15414),L=l(7939),d=l(31009),B=l(26332),g=l(61941),k=l(17314),R=l(38687);let P=(()=>{class i{}return i.\u0275fac=function(y){return new(y||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[c.ez,g.qX,g.hd,B.u5]}),i})();var K=l(51252),V=l(70426),F=l(96481);const x={Task:{},SubTask:{}},O={entityHttpResourceUrls:{Task:g.iQ.URLS,SubTask:g.Mp.URLS},timeout:3e3};let N=(()=>{class i{}return i.\u0275fac=function(y){return new(y||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({providers:[{provide:F.jh,useValue:O}],imports:[F.ov.forRoot({entityMetadata:x})]}),i})();const C=(0,K.PH)("[tasks] sync"),M=(0,K.PH)("[tasks] sync idle"),Y=(0,K.PH)("[tasks] sync success",(0,K.Ky)()),I=(0,K.PH)("[tasks] sync problem");(0,K.Lq)({syncState:"idle"},(0,K.on)(C,i=>({...i,syncState:"syncing"})),(0,K.on)(M,i=>({...i,syncState:"idle"})),(0,K.on)(Y,i=>({...i,syncState:"syncing-done"})),(0,K.on)(I,i=>({...i,syncState:"sync-problem"})));var H=l(52779);let j=(()=>{class i{constructor(y,v){this.actions$=y,this.engine=v,this.syncingDone=(0,V.GW)(()=>this.actions$.pipe((0,V.l4)(Y),(0,H.U)(()=>M())))}}return i.\u0275fac=function(y){return new(y||i)(R.LFG(V.eX),R.LFG(E.u))},i.\u0275prov=R.Yz7({token:i,factory:i.\u0275fac}),i})();const X=[function $(i){return function(f,y){return i(f,y)}}];let tt=(()=>{class i{}return i.\u0275fac=function(y){return new(y||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[K.Aw.forFeature("appConfig",X),V.sQ.forFeature([j]),N]}),i})(),q=(()=>{class i{}return i.\u0275fac=function(y){return new(y||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[c.ez,g.qX]}),i})();var T=l(8193);let p=(()=>{class i{}return i.\u0275fac=function(y){return new(y||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[c.ez,B.u5,g.qX,T.m0,P,g.hd,k.JF,tt,q]}),i})(),_=(()=>{class i{static forRoot(y){return{ngModule:i,providers:[{provide:E.u,useClass:y&&y.customEngineService||E.u}]}}}return i.\u0275fac=function(y){return new(y||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({providers:[L.x,d.C,E.u],imports:[c.ez,p]}),i})()},15414:(nt,J,l)=>{l.d(J,{u:()=>x});var c=l(666),E=l(28938),L=l(40409),B=l(61941),g=l(38689),k=l(3931),R=l(52779),P=l(35921),K=l(7939),V=l(31009),F=l(38687);let x=(()=>{class O{constructor(C,M){this.subtasksService=C,this.tasksService=M}helloWorld(){return"Hello from ngrx/data application"}title(){return(0,g.of)('TASKS ("ngrx/data" application)')}allTasksSelector(){return this.tasksService.entities$}get isProcessingSubtaskRequestSelector(){return this.subtasksService.loading$}get isProcessingTaskRequestSelector(){return this.tasksService.loading$}allSubtasks(C){return this.subtasksService.entities$}synchonizationSateSelector(){return this.tasksService.loading$.pipe((0,k.M)(this.subtasksService.loading$),(0,R.U)(([C,M])=>C||M?"syncing":"idle"))}initAction(){var C=this;return(0,c.Z)(function*(){if(E.ZH.isWebSQL){const M=yield B.iQ.ctrl.getAll().received;C.tasksService.clearCache(),C.tasksService.addManyToCache(M.body.json)}else C.tasksService.getAll()})()}fetchSubtaskAction(C){var M=this;return(0,c.Z)(function*(){if(E.ZH.isWebSQL){const Y=yield B.Mp.ctrl.getAll(C).received;M.subtasksService.clearCache(),M.subtasksService.addManyToCache(Y.body.json)}else M.subtasksService.getWithQuery({taskId:C?.toString()})})()}addTaskAction(C,M){var Y=this;return(0,c.Z)(function*(){"Enter"===C.code&&M.newTaskModel&&(yield(0,P.z)(Y.tasksService.add(B.iQ.from({name:M.newTaskModel}))),M.newTaskModel="")})()}addSubTaskAction(C,M){if(C.stopImmediatePropagation(),C.stopPropagation(),"Enter"===C.code&&M.tempSubtask){const Y=B.Mp.from({name:M.tempSubtask,taskId:M.taskId}),I=L.cloneDeep(Y);this.subtasksService.add(I),M.tempSubtask=""}}removeTaskAction(C){this.tasksService.delete({id:C})}removeSubTaskAction(C){this.subtasksService.delete(L.cloneDeep(C))}onSaveTaskAction(C,M){M=L.cloneDeep(M),L.merge(M,C),this.tasksService.update(M)}onSaveSubTaskAction(C,M){M=L.cloneDeep(M),L.merge(M,C),this.subtasksService.update(M)}toogleSubtasksAction(C,M,Y){var I=this;Y.toogled=M,setTimeout((0,c.Z)(function*(){(M=L.cloneDeep(M)).selected=!M.selected,I.tasksService.updateManyInCache((yield(0,P.z)(I.tasksService.entities$)).map(W=>((W=L.cloneDeep(W)).selected=!1,W))),M.selected?(I.tasksService.updateOneInCache(M),Y.drawer?.open()):Y.drawer?.close(),C.stopPropagation()}))}}return O.\u0275fac=function(C){return new(C||O)(F.LFG(K.x),F.LFG(V.C))},O.\u0275prov=F.Yz7({token:O,factory:O.\u0275fac}),O})()},7939:(nt,J,l)=>{l.d(J,{x:()=>B});var c=l(61941),E=l(96481),L=l(54358),d=l(38687);let B=(()=>{class g extends E.c8{constructor(R){super(L._i.getName(c.Mp),R)}}return g.\u0275fac=function(R){return new(R||g)(d.LFG(E.yV))},g.\u0275prov=d.Yz7({token:g,factory:g.\u0275fac}),g})()},31009:(nt,J,l)=>{l.d(J,{C:()=>B});var c=l(96481),E=l(54358),L=l(61941),d=l(38687);let B=(()=>{class g extends c.c8{constructor(R){super(E._i.getName(L.iQ),R)}}return g.\u0275fac=function(R){return new(R||g)(d.LFG(c.yV))},g.\u0275prov=d.Yz7({token:g,factory:g.\u0275fac}),g})()},96481:(nt,J,l)=>{l.d(J,{jh:()=>ft,c8:()=>Vt,yV:()=>Ct,ov:()=>Te});var c=l(38687),E=l(36506),L=l(52779),d=l(8202),B=l(46231),g=l(75921),k=l(37417),R=l(28477);function P(r,e,t){let n,s=!1;return r&&"object"==typeof r?({bufferSize:n=1/0,windowTime:e=1/0,refCount:s=!1,scheduler:t}=r):n=r??1/0,(0,R.B)({connector:()=>new k.t(n,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}var K=l(45498),V=l(82045),F=l(3931),x=l(18962),O=l(17314),N=l(67950),C=l(38689),M=l(75105),Y=l(99418),I=l(25192),W=l(25707),D=l(51252),b=l(70426);let $=(()=>{class r{create(t,n,s,a){const h="string"==typeof t?{...a||{},entityName:t,entityOp:n,data:s}:t;return this.createCore(h)}createCore(t){const{entityName:n,entityOp:s,tag:a}=t;if(!n)throw new Error("Missing entity name for new action");if(null==s)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(s,a||n),payload:t}}createFromAction(t,n){return this.create({...t.payload,...n})}formatActionType(t,n){return`[${n}] ${t}`}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();class H{constructor(e,t){this.entityName=e,this.selectId=t}mustBeEntity(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should have a single entity.");const n=this.selectId(t);return this.isNotKeyType(n)&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeEntities(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((n,s)=>{const a=this.selectId(n);this.isNotKeyType(a)&&this.throwError(e,`, item ${s+1}, does not have a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entities")}mustBeKey(e){const t=this.extractData(e);if(void 0===t)throw new Error("should be a single entity key");if(this.isNotKeyType(t))throw new Error("is not a valid key (id)");return t}mustBeKeys(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((n,s)=>{this.isNotKeyType(n)&&this.throwError(e,`${this.entityName} ', item ${s+1}, is not a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entity keys (id)")}mustBeUpdate(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:n,changes:s}=t,a=this.selectId(s);return(this.isNotKeyType(n)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdates(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((n,s)=>{const{id:a,changes:h}=n,u=this.selectId(h);(this.isNotKeyType(a)||this.isNotKeyType(u))&&this.throwError(e,`, item ${s+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}mustBeUpdateResponse(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:n,changes:s}=t,a=this.selectId(s);return(this.isNotKeyType(n)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdateResponses(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((n,s)=>{const{id:a,changes:h}=n,u=this.selectId(h);(this.isNotKeyType(a)||this.isNotKeyType(u))&&this.throwError(e,`, item ${s+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}extractData(e){return e.payload&&e.payload.data}isNotKeyType(e){return"string"!=typeof e&&"number"!=typeof e}throwError(e,t){throw new Error(`${this.entityName} EntityAction guard for "${e.type}": payload ${t}`)}}function j(r){return r?.id}function X(r){if(null==r)return[];if(Array.isArray(r[0])){const[e,...t]=r;r=[...e,...t]}return r}function tt(r){return r=r||j,function(t){const n=r(t);if(null==n)throw new Error("Primary key may not be null/undefined.");return t&&{id:n,changes:t}}}function q(...r){const e=X(r);switch(e.length){case 0:return(0,E.h)(n=>n.payload&&null!=n.payload.entityOp);case 1:const t=e[0];return(0,E.h)(n=>n.payload&&t===n.payload.entityOp);default:return(0,E.h)(n=>{const s=n.payload&&n.payload.entityOp;return s&&e.some(a=>a===s)})}}function T(...r){const e=X(r);switch(e.length){case 0:return(0,E.h)(n=>n.payload&&null!=n.payload.entityName);case 1:const t=e[0];return(0,E.h)(n=>n.payload&&t===n.payload.entityName);default:return(0,E.h)(n=>{const s=n.payload&&n.payload.entityName;return!!s&&e.some(a=>a===s)})}}var p=(()=>((p=p||{}).Add="Add",p.Delete="Delete",p.Update="Update",p.Upsert="Upsert",p))();function f(r){const e=(r=r&&r.changes?r:{changes:[]}).changes.filter(t=>null!=t&&t.entities&&t.entities.length>0);return{...r,changes:e}}new class _{add(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:p.Add,entities:t}}delete(e,t){const n=Array.isArray(t)?t:t?[t]:[];return{entityName:e,op:p.Delete,entities:n}}update(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:p.Update,entities:t}}upsert(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:p.Upsert,entities:t}}};var y=(()=>((y=y||{})[y.IgnoreChanges=0]="IgnoreChanges",y[y.PreserveChanges=1]="PreserveChanges",y[y.OverwriteChanges=2]="OverwriteChanges",y))(),v=(()=>((v=v||{}).CLEAR_COLLECTIONS="@ngrx/data/entity-cache/clear-collections",v.LOAD_COLLECTIONS="@ngrx/data/entity-cache/load-collections",v.MERGE_QUERY_SET="@ngrx/data/entity-cache/merge-query-set",v.SET_ENTITY_CACHE="@ngrx/data/entity-cache/set-cache",v.SAVE_ENTITIES="@ngrx/data/entity-cache/save-entities",v.SAVE_ENTITIES_CANCEL="@ngrx/data/entity-cache/save-entities-cancel",v.SAVE_ENTITIES_CANCELED="@ngrx/data/entity-cache/save-entities-canceled",v.SAVE_ENTITIES_ERROR="@ngrx/data/entity-cache/save-entities-error",v.SAVE_ENTITIES_SUCCESS="@ngrx/data/entity-cache/save-entities-success",v))();class w{constructor(e,t){this.type=v.CLEAR_COLLECTIONS,this.payload={collections:e,tag:t}}}class Z{constructor(e,t){this.type=v.LOAD_COLLECTIONS,this.payload={collections:e,tag:t}}}class st{constructor(e,t,n){this.type=v.MERGE_QUERY_SET,this.payload={querySet:e,mergeStrategy:null===t?y.PreserveChanges:t,tag:n}}}class yt{constructor(e,t){this.cache=e,this.type=v.SET_ENTITY_CACHE,this.payload={cache:e,tag:t}}}class Xt{constructor(e,t,n){this.type=v.SAVE_ENTITIES,n=n||{},e&&(e.tag=e.tag||n.tag),this.payload={changeSet:e,url:t,...n,tag:e.tag}}}class qt{constructor(e,t,n,s){this.type=v.SAVE_ENTITIES_CANCEL,this.payload={correlationId:e,reason:t,entityNames:n,tag:s}}}class te{constructor(e,t,n){this.type=v.SAVE_ENTITIES_CANCELED,this.payload={correlationId:e,reason:t,tag:n}}}class ee{constructor(e,t){this.type=v.SAVE_ENTITIES_ERROR,this.payload={error:e,originalAction:t,correlationId:t.payload.correlationId}}}class pt{constructor(e,t,n){this.type=v.SAVE_ENTITIES_SUCCESS,n=n||{},e&&(e.tag=e.tag||n.tag),this.payload={changeSet:e,url:t,...n,tag:e.tag}}}var o=(()=>((o=o||{}).CANCEL_PERSIST="@ngrx/data/cancel-persist",o.CANCELED_PERSIST="@ngrx/data/canceled-persist",o.QUERY_ALL="@ngrx/data/query-all",o.QUERY_ALL_SUCCESS="@ngrx/data/query-all/success",o.QUERY_ALL_ERROR="@ngrx/data/query-all/error",o.QUERY_LOAD="@ngrx/data/query-load",o.QUERY_LOAD_SUCCESS="@ngrx/data/query-load/success",o.QUERY_LOAD_ERROR="@ngrx/data/query-load/error",o.QUERY_MANY="@ngrx/data/query-many",o.QUERY_MANY_SUCCESS="@ngrx/data/query-many/success",o.QUERY_MANY_ERROR="@ngrx/data/query-many/error",o.QUERY_BY_KEY="@ngrx/data/query-by-key",o.QUERY_BY_KEY_SUCCESS="@ngrx/data/query-by-key/success",o.QUERY_BY_KEY_ERROR="@ngrx/data/query-by-key/error",o.SAVE_ADD_MANY="@ngrx/data/save/add-many",o.SAVE_ADD_MANY_ERROR="@ngrx/data/save/add-many/error",o.SAVE_ADD_MANY_SUCCESS="@ngrx/data/save/add-many/success",o.SAVE_ADD_ONE="@ngrx/data/save/add-one",o.SAVE_ADD_ONE_ERROR="@ngrx/data/save/add-one/error",o.SAVE_ADD_ONE_SUCCESS="@ngrx/data/save/add-one/success",o.SAVE_DELETE_MANY="@ngrx/data/save/delete-many",o.SAVE_DELETE_MANY_SUCCESS="@ngrx/data/save/delete-many/success",o.SAVE_DELETE_MANY_ERROR="@ngrx/data/save/delete-many/error",o.SAVE_DELETE_ONE="@ngrx/data/save/delete-one",o.SAVE_DELETE_ONE_SUCCESS="@ngrx/data/save/delete-one/success",o.SAVE_DELETE_ONE_ERROR="@ngrx/data/save/delete-one/error",o.SAVE_UPDATE_MANY="@ngrx/data/save/update-many",o.SAVE_UPDATE_MANY_SUCCESS="@ngrx/data/save/update-many/success",o.SAVE_UPDATE_MANY_ERROR="@ngrx/data/save/update-many/error",o.SAVE_UPDATE_ONE="@ngrx/data/save/update-one",o.SAVE_UPDATE_ONE_SUCCESS="@ngrx/data/save/update-one/success",o.SAVE_UPDATE_ONE_ERROR="@ngrx/data/save/update-one/error",o.SAVE_UPSERT_MANY="@ngrx/data/save/upsert-many",o.SAVE_UPSERT_MANY_SUCCESS="@ngrx/data/save/upsert-many/success",o.SAVE_UPSERT_MANY_ERROR="@ngrx/data/save/upsert-many/error",o.SAVE_UPSERT_ONE="@ngrx/data/save/upsert-one",o.SAVE_UPSERT_ONE_SUCCESS="@ngrx/data/save/upsert-one/success",o.SAVE_UPSERT_ONE_ERROR="@ngrx/data/save/upsert-one/error",o.ADD_ALL="@ngrx/data/add-all",o.ADD_MANY="@ngrx/data/add-many",o.ADD_ONE="@ngrx/data/add-one",o.REMOVE_ALL="@ngrx/data/remove-all",o.REMOVE_MANY="@ngrx/data/remove-many",o.REMOVE_ONE="@ngrx/data/remove-one",o.UPDATE_MANY="@ngrx/data/update-many",o.UPDATE_ONE="@ngrx/data/update-one",o.UPSERT_MANY="@ngrx/data/upsert-many",o.UPSERT_ONE="@ngrx/data/upsert-one",o.COMMIT_ALL="@ngrx/data/commit-all",o.COMMIT_MANY="@ngrx/data/commit-many",o.COMMIT_ONE="@ngrx/data/commit-one",o.UNDO_ALL="@ngrx/data/undo-all",o.UNDO_MANY="@ngrx/data/undo-many",o.UNDO_ONE="@ngrx/data/undo-one",o.SET_CHANGE_STATE="@ngrx/data/set-change-state",o.SET_COLLECTION="@ngrx/data/set-collection",o.SET_FILTER="@ngrx/data/set-filter",o.SET_LOADED="@ngrx/data/set-loaded",o.SET_LOADING="@ngrx/data/set-loading",o))();const Et="/success",gt="/error";function Dt(r){return r+Et}class rt{constructor(e,t){this.error=e,this.requestData=t,this.message="string"==typeof e?e:function se(r){const{error:e,body:t,message:n}=r;let s=null;return e?s="string"==typeof e?e:e.message:n?s=n:t&&(s="string"==typeof t?t:t.error),"string"==typeof s?s:s?JSON.stringify(s):null}(e)}}class ft{}class ct{}const Ot=new c.OlP("@ngrx/data Plural Names");class Tt{}class kt{}let re=(()=>{class r{constructor(t){this.pluralizer=t,this.knownHttpResourceUrls={}}getResourceUrls(t,n,s=!1){let a=this.knownHttpResourceUrls[t];if(!a){const h=s?n:function ae(r){return r.replace(/^[/\s]+|[/\s]+$/g,"")}(n);a={entityResourceUrl:`${h}/${t}/`.toLowerCase(),collectionResourceUrl:`${h}/${this.pluralizer.pluralize(t)}/`.toLowerCase()},this.registerHttpResourceUrls({[t]:a})}return a}entityResource(t,n,s){return this.getResourceUrls(t,n,s).entityResourceUrl}collectionResource(t,n){return this.getResourceUrls(t,n).collectionResourceUrl}registerHttpResourceUrls(t){this.knownHttpResourceUrls={...this.knownHttpResourceUrls,...t||{}}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Tt))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();class ie{get name(){return this._name}constructor(e,t,n,s){this.http=t,this.httpUrlGenerator=n,this.getDelay=0,this.saveDelay=0,this.timeout=0,this.trailingSlashEndpoints=!1,this._name=`${e} DefaultDataService`,this.entityName=e;const{root:a="api",delete404OK:h=!0,getDelay:u=0,saveDelay:m=0,timeout:S=0,trailingSlashEndpoints:A=!1}=s||{};this.delete404OK=h,this.entityUrl=n.entityResource(e,a,A),this.entitiesUrl=n.collectionResource(e,a),this.getDelay=u,this.saveDelay=m,this.timeout=S}add(e,t){const n=e||new Error(`No "${this.entityName}" entity to add`);return this.execute("POST",this.entityUrl,n,null,t)}delete(e,t){let n;return null==e&&(n=new Error(`No "${this.entityName}" key to delete`)),this.execute("DELETE",this.entityUrl+e,n,null,t).pipe((0,L.U)(s=>e))}getAll(e){return this.execute("GET",this.entitiesUrl,null,e)}getById(e,t){let n;return null==e&&(n=new Error(`No "${this.entityName}" key to get`)),this.execute("GET",this.entityUrl+e,n,null,t)}getWithQuery(e,t){const s=new O.LE("string"==typeof e?{fromString:e}:{fromObject:e});return this.execute("GET",this.entitiesUrl,void 0,{params:s},t)}update(e,t){const n=e&&e.id,s=null==n?new Error(`No "${this.entityName}" update data or id`):e.changes;return this.execute("PUT",this.entityUrl+n,s,null,t)}upsert(e,t){const n=e||new Error(`No "${this.entityName}" entity to upsert`);return this.execute("POST",this.entityUrl,n,null,t)}execute(e,t,n,s,a){let h,u;a&&(h={headers:a?.httpHeaders?new O.WM(a?.httpHeaders):void 0,params:a?.httpParams?new O.LE(a?.httpParams):void 0}),(s||h)&&((0,c.X6Q)()&&s&&h&&console.warn("@ngrx/data: options.httpParams will be merged with queryParams when both are are provided to getWithQuery(). In the event of a conflict HttpOptions.httpParams will override queryParams`. The queryParams parameter of getWithQuery() will be removed in next major release."),u={...s,headers:h?.headers??s?.headers,params:h?.params??s?.params});const m={method:e,url:t,data:n,options:u};if(n instanceof Error)return this.handleError(m)(n);let S;switch(e){case"DELETE":S=this.http.delete(t,u),this.saveDelay&&(S=S.pipe((0,d.g)(this.saveDelay)));break;case"GET":S=this.http.get(t,u),this.getDelay&&(S=S.pipe((0,d.g)(this.getDelay)));break;case"POST":S=this.http.post(t,n,u),this.saveDelay&&(S=S.pipe((0,d.g)(this.saveDelay)));break;case"PUT":S=this.http.put(t,n,u),this.saveDelay&&(S=S.pipe((0,d.g)(this.saveDelay)));break;default:{const A=new Error("Unimplemented HTTP method, "+e);S=(0,N._)(A)}}return this.timeout&&(S=S.pipe((0,B.V)(this.timeout+this.saveDelay))),S.pipe((0,g.K)(this.handleError(m)))}handleError(e){return t=>{const n=this.handleDelete404(t,e);if(n)return n;const s=new rt(t,e);return(0,N._)(s)}}handleDelete404(e,t){if(404===e.status&&"DELETE"===t.method&&this.delete404OK)return(0,C.of)({})}}let Rt=(()=>{class r{constructor(t,n,s){this.http=t,this.httpUrlGenerator=n,this.config=s,n.registerHttpResourceUrls((s=s||{}).entityHttpResourceUrls)}create(t){return new ie(t,this.http,this.httpUrlGenerator,this.config)}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(O.eN),c.LFG(kt),c.LFG(ft,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();const Ut=new c.OlP("@ngrx/data Entity Metadata");let at=(()=>{class r{constructor(t){this.definitions={},t&&t.forEach(n=>this.registerMetadataMap(n))}getDefinition(t,n=!0){t=t.trim();const s=this.definitions[t];if(!s&&n)throw new Error(`No EntityDefinition for entity type "${t}".`);return s}registerMetadata(t){if(t){const n=function oe(r){let e=r.entityName;if(!e)throw new Error("Missing required entityName");r.entityName=e=e.trim();const t=r.selectId||j,n=r.sortComparer=r.sortComparer||!1,s=(0,W.H)({selectId:t,sortComparer:n}),a=r.entityDispatcherOptions||{},h=s.getInitialState({entityName:e,filter:"",loaded:!1,loading:!1,changeState:{},...r.additionalCollectionState||{}});return{entityName:e,entityAdapter:s,entityDispatcherOptions:a,initialState:h,metadata:r,noChangeTracking:!0===r.noChangeTracking,selectId:t,sortComparer:n}}(t);this.registerDefinition(n)}}registerMetadataMap(t={}){Object.keys(t||{}).forEach(n=>this.registerMetadata({entityName:n,...t[n]}))}registerDefinition(t){this.definitions[t.entityName]=t}registerDefinitions(t){Object.assign(this.definitions,t)}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Ut,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();const Lt=p.Update;let xt=(()=>{class r{constructor(t,n,s){this.entityDefinitionService=t,this.http=n,this.idSelectors={},this.saveDelay=0,this.timeout=0;const{saveDelay:a=0,timeout:h=0}=s||{};this.saveDelay=a,this.timeout=h}saveEntities(t,n){t=this.filterChangeSet(t),t=this.flattenUpdates(t);let s=this.http.post(n,t).pipe((0,L.U)(a=>this.restoreUpdates(a)),(0,g.K)(this.handleError({method:"POST",url:n,data:t})));return this.timeout&&(s=s.pipe((0,B.V)(this.timeout))),this.saveDelay&&(s=s.pipe((0,d.g)(this.saveDelay))),s}handleError(t){return n=>{const s=new rt(n,t);return(0,N._)(s)}}filterChangeSet(t){return f(t)}flattenUpdates(t){let n=t.changes;if(0===n.length)return t;let s=!1;return n=n.map(a=>a.op===Lt&&a.entities.length>0?(s=!0,{...a,entities:a.entities.map(h=>h.changes)}):a),s?{...t,changes:n}:t}restoreUpdates(t){if(null==t)return t;let n=t.changes;if(0===n.length)return t;let s=!1;return n=n.map(a=>{if(a.op===Lt){s=!0;const h=this.getIdSelector(a.entityName);return{...a,entities:a.entities.map(u=>({id:h(u),changes:u}))}}return a}),s?{...t,changes:n}:t}getIdSelector(t){let n=this.idSelectors[t];return n||(n=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=n),n}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(at),c.LFG(O.eN),c.LFG(ft,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),It=(()=>{class r{constructor(t){this.defaultDataServiceFactory=t,this.services={}}getService(t){t=t.trim();let n=this.services[t];return n||(n=this.defaultDataServiceFactory.create(t),this.services[t]=n),n}registerService(t,n){this.services[t.trim()]=n}registerServices(t){this.services={...this.services,...t}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Rt))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();class Nt{}let ce=(()=>{class r{constructor(t,n){this.logger=t,this.entityActionFactory=n}handleSuccess(t){const n=Dt(t.payload.entityOp);return s=>this.entityActionFactory.createFromAction(t,{entityOp:n,data:s})}handleError(t){const n=function ne(r){return r+gt}(t.payload.entityOp);return s=>{const h={error:s instanceof rt?s:new rt(s,null),originalAction:t};return this.logger.error(h),this.entityActionFactory.createFromAction(t,{entityOp:n,data:h})}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(ct),c.LFG($))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();class Ft{constructor(e){this.message=e,this.message=e||"Canceled by user"}}let St=(()=>{class r{constructor(){this.seed=0,this.prefix="CRID"}next(){return this.seed+=1,this.prefix+this.seed}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),_t=(()=>{class r{constructor(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),de=(()=>{class r{constructor(t,n,s,a){this.correlationIdGenerator=t,this.defaultDispatcherOptions=n,this.store=a,this.reducedActions$=s.pipe(P(1)),this.raSubscription=this.reducedActions$.subscribe()}dispatch(t){return this.store.dispatch(t),t}cancelSaveEntities(t,n,s,a){if(!t)throw new Error("Missing correlationId");const h=new qt(t,n,s,a);this.dispatch(h)}clearCollections(t,n){this.dispatch(new w(t,n))}loadCollections(t,n){this.dispatch(new Z(t,n))}mergeQuerySet(t,n,s){this.dispatch(new st(t,n,s))}setEntityCache(t,n){this.dispatch(new yt(t,n))}saveEntities(t,n,s){const a=Array.isArray(t)?{changes:t}:t,h=null==(s=s||{}).correlationId?this.correlationIdGenerator.next():s.correlationId,u=null==s.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===s.isOptimistic,m=s.tag||"Save Entities";s={...s,correlationId:h,isOptimistic:u,tag:m};const S=new Xt(a,n,s);return this.dispatch(S),this.getSaveEntitiesResponseData$(s.correlationId).pipe(P(1))}getSaveEntitiesResponseData$(t){return this.reducedActions$.pipe((0,E.h)(n=>n.type===v.SAVE_ENTITIES_SUCCESS||n.type===v.SAVE_ENTITIES_ERROR||n.type===v.SAVE_ENTITIES_CANCEL),(0,E.h)(n=>t===n.payload.correlationId),(0,K.q)(1),(0,V.z)(n=>n.type===v.SAVE_ENTITIES_CANCEL?(0,N._)(new Ft(n.payload.reason)):n.type===v.SAVE_ENTITIES_SUCCESS?(0,C.of)(n.payload.changeSet):(0,N._)(n.payload)))}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(St),c.LFG(_t),c.LFG(D.Y$),c.LFG(D.yh))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();class ue{constructor(e,t,n,s=j,a,h,u,m){this.entityName=e,this.entityActionFactory=t,this.store=n,this.selectId=s,this.defaultDispatcherOptions=a,this.reducedActions$=h,this.correlationIdGenerator=m,this.guard=new H(e,s),this.toUpdate=tt(s);const S=(0,D.P1)(u,A=>A[e]);this.entityCollection$=n.select(S)}createEntityAction(e,t,n){return this.entityActionFactory.create({entityName:this.entityName,entityOp:e,data:t,...n})}createAndDispatch(e,t,n){const s=this.createEntityAction(e,t,n);return this.dispatch(s),s}dispatch(e){return this.store.dispatch(e),e}add(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticAdd);const n=this.createEntityAction(o.SAVE_ADD_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(n),this.dispatch(n),this.getResponseData$(t.correlationId).pipe((0,F.M)(this.entityCollection$),(0,L.U)(([s,a])=>a.entities[this.selectId(s)]),P(1))}cancel(e,t,n){if(!e)throw new Error("Missing correlationId");this.createAndDispatch(o.CANCEL_PERSIST,t,{correlationId:e})}delete(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticDelete);const n=this.getKey(e),s=this.createEntityAction(o.SAVE_DELETE_ONE,n,t);return this.guard.mustBeKey(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,L.U)(()=>n),P(1))}getAll(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(o.QUERY_ALL,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe((0,F.M)(this.entityCollection$),(0,L.U)(([n,s])=>n.reduce((a,h)=>{const u=s.entities[this.selectId(h)];return u&&a.push(u),a},[])),P(1))}getByKey(e,t){t=this.setQueryEntityActionOptions(t);const n=this.createEntityAction(o.QUERY_BY_KEY,e,t);return this.dispatch(n),this.getResponseData$(t.correlationId).pipe((0,F.M)(this.entityCollection$),(0,L.U)(([s,a])=>a.entities[this.selectId(s)]),P(1))}getWithQuery(e,t){t=this.setQueryEntityActionOptions(t);const n=this.createEntityAction(o.QUERY_MANY,e,t);return this.dispatch(n),this.getResponseData$(t.correlationId).pipe((0,F.M)(this.entityCollection$),(0,L.U)(([s,a])=>s.reduce((h,u)=>{const m=a.entities[this.selectId(u)];return m&&h.push(m),h},[])),P(1))}load(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(o.QUERY_LOAD,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(P(1))}loadWithQuery(e,t){t=this.setQueryEntityActionOptions(t);const n=this.createEntityAction(o.QUERY_MANY,e,t);return this.dispatch(n),this.getResponseData$(t.correlationId).pipe(P(1))}update(e,t){const n=this.toUpdate(e);t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpdate);const s=this.createEntityAction(o.SAVE_UPDATE_ONE,n,t);return t.isOptimistic&&this.guard.mustBeUpdate(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,L.U)(a=>a.changes),(0,F.M)(this.entityCollection$),(0,L.U)(([a,h])=>h.entities[this.selectId(a)]),P(1))}upsert(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpsert);const n=this.createEntityAction(o.SAVE_UPSERT_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(n),this.dispatch(n),this.getResponseData$(t.correlationId).pipe((0,F.M)(this.entityCollection$),(0,L.U)(([s,a])=>a.entities[this.selectId(s)]),P(1))}addAllToCache(e,t){this.createAndDispatch(o.ADD_ALL,e,t)}addOneToCache(e,t){this.createAndDispatch(o.ADD_ONE,e,t)}addManyToCache(e,t){this.createAndDispatch(o.ADD_MANY,e,t)}clearCache(e){this.createAndDispatch(o.REMOVE_ALL,void 0,e)}removeOneFromCache(e,t){this.createAndDispatch(o.REMOVE_ONE,this.getKey(e),t)}removeManyFromCache(e,t){if(!e||0===e.length)return;const n="object"==typeof e[0]?e.map(s=>this.getKey(s)):e;this.createAndDispatch(o.REMOVE_MANY,n,t)}updateOneInCache(e,t){const n=this.toUpdate(e);this.createAndDispatch(o.UPDATE_ONE,n,t)}updateManyInCache(e,t){if(!e||0===e.length)return;const n=e.map(s=>this.toUpdate(s));this.createAndDispatch(o.UPDATE_MANY,n,t)}upsertOneInCache(e,t){this.createAndDispatch(o.UPSERT_ONE,e,t)}upsertManyInCache(e,t){!e||0===e.length||this.createAndDispatch(o.UPSERT_MANY,e,t)}setFilter(e){this.createAndDispatch(o.SET_FILTER,e)}setLoaded(e){this.createAndDispatch(o.SET_LOADED,!!e)}setLoading(e){this.createAndDispatch(o.SET_LOADING,!!e)}getKey(e){return"object"==typeof e?this.selectId(e):e}getResponseData$(e){return this.reducedActions$.pipe((0,E.h)(t=>!!t.payload),(0,E.h)(t=>{const{correlationId:n,entityName:s,entityOp:a}=t.payload;return s===this.entityName&&n===e&&(a.endsWith(Et)||a.endsWith(gt)||a===o.CANCEL_PERSIST)}),(0,K.q)(1),(0,V.z)(t=>{const{entityOp:n}=t.payload;return n===o.CANCEL_PERSIST?(0,N._)(new Ft(t.payload.data)):n.endsWith(Et)?(0,C.of)(t.payload.data):(0,N._)(t.payload.data.error)}))}setQueryEntityActionOptions(e){const t=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId;return{...e,correlationId:t}}setSaveEntityActionOptions(e,t){const n=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId,s=null==e.isOptimistic?t||!1:!0===e.isOptimistic;return{...e,correlationId:n,isOptimistic:s}}}const dt="entityCache",vt=new c.OlP("@ngrx/data Entity Cache Name"),bt=new c.OlP("@ngrx/data Entity Cache Meta Reducers"),Pt=new c.OlP("@ngrx/data Entity Collection Meta Reducers"),he=new c.OlP("@ngrx/data Initial Entity Cache State"),ut=new c.OlP("@ngrx/data Entity Cache Selector"),le={provide:ut,useFactory:Yt,deps:[[new c.FiY,vt]]};function Yt(r){return(0,D.ZF)(r=r||dt)}let mt=(()=>{class r{constructor(t,n,s,a,h,u){this.entityActionFactory=t,this.store=n,this.entityDispatcherDefaultOptions=s,this.entityCacheSelector=h,this.correlationIdGenerator=u,this.reducedActions$=a.pipe(P(1)),this.raSubscription=this.reducedActions$.subscribe()}create(t,n=j,s={}){const a={...this.entityDispatcherDefaultOptions,...s};return new ue(t,this.entityActionFactory,this.store,n,a,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)}ngOnDestroy(){this.raSubscription.unsubscribe()}}return r.\u0275fac=function(t){return new(t||r)(c.LFG($),c.LFG(D.yh),c.LFG(_t),c.LFG(D.Y$),c.LFG(ut),c.LFG(St))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();const $t=new c.OlP("@ngrx/data Entity Effects Scheduler");let wt=(()=>{class r{constructor(t,n,s,a,h){this.actions=t,this.dataService=n,this.entityActionFactory=s,this.logger=a,this.scheduler=h,this.responseDelay=10,this.saveEntitiesCancel$=(0,b.GW)(()=>this.actions.pipe((0,b.l4)(v.SAVE_ENTITIES_CANCEL),(0,E.h)(u=>null!=u.payload.correlationId)),{dispatch:!1}),this.saveEntities$=(0,b.GW)(()=>this.actions.pipe((0,b.l4)(v.SAVE_ENTITIES),(0,V.z)(u=>this.saveEntities(u))))}saveEntities(t){const n=t.payload.error;if(n)return this.handleSaveEntitiesError$(t)(n);try{const s=f(t.payload.changeSet),{correlationId:a,mergeStrategy:h,tag:u,url:m}=t.payload;if(0===s.changes.length)return(0,C.of)(new pt(s,m,{correlationId:a,mergeStrategy:h,tag:u}));const A=this.saveEntitiesCancel$.pipe((0,E.h)(Q=>a===Q.payload.correlationId),(0,L.U)(Q=>new te(a,Q.payload.reason,Q.payload.tag))),U=this.dataService.saveEntities(s,m).pipe((0,x.b)(Q=>this.handleSaveEntitiesSuccess$(t,this.entityActionFactory)(Q)),(0,g.K)(this.handleSaveEntitiesError$(t)));return(0,M.S)(A,U)}catch(s){return this.handleSaveEntitiesError$(t)(s)}}handleSaveEntitiesError$(t){return n=>{const s=n instanceof rt?n:new rt(n,null);return(0,C.of)(new ee(s,t)).pipe((0,d.g)(this.responseDelay,this.scheduler||Y.z))}}handleSaveEntitiesSuccess$(t,n){const{url:s,correlationId:a,mergeStrategy:h,tag:u}=t.payload,m={correlationId:a,mergeStrategy:h,tag:u};return S=>{if(S)return(0,C.of)(new pt(S,s,m));if(S=t.payload.changeSet,!t.payload.isOptimistic)return(0,C.of)(new pt(S,s,m));const A=S.changes.reduce((U,Q)=>-1===U.indexOf(Q.entityName)?U.concat(Q.entityName):U,[]);return(0,I.T)(A.map(U=>n.create(U,o.SET_LOADING,!1)))}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(b.eX),c.LFG(xt),c.LFG($),c.LFG(ct),c.LFG($t,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();const ye=[o.QUERY_ALL,o.QUERY_LOAD,o.QUERY_BY_KEY,o.QUERY_MANY,o.SAVE_ADD_ONE,o.SAVE_DELETE_ONE,o.SAVE_UPDATE_ONE,o.SAVE_UPSERT_ONE];let Bt=(()=>{class r{constructor(t,n,s,a,h){this.actions=t,this.dataService=n,this.entityActionFactory=s,this.resultHandler=a,this.scheduler=h,this.responseDelay=10,this.cancel$=(0,b.GW)(()=>this.actions.pipe(q(o.CANCEL_PERSIST),(0,L.U)(u=>u.payload.correlationId),(0,E.h)(u=>null!=u)),{dispatch:!1}),this.persist$=(0,b.GW)(()=>this.actions.pipe(q(ye),(0,V.z)(u=>this.persist(u))))}persist(t){if(t.payload.skip)return this.handleSkipSuccess$(t);if(t.payload.error)return this.handleError$(t)(t.payload.error);try{const n=this.cancel$.pipe((0,E.h)(a=>t.payload.correlationId===a),(0,L.U)(a=>this.entityActionFactory.createFromAction(t,{entityOp:o.CANCELED_PERSIST}))),s=this.callDataService(t).pipe((0,L.U)(this.resultHandler.handleSuccess(t)),(0,g.K)(this.handleError$(t)));return(0,M.S)(n,s)}catch(n){return this.handleError$(t)(n)}}callDataService(t){const{entityName:n,entityOp:s,data:a,httpOptions:h}=t.payload,u=this.dataService.getService(n);switch(s){case o.QUERY_ALL:case o.QUERY_LOAD:return u.getAll(h);case o.QUERY_BY_KEY:return u.getById(a,h);case o.QUERY_MANY:return u.getWithQuery(a,h);case o.SAVE_ADD_ONE:return u.add(a,h);case o.SAVE_DELETE_ONE:return u.delete(a,h);case o.SAVE_UPDATE_ONE:const{id:m,changes:S}=a;return u.update(a,h).pipe((0,L.U)(A=>A&&Object.keys(A).length>0?{id:m,changes:{...S,...A},changed:!0}:{id:m,changes:S,changed:!1}));case o.SAVE_UPSERT_ONE:return u.upsert(a,h).pipe((0,L.U)(A=>A&&Object.keys(A).length>0?A:a));default:throw new Error(`Persistence action "${s}" is not implemented.`)}}handleError$(t){return n=>(0,C.of)(this.resultHandler.handleError(t)(n)).pipe((0,d.g)(this.responseDelay,this.scheduler||Y.z))}handleSkipSuccess$(t){const n=Dt(t.payload.entityOp),s=this.entityActionFactory.createFromAction(t,{entityOp:n});return(0,C.of)(s).pipe((0,d.g)(this.responseDelay,this.scheduler||Y.z))}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(b.eX),c.LFG(It),c.LFG($),c.LFG(Nt),c.LFG($t,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();class Vt{constructor(e,t){this.entityName=e,e=e.trim();const{dispatcher:n,selectors:s,selectors$:a}=t.create(e);this.entityName=e,this.dispatcher=n,this.guard=n.guard,this.selectId=n.selectId,this.toUpdate=n.toUpdate,this.selectors=s,this.selectors$=a,this.collection$=a.collection$,this.count$=a.count$,this.entities$=a.entities$,this.entityActions$=a.entityActions$,this.entityMap$=a.entityMap$,this.errors$=a.errors$,this.filter$=a.filter$,this.filteredEntities$=a.filteredEntities$,this.keys$=a.keys$,this.loaded$=a.loaded$,this.loading$=a.loading$,this.changeState$=a.changeState$}createEntityAction(e,t,n){return this.dispatcher.createEntityAction(e,t,n)}createAndDispatch(e,t,n){return this.dispatcher.createAndDispatch(e,t,n)}dispatch(e){return this.dispatcher.dispatch(e)}get store(){return this.dispatcher.store}add(e,t){return this.dispatcher.add(e,t)}cancel(e,t,n){this.dispatcher.cancel(e,t,n)}delete(e,t){return this.dispatcher.delete(e,t)}getAll(e){return this.dispatcher.getAll(e)}getByKey(e,t){return this.dispatcher.getByKey(e,t)}getWithQuery(e,t){return this.dispatcher.getWithQuery(e,t)}load(e){return this.dispatcher.load(e)}loadWithQuery(e,t){return this.dispatcher.loadWithQuery(e,t)}update(e,t){return this.dispatcher.update(e,t)}upsert(e,t){return this.dispatcher.upsert(e,t)}addAllToCache(e,t){this.dispatcher.addAllToCache(e,t)}addOneToCache(e,t){this.dispatcher.addOneToCache(e,t)}addManyToCache(e,t){this.dispatcher.addManyToCache(e,t)}clearCache(){this.dispatcher.clearCache()}removeOneFromCache(e,t){this.dispatcher.removeOneFromCache(e,t)}removeManyFromCache(e,t){this.dispatcher.removeManyFromCache(e,t)}updateOneInCache(e,t){this.dispatcher.updateOneInCache(e,t)}updateManyInCache(e,t){this.dispatcher.updateManyInCache(e,t)}upsertOneInCache(e,t){this.dispatcher.upsertOneInCache(e,t)}upsertManyInCache(e,t){this.dispatcher.upsertManyInCache(e,t)}setFilter(e){this.dispatcher.setFilter(e)}setLoaded(e){this.dispatcher.setLoaded(!!e)}setLoading(e){this.dispatcher.setLoading(!!e)}}let ht=(()=>{class r{constructor(t){this.entityDefinitionService=t}create(t){const n=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return n&&n.initialState||function pe(r){return{entityName:r,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}(t)}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(at,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),Kt=(()=>{class r{constructor(t,n){this.entityCollectionCreator=t||new ht,this.selectEntityCache=n||Yt(dt)}createCollectionSelector(t){return(0,D.P1)(this.selectEntityCache,(s={})=>s[t]||this.entityCollectionCreator.create(t))}createCollectionSelectors(t){const n="string"==typeof t?{entityName:t}:t,s=z=>z.ids,a=z=>z.entities,h=(0,D.P1)(s,a,(z,ot)=>z.map(ke=>ot[ke])),u=(0,D.P1)(s,z=>z.length),m=z=>z.filter,S=n.filterFn,A=S?(0,D.P1)(h,m,(z,ot)=>S(z,ot)):h,it={};return Object.keys(n.additionalCollectionState||{}).forEach(z=>{it["select"+z[0].toUpperCase()+z.slice(1)]=ot=>ot[z]}),{selectCount:u,selectEntities:h,selectEntityMap:a,selectFilter:m,selectFilteredEntities:A,selectKeys:s,selectLoaded:z=>z.loaded,selectLoading:z=>z.loading,selectChangeState:z=>z.changeState,...it}}create(t){const n="string"==typeof t?{entityName:t}:t,s=n.entityName,a=this.createCollectionSelector(s),h=this.createCollectionSelectors(n),u={};return Object.keys(h).forEach(m=>{u[m]=(0,D.P1)(a,h[m])}),{entityName:s,selectCollection:a,selectEntityCache:this.selectEntityCache,...u}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(ht,8),c.LFG(ut,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),At=(()=>{class r{constructor(t,n,s){this.store=t,this.actions=n,this.selectEntityCache=s,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=n.pipe((0,E.h)(a=>a.payload&&a.payload.entityOp&&a.payload.entityOp.endsWith(gt)),P(1))}create(t,n){const s={entityName:t};return Object.keys(n).forEach(a=>{if(a.startsWith("select")){const h=a[6].toLowerCase()+a.substring(7)+"$";s[h]=this.store.select(n[a])}}),s.entityActions$=this.actions.pipe(T(t)),s.errors$=this.entityActionErrors$.pipe(T(t)),s}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(D.yh),c.LFG(b.eX),c.LFG(ut))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),Ct=(()=>{class r{constructor(t,n,s,a){this.entityDispatcherFactory=t,this.entityDefinitionService=n,this.entitySelectorsFactory=s,this.entitySelectors$Factory=a}create(t){t=t.trim();const n=this.entityDefinitionService.getDefinition(t),s=this.entityDispatcherFactory.create(t,n.selectId,n.entityDispatcherOptions),a=this.entitySelectorsFactory.create(n.metadata);return{dispatcher:s,entityName:t,selectors:a,selectors$:this.entitySelectors$Factory.create(t,a)}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(mt),c.LFG(at),c.LFG(Kt),c.LFG(At))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),Gt=(()=>{class r{constructor(t){this.entityCollectionServiceElementsFactory=t}create(t){return new Vt(t,this.entityCollectionServiceElementsFactory)}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Ct))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),Qt=(()=>{class r{constructor(t,n,s,a){this.entityCollectionServiceFactory=t,this.store=a,this.entityActionErrors$=s.entityActionErrors$,this.entityCache$=s.entityCache$,this.reducedActions$=n.reducedActions$}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Gt),c.LFG(mt),c.LFG(At),c.LFG(D.yh))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),Ee=(()=>{class r{constructor(t){this.entityServicesElements=t,this.EntityCollectionServices={}}get entityActionErrors$(){return this.entityServicesElements.entityActionErrors$}get entityCache$(){return this.entityServicesElements.entityCache$}get entityCollectionServiceFactory(){return this.entityServicesElements.entityCollectionServiceFactory}get reducedActions$(){return this.entityServicesElements.reducedActions$}get store(){return this.entityServicesElements.store}dispatch(t){this.store.dispatch(t)}createEntityCollectionService(t){return this.entityCollectionServiceFactory.create(t)}getEntityCollectionService(t){let n=this.EntityCollectionServices[t];return n||(n=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=n),n}registerEntityCollectionService(t,n){this.EntityCollectionServices[n||t.entityName]=t}registerEntityCollectionServices(t){Array.isArray(t)?t.forEach(n=>this.registerEntityCollectionService(n)):Object.keys(t||{}).forEach(n=>{this.registerEntityCollectionService(t[n],n)})}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Qt))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();var G=(()=>((G=G||{})[G.Unchanged=0]="Unchanged",G[G.Added=1]="Added",G[G.Deleted=2]="Deleted",G[G.Updated=3]="Updated",G))();class fe{constructor(e,t){this.adapter=e,this.selectId=t,this.selectId=t||j}commitAll(e){return 0===Object.keys(e.changeState).length?e:{...e,changeState:{}}}commitMany(e,t){if(null==e||0===e.length)return t;let n=!1;const s=e.reduce((a,h)=>{const u="object"==typeof h?this.selectId(h):h;return a[u]&&(n||(a={...a},n=!0),delete a[u]),a},t.changeState);return n?{...t,changeState:s}:t}commitOne(e,t){return null==e?t:this.commitMany([e],t)}mergeQueryResults(e,t,n){return this.mergeServerUpserts(e,t,y.PreserveChanges,n)}mergeSaveAdds(e,t,n){return this.mergeServerUpserts(e,t,y.OverwriteChanges,n)}mergeSaveDeletes(e,t,n){const s=e;return t=(n=n??y.OverwriteChanges)===y.IgnoreChanges?t:this.commitMany(s,t),this.adapter.removeMany(s,t)}mergeSaveUpdates(e,t,n,s=!1){if(null==e||0===e.length)return t;let u,a=!1,h=t.changeState;switch(n=n??y.OverwriteChanges){case y.IgnoreChanges:return u=m(e),this.adapter.updateMany(u,t);case y.OverwriteChanges:return h=e.reduce((S,A)=>{const U=A.id;return S[U]&&(a||(S={...S},a=!0),delete S[U]),S},t.changeState),t=a?{...t,changeState:h}:t,u=m(e),this.adapter.updateMany(u,t);case y.PreserveChanges:{const S=[];return h=e.reduce((A,U)=>{const Q=U.id,et=A[Q];if(et){a||(A={...A},a=!0);const lt=this.selectId(U.changes),it=et;lt!==Q&&delete A[Q];const z={...it.originalValue,...U.changes};A[lt]={...it,originalValue:z}}else S.push(U);return A},t.changeState),t=a?{...t,changeState:h}:t,u=m(S),this.adapter.updateMany(u,t)}}function m(S){return!0===s&&(S=S.filter(A=>!0===A.changed)),S.map(A=>({id:A.id,changes:A.changes}))}}mergeSaveUpserts(e,t,n){return this.mergeServerUpserts(e,t,y.OverwriteChanges,n)}mergeServerUpserts(e,t,n,s){if(null==e||0===e.length)return t;let a=!1,h=t.changeState;switch(s=s??n){case y.IgnoreChanges:return this.adapter.upsertMany(e,t);case y.OverwriteChanges:return t=this.adapter.upsertMany(e,t),h=e.reduce((u,m)=>{const S=this.selectId(m);return u[S]&&(a||(u={...u},a=!0),delete u[S]),u},t.changeState),a?{...t,changeState:h}:t;case y.PreserveChanges:{const u=[];return h=e.reduce((m,S)=>{const A=this.selectId(S);return m[A]?a||(m={...m,[A]:{...m[A],originalValue:S}},a=!0):u.push(S),m},t.changeState),t=this.adapter.upsertMany(u,t),a?{...t,changeState:h}:t}}}trackAddMany(e,t,n){if(n===y.IgnoreChanges||null==e||0===e.length)return t;let s=!1;const a=e.reduce((h,u)=>{const m=this.selectId(u);if(null==m||""===m)throw new Error(`${t.entityName} entity add requires a key to be tracked`);return h[m]||(s||(s=!0,h={...h}),h[m]={changeType:G.Added}),h},t.changeState);return s?{...t,changeState:a}:t}trackAddOne(e,t,n){return null==e?t:this.trackAddMany([e],t,n)}trackDeleteMany(e,t,n){if(n===y.IgnoreChanges||null==e||0===e.length)return t;let s=!1;const a=t.entities,h=e.reduce((u,m)=>{const S=a[m];if(S){const U=u[m];U?U.changeType===G.Added?(A(),delete u[m]):U.changeType===G.Updated&&(A(),u[m]={...u[m],changeType:G.Deleted}):(A(),u[m]={changeType:G.Deleted,originalValue:S})}return u;function A(){s||(s=!0,u={...u})}},t.changeState);return s?{...t,changeState:h}:t}trackDeleteOne(e,t,n){return null==e?t:this.trackDeleteMany([e],t,n)}trackUpdateMany(e,t,n){if(n===y.IgnoreChanges||null==e||0===e.length)return t;let s=!1;const a=t.entities,h=e.reduce((u,m)=>{const{id:S}=m;if(null==S||""===S)throw new Error(`${t.entityName} entity update requires a key to be tracked`);const U=a[S];return U&&(u[S]||(s||(s=!0,u={...u}),u[S]={changeType:G.Updated,originalValue:U})),u},t.changeState);return s?{...t,changeState:h}:t}trackUpdateOne(e,t,n){return null==e?t:this.trackUpdateMany([e],t,n)}trackUpsertMany(e,t,n){if(n===y.IgnoreChanges||null==e||0===e.length)return t;let s=!1;const a=t.entities,h=e.reduce((u,m)=>{const S=this.selectId(m);if(null==S||""===S)throw new Error(`${t.entityName} entity upsert requires a key to be tracked`);if(!u[S]){s||(s=!0,u={...u});const U=a[S];u[S]=null==U?{changeType:G.Added}:{changeType:G.Updated,originalValue:U}}return u},t.changeState);return s?{...t,changeState:h}:t}trackUpsertOne(e,t,n){return null==e?t:this.trackUpsertMany([e],t,n)}undoAll(e){const t=Object.keys(e.changeState),{remove:n,upsert:s}=t.reduce((a,h)=>{const u=a.chgState[h];switch(u.changeType){case G.Added:a.remove.push(h);break;case G.Deleted:const m=u.originalValue;m&&a.upsert.push(m);break;case G.Updated:a.upsert.push(u.originalValue)}return a},{remove:[],upsert:[],chgState:e.changeState});return e=this.adapter.removeMany(n,e),e=this.adapter.upsertMany(s,e),{...e,changeState:{}}}undoMany(e,t){if(null==e||0===e.length)return t;let n=!1;const{changeState:s,remove:a,upsert:h}=e.reduce((u,m)=>{let S=u.changeState;const A="object"==typeof m?this.selectId(m):m,U=S[A];if(U)switch(n||(S={...S},n=!0),delete S[A],u.changeState=S,U.changeType){case G.Added:u.remove.push(A);break;case G.Deleted:const Q=U.originalValue;Q&&u.upsert.push(Q);break;case G.Updated:u.upsert.push(U.originalValue)}return u},{remove:[],upsert:[],changeState:t.changeState});return t=this.adapter.removeMany(a,t),t=this.adapter.upsertMany(h,t),n?{...t,changeState:s}:t}undoOne(e,t){return null==e?t:this.undoMany([e],t)}}class Se{constructor(e,t,n){this.entityName=e,this.definition=t,this.methods={[o.CANCEL_PERSIST]:this.cancelPersist.bind(this),[o.QUERY_ALL]:this.queryAll.bind(this),[o.QUERY_ALL_ERROR]:this.queryAllError.bind(this),[o.QUERY_ALL_SUCCESS]:this.queryAllSuccess.bind(this),[o.QUERY_BY_KEY]:this.queryByKey.bind(this),[o.QUERY_BY_KEY_ERROR]:this.queryByKeyError.bind(this),[o.QUERY_BY_KEY_SUCCESS]:this.queryByKeySuccess.bind(this),[o.QUERY_LOAD]:this.queryLoad.bind(this),[o.QUERY_LOAD_ERROR]:this.queryLoadError.bind(this),[o.QUERY_LOAD_SUCCESS]:this.queryLoadSuccess.bind(this),[o.QUERY_MANY]:this.queryMany.bind(this),[o.QUERY_MANY_ERROR]:this.queryManyError.bind(this),[o.QUERY_MANY_SUCCESS]:this.queryManySuccess.bind(this),[o.SAVE_ADD_MANY]:this.saveAddMany.bind(this),[o.SAVE_ADD_MANY_ERROR]:this.saveAddManyError.bind(this),[o.SAVE_ADD_MANY_SUCCESS]:this.saveAddManySuccess.bind(this),[o.SAVE_ADD_ONE]:this.saveAddOne.bind(this),[o.SAVE_ADD_ONE_ERROR]:this.saveAddOneError.bind(this),[o.SAVE_ADD_ONE_SUCCESS]:this.saveAddOneSuccess.bind(this),[o.SAVE_DELETE_MANY]:this.saveDeleteMany.bind(this),[o.SAVE_DELETE_MANY_ERROR]:this.saveDeleteManyError.bind(this),[o.SAVE_DELETE_MANY_SUCCESS]:this.saveDeleteManySuccess.bind(this),[o.SAVE_DELETE_ONE]:this.saveDeleteOne.bind(this),[o.SAVE_DELETE_ONE_ERROR]:this.saveDeleteOneError.bind(this),[o.SAVE_DELETE_ONE_SUCCESS]:this.saveDeleteOneSuccess.bind(this),[o.SAVE_UPDATE_MANY]:this.saveUpdateMany.bind(this),[o.SAVE_UPDATE_MANY_ERROR]:this.saveUpdateManyError.bind(this),[o.SAVE_UPDATE_MANY_SUCCESS]:this.saveUpdateManySuccess.bind(this),[o.SAVE_UPDATE_ONE]:this.saveUpdateOne.bind(this),[o.SAVE_UPDATE_ONE_ERROR]:this.saveUpdateOneError.bind(this),[o.SAVE_UPDATE_ONE_SUCCESS]:this.saveUpdateOneSuccess.bind(this),[o.SAVE_UPSERT_MANY]:this.saveUpsertMany.bind(this),[o.SAVE_UPSERT_MANY_ERROR]:this.saveUpsertManyError.bind(this),[o.SAVE_UPSERT_MANY_SUCCESS]:this.saveUpsertManySuccess.bind(this),[o.SAVE_UPSERT_ONE]:this.saveUpsertOne.bind(this),[o.SAVE_UPSERT_ONE_ERROR]:this.saveUpsertOneError.bind(this),[o.SAVE_UPSERT_ONE_SUCCESS]:this.saveUpsertOneSuccess.bind(this),[o.ADD_ALL]:this.addAll.bind(this),[o.ADD_MANY]:this.addMany.bind(this),[o.ADD_ONE]:this.addOne.bind(this),[o.REMOVE_ALL]:this.removeAll.bind(this),[o.REMOVE_MANY]:this.removeMany.bind(this),[o.REMOVE_ONE]:this.removeOne.bind(this),[o.UPDATE_MANY]:this.updateMany.bind(this),[o.UPDATE_ONE]:this.updateOne.bind(this),[o.UPSERT_MANY]:this.upsertMany.bind(this),[o.UPSERT_ONE]:this.upsertOne.bind(this),[o.COMMIT_ALL]:this.commitAll.bind(this),[o.COMMIT_MANY]:this.commitMany.bind(this),[o.COMMIT_ONE]:this.commitOne.bind(this),[o.UNDO_ALL]:this.undoAll.bind(this),[o.UNDO_MANY]:this.undoMany.bind(this),[o.UNDO_ONE]:this.undoOne.bind(this),[o.SET_CHANGE_STATE]:this.setChangeState.bind(this),[o.SET_COLLECTION]:this.setCollection.bind(this),[o.SET_FILTER]:this.setFilter.bind(this),[o.SET_LOADED]:this.setLoaded.bind(this),[o.SET_LOADING]:this.setLoading.bind(this)},this.adapter=t.entityAdapter,this.isChangeTracking=!0!==t.noChangeTracking,this.selectId=t.selectId,this.guard=new H(e,this.selectId),this.toUpdate=tt(this.selectId),this.entityChangeTracker=n||new fe(this.adapter,this.selectId)}cancelPersist(e){return this.setLoadingFalse(e)}queryAll(e){return this.setLoadingTrue(e)}queryAllError(e,t){return this.setLoadingFalse(e)}queryAllSuccess(e,t){const n=this.extractData(t),s=this.extractMergeStrategy(t);return{...this.entityChangeTracker.mergeQueryResults(n,e,s),loaded:!0,loading:!1}}queryByKey(e,t){return this.setLoadingTrue(e)}queryByKeyError(e,t){return this.setLoadingFalse(e)}queryByKeySuccess(e,t){const n=this.extractData(t),s=this.extractMergeStrategy(t);return e=null==n?e:this.entityChangeTracker.mergeQueryResults([n],e,s),this.setLoadingFalse(e)}queryLoad(e){return this.setLoadingTrue(e)}queryLoadError(e,t){return this.setLoadingFalse(e)}queryLoadSuccess(e,t){const n=this.extractData(t);return{...this.adapter.setAll(n,e),loading:!1,loaded:!0,changeState:{}}}queryMany(e,t){return this.setLoadingTrue(e)}queryManyError(e,t){return this.setLoadingFalse(e)}queryManySuccess(e,t){const n=this.extractData(t),s=this.extractMergeStrategy(t);return{...this.entityChangeTracker.mergeQueryResults(n,e,s),loaded:!0,loading:!1}}saveAddMany(e,t){if(this.isOptimistic(t)){const n=this.guard.mustBeEntities(t),s=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddMany(n,e,s),e=this.adapter.addMany(n,e)}return this.setLoadingTrue(e)}saveAddManyError(e,t){return this.setLoadingFalse(e)}saveAddManySuccess(e,t){const n=this.guard.mustBeEntities(t),s=this.extractMergeStrategy(t);return e=this.isOptimistic(t)?this.entityChangeTracker.mergeSaveUpserts(n,e,s):this.entityChangeTracker.mergeSaveAdds(n,e,s),this.setLoadingFalse(e)}saveAddOne(e,t){if(this.isOptimistic(t)){const n=this.guard.mustBeEntity(t),s=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddOne(n,e,s),e=this.adapter.addOne(n,e)}return this.setLoadingTrue(e)}saveAddOneError(e,t){return this.setLoadingFalse(e)}saveAddOneSuccess(e,t){const n=this.guard.mustBeEntity(t),s=this.extractMergeStrategy(t);if(this.isOptimistic(t)){const a=this.toUpdate(n);e=this.entityChangeTracker.mergeSaveUpdates([a],e,s,!1)}else e=this.entityChangeTracker.mergeSaveAdds([n],e,s);return this.setLoadingFalse(e)}saveDeleteOne(e,t){const n=this.extractData(t),s="object"==typeof n?this.selectId(n):n,a=e.changeState[s];if(a&&(a.changeType===G.Added?(e=this.adapter.removeOne(s,e),e=this.entityChangeTracker.commitOne(s,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(s,e)),this.isOptimistic(t)){const h=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteOne(s,e,h),e=this.adapter.removeOne(s,e)}return this.setLoadingTrue(e)}saveDeleteOneError(e,t){return this.setLoadingFalse(e)}saveDeleteOneSuccess(e,t){const n=this.extractData(t);if(this.isOptimistic(t)){const s=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes([n],e,s)}else e=this.adapter.removeOne(n,e),e=this.entityChangeTracker.commitOne(n,e);return this.setLoadingFalse(e)}saveDeleteMany(e,t){const n=this.extractData(t).map(s=>"object"==typeof s?this.selectId(s):s);if(n.forEach(s=>{const a=e.changeState[s];a&&(a.changeType===G.Added?(e=this.adapter.removeOne(s,e),e=this.entityChangeTracker.commitOne(s,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(s,e))}),this.isOptimistic(t)){const s=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteMany(n,e,s),e=this.adapter.removeMany(n,e)}return this.setLoadingTrue(e)}saveDeleteManyError(e,t){return this.setLoadingFalse(e)}saveDeleteManySuccess(e,t){const n=this.extractData(t);if(this.isOptimistic(t)){const s=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes(n,e,s)}else e=this.adapter.removeMany(n,e),e=this.entityChangeTracker.commitMany(n,e);return this.setLoadingFalse(e)}saveUpdateOne(e,t){const n=this.guard.mustBeUpdate(t);if(this.isOptimistic(t)){const s=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateOne(n,e,s),e=this.adapter.updateOne(n,e)}return this.setLoadingTrue(e)}saveUpdateOneError(e,t){return this.setLoadingFalse(e)}saveUpdateOneSuccess(e,t){const n=this.guard.mustBeUpdateResponse(t),s=this.isOptimistic(t),a=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpdates([n],e,a,s),this.setLoadingFalse(e)}saveUpdateMany(e,t){const n=this.guard.mustBeUpdates(t);if(this.isOptimistic(t)){const s=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateMany(n,e,s),e=this.adapter.updateMany(n,e)}return this.setLoadingTrue(e)}saveUpdateManyError(e,t){return this.setLoadingFalse(e)}saveUpdateManySuccess(e,t){const n=this.guard.mustBeUpdateResponses(t),a=(this.isOptimistic(t),this.extractMergeStrategy(t));return e=this.entityChangeTracker.mergeSaveUpdates(n,e,a,!1),this.setLoadingFalse(e)}saveUpsertOne(e,t){if(this.isOptimistic(t)){const n=this.guard.mustBeEntity(t),s=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertOne(n,e,s),e=this.adapter.upsertOne(n,e)}return this.setLoadingTrue(e)}saveUpsertOneError(e,t){return this.setLoadingFalse(e)}saveUpsertOneSuccess(e,t){const n=this.guard.mustBeEntity(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts([n],e,s),this.setLoadingFalse(e)}saveUpsertMany(e,t){if(this.isOptimistic(t)){const n=this.guard.mustBeEntities(t),s=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertMany(n,e,s),e=this.adapter.upsertMany(n,e)}return this.setLoadingTrue(e)}saveUpsertManyError(e,t){return this.setLoadingFalse(e)}saveUpsertManySuccess(e,t){const n=this.guard.mustBeEntities(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts(n,e,s),this.setLoadingFalse(e)}addAll(e,t){const n=this.guard.mustBeEntities(t);return{...this.adapter.setAll(n,e),loading:!1,loaded:!0,changeState:{}}}addMany(e,t){const n=this.guard.mustBeEntities(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddMany(n,e,s),this.adapter.addMany(n,e)}addOne(e,t){const n=this.guard.mustBeEntity(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddOne(n,e,s),this.adapter.addOne(n,e)}removeMany(e,t){const n=this.guard.mustBeKeys(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteMany(n,e,s),this.adapter.removeMany(n,e)}removeOne(e,t){const n=this.guard.mustBeKey(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteOne(n,e,s),this.adapter.removeOne(n,e)}removeAll(e,t){return{...this.adapter.removeAll(e),loaded:!1,loading:!1,changeState:{}}}updateMany(e,t){const n=this.guard.mustBeUpdates(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateMany(n,e,s),this.adapter.updateMany(n,e)}updateOne(e,t){const n=this.guard.mustBeUpdate(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateOne(n,e,s),this.adapter.updateOne(n,e)}upsertMany(e,t){const n=this.guard.mustBeEntities(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertMany(n,e,s),this.adapter.upsertMany(n,e)}upsertOne(e,t){const n=this.guard.mustBeEntity(t),s=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertOne(n,e,s),this.adapter.upsertOne(n,e)}commitAll(e){return this.entityChangeTracker.commitAll(e)}commitMany(e,t){return this.entityChangeTracker.commitMany(this.extractData(t),e)}commitOne(e,t){return this.entityChangeTracker.commitOne(this.extractData(t),e)}undoAll(e){return this.entityChangeTracker.undoAll(e)}undoMany(e,t){return this.entityChangeTracker.undoMany(this.extractData(t),e)}undoOne(e,t){return this.entityChangeTracker.undoOne(this.extractData(t),e)}setChangeState(e,t){const n=this.extractData(t);return e.changeState===n?e:{...e,changeState:n}}setCollection(e,t){const n=this.extractData(t);return e===n?e:n}setFilter(e,t){const n=this.extractData(t);return e.filter===n?e:{...e,filter:n}}setLoaded(e,t){const n=!0===this.extractData(t)||!1;return e.loaded===n?e:{...e,loaded:n}}setLoading(e,t){return this.setLoadingFlag(e,this.extractData(t))}setLoadingFalse(e){return this.setLoadingFlag(e,!1)}setLoadingTrue(e){return this.setLoadingFlag(e,!0)}setLoadingFlag(e,t){return e.loading===(t=!0===t)?e:{...e,loading:t}}extractData(e){return e.payload&&e.payload.data}extractMergeStrategy(e){return this.isChangeTracking?e.payload&&e.payload.mergeStrategy:y.IgnoreChanges}isOptimistic(e){return e.payload&&!0===e.payload.isOptimistic}}let Wt=(()=>{class r{constructor(t){this.entityDefinitionService=t}create(t){const n=this.entityDefinitionService.getDefinition(t);return new Se(t,n).methods}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(at))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),zt=(()=>{class r{constructor(t){this.methodsFactory=t}create(t){const n=this.methodsFactory.create(t);return function(a,h){const u=n[h.payload.entityOp];return u?u(a,h):a}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Wt))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),jt=(()=>{class r{constructor(t,n){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=D.qC.apply(null,n||[])}getOrCreateReducer(t){let n=this.entityCollectionReducers[t];return n||(n=this.entityCollectionReducerFactory.create(t),n=this.registerReducer(t,n),this.entityCollectionReducers[t]=n),n}registerReducer(t,n){return n=this.entityCollectionMetaReducer(n),this.entityCollectionReducers[t.trim()]=n}registerReducers(t){(t?Object.keys(t):[]).forEach(s=>this.registerReducer(s,t[s]))}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(zt),c.LFG(Pt,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),Ht=(()=>{class r{constructor(t,n,s){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=n,this.logger=s}create(){return function t(n={},s){switch(s.type){case v.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(n,s);case v.LOAD_COLLECTIONS:return this.loadCollectionsReducer(n,s);case v.MERGE_QUERY_SET:return this.mergeQuerySetReducer(n,s);case v.SAVE_ENTITIES:return this.saveEntitiesReducer(n,s);case v.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(n,s);case v.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(n,s);case v.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(n,s);case v.SET_ENTITY_CACHE:return s.payload.cache}const a=s.payload;return a&&a.entityName&&a.entityOp&&!a.error?this.applyCollectionReducer(n,s):n}.bind(this)}clearCollectionsReducer(t,n){let{collections:s}=n.payload;const h=o.REMOVE_ALL;return s||(s=Object.keys(t)),s.reduce((u,m)=>this.applyCollectionReducer(u,{type:`[${m}] ${n.type}`,payload:{entityName:m,entityOp:h}}),t)}loadCollectionsReducer(t,n){const{collections:s}=n.payload,h=o.ADD_ALL;return Object.keys(s).reduce((m,S)=>this.applyCollectionReducer(m,{type:`[${S}] ${n.type}`,payload:{entityName:S,entityOp:h,data:s[S]}}),t)}mergeQuerySetReducer(t,n){let{mergeStrategy:s,querySet:a}=n.payload;s=null===s?y.PreserveChanges:s;const u=o.QUERY_MANY_SUCCESS;return Object.keys(a).reduce((S,A)=>this.applyCollectionReducer(S,{type:`[${A}] ${n.type}`,payload:{entityName:A,entityOp:u,data:a[A],mergeStrategy:s}}),t)}saveEntitiesReducer(t,n){const{changeSet:s,correlationId:a,isOptimistic:h,mergeStrategy:u,tag:m}=n.payload;try{s.changes.forEach(A=>{const U=A.entityName,Q={entityName:U,entityOp:S(A),data:A.entities,correlationId:a,isOptimistic:h,mergeStrategy:u,tag:m},et={type:`[${U}] ${n.type}`,payload:Q};if(t=this.applyCollectionReducer(t,et),et.payload.error)throw et.payload.error})}catch(A){n.payload.error=A}return t;function S(A){switch(A.op){case p.Add:return o.SAVE_ADD_MANY;case p.Delete:return o.SAVE_DELETE_MANY;case p.Update:return o.SAVE_UPDATE_MANY;case p.Upsert:return o.SAVE_UPSERT_MANY}}}saveEntitiesCancelReducer(t,n){return this.clearLoadingFlags(t,n.payload.entityNames||[])}saveEntitiesErrorReducer(t,n){const h=n.payload.originalAction.payload.changeSet.changes.map(u=>u.entityName);return this.clearLoadingFlags(t,h)}saveEntitiesSuccessReducer(t,n){const{changeSet:s,correlationId:a,isOptimistic:h,mergeStrategy:u,tag:m}=n.payload;return s.changes.forEach(A=>{const U=A.entityName,Q={entityName:U,entityOp:S(A),data:A.entities,correlationId:a,isOptimistic:h,mergeStrategy:u,tag:m};t=this.applyCollectionReducer(t,{type:`[${U}] ${n.type}`,payload:Q})}),t;function S(A){switch(A.op){case p.Add:return o.SAVE_ADD_MANY_SUCCESS;case p.Delete:return o.SAVE_DELETE_MANY_SUCCESS;case p.Update:return o.SAVE_UPDATE_MANY_SUCCESS;case p.Upsert:return o.SAVE_UPSERT_MANY_SUCCESS}}}applyCollectionReducer(t={},n){const s=n.payload.entityName,a=t[s],h=this.entityCollectionReducerRegistry.getOrCreateReducer(s);let u;try{u=h(a||this.entityCollectionCreator.create(s),n)}catch(m){this.logger.error(m),n.payload.error=m}return n.payload.error||a===u?t:{...t,[s]:u}}clearLoadingFlags(t,n){let s=!1;return n.forEach(a=>{const h=t[a];h.loading&&(s||(t={...t},s=!0),t[a]={...h,loading:!1})}),t}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(ht),c.LFG(jt),c.LFG(ct))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})(),_e=(()=>{class r{error(t,n){t&&(n?console.error(t,n):console.error(t))}log(t,n){t&&(n?console.log(t,n):console.log(t))}warn(t,n){t&&(n?console.warn(t,n):console.warn(t))}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();const ve=["equipment","information","money","series"];let me=(()=>{class r{constructor(t){this.pluralNames={},t&&t.forEach(n=>this.registerPluralNames(n))}pluralize(t){return this.pluralNames[t]||(ve.indexOf(t.toLowerCase())>=0?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substring(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")}registerPluralNames(t){this.pluralNames={...this.pluralNames,...t||{}}}}return r.\u0275fac=function(t){return new(t||r)(c.LFG(Ot,8))},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac}),r})();const Zt=[St,_t,$,de,Ht,le,ht,zt,Wt,jt,Ct,Gt,at,mt,Kt,At,Qt,{provide:vt,useValue:dt},{provide:class ge{},useClass:Ee},{provide:ct,useClass:_e},{provide:c.Xts,multi:!0,useValue:()=>function Ce(){const r=(0,c.f3M)(D.PB),e=(0,c.f3M)(Ht),t=(0,c.f3M)(vt,{optional:!0}),n=(0,c.f3M)(he,{optional:!0}),s=(0,c.f3M)(bt,{optional:!0}),a=t||dt,h=(s||[]).map(S=>S instanceof c.OlP?(0,c.f3M)(S):S),u="function"==typeof n?n():n,m={key:a,reducers:e.create(),reducerFactory:D.UY,initialState:u||{},metaReducers:h};r.addFeature(m)}()}],Jt=[Rt,xt,It,wt,Bt,{provide:kt,useClass:re},{provide:Nt,useClass:ce},{provide:Tt,useClass:me},{provide:c.Xts,multi:!0,useValue:()=>function Me(){const r=(0,c.f3M)(b.Ll),e=(0,c.f3M)(wt),t=(0,c.f3M)(Bt);r.addEffects(e),r.addEffects(t)}()}];function Mt(r){return[{provide:bt,useValue:r.entityCacheMetaReducers?r.entityCacheMetaReducers:[]},{provide:Pt,useValue:r.entityCollectionMetaReducers?r.entityCollectionMetaReducers:[]},{provide:Ot,multi:!0,useValue:r.pluralNames?r.pluralNames:{}},{provide:Ut,multi:!0,useValue:r.entityMetadata?r.entityMetadata:[]}]}let Oe=(()=>{class r{static forRoot(t){return{ngModule:r,providers:[Mt(t)]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=c.oAB({type:r}),r.\u0275inj=c.cJS({providers:[Zt]}),r})(),Te=(()=>{class r{static forRoot(t){return{ngModule:r,providers:[Mt(t)]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=c.oAB({type:r}),r.\u0275inj=c.cJS({providers:[Jt],imports:[Oe]}),r})()},25707:(nt,J,l)=>{l.d(J,{H:()=>V});var c=l(51252),E=l(38687),g=(()=>((g=g||{})[g.EntitiesOnly=0]="EntitiesOnly",g[g.Both=1]="Both",g[g.None=2]="None",g))();function k(x){return function(N,C){const M={ids:[...C.ids],entities:{...C.entities}},Y=x(N,M);return Y===g.Both?Object.assign({},C,M):Y===g.EntitiesOnly?{...C,entities:M.entities}:C}}function R(x,O){const N=O(x);return(0,E.X6Q)()&&void 0===N&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",x,"The `selectId` implementation:",O.toString()),N}function P(x){function O(T,p){const _=R(T,x);return _ in p.entities?g.None:(p.ids.push(_),p.entities[_]=T,g.Both)}function N(T,p){let _=!1;for(const i of T)_=O(i,p)!==g.None||_;return _?g.Both:g.None}function M(T,p){const _=R(T,x);return _ in p.entities?(p.entities[_]=T,g.EntitiesOnly):(p.ids.push(_),p.entities[_]=T,g.Both)}function W(T,p){const i=(T instanceof Array?T:p.ids.filter(f=>T(p.entities[f]))).filter(f=>f in p.entities).map(f=>delete p.entities[f]).length>0;return i&&(p.ids=p.ids.filter(f=>f in p.entities)),i?g.Both:g.None}function $(T,p){return H([T],p)}function H(T,p){const _={};return(T=T.filter(f=>f.id in p.entities)).length>0?T.filter(y=>function b(T,p,_){const f=Object.assign({},_.entities[p.id],p.changes),y=R(f,x),v=y!==p.id;return v&&(T[p.id]=y,delete _.entities[p.id]),_.entities[y]=f,v}(_,y,p)).length>0?(p.ids=p.ids.map(y=>_[y]||y),g.Both):g.EntitiesOnly:g.None}function q(T,p){const _=[],i=[];for(const v of T){const w=R(v,x);w in p.entities?i.push({id:w,changes:v}):_.push(v)}const f=H(i,p),y=N(_,p);switch(!0){case y===g.None&&f===g.None:return g.None;case y===g.Both||f===g.Both:return g.Both;default:return g.EntitiesOnly}}return{removeAll:function D(T){return Object.assign({},T,{ids:[],entities:{}})},addOne:k(O),addMany:k(N),setAll:k(function C(T,p){return p.ids=[],p.entities={},N(T,p),g.Both}),setOne:k(M),setMany:k(function Y(T,p){const _=T.map(i=>M(i,p));switch(!0){case _.some(i=>i===g.Both):return g.Both;case _.some(i=>i===g.EntitiesOnly):return g.EntitiesOnly;default:return g.None}}),updateOne:k($),updateMany:k(H),upsertOne:k(function tt(T,p){return q([T],p)}),upsertMany:k(q),removeOne:k(function I(T,p){return W([T],p)}),removeMany:k(W),map:k(function j(T,p){return H(p.ids.reduce((f,y)=>{const v=T(p.entities[y]);return v!==p.entities[y]&&f.push({id:y,changes:v}),f},[]).filter(({id:f})=>f in p.entities),p)}),mapOne:k(function X({map:T,id:p},_){const i=_.entities[p];return i?$({id:p,changes:T(i)},_):g.None})}}function K(x,O){const{removeOne:N,removeMany:C,removeAll:M}=P(x);function Y(_,i){return I([_],i)}function I(_,i){const f=_.filter(y=>!(R(y,x)in i.entities));return 0===f.length?g.None:(p(f,i),g.Both)}function D(_,i){const f=R(_,x);return f in i.entities?(i.ids=i.ids.filter(y=>y!==f),p([_],i),g.Both):Y(_,i)}function $(_,i){return j([_],i)}function j(_,i){const f=[],y=_.filter(v=>function H(_,i,f){if(!(i.id in f.entities))return!1;const v=Object.assign({},f.entities[i.id],i.changes),w=R(v,x);return delete f.entities[i.id],_.push(v),w!==i.id}(f,v,i)).length>0;if(0===f.length)return g.None;{const v=i.ids,w=[];return i.ids=i.ids.filter((Z,st)=>Z in i.entities||(w.push(st),!1)),p(f,i),!y&&w.every(Z=>i.ids[Z]===v[Z])?g.EntitiesOnly:g.Both}}function T(_,i){const f=[],y=[];for(const Z of _){const st=R(Z,x);st in i.entities?y.push({id:st,changes:Z}):f.push(Z)}const v=j(y,i),w=I(f,i);switch(!0){case w===g.None&&v===g.None:return g.None;case w===g.Both||v===g.Both:return g.Both;default:return g.EntitiesOnly}}function p(_,i){_.sort(O);const f=[];let y=0,v=0;for(;y<_.length&&v<i.ids.length;){const w=_[y],Z=R(w,x),st=i.ids[v];O(w,i.entities[st])<=0?(f.push(Z),y++):(f.push(st),v++)}i.ids=f.concat(y<_.length?_.slice(y).map(x):i.ids.slice(v)),_.forEach((w,Z)=>{i.entities[x(w)]=w})}return{removeOne:N,removeMany:C,removeAll:M,addOne:k(Y),updateOne:k($),upsertOne:k(function q(_,i){return T([_],i)}),setAll:k(function W(_,i){return i.entities={},i.ids=[],I(_,i),g.Both}),setOne:k(D),setMany:k(function b(_,i){const f=_.map(y=>D(y,i));switch(!0){case f.some(y=>y===g.Both):return g.Both;case f.some(y=>y===g.EntitiesOnly):return g.EntitiesOnly;default:return g.None}}),addMany:k(I),updateMany:k(j),upsertMany:k(T),map:k(function X(_,i){return j(i.ids.reduce((y,v)=>{const w=_(i.entities[v]);return w!==i.entities[v]&&y.push({id:v,changes:w}),y},[]),i)}),mapOne:k(function tt({map:_,id:i},f){const y=f.entities[i];return y?$({id:i,changes:_(y)},f):g.None})}}function V(x={}){const{selectId:O,sortComparer:N}={selectId:x.selectId??(I=>I.id),sortComparer:x.sortComparer??!1},C=function d(){return{getInitialState:function x(O={}){return Object.assign({ids:[],entities:{}},O)}}}(),M=function B(){return{getSelectors:function x(O){const N=I=>I.ids,C=I=>I.entities,M=(0,c.P1)(N,C,(I,W)=>I.map(D=>W[D])),Y=(0,c.P1)(N,I=>I.length);return O?{selectIds:(0,c.P1)(O,N),selectEntities:(0,c.P1)(O,C),selectAll:(0,c.P1)(O,M),selectTotal:(0,c.P1)(O,Y)}:{selectIds:N,selectEntities:C,selectAll:M,selectTotal:Y}}}}();return{selectId:O,sortComparer:N,...C,...M,...N?K(O,N):P(O)}}}}]);