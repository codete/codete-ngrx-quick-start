"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[214],{38214:(q,D,f)=>{f.r(D),f.d(D,{RealtimeProcessAppComponent:()=>Y,RealtimeProcessAppModule:()=>de});var B=f(18205),W=f(42363),A=f(70426),l=f(51252);const h=(0,l.Lq)({loggedUser:""});var i=f(38687);const $=(0,l.PH)("[processes] INIT"),L=(0,l.PH)("[processes] FETCH_PROCESSES"),j=(0,l.PH)("[processes] FETCH_PROCESSES_SUCCESS",(0,l.Ky)()),p=((0,l.PH)("[processes] FETCH_PROCESSES_ERROR",(0,l.Ky)()),(0,l.PH)("[processes] REALTIME_CHANGES_SUBSCRIBE",(0,l.Ky)())),m=((0,l.PH)("[processes] REALTIME_CHANGES_NEW_DATA",(0,l.Ky)()),(0,l.PH)("[processes] START_PROCESS",(0,l.Ky)())),M=(0,l.PH)("[processes] START_PROCESS_SUCCESS"),C=(0,l.PH)("[processes] STOP_PROCESS",(0,l.Ky)()),v=(0,l.PH)("[processes] STOP_PROCESS_SUCCESS"),E=(0,l.PH)("[processes] UPDATE_PROCESS",(0,l.Ky)());var R=f(61941);const F="processes";var w=f(40409);const T=(0,f(25707).H)(),U=T.getInitialState({backgroundOperation:"nothing"}),G=(0,l.Lq)(U,(0,l.on)($,(o,y)=>T.setAll([],{...o,isLoadingProcesses:!1})),(0,l.on)(L,(o,y)=>T.setAll([],{...o,isLoadingProcesses:!0})),(0,l.on)(j,(o,{processes:y})=>T.setAll(y,{...o,isLoadingProcesses:!1})),(0,l.on)(E,(o,y)=>{const u=w.cloneDeep(y.process);let O=[];const H=o.entities[y.process.id];return"killing"===H.state&&(O=["killed","ended-with-error","ended-ok"]),"starting"===H.state&&(O=["active"]),O.length>0&&u.changes.state&&!O.includes(u.changes.state)&&(console.warn(`Changing state to ${H.state}... `),u.changes.state=H.state),T.updateOne(u,{...o})})),{selectAll:a}=T.getSelectors(),t=(0,l.ZF)(F),e=(0,l.P1)(t,a),r=(0,l.P1)(e,o=>o.map(y=>R.An.from(y)));(0,l.P1)(t,o=>"loading-processes"===o.backgroundOperation),(0,l.P1)(t,o=>"syncing-with-db"===o.backgroundOperation);var S=f(8092),b=f(55400),N=f(82041),Q=f(76707);function te(o,y){if(1&o){const u=i.EpF();i.TgZ(0,"app-process",2),i.NdJ("processAction",function(H){const x=i.CHM(u).$implicit,pe=i.oxw();return i.KtG(pe.onProcessAction(H,x))})("subscribeRealtime",function(){const P=i.CHM(u).$implicit,x=i.oxw();return i.KtG(x.onProcessRealtimeSubscribe(P))}),i._uU(1),i.qZA()}if(2&o){const u=y.$implicit;i.Q6J("process",u),i.xp6(1),i.hij(" ",u.id," ")}}let ne=(()=>{class o{constructor(u){this.store=u,this.destroy$=new b.x,this.processes$=this.store.select(r)}ngOnInit(){this.store.dispatch($())}ngOnDestroy(){this.destroy$.next(void 0),this.destroy$.unsubscribe(),S.ZH.ng.unsubscribe(this.destroy$)}onProcessRealtimeSubscribe(u){this.store.dispatch(p({process:u,destroy$:S.ZH.ng.serialize(this.destroy$)}))}onProcessAction(u,O){"start"===u&&this.store.dispatch(m({process:O})),"stop"===u&&this.store.dispatch(C({process:O}))}trackByMethod(u,O){return O.id}}return o.\u0275fac=function(u){return new(u||o)(i.Y36(l.yh))},o.\u0275cmp=i.Xpm({type:o,selectors:[["app-processes"]],decls:7,vars:4,consts:[[1,"wrapper"],[3,"process","processAction","subscribeRealtime",4,"ngFor","ngForOf","ngForTrackBy"],[3,"process","processAction","subscribeRealtime"]],template:function(u,O){1&u&&(i.TgZ(0,"mat-card")(1,"h2"),i._uU(2,"Processes"),i.qZA(),i._UZ(3,"br"),i.TgZ(4,"div",0),i.YNc(5,te,2,2,"app-process",1),i.ALo(6,"async"),i.qZA()()),2&u&&(i.xp6(5),i.Q6J("ngForOf",i.lcZ(6,2,O.processes$))("ngForTrackBy",O.trackByMethod))},dependencies:[B.sg,N.H,Q.a8,B.Ov],styles:["h2[_ngcontent-%COMP%]{color:gray;text-indent:20px}.wrapper[_ngcontent-%COMP%]{padding:10px}"]}),o})(),Y=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(u){return new(u||o)},o.\u0275cmp=i.Xpm({type:o,selectors:[["app-realtime-process-app"]],decls:1,vars:0,template:function(u,O){1&u&&i._UZ(0,"app-processes")},dependencies:[ne]}),o})(),k=(()=>{class o{constructor(u){this.ctrl=u}}return o.\u0275fac=function(u){return new(u||o)(i.LFG(R.$8))},o.\u0275prov=i.Yz7({token:o,factory:o.\u0275fac}),o})();var V=f(61831),se=f(38689),K=f(52779),_=f(97808),X=f(82045),oe=f(57267),re=f(88143),ie=f(40873),ce=f(69530);let ae=(()=>{class o{constructor(u,O,H){this.actions$=u,this.service=O,this.store=H,this.init=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)($),(0,V.w)(()=>(0,se.of)(L())))),this.fetchProcesses=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(L),(0,V.w)(()=>this.service.ctrl.getAll().received.observable.pipe((0,K.U)(P=>P.body.rawJson),(0,K.U)(P=>j({processes:P})))))),this.startProcess=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(m),(0,_.b)(P=>{this.store.dispatch(E({process:{id:P.process.id,changes:{state:"starting"}}}))}),(0,X.z)(P=>P.process.start().pipe((0,K.U)(()=>M()))))),this.stopProcess=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(C),(0,_.b)(P=>{this.store.dispatch(E({process:{id:P.process.id,changes:{state:"killing"}}}))}),(0,X.z)(P=>P.process.stop().pipe((0,K.U)(()=>v()))))),this.realtimeChanges=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(p),(0,X.z)(P=>ce.iQ.Realtime.Browser.listenChangesEntityObj(P.process).pipe((0,oe.R)(S.ZH.ng.deserialize(P.destroy$)),(0,re.b)(500),(0,ie.z)(()=>R.An.ctrl.getBy(P.process.id).received.observable.pipe((0,K.U)(x=>x.body.rawJson))),(0,K.U)(x=>E({process:{id:x.id,changes:x}}))))))}}return o.\u0275fac=function(u){return new(u||o)(i.LFG(A.eX),i.LFG(k),i.LFG(l.yh))},o.\u0275prov=i.Yz7({token:o,factory:o.\u0275fac}),o})(),ue=(()=>{class o{}return o.\u0275fac=function(u){return new(u||o)},o.\u0275mod=i.oAB({type:o}),o.\u0275inj=i.cJS({providers:[k,R.$8],imports:[B.ez,R.JT,R.qX,l.Aw.forFeature(F,G),A.sQ.forFeature([ae])]}),o})();const le=[{path:"",component:Y}];let de=(()=>{class o{}return o.\u0275fac=function(u){return new(u||o)},o.\u0275mod=i.oAB({type:o}),o.\u0275inj=i.cJS({imports:[B.ez,l.Aw.forFeature("realtime-process-app",h),A.sQ.forFeature([]),W.Bz.forChild(le),ue]}),o})()},25707:(q,D,f)=>{f.d(D,{H:()=>j});var B=f(51252),W=f(38687),n=(()=>((n=n||{})[n.EntitiesOnly=0]="EntitiesOnly",n[n.Both=1]="Both",n[n.None=2]="None",n))();function h(p){return function(m,M){const C={ids:[...M.ids],entities:{...M.entities}},v=p(m,C);return v===n.Both?Object.assign({},M,C):v===n.EntitiesOnly?{...M,entities:C.entities}:M}}function i(p,g){const m=g(p);return(0,W.X6Q)()&&void 0===m&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",p,"The `selectId` implementation:",g.toString()),m}function $(p){function g(a,s){const t=i(a,p);return t in s.entities?n.None:(s.ids.push(t),s.entities[t]=a,n.Both)}function m(a,s){let t=!1;for(const e of a)t=g(e,s)!==n.None||t;return t?n.Both:n.None}function C(a,s){const t=i(a,p);return t in s.entities?(s.entities[t]=a,n.EntitiesOnly):(s.ids.push(t),s.entities[t]=a,n.Both)}function R(a,s){const e=(a instanceof Array?a:s.ids.filter(r=>a(s.entities[r]))).filter(r=>r in s.entities).map(r=>delete s.entities[r]).length>0;return e&&(s.ids=s.ids.filter(r=>r in s.entities)),e?n.Both:n.None}function I(a,s){return T([a],s)}function T(a,s){const t={};return(a=a.filter(r=>r.id in s.entities)).length>0?a.filter(c=>function w(a,s,t){const r=Object.assign({},t.entities[s.id],s.changes),c=i(r,p),d=c!==s.id;return d&&(a[s.id]=c,delete t.entities[s.id]),t.entities[c]=r,d}(t,c,s)).length>0?(s.ids=s.ids.map(c=>t[c]||c),n.Both):n.EntitiesOnly:n.None}function Z(a,s){const t=[],e=[];for(const d of a){const S=i(d,p);S in s.entities?e.push({id:S,changes:d}):t.push(d)}const r=T(e,s),c=m(t,s);switch(!0){case c===n.None&&r===n.None:return n.None;case c===n.Both||r===n.Both:return n.Both;default:return n.EntitiesOnly}}return{removeAll:function F(a){return Object.assign({},a,{ids:[],entities:{}})},addOne:h(g),addMany:h(m),setAll:h(function M(a,s){return s.ids=[],s.entities={},m(a,s),n.Both}),setOne:h(C),setMany:h(function v(a,s){const t=a.map(e=>C(e,s));switch(!0){case t.some(e=>e===n.Both):return n.Both;case t.some(e=>e===n.EntitiesOnly):return n.EntitiesOnly;default:return n.None}}),updateOne:h(I),updateMany:h(T),upsertOne:h(function z(a,s){return Z([a],s)}),upsertMany:h(Z),removeOne:h(function E(a,s){return R([a],s)}),removeMany:h(R),map:h(function U(a,s){return T(s.ids.reduce((r,c)=>{const d=a(s.entities[c]);return d!==s.entities[c]&&r.push({id:c,changes:d}),r},[]).filter(({id:r})=>r in s.entities),s)}),mapOne:h(function G({map:a,id:s},t){const e=t.entities[s];return e?I({id:s,changes:a(e)},t):n.None})}}function L(p,g){const{removeOne:m,removeMany:M,removeAll:C}=$(p);function v(t,e){return E([t],e)}function E(t,e){const r=t.filter(c=>!(i(c,p)in e.entities));return 0===r.length?n.None:(s(r,e),n.Both)}function F(t,e){const r=i(t,p);return r in e.entities?(e.ids=e.ids.filter(c=>c!==r),s([t],e),n.Both):v(t,e)}function I(t,e){return U([t],e)}function U(t,e){const r=[],c=t.filter(d=>function T(t,e,r){if(!(e.id in r.entities))return!1;const d=Object.assign({},r.entities[e.id],e.changes),S=i(d,p);return delete r.entities[e.id],t.push(d),S!==e.id}(r,d,e)).length>0;if(0===r.length)return n.None;{const d=e.ids,S=[];return e.ids=e.ids.filter((b,N)=>b in e.entities||(S.push(N),!1)),s(r,e),!c&&S.every(b=>e.ids[b]===d[b])?n.EntitiesOnly:n.Both}}function a(t,e){const r=[],c=[];for(const b of t){const N=i(b,p);N in e.entities?c.push({id:N,changes:b}):r.push(b)}const d=U(c,e),S=E(r,e);switch(!0){case S===n.None&&d===n.None:return n.None;case S===n.Both||d===n.Both:return n.Both;default:return n.EntitiesOnly}}function s(t,e){t.sort(g);const r=[];let c=0,d=0;for(;c<t.length&&d<e.ids.length;){const S=t[c],b=i(S,p),N=e.ids[d];g(S,e.entities[N])<=0?(r.push(b),c++):(r.push(N),d++)}e.ids=r.concat(c<t.length?t.slice(c).map(p):e.ids.slice(d)),t.forEach((S,b)=>{e.entities[p(S)]=S})}return{removeOne:m,removeMany:M,removeAll:C,addOne:h(v),updateOne:h(I),upsertOne:h(function Z(t,e){return a([t],e)}),setAll:h(function R(t,e){return e.entities={},e.ids=[],E(t,e),n.Both}),setOne:h(F),setMany:h(function w(t,e){const r=t.map(c=>F(c,e));switch(!0){case r.some(c=>c===n.Both):return n.Both;case r.some(c=>c===n.EntitiesOnly):return n.EntitiesOnly;default:return n.None}}),addMany:h(E),updateMany:h(U),upsertMany:h(a),map:h(function G(t,e){return U(e.ids.reduce((c,d)=>{const S=t(e.entities[d]);return S!==e.entities[d]&&c.push({id:d,changes:S}),c},[]),e)}),mapOne:h(function z({map:t,id:e},r){const c=r.entities[e];return c?I({id:e,changes:t(c)},r):n.None})}}function j(p={}){const{selectId:g,sortComparer:m}={selectId:p.selectId??(E=>E.id),sortComparer:p.sortComparer??!1},M=function l(){return{getInitialState:function p(g={}){return Object.assign({ids:[],entities:{}},g)}}}(),C=function J(){return{getSelectors:function p(g){const m=E=>E.ids,M=E=>E.entities,C=(0,B.P1)(m,M,(E,R)=>E.map(F=>R[F])),v=(0,B.P1)(m,E=>E.length);return g?{selectIds:(0,B.P1)(g,m),selectEntities:(0,B.P1)(g,M),selectAll:(0,B.P1)(g,C),selectTotal:(0,B.P1)(g,v)}:{selectIds:m,selectEntities:M,selectAll:C,selectTotal:v}}}}();return{selectId:g,sortComparer:m,...M,...C,...m?L(g,m):$(g)}}}}]);