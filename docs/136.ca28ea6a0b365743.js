"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[136],{96136:(k,x,y)=>{y.r(x),y.d(x,{RealtimeProcessAppComponent:()=>X,RealtimeProcessAppModule:()=>ie});var c=y(42520),d=y(2613),w=y(18123),W=y(26110),G=y(66546),s=y(61038),_=y(64475),A=y(19624),H=y(43330),z=y(76629),F=y(67299),J=y(99443),u=y(50617),p=y(34299),h=y(22975),P=y(18631),m=y(11512),C=y(71616),M=y(19884);function D(o,O){if(1&o){const l=c.EpF();c.TgZ(0,"app-process",1),c.NdJ("processAction",function(b){const K=c.CHM(l).$implicit;return c.oxw().onProcessAction(b,K)})("subscribeRealtime",function(){const S=c.CHM(l).$implicit;return c.oxw().onProcessRealtimeSubscribe(S)}),c._uU(1),c.qZA()}if(2&o){const l=O.$implicit;c.Q6J("process",l),c.xp6(1),c.hij(" ",l.id," ")}}const I=(0,d.Lq)({loggedUser:""}),v=(0,d.PH)("[processes] INIT"),T=(0,d.PH)("[processes] FETCH_PROCESSES"),N=(0,d.PH)("[processes] FETCH_PROCESSES_SUCCESS",(0,d.Ky)()),L=((0,d.PH)("[processes] FETCH_PROCESSES_ERROR",(0,d.Ky)()),(0,d.PH)("[processes] REALTIME_CHANGES_SUBSCRIBE",(0,d.Ky)())),n=((0,d.PH)("[processes] REALTIME_CHANGES_NEW_DATA",(0,d.Ky)()),(0,d.PH)("[processes] START_PROCESS",(0,d.Ky)())),t=(0,d.PH)("[processes] START_PROCESS_SUCCESS"),e=(0,d.PH)("[processes] STOP_PROCESS",(0,d.Ky)()),i=(0,d.PH)("[processes] STOP_PROCESS_SUCCESS"),r=(0,d.PH)("[processes] UPDATE_PROCESS",(0,d.Ky)()),f="processes",E=(0,C.H)(),R=E.getInitialState({backgroundOperation:"nothing"}),B=(0,d.Lq)(R,(0,d.on)(v,(o,O)=>E.setAll([],Object.assign(Object.assign({},o),{isLoadingProcesses:!1}))),(0,d.on)(T,(o,O)=>E.setAll([],Object.assign(Object.assign({},o),{isLoadingProcesses:!0}))),(0,d.on)(N,(o,{processes:O})=>E.setAll(O,Object.assign(Object.assign({},o),{isLoadingProcesses:!1}))),(0,d.on)(r,(o,O)=>{const l=h.cloneDeep(O.process);let g=[];const b=o.entities[O.process.id];return"killing"===b&&(g=["killed","ended-with-error","ended-ok"]),"starting"===b&&(g=["active"]),g.length>0&&l.changes.state&&!g.includes(l.changes.state)&&(console.warn(`Changing state to ${b.state}... `),l.changes.state=b.state),E.updateOne(l,Object.assign({},o))})),{selectAll:V}=E.getSelectors(),Z=(0,d.ZF)(f),q=(0,d.P1)(Z,V),ee=(0,d.P1)(q,o=>o.map(O=>u.An.from(O)));(0,d.P1)(Z,o=>"loading-processes"===o.backgroundOperation),(0,d.P1)(Z,o=>"syncing-with-db"===o.backgroundOperation);let te=(()=>{class o{constructor(l){this.store=l,this.processes$=this.store.select(ee)}ngOnInit(){this.store.dispatch(v())}onProcessRealtimeSubscribe(l){this.store.dispatch(L({process:l}))}onProcessAction(l,g){"start"===l&&this.store.dispatch(n({process:g})),"stop"===l&&this.store.dispatch(e({process:g}))}trackByMethod(l,g){return g.id}}return o.\u0275fac=function(l){return new(l||o)(c.Y36(d.yh))},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-processes"]],decls:6,vars:4,consts:[[3,"process","processAction","subscribeRealtime",4,"ngFor","ngForOf","ngForTrackBy"],[3,"process","processAction","subscribeRealtime"]],template:function(l,g){1&l&&(c.TgZ(0,"mat-card")(1,"h2"),c._uU(2,"Processes"),c.qZA(),c._UZ(3,"br"),c.YNc(4,D,2,2,"app-process",0),c.ALo(5,"async"),c.qZA()),2&l&&(c.xp6(4),c.Q6J("ngForOf",c.lcZ(5,2,g.processes$))("ngForTrackBy",g.trackByMethod))},directives:[w.a8,u.HF,F.sg],pipes:[F.Ov],styles:[""]}),o})(),X=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-realtime-process-app"]],decls:1,vars:0,template:function(l,g){1&l&&c._UZ(0,"app-processes")},directives:[te],styles:[""]}),o})(),Y=(()=>{class o{constructor(l){this.ctrl=l}}return o.\u0275fac=function(l){return new(l||o)(c.LFG(u.$8))},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac}),o})(),ne=(()=>{class o{constructor(l,g,b){this.actions$=l,this.service=g,this.store=b,this.init=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(v),(0,W.w)(()=>(0,G.of)(T())))),this.fetchProcesses=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(T),(0,W.w)(()=>this.service.ctrl.getAll().received.observable.pipe((0,s.U)(S=>S.body.rawJson),(0,s.U)(S=>N({processes:S})))))),this.startProcess=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(n),(0,_.b)(S=>{this.store.dispatch(r({process:{id:S.process.id,changes:{state:"starting"}}}))}),(0,A.z)(S=>S.process.start().pipe((0,s.U)(()=>t()))))),this.stopProcess=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(e),(0,_.b)(S=>{this.store.dispatch(r({process:{id:S.process.id,changes:{state:"killing"}}}))}),(0,A.z)(S=>S.process.stop().pipe((0,s.U)(()=>i()))))),this.realtimeChanges=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(L),(0,A.z)(S=>M.iQ.Realtime.Browser.listenChangesEntityObj(S.process).pipe((0,H.b)(500),(0,z.z)(()=>u.An.ctrl.getBy(S.process.id).received.observable.pipe((0,s.U)(K=>K.body.rawJson))),(0,s.U)(K=>r({process:{id:K.id,changes:K}}))))))}}return o.\u0275fac=function(l){return new(l||o)(c.LFG(p.eX),c.LFG(Y),c.LFG(d.yh))},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac}),o})(),se=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[Y,u.$8],imports:[[F.ez,u.JT,u.qX,d.Aw.forFeature(f,B),p.sQ.forFeature([ne])]]}),o})();const oe=[{path:"",component:X}];let ie=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[[F.ez,d.Aw.forRoot(I,{}),p.sQ.forRoot([]),P.Qi.forRoot(),m.FT.instrument({maxAge:25}),J.Bz.forChild(oe),se]]}),o})()},71616:(k,x,y)=>{y.d(x,{H:()=>F});var c=y(2613),d=y(42520),s=(()=>{return(u=s||(s={}))[u.EntitiesOnly=0]="EntitiesOnly",u[u.Both=1]="Both",u[u.None=2]="None",s;var u})();function _(u){return function(h,P){const m={ids:[...P.ids],entities:Object.assign({},P.entities)},C=u(h,m);return C===s.Both?Object.assign({},P,m):C===s.EntitiesOnly?Object.assign(Object.assign({},P),{entities:m.entities}):P}}function A(u,p){const h=p(u);return(0,d.X6Q)()&&void 0===h&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",u,"The `selectId` implementation:",p.toString()),h}function H(u){function p(a,n){const t=A(a,u);return t in n.entities?s.None:(n.ids.push(t),n.entities[t]=a,s.Both)}function h(a,n){let t=!1;for(const e of a)t=p(e,n)!==s.None||t;return t?s.Both:s.None}function m(a,n){const t=A(a,u);return t in n.entities?(n.entities[t]=a,s.EntitiesOnly):(n.ids.push(t),n.entities[t]=a,s.Both)}function D(a,n){const e=(a instanceof Array?a:n.ids.filter(i=>a(n.entities[i]))).filter(i=>i in n.entities).map(i=>delete n.entities[i]).length>0;return e&&(n.ids=n.ids.filter(i=>i in n.entities)),e?s.Both:s.None}function I(a,n){return v([a],n)}function v(a,n){const t={};return(a=a.filter(i=>i.id in n.entities)).length>0?a.filter(r=>function j(a,n,t){const i=Object.assign({},t.entities[n.id],n.changes),r=A(i,u),f=r!==n.id;return f&&(a[n.id]=r,delete t.entities[n.id]),t.entities[r]=i,f}(t,r,n)).length>0?(n.ids=n.ids.map(r=>t[r]||r),s.Both):s.EntitiesOnly:s.None}function L(a,n){const t=[],e=[];for(const f of a){const E=A(f,u);E in n.entities?e.push({id:E,changes:f}):t.push(f)}const i=v(e,n),r=h(t,n);switch(!0){case r===s.None&&i===s.None:return s.None;case r===s.Both||i===s.Both:return s.Both;default:return s.EntitiesOnly}}return{removeAll:function U(a){return Object.assign({},a,{ids:[],entities:{}})},addOne:_(p),addMany:_(h),setAll:_(function P(a,n){return n.ids=[],n.entities={},h(a,n),s.Both}),setOne:_(m),setMany:_(function C(a,n){const t=a.map(e=>m(e,n));switch(!0){case t.some(e=>e===s.Both):return s.Both;case t.some(e=>e===s.EntitiesOnly):return s.EntitiesOnly;default:return s.None}}),updateOne:_(I),updateMany:_(v),upsertOne:_(function $(a,n){return L([a],n)}),upsertMany:_(L),removeOne:_(function M(a,n){return D([a],n)}),removeMany:_(D),map:_(function T(a,n){return v(n.ids.reduce((i,r)=>{const f=a(n.entities[r]);return f!==n.entities[r]&&i.push({id:r,changes:f}),i},[]).filter(({id:i})=>i in n.entities),n)}),mapOne:_(function N({map:a,id:n},t){const e=t.entities[n];return e?I({id:n,changes:a(e)},t):s.None})}}function F(u={}){const{selectId:p,sortComparer:h}=Object.assign({sortComparer:!1,selectId:M=>M.id},u),P=function W(){return{getInitialState:function u(p={}){return Object.assign({ids:[],entities:{}},p)}}}(),m=function G(){return{getSelectors:function u(p){const h=M=>M.ids,P=M=>M.entities,m=(0,c.P1)(h,P,(M,D)=>M.map(U=>D[U])),C=(0,c.P1)(h,M=>M.length);return p?{selectIds:(0,c.P1)(p,h),selectEntities:(0,c.P1)(p,P),selectAll:(0,c.P1)(p,m),selectTotal:(0,c.P1)(p,C)}:{selectIds:h,selectEntities:P,selectAll:m,selectTotal:C}}}}(),C=h?function z(u,p){const{removeOne:h,removeMany:P,removeAll:m}=H(u);function C(t,e){return M([t],e)}function M(t,e){const i=t.filter(r=>!(A(r,u)in e.entities));return 0===i.length?s.None:(n(i,e),s.Both)}function U(t,e){const i=A(t,u);return i in e.entities?(e.ids=e.ids.filter(r=>r!==i),n([t],e),s.Both):C(t,e)}function I(t,e){return T([t],e)}function T(t,e){const i=[],r=t.filter(f=>function v(t,e,i){if(!(e.id in i.entities))return!1;const f=Object.assign({},i.entities[e.id],e.changes),E=A(f,u);return delete i.entities[e.id],t.push(f),E!==e.id}(i,f,e)).length>0;if(0===i.length)return s.None;{const f=e.ids,E=[];return e.ids=e.ids.filter((R,B)=>R in e.entities||(E.push(B),!1)),n(i,e),!r&&E.every(R=>e.ids[R]===f[R])?s.EntitiesOnly:s.Both}}function a(t,e){const i=[],r=[];for(const R of t){const B=A(R,u);B in e.entities?r.push({id:B,changes:R}):i.push(R)}const f=T(r,e),E=M(i,e);switch(!0){case E===s.None&&f===s.None:return s.None;case E===s.Both||f===s.Both:return s.Both;default:return s.EntitiesOnly}}function n(t,e){t.sort(p);const i=[];let r=0,f=0;for(;r<t.length&&f<e.ids.length;){const E=t[r],R=A(E,u),B=e.ids[f];p(E,e.entities[B])<=0?(i.push(R),r++):(i.push(B),f++)}e.ids=i.concat(r<t.length?t.slice(r).map(u):e.ids.slice(f)),t.forEach((E,R)=>{e.entities[u(E)]=E})}return{removeOne:h,removeMany:P,removeAll:m,addOne:_(C),updateOne:_(I),upsertOne:_(function L(t,e){return a([t],e)}),setAll:_(function D(t,e){return e.entities={},e.ids=[],M(t,e),s.Both}),setOne:_(U),setMany:_(function j(t,e){const i=t.map(r=>U(r,e));switch(!0){case i.some(r=>r===s.Both):return s.Both;case i.some(r=>r===s.EntitiesOnly):return s.EntitiesOnly;default:return s.None}}),addMany:_(M),updateMany:_(T),upsertMany:_(a),map:_(function N(t,e){return T(e.ids.reduce((r,f)=>{const E=t(e.entities[f]);return E!==e.entities[f]&&r.push({id:f,changes:E}),r},[]),e)}),mapOne:_(function $({map:t,id:e},i){const r=i.entities[e];return r?I({id:e,changes:t(r)},i):s.None})}}(p,h):H(p);return Object.assign(Object.assign(Object.assign({selectId:p,sortComparer:h},P),m),C)}}}]);