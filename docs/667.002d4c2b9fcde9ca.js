"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[667],{45667:(at,H,u)=>{u.r(H),u.d(H,{SubtasksComponent:()=>Y.b,TasksAppComponent:()=>L,TasksAppModule1:()=>R,TasksContainer:()=>Q.W,TasksEngineComponent:()=>p.A,TasksEngineModule:()=>g.c,TasksEngineService:()=>w.u});var d=u(60105),p=u(77444);let L=(()=>{class F{constructor(){}ngOnInit(){}}return F.\u0275fac=function(T){return new(T||F)},F.\u0275cmp=d.Xpm({type:F,selectors:[["app-tasks-app"]],decls:1,vars:0,template:function(T,j){1&T&&d._UZ(0,"app-tasks-engine")},directives:[p.A],styles:[""]}),F})();var h=u(41380),$=u(26983),g=u(9450);const b=[{path:"",component:L}];let R=(()=>{class F{}return F.\u0275fac=function(T){return new(T||F)},F.\u0275mod=d.oAB({type:F}),F.\u0275inj=d.cJS({imports:[[h.ez,$.Bz.forChild(b),g.c.forRoot()]]}),F})();var w=u(97140),Y=u(82932),Q=u(31267)},82932:(at,H,u)=>{u.d(H,{b:()=>I});var d=u(58485),p=u(60105),h=(u(23554),u(12777)),$=u(23355),g=u(97140),b=u(55605),R=u(52649),w=u(41380),Y=u(98582),Q=u(65941),F=u(52988),M=u(60465),T=u(16612);function j(x,K){1&x&&p._UZ(0,"mat-progress-bar",4)}function O(x,K){if(1&x){const D=p.EpF();p.TgZ(0,"app-task",8),p.NdJ("remove",function(){const Z=p.CHM(D).$implicit;return p.oxw(2).onRemove(Z)})("isDone",function(V){const q=p.CHM(D).$implicit;return p.oxw(2).onSave(V,q)})("saveName",function(V){const q=p.CHM(D).$implicit;return p.oxw(2).onSaveName(V,q)}),p.qZA()}2&x&&p.Q6J("task",K.$implicit)("isSubtask",!0)("editable",!0)}function m(x,K){if(1&x){const D=p.EpF();p.YNc(0,O,1,3,"app-task",5),p.ALo(1,"async"),p.TgZ(2,"mat-form-field",6)(3,"input",7),p.NdJ("ngModelChange",function(V){return p.CHM(D),p.oxw().tempSubtask=V})("keypress",function(V){return p.CHM(D),p.oxw().onNewSubtask(V)},!1,p.Jf7),p.ALo(4,"async"),p.qZA()(),p._UZ(5,"br")}if(2&x){const D=p.oxw();p.Q6J("ngForOf",p.lcZ(1,3,D.subtasks$)),p.xp6(3),p.Q6J("disabled",p.lcZ(4,5,D.isAddingSubtask$))("ngModel",D.tempSubtask)}}let I=(()=>{class x{constructor(D){this.engine=D,this.close=new p.vpe,this.removeTask=new p.vpe,this.removeSubtask=new p.vpe,this.newSubtask=new p.vpe,this.tasksLoaded=!1,this.isLoadingSubtasks$=this.engine.isProcessingSubtaskRequestSelector,this.isAddingSubtask$=this.engine.isProcessingSubtaskRequestSelector,this.subtasks$=this.engine.allSubtasks(this).pipe((0,h.U)(N=>this.taskId?N.filter(V=>V.taskId===this.taskId):[]),(0,$.b)(()=>{this.tasksLoaded=!0}))}ngOnChanges(D){this.taskId&&(this.tasksLoaded=!1,this.engine.fetchSubtaskAction(this.taskId))}onSaveName(D,N){this.engine.onSaveSubTaskAction({name:D},N)}onNewSubtask(D){this.engine.addSubTaskAction(D,this)}onRemove(D){var N=this;return(0,d.Z)(function*(){N.engine.removeSubTaskAction(D)})()}onSave(D,N){this.engine.onSaveSubTaskAction({isDone:D},N)}ngOnInit(){}}return x.\u0275fac=function(D){return new(D||x)(p.Y36(g.u))},x.\u0275cmp=p.Xpm({type:x,selectors:[["app-subtasks"]],inputs:{taskId:"taskId"},outputs:{close:"close",removeTask:"removeTask",removeSubtask:"removeSubtask",newSubtask:"newSubtask"},features:[p.TTD],decls:11,vars:4,consts:[["mat-icon-button","",3,"click"],["mat-icon-button","",1,"delete",3,"click"],["mode","indeterminate",4,"ngIf","ngIfElse"],["tasksList",""],["mode","indeterminate"],[3,"task","isSubtask","editable","remove","isDone","saveName",4,"ngFor","ngForOf"],[1,"new-subtask-input"],["matInput","","placeholder","+ Add new subtask..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isSubtask","editable","remove","isDone","saveName"]],template:function(D,N){if(1&D&&(p.TgZ(0,"button",0),p.NdJ("click",function(){return N.close.emit()}),p.TgZ(1,"mat-icon"),p._uU(2,"close"),p.qZA()(),p.TgZ(3,"button",1),p.NdJ("click",function(){return N.removeTask.emit(N.taskId)}),p.TgZ(4,"mat-icon"),p._uU(5," delete_forever "),p.qZA()(),p._UZ(6,"br"),p.YNc(7,j,1,0,"mat-progress-bar",2),p.ALo(8,"async"),p.YNc(9,m,6,7,"ng-template",null,3,p.W1O)),2&D){const V=p.MAs(10);p.xp6(7),p.Q6J("ngIf",!N.tasksLoaded&&p.lcZ(8,2,N.isLoadingSubtasks$))("ngIfElse",V)}},directives:[b.lW,R.Hw,w.O5,Y.pW,w.sg,Q.m,F.KE,M.Nt,T.Fj,T.JJ,T.On],pipes:[w.Ov],styles:["[_nghost-%COMP%]{width:400px;display:block;padding:5px}.new-subtask-input[_ngcontent-%COMP%]{width:100%}.delete[_ngcontent-%COMP%]{float:right}"]}),x})()},31267:(at,H,u)=>{u.d(H,{W:()=>k});var d=u(58485),p=u(23554),L=u(97140),h=u(60105),$=u(46251),g=u(1036),b=u(41380),R=u(82932),w=u(94235),Y=u(16246),Q=u(55605),F=u(52649),M=u(23822);function T(E,S){1&E&&(h.TgZ(0,"button",3)(1,"mat-icon"),h._uU(2,"sync"),h.qZA()())}function j(E,S){1&E&&(h.TgZ(0,"button",4)(1,"mat-icon"),h._uU(2,"sync_problem"),h.qZA()())}function O(E,S){1&E&&(h.TgZ(0,"button",4),h._UZ(1,"mat-spinner",5),h.qZA()),2&E&&(h.xp6(1),h.Q6J("diameter",20))}function m(E,S){1&E&&(h.TgZ(0,"button",4)(1,"mat-icon"),h._uU(2,"done"),h.qZA()())}function I(E,S){if(1&E&&(h.ynx(0),h.YNc(1,T,3,0,"button",1),h.YNc(2,j,3,0,"button",2),h.YNc(3,O,2,1,"button",2),h.YNc(4,m,3,0,"button",2),h.BQk()),2&E){const o=S.ngIf;h.xp6(1),h.Q6J("ngIf","idle"===o),h.xp6(1),h.Q6J("ngIf","sync-problem"===o),h.xp6(1),h.Q6J("ngIf","syncing"===o),h.xp6(1),h.Q6J("ngIf","syncing-done"===o)}}let x=(()=>{class E{constructor(o){this.engine=o,this.state$=this.engine.synchonizationSateSelector()}}return E.\u0275fac=function(o){return new(o||E)(h.Y36(L.u))},E.\u0275cmp=h.Xpm({type:E,selectors:[["app-synchonization"]],decls:2,vars:3,consts:[[4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer",4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer-blocked",4,"ngIf"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer-blocked"],[3,"diameter"]],template:function(o,i){1&o&&(h.YNc(0,I,5,4,"ng-container",0),h.ALo(1,"async")),2&o&&h.Q6J("ngIf",h.lcZ(1,1,i.state$))},directives:[b.O5,Q.lW,F.Hw,M.Ou],pipes:[b.Ov],styles:["[_nghost-%COMP%]{position:absolute;right:20px}.pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:pointer}.pointer-blocked[_ngcontent-%COMP%]{pointer-events:none;cursor:not-allowed}.pointer-blocked[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:not-allowed}.sync-button[_ngcontent-%COMP%]{z-index:999;float:right;opacity:.7}.sync-button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{left:10px}.sync-button[_ngcontent-%COMP%]:hover{opacity:1}  .mat-progress-spinner circle, .mat-spinner[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke:gray}"]}),E})();var K=u(52988),D=u(60465),N=u(16612),V=u(65941);const Z=["drawer"];function q(E,S){if(1&E){const o=h.EpF();h.TgZ(0,"app-subtasks",9),h.NdJ("close",function(){return h.CHM(o),h.oxw().onCloseSubtaskMenu()})("removeTask",function(f){return h.CHM(o),h.oxw().onRemoveTask(f)}),h.qZA()}if(2&E){const o=h.oxw();h.Q6J("taskId",o.toogled.id)}}function et(E,S){if(1&E){const o=h.EpF();h.TgZ(0,"app-task",10),h.NdJ("isDone",function(f){const P=h.CHM(o).$implicit;return h.oxw().onSave(f,P)})("click",function(f){const P=h.CHM(o).$implicit;return h.oxw().toogle(f,P)})("focused",function(f){const P=h.CHM(o).$implicit;return h.oxw().focus(f,P)})("saveName",function(f){const P=h.CHM(o).$implicit;return h.oxw().onSaveName(f,P)}),h.qZA()}2&E&&h.Q6J("task",S.$implicit)}let k=(()=>{class E{constructor(o,i){this.engine=o,this.breakpointObserver=i,this.tasks$=this.engine.allTasksSelector(),this.title$=this.engine.title(),this.isAddingTasks$=this.engine.isProcessingTaskRequestSelector,this.focusFired=0}ngOnInit(){var o=this;return(0,d.Z)(function*(){o.engine.initAction()})()}onRemoveTask(o){var i;null===(i=this.drawer)||void 0===i||i.close(),this.engine.removeTaskAction(o)}onRemoveSubTask(o){this.engine.removeSubTaskAction(o)}onCloseSubtaskMenu(){var o;null===(o=this.drawer)||void 0===o||o.close()}ngAfterViewInit(){}add(o){this.engine.addTaskAction(o,this)}onSave(o,i){this.engine.onSaveTaskAction({isDone:o},i)}onSaveName(o,i){this.engine.onSaveTaskAction({name:o},i)}focus(){this.focusFired=2}toogle(o,i){setTimeout(()=>{this.focusFired>0?(this.focusFired--,o.stopImmediatePropagation(),o.stopPropagation(),0===this.focusFired&&this.tasks.find(A=>A.task.id===i.id).focusTriggered.next()):this.engine.toogleSubtasksAction(o,i,this)},200)}}return E.\u0275fac=function(o){return new(o||E)(h.Y36(L.u),h.Y36($.Yg))},E.\u0275cmp=h.Xpm({type:E,selectors:[["app-tasks"]],viewQuery:function(o,i){if(1&o&&(h.Gf(Z,5),h.Gf(p.mk,5)),2&o){let f;h.iGM(f=h.CRH())&&(i.drawer=f.first),h.iGM(f=h.CRH())&&(i.tasks=f)}},decls:18,vars:14,consts:[[1,"container",3,"hasBackdrop"],["position","end",3,"mode"],["drawer",""],[3,"taskId","close","removeTask",4,"ngIf"],["grow","",1,"title"],[1,"background",3,"width"],[1,"new-task-input"],["matInput","","autocomplete","off","placeholder","+ Add new task..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isDone","click","focused","saveName",4,"ngFor","ngForOf"],[3,"taskId","close","removeTask"],[3,"task","isDone","click","focused","saveName"]],template:function(o,i){1&o&&(h.TgZ(0,"mat-drawer-container",0)(1,"mat-drawer",1,2),h.YNc(3,q,1,1,"app-subtasks",3),h.qZA(),h.TgZ(4,"mat-drawer-content")(5,"mat-card")(6,"columns-container")(7,"column",4),h._uU(8),h.ALo(9,"async"),h.qZA(),h.TgZ(10,"column",5),h._UZ(11,"app-synchonization"),h.qZA()(),h.TgZ(12,"mat-form-field",6)(13,"input",7),h.NdJ("ngModelChange",function(A){return i.newTaskModel=A})("keypress",function(A){return i.add(A)},!1,h.Jf7),h.ALo(14,"async"),h.qZA()(),h._UZ(15,"br"),h.YNc(16,et,1,1,"app-task",8),h.ALo(17,"async"),h.qZA()()()),2&o&&(h.Q6J("hasBackdrop",!1),h.xp6(1),h.Q6J("mode","side"),h.xp6(2),h.Q6J("ngIf",i.toogled),h.xp6(5),h.hij(" ",h.lcZ(9,8,i.title$)," "),h.xp6(2),h.Q6J("width",60),h.xp6(3),h.Q6J("disabled",h.lcZ(14,10,i.isAddingTasks$))("ngModel",i.newTaskModel),h.xp6(3),h.Q6J("ngForOf",h.lcZ(17,12,i.tasks$)))},directives:[g.kh,g.jA,b.O5,R.b,g.LW,w.a8,Y.a_,Y.bg,Y.iB,x,K.KE,D.Nt,N.Fj,N.JJ,N.On,b.sg,V.m],pipes:[b.Ov],styles:["[_nghost-%COMP%]{--max-container-size: 1200px;white-space:nowrap}.container[_ngcontent-%COMP%]{height:100%}.new-task-input[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{text-align:center;margin:0}.title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.background[_ngcontent-%COMP%]{background-color:#fff}"]}),E})()},77444:(at,H,u)=>{u.d(H,{A:()=>R});var d=u(83070),p=u(85089),L=u(12038),h=u(97140),$=u(60105),g=u(22051),b=u(31267);let R=(()=>{class w{constructor(Q,F,M){this.engine=Q,this.store=F,this.actionListener$=M,this.$destroy=new d.x}ngOnDestroy(){this.$destroy.next(void 0),this.$destroy.unsubscribe()}ngOnInit(){this.message=this.engine.helloWorld(),this.activeteSynchonization()}activeteSynchonization(){this.actionListener$.pipe((0,p.T)(1),(0,L.R)(this.$destroy)).subscribe(Q=>{})}}return w.\u0275fac=function(Q){return new(Q||w)($.Y36(h.u),$.Y36(g.yh),$.Y36(g.UO))},w.\u0275cmp=$.Xpm({type:w,selectors:[["app-tasks-engine"]],decls:1,vars:0,template:function(Q,F){1&Q&&$._UZ(0,"app-tasks")},directives:[b.W],styles:[""]}),w})()},9450:(at,H,u)=>{u.d(H,{c:()=>o});var d=u(41380),p=u(97140),L=u(89670),h=u(71036),$=u(16612),g=u(23554),b=u(54227),R=u(60105);let w=(()=>{class i{}return i.\u0275fac=function(A){return new(A||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[d.ez,g.qX,g.hd,$.u5]]}),i})();var Y=u(22051),Q=u(27565),F=u(87036),M=u(89886);const T={Task:{},SubTask:{}},j={entityHttpResourceUrls:{Task:g.iQ.URLS,SubTask:g.Mp.URLS},timeout:3e3};let O=(()=>{class i{}return i.\u0275fac=function(A){return new(A||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({providers:[{provide:M.jh,useValue:j}],imports:[[M.ov.forRoot({entityMetadata:T})]]}),i})();const m=(0,Y.PH)("[tasks] sync"),I=(0,Y.PH)("[tasks] sync idle"),x=(0,Y.PH)("[tasks] sync success",(0,Y.Ky)()),K=(0,Y.PH)("[tasks] sync problem"),V=(0,Y.Lq)({syncState:"idle"},(0,Y.on)(m,i=>Object.assign(Object.assign({},i),{syncState:"syncing"})),(0,Y.on)(I,i=>Object.assign(Object.assign({},i),{syncState:"idle"})),(0,Y.on)(x,i=>Object.assign(Object.assign({},i),{syncState:"syncing-done"})),(0,Y.on)(K,i=>Object.assign(Object.assign({},i),{syncState:"sync-problem"})));var q=u(12777);let et=(()=>{class i{constructor(A,P){this.actions$=A,this.engine=P,this.syncingDone=(0,Q.GW)(()=>this.actions$.pipe((0,Q.l4)(x),(0,q.U)(()=>I())))}}return i.\u0275fac=function(A){return new(A||i)(R.LFG(Q.eX),R.LFG(p.u))},i.\u0275prov=R.Yz7({token:i,factory:i.\u0275fac}),i})();const it=[function Z(i){return function(f,A){return i(f,A)}}];let st=(()=>{class i{}return i.\u0275fac=function(A){return new(A||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[Y.Aw.forRoot({},{metaReducers:it}),Q.sQ.forRoot([et]),Y.Aw.forFeature("appConfig",V),F.FT.instrument(),O]]}),i})(),k=(()=>{class i{}return i.\u0275fac=function(A){return new(A||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[d.ez,g.qX]]}),i})();var E=u(16246);let S=(()=>{class i{}return i.\u0275fac=function(A){return new(A||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({imports:[[d.ez,$.u5,g.qX,E.m0,w,g.hd,b.JF,st,k]]}),i})(),o=(()=>{class i{static forRoot(A){return{ngModule:i,providers:[{provide:p.u,useClass:A&&A.customEngineService||p.u}]}}}return i.\u0275fac=function(A){return new(A||i)},i.\u0275mod=R.oAB({type:i}),i.\u0275inj=R.cJS({providers:[L.x,h.C,p.u],imports:[[d.ez,S]]}),i})()},97140:(at,H,u)=>{u.d(H,{u:()=>M});var d=u(58485),p=u(95991),L=u(18801),$=u(23554),g=u(4393),b=u(53030),R=u(12777),w=u(10925),Y=u(89670),Q=u(71036),F=u(60105);let M=(()=>{class T{constructor(O,m){this.subtasksService=O,this.tasksService=m}helloWorld(){return"Hello from ngrx/data application"}title(){return(0,g.of)('TASKS ("ngrx/data" application)')}allTasksSelector(){return this.tasksService.entities$}get isProcessingSubtaskRequestSelector(){return this.subtasksService.loading$}get isProcessingTaskRequestSelector(){return this.tasksService.loading$}allSubtasks(O){return this.subtasksService.entities$}synchonizationSateSelector(){return this.tasksService.loading$.pipe((0,b.M)(this.subtasksService.loading$),(0,R.U)(([O,m])=>O||m?"syncing":"idle"))}initAction(){var O=this;return(0,d.Z)(function*(){if(p.ZH.isWebSQL){const m=yield $.iQ.ctrl.getAll().received;O.tasksService.clearCache(),O.tasksService.addManyToCache(m.body.json)}else O.tasksService.getAll()})()}fetchSubtaskAction(O){var m=this;return(0,d.Z)(function*(){if(p.ZH.isWebSQL){const I=yield $.Mp.ctrl.getAll(O).received;m.subtasksService.clearCache(),m.subtasksService.addManyToCache(I.body.json)}else m.subtasksService.getWithQuery({taskId:null==O?void 0:O.toString()})})()}addTaskAction(O,m){var I=this;return(0,d.Z)(function*(){"Enter"===O.code&&m.newTaskModel&&(yield(0,w.z)(I.tasksService.add($.iQ.from({name:m.newTaskModel}))),m.newTaskModel="")})()}addSubTaskAction(O,m){if(O.stopImmediatePropagation(),O.stopPropagation(),"Enter"===O.code&&m.tempSubtask){const I=$.Mp.from({name:m.tempSubtask,taskId:m.taskId}),x=L.cloneDeep(I);this.subtasksService.add(x),m.tempSubtask=""}}removeTaskAction(O){this.tasksService.delete({id:O})}removeSubTaskAction(O){this.subtasksService.delete(L.cloneDeep(O))}onSaveTaskAction(O,m){m=L.cloneDeep(m),L.merge(m,O),this.tasksService.update(m)}onSaveSubTaskAction(O,m){m=L.cloneDeep(m),L.merge(m,O),this.subtasksService.update(m)}toogleSubtasksAction(O,m,I){var x=this;I.toogled=m,setTimeout((0,d.Z)(function*(){var K,D;(m=L.cloneDeep(m)).selected=!m.selected,x.tasksService.updateManyInCache((yield(0,w.z)(x.tasksService.entities$)).map(N=>((N=L.cloneDeep(N)).selected=!1,N))),m.selected?(x.tasksService.updateOneInCache(m),null===(K=I.drawer)||void 0===K||K.open()):null===(D=I.drawer)||void 0===D||D.close(),O.stopPropagation()}))}}return T.\u0275fac=function(O){return new(O||T)(F.LFG(Y.x),F.LFG(Q.C))},T.\u0275prov=F.Yz7({token:T,factory:T.\u0275fac}),T})()},89670:(at,H,u)=>{u.d(H,{x:()=>$});var d=u(23554),p=u(89886),L=u(28125),h=u(60105);let $=(()=>{class g extends p.c8{constructor(R){super(L._i.getName(d.Mp),R)}}return g.\u0275fac=function(R){return new(R||g)(h.LFG(p.yV))},g.\u0275prov=h.Yz7({token:g,factory:g.\u0275fac}),g})()},71036:(at,H,u)=>{u.d(H,{C:()=>$});var d=u(89886),p=u(28125),L=u(23554),h=u(60105);let $=(()=>{class g extends d.c8{constructor(R){super(p._i.getName(L.iQ),R)}}return g.\u0275fac=function(R){return new(R||g)(h.LFG(d.yV))},g.\u0275prov=h.Yz7({token:g,factory:g.\u0275fac}),g})()},89886:(at,H,u)=>{u.d(H,{jh:()=>vt,c8:()=>Qt,yV:()=>kt,ov:()=>Ue});var d=u(60105),p=u(98832),L=u(12777),h=u(40964),$=u(35928),g=u(39693),b=u(78885),R=u(23403),w=u(6568);function Y(n,e){return e?t=>(0,$.z)(e.pipe((0,g.q)(1),(0,b.l)()),t.pipe(Y(n))):(0,w.z)((t,s)=>n(t,s).pipe((0,g.q)(1),(0,R.h)(t)))}var Q=u(3795);function F(n,e=h.z){const t=(0,Q.H)(n,e);return Y(()=>t)}var M=u(3747),T=u(12866),j=u(31487),O=u(64839);function m(n,e,t){let s,r=!1;return n&&"object"==typeof n?({bufferSize:s=1/0,windowTime:e=1/0,refCount:r=!1,scheduler:t}=n):s=null!=n?n:1/0,(0,O.B)({connector:()=>new j.t(s,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}var I=u(53030),x=u(85781),K=u(54227),D=u(40553),N=u(4393),V=u(89047),Z=u(34707);const{isArray:q}=Array;var it=u(68991);function st(...n){return 1===(n=function et(n){return 1===n.length&&q(n[0])?n[0]:n}(n)).length?(0,Z.Xf)(n[0]):new V.y(function k(n){return e=>{let t=[];for(let s=0;t&&!e.closed&&s<n.length;s++)t.push((0,Z.Xf)(n[s]).subscribe((0,it.x)(e,r=>{if(t){for(let a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(r)})))}}(n))}var E=u(15249),S=u(12834),o=u(22051),i=u(27565);let f=(()=>{class n{create(t,s,r,a){const c="string"==typeof t?Object.assign(Object.assign({},a||{}),{entityName:t,entityOp:s,data:r}):t;return this.createCore(c)}createCore(t){const{entityName:s,entityOp:r,tag:a}=t;if(!s)throw new Error("Missing entity name for new action");if(null==r)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(r,a||s),payload:t}}createFromAction(t,s){return this.create(Object.assign(Object.assign({},t.payload),s))}formatActionType(t,s){return`[${s}] ${t}`}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();class A{constructor(e,t){this.entityName=e,this.selectId=t}mustBeEntity(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should have a single entity.");const s=this.selectId(t);return this.isNotKeyType(s)&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeEntities(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const a=this.selectId(s);this.isNotKeyType(a)&&this.throwError(e,`, item ${r+1}, does not have a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entities")}mustBeKey(e){const t=this.extractData(e);if(!t)throw new Error("should be a single entity key");if(this.isNotKeyType(t))throw new Error("is not a valid key (id)");return t}mustBeKeys(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{this.isNotKeyType(s)&&this.throwError(e,`${this.entityName} ', item ${r+1}, is not a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entity keys (id)")}mustBeUpdate(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdates(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:c}=s,l=this.selectId(c);(this.isNotKeyType(a)||this.isNotKeyType(l))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}mustBeUpdateResponse(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdateResponses(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:c}=s,l=this.selectId(c);(this.isNotKeyType(a)||this.isNotKeyType(l))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}extractData(e){return e.payload&&e.payload.data}isNotKeyType(e){return"string"!=typeof e&&"number"!=typeof e}throwError(e,t){throw new Error(`${this.entityName} EntityAction guard for "${e.type}": payload ${t}`)}}function P(n){return null==n?void 0:n.id}function X(n){if(null==n)return[];if(Array.isArray(n[0])){const[e,...t]=n;n=[...e,...t]}return n}function nt(n){return n=n||P,function(t){const s=n(t);if(null==s)throw new Error("Primary key may not be null/undefined.");return t&&{id:s,changes:t}}}function ht(...n){const e=X(n);switch(e.length){case 0:return(0,p.h)(s=>s.payload&&null!=s.payload.entityOp);case 1:const t=e[0];return(0,p.h)(s=>s.payload&&t===s.payload.entityOp);default:return(0,p.h)(s=>{const r=s.payload&&s.payload.entityOp;return r&&e.some(a=>a===r)})}}function Rt(...n){const e=X(n);switch(e.length){case 0:return(0,p.h)(s=>s.payload&&null!=s.payload.entityName);case 1:const t=e[0];return(0,p.h)(s=>s.payload&&t===s.payload.entityName);default:return(0,p.h)(s=>{const r=s.payload&&s.payload.entityName;return!!r&&e.some(a=>a===r)})}}var tt=(()=>{return(n=tt||(tt={})).Add="Add",n.Delete="Delete",n.Update="Update",n.Upsert="Upsert",tt;var n})();function Ut(n){const e=(n=n&&n.changes?n:{changes:[]}).changes.filter(t=>null!=t&&t.entities&&t.entities.length>0);return Object.assign(Object.assign({},n),{changes:e})}new class te{add(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:tt.Add,entities:t}}delete(e,t){const s=Array.isArray(t)?t:t?[t]:[];return{entityName:e,op:tt.Delete,entities:s}}update(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:tt.Update,entities:t}}upsert(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:tt.Upsert,entities:t}}};var W=(()=>{return(n=W||(W={}))[n.IgnoreChanges=0]="IgnoreChanges",n[n.PreserveChanges=1]="PreserveChanges",n[n.OverwriteChanges=2]="OverwriteChanges",W;var n})(),B=(()=>{return(n=B||(B={})).CLEAR_COLLECTIONS="@ngrx/data/entity-cache/clear-collections",n.LOAD_COLLECTIONS="@ngrx/data/entity-cache/load-collections",n.MERGE_QUERY_SET="@ngrx/data/entity-cache/merge-query-set",n.SET_ENTITY_CACHE="@ngrx/data/entity-cache/set-cache",n.SAVE_ENTITIES="@ngrx/data/entity-cache/save-entities",n.SAVE_ENTITIES_CANCEL="@ngrx/data/entity-cache/save-entities-cancel",n.SAVE_ENTITIES_CANCELED="@ngrx/data/entity-cache/save-entities-canceled",n.SAVE_ENTITIES_ERROR="@ngrx/data/entity-cache/save-entities-error",n.SAVE_ENTITIES_SUCCESS="@ngrx/data/entity-cache/save-entities-success",B;var n})();class ee{constructor(e,t){this.type=B.CLEAR_COLLECTIONS,this.payload={collections:e,tag:t}}}class se{constructor(e,t){this.type=B.LOAD_COLLECTIONS,this.payload={collections:e,tag:t}}}class ne{constructor(e,t,s){this.type=B.MERGE_QUERY_SET,this.payload={querySet:e,mergeStrategy:null===t?W.PreserveChanges:t,tag:s}}}class re{constructor(e,t){this.cache=e,this.type=B.SET_ENTITY_CACHE,this.payload={cache:e,tag:t}}}class ae{constructor(e,t,s){this.type=B.SAVE_ENTITIES,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}class ie{constructor(e,t,s,r){this.type=B.SAVE_ENTITIES_CANCEL,this.payload={correlationId:e,reason:t,entityNames:s,tag:r}}}class oe{constructor(e,t,s){this.type=B.SAVE_ENTITIES_CANCELED,this.payload={correlationId:e,reason:t,tag:s}}}class ce{constructor(e,t){this.type=B.SAVE_ENTITIES_ERROR,this.payload={error:e,originalAction:t,correlationId:t.payload.correlationId}}}class ft{constructor(e,t,s){this.type=B.SAVE_ENTITIES_SUCCESS,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}var y=(()=>{return(n=y||(y={})).CANCEL_PERSIST="@ngrx/data/cancel-persist",n.CANCELED_PERSIST="@ngrx/data/canceled-persist",n.QUERY_ALL="@ngrx/data/query-all",n.QUERY_ALL_SUCCESS="@ngrx/data/query-all/success",n.QUERY_ALL_ERROR="@ngrx/data/query-all/error",n.QUERY_LOAD="@ngrx/data/query-load",n.QUERY_LOAD_SUCCESS="@ngrx/data/query-load/success",n.QUERY_LOAD_ERROR="@ngrx/data/query-load/error",n.QUERY_MANY="@ngrx/data/query-many",n.QUERY_MANY_SUCCESS="@ngrx/data/query-many/success",n.QUERY_MANY_ERROR="@ngrx/data/query-many/error",n.QUERY_BY_KEY="@ngrx/data/query-by-key",n.QUERY_BY_KEY_SUCCESS="@ngrx/data/query-by-key/success",n.QUERY_BY_KEY_ERROR="@ngrx/data/query-by-key/error",n.SAVE_ADD_MANY="@ngrx/data/save/add-many",n.SAVE_ADD_MANY_ERROR="@ngrx/data/save/add-many/error",n.SAVE_ADD_MANY_SUCCESS="@ngrx/data/save/add-many/success",n.SAVE_ADD_ONE="@ngrx/data/save/add-one",n.SAVE_ADD_ONE_ERROR="@ngrx/data/save/add-one/error",n.SAVE_ADD_ONE_SUCCESS="@ngrx/data/save/add-one/success",n.SAVE_DELETE_MANY="@ngrx/data/save/delete-many",n.SAVE_DELETE_MANY_SUCCESS="@ngrx/data/save/delete-many/success",n.SAVE_DELETE_MANY_ERROR="@ngrx/data/save/delete-many/error",n.SAVE_DELETE_ONE="@ngrx/data/save/delete-one",n.SAVE_DELETE_ONE_SUCCESS="@ngrx/data/save/delete-one/success",n.SAVE_DELETE_ONE_ERROR="@ngrx/data/save/delete-one/error",n.SAVE_UPDATE_MANY="@ngrx/data/save/update-many",n.SAVE_UPDATE_MANY_SUCCESS="@ngrx/data/save/update-many/success",n.SAVE_UPDATE_MANY_ERROR="@ngrx/data/save/update-many/error",n.SAVE_UPDATE_ONE="@ngrx/data/save/update-one",n.SAVE_UPDATE_ONE_SUCCESS="@ngrx/data/save/update-one/success",n.SAVE_UPDATE_ONE_ERROR="@ngrx/data/save/update-one/error",n.SAVE_UPSERT_MANY="@ngrx/data/save/upsert-many",n.SAVE_UPSERT_MANY_SUCCESS="@ngrx/data/save/upsert-many/success",n.SAVE_UPSERT_MANY_ERROR="@ngrx/data/save/upsert-many/error",n.SAVE_UPSERT_ONE="@ngrx/data/save/upsert-one",n.SAVE_UPSERT_ONE_SUCCESS="@ngrx/data/save/upsert-one/success",n.SAVE_UPSERT_ONE_ERROR="@ngrx/data/save/upsert-one/error",n.ADD_ALL="@ngrx/data/add-all",n.ADD_MANY="@ngrx/data/add-many",n.ADD_ONE="@ngrx/data/add-one",n.REMOVE_ALL="@ngrx/data/remove-all",n.REMOVE_MANY="@ngrx/data/remove-many",n.REMOVE_ONE="@ngrx/data/remove-one",n.UPDATE_MANY="@ngrx/data/update-many",n.UPDATE_ONE="@ngrx/data/update-one",n.UPSERT_MANY="@ngrx/data/upsert-many",n.UPSERT_ONE="@ngrx/data/upsert-one",n.COMMIT_ALL="@ngrx/data/commit-all",n.COMMIT_MANY="@ngrx/data/commit-many",n.COMMIT_ONE="@ngrx/data/commit-one",n.UNDO_ALL="@ngrx/data/undo-all",n.UNDO_MANY="@ngrx/data/undo-many",n.UNDO_ONE="@ngrx/data/undo-one",n.SET_CHANGE_STATE="@ngrx/data/set-change-state",n.SET_COLLECTION="@ngrx/data/set-collection",n.SET_FILTER="@ngrx/data/set-filter",n.SET_LOADED="@ngrx/data/set-loaded",n.SET_LOADING="@ngrx/data/set-loading",y;var n})();const St="/success",_t="/error";function Lt(n){return n+St}class ot{constructor(e,t){this.error=e,this.requestData=t,this.message="string"==typeof e?e:function ue(n){const{error:e,body:t,message:s}=n;let r=null;return e?r="string"==typeof e?e:e.message:s?r=s:t&&(r="string"==typeof t?t:t.error),"string"==typeof r?r:r?JSON.stringify(r):null}(e)}}class vt{}class lt{}const mt=new d.OlP("@ngrx/data Plural Names");class xt{}class Nt{}let he=(()=>{class n{constructor(t){this.pluralizer=t,this.knownHttpResourceUrls={}}getResourceUrls(t,s){let r=this.knownHttpResourceUrls[t];if(!r){const a=function le(n){return n.replace(/^[/\s]+|[/\s]+$/g,"")}(s);r={entityResourceUrl:`${a}/${t}/`.toLowerCase(),collectionResourceUrl:`${a}/${this.pluralizer.pluralize(t)}/`.toLowerCase()},this.registerHttpResourceUrls({[t]:r})}return r}entityResource(t,s){return this.getResourceUrls(t,s).entityResourceUrl}collectionResource(t,s){return this.getResourceUrls(t,s).collectionResourceUrl}registerHttpResourceUrls(t){this.knownHttpResourceUrls=Object.assign(Object.assign({},this.knownHttpResourceUrls),t||{})}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(xt))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();class ye{constructor(e,t,s,r){this.http=t,this.httpUrlGenerator=s,this.getDelay=0,this.saveDelay=0,this.timeout=0,this._name=`${e} DefaultDataService`,this.entityName=e;const{root:a="api",delete404OK:c=!0,getDelay:l=0,saveDelay:v=0,timeout:_=0}=r||{};this.delete404OK=c,this.entityUrl=s.entityResource(e,a),this.entitiesUrl=s.collectionResource(e,a),this.getDelay=l,this.saveDelay=v,this.timeout=_}get name(){return this._name}add(e){const t=e||new Error(`No "${this.entityName}" entity to add`);return this.execute("POST",this.entityUrl,t)}delete(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to delete`)),this.execute("DELETE",this.entityUrl+e,t).pipe((0,L.U)(s=>e))}getAll(){return this.execute("GET",this.entitiesUrl)}getById(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to get`)),this.execute("GET",this.entityUrl+e,t)}getWithQuery(e){const s=new K.LE("string"==typeof e?{fromString:e}:{fromObject:e});return this.execute("GET",this.entitiesUrl,void 0,{params:s})}update(e){const t=e&&e.id,s=null==t?new Error(`No "${this.entityName}" update data or id`):e.changes;return this.execute("PUT",this.entityUrl+t,s)}upsert(e){const t=e||new Error(`No "${this.entityName}" entity to upsert`);return this.execute("POST",this.entityUrl,t)}execute(e,t,s,r){const a={method:e,url:t,data:s,options:r};if(s instanceof Error)return this.handleError(a)(s);let c;switch(e){case"DELETE":c=this.http.delete(t,r),this.saveDelay&&(c=c.pipe(F(this.saveDelay)));break;case"GET":c=this.http.get(t,r),this.getDelay&&(c=c.pipe(F(this.getDelay)));break;case"POST":c=this.http.post(t,s,r),this.saveDelay&&(c=c.pipe(F(this.saveDelay)));break;case"PUT":c=this.http.put(t,s,r),this.saveDelay&&(c=c.pipe(F(this.saveDelay)));break;default:{const l=new Error("Unimplemented HTTP method, "+e);c=(0,D._)(l)}}return this.timeout&&(c=c.pipe((0,M.V)(this.timeout+this.saveDelay))),c.pipe((0,T.K)(this.handleError(a)))}handleError(e){return t=>{const s=this.handleDelete404(t,e);if(s)return s;const r=new ot(t,e);return(0,D._)(r)}}handleDelete404(e,t){if(404===e.status&&"DELETE"===t.method&&this.delete404OK)return(0,N.of)({})}}let It=(()=>{class n{constructor(t,s,r){this.http=t,this.httpUrlGenerator=s,this.config=r,s.registerHttpResourceUrls((r=r||{}).entityHttpResourceUrls)}create(t){return new ye(t,this.http,this.httpUrlGenerator,this.config)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(K.eN),d.LFG(Nt),d.LFG(vt,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();const Ft=new d.OlP("@ngrx/data Entity Metadata");let ct=(()=>{class n{constructor(t){this.definitions={},t&&t.forEach(s=>this.registerMetadataMap(s))}getDefinition(t,s=!0){t=t.trim();const r=this.definitions[t];if(!r&&s)throw new Error(`No EntityDefinition for entity type "${t}".`);return r}registerMetadata(t){if(t){const s=function pe(n){let e=n.entityName;if(!e)throw new Error("Missing required entityName");n.entityName=e=e.trim();const t=n.selectId||P,s=n.sortComparer=n.sortComparer||!1,r=(0,S.H)({selectId:t,sortComparer:s}),a=n.entityDispatcherOptions||{},c=r.getInitialState(Object.assign({entityName:e,filter:"",loaded:!1,loading:!1,changeState:{}},n.additionalCollectionState||{}));return{entityName:e,entityAdapter:r,entityDispatcherOptions:a,initialState:c,metadata:n,noChangeTracking:!0===n.noChangeTracking,selectId:t,sortComparer:s}}(t);this.registerDefinition(s)}}registerMetadataMap(t={}){Object.keys(t||{}).forEach(s=>this.registerMetadata(Object.assign({entityName:s},t[s])))}registerDefinition(t){this.definitions[t.entityName]=t}registerDefinitions(t){Object.assign(this.definitions,t)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Ft,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();const Pt=tt.Update;let Yt=(()=>{class n{constructor(t,s,r){this.entityDefinitionService=t,this.http=s,this.idSelectors={},this.saveDelay=0,this.timeout=0;const{saveDelay:a=0,timeout:c=0}=r||{};this.saveDelay=a,this.timeout=c}saveEntities(t,s){t=this.filterChangeSet(t),t=this.flattenUpdates(t);let r=this.http.post(s,t).pipe((0,L.U)(a=>this.restoreUpdates(a)),(0,T.K)(this.handleError({method:"POST",url:s,data:t})));return this.timeout&&(r=r.pipe((0,M.V)(this.timeout))),this.saveDelay&&(r=r.pipe(F(this.saveDelay))),r}handleError(t){return s=>{const r=new ot(s,t);return(0,D._)(r)}}filterChangeSet(t){return Ut(t)}flattenUpdates(t){let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>a.op===Pt&&a.entities.length>0?(r=!0,Object.assign(Object.assign({},a),{entities:a.entities.map(c=>c.changes)})):a),r?Object.assign(Object.assign({},t),{changes:s}):t}restoreUpdates(t){if(null==t)return t;let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>{if(a.op===Pt){r=!0;const c=this.getIdSelector(a.entityName);return Object.assign(Object.assign({},a),{entities:a.entities.map(l=>({id:c(l),changes:l}))})}return a}),r?Object.assign(Object.assign({},t),{changes:s}):t}getIdSelector(t){let s=this.idSelectors[t];return s||(s=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=s),s}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(ct),d.LFG(K.eN),d.LFG(vt,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),jt=(()=>{class n{constructor(t){this.defaultDataServiceFactory=t,this.services={}}getService(t){t=t.trim();let s=this.services[t];return s||(s=this.defaultDataServiceFactory.create(t),this.services[t]=s),s}registerService(t,s){this.services[t.trim()]=s}registerServices(t){this.services=Object.assign(Object.assign({},this.services),t)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(It))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();class $t{}let ge=(()=>{class n{constructor(t,s){this.logger=t,this.entityActionFactory=s}handleSuccess(t){const s=Lt(t.payload.entityOp);return r=>this.entityActionFactory.createFromAction(t,{entityOp:s,data:r})}handleError(t){const s=function de(n){return n+_t}(t.payload.entityOp);return r=>{const c={error:r instanceof ot?r:new ot(r,null),originalAction:t};return this.logger.error(c),this.entityActionFactory.createFromAction(t,{entityOp:s,data:c})}}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(lt),d.LFG(f))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();class wt{constructor(e){this.message=e,this.message=e||"Canceled by user"}}let At=(()=>{class n{constructor(){this.seed=0,this.prefix="CRID"}next(){return this.seed+=1,this.prefix+this.seed}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Ct=(()=>{class n{constructor(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Ee=(()=>{class n{constructor(t,s,r,a){this.correlationIdGenerator=t,this.defaultDispatcherOptions=s,this.store=a,this.reducedActions$=r.pipe(m(1)),this.raSubscription=this.reducedActions$.subscribe()}dispatch(t){return this.store.dispatch(t),t}cancelSaveEntities(t,s,r,a){if(!t)throw new Error("Missing correlationId");const c=new ie(t,s,r,a);this.dispatch(c)}clearCollections(t,s){this.dispatch(new ee(t,s))}loadCollections(t,s){this.dispatch(new se(t,s))}mergeQuerySet(t,s,r){this.dispatch(new ne(t,s,r))}setEntityCache(t,s){this.dispatch(new re(t,s))}saveEntities(t,s,r){const a=Array.isArray(t)?{changes:t}:t,c=null==(r=r||{}).correlationId?this.correlationIdGenerator.next():r.correlationId,l=null==r.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===r.isOptimistic,v=r.tag||"Save Entities";r=Object.assign(Object.assign({},r),{correlationId:c,isOptimistic:l,tag:v});const _=new ae(a,s,r);return this.dispatch(_),this.getSaveEntitiesResponseData$(r.correlationId).pipe(m(1))}getSaveEntitiesResponseData$(t){return this.reducedActions$.pipe((0,p.h)(s=>s.type===B.SAVE_ENTITIES_SUCCESS||s.type===B.SAVE_ENTITIES_ERROR||s.type===B.SAVE_ENTITIES_CANCEL),(0,p.h)(s=>t===s.payload.correlationId),(0,g.q)(1),(0,w.z)(s=>s.type===B.SAVE_ENTITIES_CANCEL?(0,D._)(new wt(s.payload.reason)):s.type===B.SAVE_ENTITIES_SUCCESS?(0,N.of)(s.payload.changeSet):(0,D._)(s.payload)))}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(At),d.LFG(Ct),d.LFG(o.Y$),d.LFG(o.yh))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();class fe{constructor(e,t,s,r=P,a,c,l,v){this.entityName=e,this.entityActionFactory=t,this.store=s,this.selectId=r,this.defaultDispatcherOptions=a,this.reducedActions$=c,this.correlationIdGenerator=v,this.guard=new A(e,r),this.toUpdate=nt(r);const _=(0,o.P1)(l,C=>C[e]);this.entityCollection$=s.select(_)}createEntityAction(e,t,s){return this.entityActionFactory.create(Object.assign({entityName:this.entityName,entityOp:e,data:t},s))}createAndDispatch(e,t,s){const r=this.createEntityAction(e,t,s);return this.dispatch(r),r}dispatch(e){return this.store.dispatch(e),e}add(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticAdd);const s=this.createEntityAction(y.SAVE_ADD_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,I.M)(this.entityCollection$),(0,L.U)(([r,a])=>a.entities[this.selectId(r)]),m(1))}cancel(e,t,s){if(!e)throw new Error("Missing correlationId");this.createAndDispatch(y.CANCEL_PERSIST,t,{correlationId:e})}delete(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticDelete);const s=this.getKey(e),r=this.createEntityAction(y.SAVE_DELETE_ONE,s,t);return this.guard.mustBeKey(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,L.U)(()=>s),m(1))}getAll(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(y.QUERY_ALL,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe((0,I.M)(this.entityCollection$),(0,L.U)(([s,r])=>s.reduce((a,c)=>{const l=r.entities[this.selectId(c)];return l&&a.push(l),a},[])),m(1))}getByKey(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(y.QUERY_BY_KEY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,I.M)(this.entityCollection$),(0,L.U)(([r,a])=>a.entities[this.selectId(r)]),m(1))}getWithQuery(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(y.QUERY_MANY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,I.M)(this.entityCollection$),(0,L.U)(([r,a])=>r.reduce((c,l)=>{const v=a.entities[this.selectId(l)];return v&&c.push(v),c},[])),m(1))}load(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(y.QUERY_LOAD,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(m(1))}update(e,t){const s=this.toUpdate(e);t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpdate);const r=this.createEntityAction(y.SAVE_UPDATE_ONE,s,t);return t.isOptimistic&&this.guard.mustBeUpdate(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,L.U)(a=>a.changes),(0,I.M)(this.entityCollection$),(0,L.U)(([a,c])=>c.entities[this.selectId(a)]),m(1))}upsert(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpsert);const s=this.createEntityAction(y.SAVE_UPSERT_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,I.M)(this.entityCollection$),(0,L.U)(([r,a])=>a.entities[this.selectId(r)]),m(1))}addAllToCache(e,t){this.createAndDispatch(y.ADD_ALL,e,t)}addOneToCache(e,t){this.createAndDispatch(y.ADD_ONE,e,t)}addManyToCache(e,t){this.createAndDispatch(y.ADD_MANY,e,t)}clearCache(e){this.createAndDispatch(y.REMOVE_ALL,void 0,e)}removeOneFromCache(e,t){this.createAndDispatch(y.REMOVE_ONE,this.getKey(e),t)}removeManyFromCache(e,t){if(!e||0===e.length)return;const s="object"==typeof e[0]?e.map(r=>this.getKey(r)):e;this.createAndDispatch(y.REMOVE_MANY,s,t)}updateOneInCache(e,t){const s=this.toUpdate(e);this.createAndDispatch(y.UPDATE_ONE,s,t)}updateManyInCache(e,t){if(!e||0===e.length)return;const s=e.map(r=>this.toUpdate(r));this.createAndDispatch(y.UPDATE_MANY,s,t)}upsertOneInCache(e,t){this.createAndDispatch(y.UPSERT_ONE,e,t)}upsertManyInCache(e,t){!e||0===e.length||this.createAndDispatch(y.UPSERT_MANY,e,t)}setFilter(e){this.createAndDispatch(y.SET_FILTER,e)}setLoaded(e){this.createAndDispatch(y.SET_LOADED,!!e)}setLoading(e){this.createAndDispatch(y.SET_LOADING,!!e)}getKey(e){return"object"==typeof e?this.selectId(e):e}getResponseData$(e){return this.reducedActions$.pipe((0,p.h)(t=>!!t.payload),(0,p.h)(t=>{const{correlationId:s,entityName:r,entityOp:a}=t.payload;return r===this.entityName&&s===e&&(a.endsWith(St)||a.endsWith(_t)||a===y.CANCEL_PERSIST)}),(0,g.q)(1),(0,w.z)(t=>{const{entityOp:s}=t.payload;return s===y.CANCEL_PERSIST?(0,D._)(new wt(t.payload.data)):s.endsWith(St)?(0,N.of)(t.payload.data):(0,D._)(t.payload.data.error)}))}setQueryEntityActionOptions(e){const t=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId;return Object.assign(Object.assign({},e),{correlationId:t})}setSaveEntityActionOptions(e,t){const s=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId,r=null==e.isOptimistic?t||!1:!0===e.isOptimistic;return Object.assign(Object.assign({},e),{correlationId:s,isOptimistic:r})}}const yt="entityCache",Ot=new d.OlP("@ngrx/data Entity Cache Name"),Mt=new d.OlP("@ngrx/data Entity Cache Meta Reducers"),Dt=new d.OlP("@ngrx/data Entity Collection Meta Reducers"),Se=new d.OlP("@ngrx/data Initial Entity Cache State"),pt=new d.OlP("@ngrx/data Entity Cache Selector"),_e={provide:pt,useFactory:Bt,deps:[[new d.FiY,Ot]]};function Bt(n){return(0,o.ZF)(n=n||yt)}let Tt=(()=>{class n{constructor(t,s,r,a,c,l){this.entityActionFactory=t,this.store=s,this.entityDispatcherDefaultOptions=r,this.entityCacheSelector=c,this.correlationIdGenerator=l,this.reducedActions$=a.pipe(m(1)),this.raSubscription=this.reducedActions$.subscribe()}create(t,s=P,r={}){const a=Object.assign(Object.assign({},this.entityDispatcherDefaultOptions),r);return new fe(t,this.entityActionFactory,this.store,s,a,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)}ngOnDestroy(){this.raSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(f),d.LFG(o.yh),d.LFG(Ct),d.LFG(o.Y$),d.LFG(pt),d.LFG(At))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();const Vt=new d.OlP("@ngrx/data Entity Effects Scheduler");let Gt=(()=>{class n{constructor(t,s,r,a,c){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.logger=a,this.scheduler=c,this.responseDelay=10,this.saveEntitiesCancel$=(0,i.GW)(()=>this.actions.pipe((0,i.l4)(B.SAVE_ENTITIES_CANCEL),(0,p.h)(l=>null!=l.payload.correlationId)),{dispatch:!1}),this.saveEntities$=(0,i.GW)(()=>this.actions.pipe((0,i.l4)(B.SAVE_ENTITIES),(0,w.z)(l=>this.saveEntities(l))))}saveEntities(t){const s=t.payload.error;if(s)return this.handleSaveEntitiesError$(t)(s);try{const r=Ut(t.payload.changeSet),{correlationId:a,mergeStrategy:c,tag:l,url:v}=t.payload,_={correlationId:a,mergeStrategy:c,tag:l};if(0===r.changes.length)return(0,N.of)(new ft(r,v,_));return st(this.saveEntitiesCancel$.pipe((0,p.h)(G=>a===G.payload.correlationId),(0,L.U)(G=>new oe(a,G.payload.reason,G.payload.tag))),this.dataService.saveEntities(r,v).pipe((0,x.b)(G=>this.handleSaveEntitiesSuccess$(t,this.entityActionFactory)(G)),(0,T.K)(this.handleSaveEntitiesError$(t))))}catch(r){return this.handleSaveEntitiesError$(t)(r)}}handleSaveEntitiesError$(t){return s=>{const r=s instanceof ot?s:new ot(s,null);return(0,N.of)(new ce(r,t)).pipe(F(this.responseDelay,this.scheduler||h.z))}}handleSaveEntitiesSuccess$(t,s){const{url:r,correlationId:a,mergeStrategy:c,tag:l}=t.payload,v={correlationId:a,mergeStrategy:c,tag:l};return _=>{if(_)return(0,N.of)(new ft(_,r,v));if(_=t.payload.changeSet,!t.payload.isOptimistic)return(0,N.of)(new ft(_,r,v));const C=_.changes.reduce((U,G)=>-1===U.indexOf(G.entityName)?U.concat(G.entityName):U,[]);return(0,E.T)(C.map(U=>s.create(U,y.SET_LOADING,!1)))}}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(i.eX),d.LFG(Yt),d.LFG(f),d.LFG(lt),d.LFG(Vt,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();const ve=[y.QUERY_ALL,y.QUERY_LOAD,y.QUERY_BY_KEY,y.QUERY_MANY,y.SAVE_ADD_ONE,y.SAVE_DELETE_ONE,y.SAVE_UPDATE_ONE,y.SAVE_UPSERT_ONE];let Kt=(()=>{class n{constructor(t,s,r,a,c){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.resultHandler=a,this.scheduler=c,this.responseDelay=10,this.cancel$=(0,i.GW)(()=>this.actions.pipe(ht(y.CANCEL_PERSIST),(0,L.U)(l=>l.payload.correlationId),(0,p.h)(l=>null!=l)),{dispatch:!1}),this.persist$=(0,i.GW)(()=>this.actions.pipe(ht(ve),(0,w.z)(l=>this.persist(l))))}persist(t){if(t.payload.skip)return this.handleSkipSuccess$(t);if(t.payload.error)return this.handleError$(t)(t.payload.error);try{return st(this.cancel$.pipe((0,p.h)(a=>t.payload.correlationId===a),(0,L.U)(a=>this.entityActionFactory.createFromAction(t,{entityOp:y.CANCELED_PERSIST}))),this.callDataService(t).pipe((0,L.U)(this.resultHandler.handleSuccess(t)),(0,T.K)(this.handleError$(t))))}catch(s){return this.handleError$(t)(s)}}callDataService(t){const{entityName:s,entityOp:r,data:a}=t.payload,c=this.dataService.getService(s);switch(r){case y.QUERY_ALL:case y.QUERY_LOAD:return c.getAll();case y.QUERY_BY_KEY:return c.getById(a);case y.QUERY_MANY:return c.getWithQuery(a);case y.SAVE_ADD_ONE:return c.add(a);case y.SAVE_DELETE_ONE:return c.delete(a);case y.SAVE_UPDATE_ONE:const{id:l,changes:v}=a;return c.update(a).pipe((0,L.U)(_=>_&&Object.keys(_).length>0?{id:l,changes:Object.assign(Object.assign({},v),_),changed:!0}:{id:l,changes:v,changed:!1}));case y.SAVE_UPSERT_ONE:return c.upsert(a).pipe((0,L.U)(_=>_&&Object.keys(_).length>0?_:a));default:throw new Error(`Persistence action "${r}" is not implemented.`)}}handleError$(t){return s=>(0,N.of)(this.resultHandler.handleError(t)(s)).pipe(F(this.responseDelay,this.scheduler||h.z))}handleSkipSuccess$(t){const s=Lt(t.payload.entityOp),r=this.entityActionFactory.createFromAction(t,{entityOp:s});return(0,N.of)(r).pipe(F(this.responseDelay,this.scheduler||h.z))}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(i.eX),d.LFG(jt),d.LFG(f),d.LFG($t),d.LFG(Vt,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();class Qt{constructor(e,t){this.entityName=e,e=e.trim();const{dispatcher:s,selectors:r,selectors$:a}=t.create(e);this.entityName=e,this.dispatcher=s,this.guard=s.guard,this.selectId=s.selectId,this.toUpdate=s.toUpdate,this.selectors=r,this.selectors$=a,this.collection$=a.collection$,this.count$=a.count$,this.entities$=a.entities$,this.entityActions$=a.entityActions$,this.entityMap$=a.entityMap$,this.errors$=a.errors$,this.filter$=a.filter$,this.filteredEntities$=a.filteredEntities$,this.keys$=a.keys$,this.loaded$=a.loaded$,this.loading$=a.loading$,this.changeState$=a.changeState$}createEntityAction(e,t,s){return this.dispatcher.createEntityAction(e,t,s)}createAndDispatch(e,t,s){return this.dispatcher.createAndDispatch(e,t,s)}dispatch(e){return this.dispatcher.dispatch(e)}get store(){return this.dispatcher.store}add(e,t){return this.dispatcher.add(e,t)}cancel(e,t,s){this.dispatcher.cancel(e,t,s)}delete(e,t){return this.dispatcher.delete(e,t)}getAll(e){return this.dispatcher.getAll(e)}getByKey(e,t){return this.dispatcher.getByKey(e,t)}getWithQuery(e,t){return this.dispatcher.getWithQuery(e,t)}load(e){return this.dispatcher.load(e)}update(e,t){return this.dispatcher.update(e,t)}upsert(e,t){return this.dispatcher.upsert(e,t)}addAllToCache(e,t){this.dispatcher.addAllToCache(e,t)}addOneToCache(e,t){this.dispatcher.addOneToCache(e,t)}addManyToCache(e,t){this.dispatcher.addManyToCache(e,t)}clearCache(){this.dispatcher.clearCache()}removeOneFromCache(e,t){this.dispatcher.removeOneFromCache(e,t)}removeManyFromCache(e,t){this.dispatcher.removeManyFromCache(e,t)}updateOneInCache(e,t){this.dispatcher.updateOneInCache(e,t)}updateManyInCache(e,t){this.dispatcher.updateManyInCache(e,t)}upsertOneInCache(e,t){this.dispatcher.upsertOneInCache(e,t)}upsertManyInCache(e,t){this.dispatcher.upsertManyInCache(e,t)}setFilter(e){this.dispatcher.setFilter(e)}setLoaded(e){this.dispatcher.setLoaded(!!e)}setLoading(e){this.dispatcher.setLoading(!!e)}}let gt=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return s&&s.initialState||function me(n){return{entityName:n,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}(t)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(ct,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),zt=(()=>{class n{constructor(t,s){this.entityCollectionCreator=t||new gt,this.selectEntityCache=s||Bt(yt)}createCollectionSelector(t){return(0,o.P1)(this.selectEntityCache,(r={})=>r[t]||this.entityCollectionCreator.create(t))}createCollectionSelectors(t){const s="string"==typeof t?{entityName:t}:t,r=z=>z.ids,a=z=>z.entities,c=(0,o.P1)(r,a,(z,ut)=>z.map(Le=>ut[Le])),l=(0,o.P1)(r,z=>z.length),v=z=>z.filter,_=s.filterFn,C=_?(0,o.P1)(c,v,(z,ut)=>_(z,ut)):c,dt={};return Object.keys(s.additionalCollectionState||{}).forEach(z=>{dt["select"+z[0].toUpperCase()+z.slice(1)]=ut=>ut[z]}),Object.assign({selectCount:l,selectEntities:c,selectEntityMap:a,selectFilter:v,selectFilteredEntities:C,selectKeys:r,selectLoaded:z=>z.loaded,selectLoading:z=>z.loading,selectChangeState:z=>z.changeState},dt)}create(t){const s="string"==typeof t?{entityName:t}:t,r=s.entityName,a=this.createCollectionSelector(r),c=this.createCollectionSelectors(s),l={};return Object.keys(c).forEach(v=>{l[v]=(0,o.P1)(a,c[v])}),Object.assign({entityName:r,selectCollection:a,selectEntityCache:this.selectEntityCache},l)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(gt,8),d.LFG(pt,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),bt=(()=>{class n{constructor(t,s,r){this.store=t,this.actions=s,this.selectEntityCache=r,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=s.pipe((0,p.h)(a=>a.payload&&a.payload.entityOp&&a.payload.entityOp.endsWith(_t)),m(1))}create(t,s){const r={entityName:t};return Object.keys(s).forEach(a=>{if(a.startsWith("select")){const c=a[6].toLowerCase()+a.substr(7)+"$";r[c]=this.store.select(s[a])}}),r.entityActions$=this.actions.pipe(Rt(t)),r.errors$=this.entityActionErrors$.pipe(Rt(t)),r}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(o.yh),d.LFG(i.eX),d.LFG(pt))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),kt=(()=>{class n{constructor(t,s,r,a){this.entityDispatcherFactory=t,this.entityDefinitionService=s,this.entitySelectorsFactory=r,this.entitySelectors$Factory=a}create(t){t=t.trim();const s=this.entityDefinitionService.getDefinition(t),r=this.entityDispatcherFactory.create(t,s.selectId,s.entityDispatcherOptions),a=this.entitySelectorsFactory.create(s.metadata);return{dispatcher:r,entityName:t,selectors:a,selectors$:this.entitySelectors$Factory.create(t,a)}}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Tt),d.LFG(ct),d.LFG(zt),d.LFG(bt))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Wt=(()=>{class n{constructor(t){this.entityCollectionServiceElementsFactory=t}create(t){return new Qt(t,this.entityCollectionServiceElementsFactory)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(kt))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Ht=(()=>{class n{constructor(t,s,r,a){this.entityCollectionServiceFactory=t,this.store=a,this.entityActionErrors$=r.entityActionErrors$,this.entityCache$=r.entityCache$,this.reducedActions$=s.reducedActions$}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Wt),d.LFG(Tt),d.LFG(bt),d.LFG(o.yh))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Ae=(()=>{class n{constructor(t){this.entityServicesElements=t,this.EntityCollectionServices={}}get entityActionErrors$(){return this.entityServicesElements.entityActionErrors$}get entityCache$(){return this.entityServicesElements.entityCache$}get entityCollectionServiceFactory(){return this.entityServicesElements.entityCollectionServiceFactory}get reducedActions$(){return this.entityServicesElements.reducedActions$}get store(){return this.entityServicesElements.store}dispatch(t){this.store.dispatch(t)}createEntityCollectionService(t){return this.entityCollectionServiceFactory.create(t)}getEntityCollectionService(t){let s=this.EntityCollectionServices[t];return s||(s=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=s),s}registerEntityCollectionService(t,s){this.EntityCollectionServices[s||t.entityName]=t}registerEntityCollectionServices(t){Array.isArray(t)?t.forEach(s=>this.registerEntityCollectionService(s)):Object.keys(t||{}).forEach(s=>{this.registerEntityCollectionService(t[s],s)})}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Ht))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();class Ce{}var J=(()=>{return(n=J||(J={}))[n.Unchanged=0]="Unchanged",n[n.Added=1]="Added",n[n.Deleted=2]="Deleted",n[n.Updated=3]="Updated",J;var n})();class Oe{constructor(e,t){this.adapter=e,this.selectId=t,this.selectId=t||P}commitAll(e){return 0===Object.keys(e.changeState).length?e:Object.assign(Object.assign({},e),{changeState:{}})}commitMany(e,t){if(null==e||0===e.length)return t;let s=!1;const r=e.reduce((a,c)=>{const l="object"==typeof c?this.selectId(c):c;return a[l]&&(s||(a=Object.assign({},a),s=!0),delete a[l]),a},t.changeState);return s?Object.assign(Object.assign({},t),{changeState:r}):t}commitOne(e,t){return null==e?t:this.commitMany([e],t)}mergeQueryResults(e,t,s){return this.mergeServerUpserts(e,t,W.PreserveChanges,s)}mergeSaveAdds(e,t,s){return this.mergeServerUpserts(e,t,W.OverwriteChanges,s)}mergeSaveDeletes(e,t,s){const r=e;return t=(s=null==s?W.OverwriteChanges:s)===W.IgnoreChanges?t:this.commitMany(r,t),this.adapter.removeMany(r,t)}mergeSaveUpdates(e,t,s,r=!1){if(null==e||0===e.length)return t;let l,a=!1,c=t.changeState;switch(s=null==s?W.OverwriteChanges:s){case W.IgnoreChanges:return l=v(e),this.adapter.updateMany(l,t);case W.OverwriteChanges:return c=e.reduce((_,C)=>{const U=C.id;return _[U]&&(a||(_=Object.assign({},_),a=!0),delete _[U]),_},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:c}):t,l=v(e),this.adapter.updateMany(l,t);case W.PreserveChanges:{const _=[];return c=e.reduce((C,U)=>{const G=U.id,rt=C[G];if(rt){a||(C=Object.assign({},C),a=!0);const Et=this.selectId(U.changes),dt=rt;Et!==G&&delete C[G];const z=Object.assign(Object.assign({},dt.originalValue),U.changes);C[Et]=Object.assign(Object.assign({},dt),{originalValue:z})}else _.push(U);return C},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:c}):t,l=v(_),this.adapter.updateMany(l,t)}}function v(_){return!0===r&&(_=_.filter(C=>!0===C.changed)),_.map(C=>({id:C.id,changes:C.changes}))}}mergeSaveUpserts(e,t,s){return this.mergeServerUpserts(e,t,W.OverwriteChanges,s)}mergeServerUpserts(e,t,s,r){if(null==e||0===e.length)return t;let a=!1,c=t.changeState;switch(r=null==r?s:r){case W.IgnoreChanges:return this.adapter.upsertMany(e,t);case W.OverwriteChanges:return t=this.adapter.upsertMany(e,t),c=e.reduce((l,v)=>{const _=this.selectId(v);return l[_]&&(a||(l=Object.assign({},l),a=!0),delete l[_]),l},t.changeState),a?Object.assign(Object.assign({},t),{changeState:c}):t;case W.PreserveChanges:{const l=[];return c=e.reduce((v,_)=>{const C=this.selectId(_);return v[C]?a||(v=Object.assign(Object.assign({},v),{[C]:Object.assign(Object.assign({},v[C]),{originalValue:_})}),a=!0):l.push(_),v},t.changeState),t=this.adapter.upsertMany(l,t),a?Object.assign(Object.assign({},t),{changeState:c}):t}}}trackAddMany(e,t,s){if(s===W.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=e.reduce((c,l)=>{const v=this.selectId(l);if(null==v||""===v)throw new Error(`${t.entityName} entity add requires a key to be tracked`);return c[v]||(r||(r=!0,c=Object.assign({},c)),c[v]={changeType:J.Added}),c},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:a}):t}trackAddOne(e,t,s){return null==e?t:this.trackAddMany([e],t,s)}trackDeleteMany(e,t,s){if(s===W.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,c=e.reduce((l,v)=>{const _=a[v];if(_){const U=l[v];U?U.changeType===J.Added?(C(),delete l[v]):U.changeType===J.Updated&&(C(),l[v]=Object.assign(Object.assign({},l[v]),{changeType:J.Deleted})):(C(),l[v]={changeType:J.Deleted,originalValue:_})}return l;function C(){r||(r=!0,l=Object.assign({},l))}},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:c}):t}trackDeleteOne(e,t,s){return null==e?t:this.trackDeleteMany([e],t,s)}trackUpdateMany(e,t,s){if(s===W.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,c=e.reduce((l,v)=>{const{id:_}=v;if(null==_||""===_)throw new Error(`${t.entityName} entity update requires a key to be tracked`);const U=a[_];return U&&(l[_]||(r||(r=!0,l=Object.assign({},l)),l[_]={changeType:J.Updated,originalValue:U})),l},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:c}):t}trackUpdateOne(e,t,s){return null==e?t:this.trackUpdateMany([e],t,s)}trackUpsertMany(e,t,s){if(s===W.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,c=e.reduce((l,v)=>{const _=this.selectId(v);if(null==_||""===_)throw new Error(`${t.entityName} entity upsert requires a key to be tracked`);if(!l[_]){r||(r=!0,l=Object.assign({},l));const U=a[_];l[_]=null==U?{changeType:J.Added}:{changeType:J.Updated,originalValue:U}}return l},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:c}):t}trackUpsertOne(e,t,s){return null==e?t:this.trackUpsertMany([e],t,s)}undoAll(e){const t=Object.keys(e.changeState),{remove:s,upsert:r}=t.reduce((a,c)=>{const l=a.chgState[c];switch(l.changeType){case J.Added:a.remove.push(c);break;case J.Deleted:const v=l.originalValue;v&&a.upsert.push(v);break;case J.Updated:a.upsert.push(l.originalValue)}return a},{remove:[],upsert:[],chgState:e.changeState});return e=this.adapter.removeMany(s,e),e=this.adapter.upsertMany(r,e),Object.assign(Object.assign({},e),{changeState:{}})}undoMany(e,t){if(null==e||0===e.length)return t;let s=!1;const{changeState:r,remove:a,upsert:c}=e.reduce((l,v)=>{let _=l.changeState;const C="object"==typeof v?this.selectId(v):v,U=_[C];if(U)switch(s||(_=Object.assign({},_),s=!0),delete _[C],l.changeState=_,U.changeType){case J.Added:l.remove.push(C);break;case J.Deleted:const G=U.originalValue;G&&l.upsert.push(G);break;case J.Updated:l.upsert.push(U.originalValue)}return l},{remove:[],upsert:[],changeState:t.changeState});return t=this.adapter.removeMany(a,t),t=this.adapter.upsertMany(c,t),s?Object.assign(Object.assign({},t),{changeState:r}):t}undoOne(e,t){return null==e?t:this.undoMany([e],t)}}class Me{constructor(e,t,s){this.entityName=e,this.definition=t,this.methods={[y.CANCEL_PERSIST]:this.cancelPersist.bind(this),[y.QUERY_ALL]:this.queryAll.bind(this),[y.QUERY_ALL_ERROR]:this.queryAllError.bind(this),[y.QUERY_ALL_SUCCESS]:this.queryAllSuccess.bind(this),[y.QUERY_BY_KEY]:this.queryByKey.bind(this),[y.QUERY_BY_KEY_ERROR]:this.queryByKeyError.bind(this),[y.QUERY_BY_KEY_SUCCESS]:this.queryByKeySuccess.bind(this),[y.QUERY_LOAD]:this.queryLoad.bind(this),[y.QUERY_LOAD_ERROR]:this.queryLoadError.bind(this),[y.QUERY_LOAD_SUCCESS]:this.queryLoadSuccess.bind(this),[y.QUERY_MANY]:this.queryMany.bind(this),[y.QUERY_MANY_ERROR]:this.queryManyError.bind(this),[y.QUERY_MANY_SUCCESS]:this.queryManySuccess.bind(this),[y.SAVE_ADD_MANY]:this.saveAddMany.bind(this),[y.SAVE_ADD_MANY_ERROR]:this.saveAddManyError.bind(this),[y.SAVE_ADD_MANY_SUCCESS]:this.saveAddManySuccess.bind(this),[y.SAVE_ADD_ONE]:this.saveAddOne.bind(this),[y.SAVE_ADD_ONE_ERROR]:this.saveAddOneError.bind(this),[y.SAVE_ADD_ONE_SUCCESS]:this.saveAddOneSuccess.bind(this),[y.SAVE_DELETE_MANY]:this.saveDeleteMany.bind(this),[y.SAVE_DELETE_MANY_ERROR]:this.saveDeleteManyError.bind(this),[y.SAVE_DELETE_MANY_SUCCESS]:this.saveDeleteManySuccess.bind(this),[y.SAVE_DELETE_ONE]:this.saveDeleteOne.bind(this),[y.SAVE_DELETE_ONE_ERROR]:this.saveDeleteOneError.bind(this),[y.SAVE_DELETE_ONE_SUCCESS]:this.saveDeleteOneSuccess.bind(this),[y.SAVE_UPDATE_MANY]:this.saveUpdateMany.bind(this),[y.SAVE_UPDATE_MANY_ERROR]:this.saveUpdateManyError.bind(this),[y.SAVE_UPDATE_MANY_SUCCESS]:this.saveUpdateManySuccess.bind(this),[y.SAVE_UPDATE_ONE]:this.saveUpdateOne.bind(this),[y.SAVE_UPDATE_ONE_ERROR]:this.saveUpdateOneError.bind(this),[y.SAVE_UPDATE_ONE_SUCCESS]:this.saveUpdateOneSuccess.bind(this),[y.SAVE_UPSERT_MANY]:this.saveUpsertMany.bind(this),[y.SAVE_UPSERT_MANY_ERROR]:this.saveUpsertManyError.bind(this),[y.SAVE_UPSERT_MANY_SUCCESS]:this.saveUpsertManySuccess.bind(this),[y.SAVE_UPSERT_ONE]:this.saveUpsertOne.bind(this),[y.SAVE_UPSERT_ONE_ERROR]:this.saveUpsertOneError.bind(this),[y.SAVE_UPSERT_ONE_SUCCESS]:this.saveUpsertOneSuccess.bind(this),[y.ADD_ALL]:this.addAll.bind(this),[y.ADD_MANY]:this.addMany.bind(this),[y.ADD_ONE]:this.addOne.bind(this),[y.REMOVE_ALL]:this.removeAll.bind(this),[y.REMOVE_MANY]:this.removeMany.bind(this),[y.REMOVE_ONE]:this.removeOne.bind(this),[y.UPDATE_MANY]:this.updateMany.bind(this),[y.UPDATE_ONE]:this.updateOne.bind(this),[y.UPSERT_MANY]:this.upsertMany.bind(this),[y.UPSERT_ONE]:this.upsertOne.bind(this),[y.COMMIT_ALL]:this.commitAll.bind(this),[y.COMMIT_MANY]:this.commitMany.bind(this),[y.COMMIT_ONE]:this.commitOne.bind(this),[y.UNDO_ALL]:this.undoAll.bind(this),[y.UNDO_MANY]:this.undoMany.bind(this),[y.UNDO_ONE]:this.undoOne.bind(this),[y.SET_CHANGE_STATE]:this.setChangeState.bind(this),[y.SET_COLLECTION]:this.setCollection.bind(this),[y.SET_FILTER]:this.setFilter.bind(this),[y.SET_LOADED]:this.setLoaded.bind(this),[y.SET_LOADING]:this.setLoading.bind(this)},this.adapter=t.entityAdapter,this.isChangeTracking=!0!==t.noChangeTracking,this.selectId=t.selectId,this.guard=new A(e,this.selectId),this.toUpdate=nt(this.selectId),this.entityChangeTracker=s||new Oe(this.adapter,this.selectId)}cancelPersist(e){return this.setLoadingFalse(e)}queryAll(e){return this.setLoadingTrue(e)}queryAllError(e,t){return this.setLoadingFalse(e)}queryAllSuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}queryByKey(e,t){return this.setLoadingTrue(e)}queryByKeyError(e,t){return this.setLoadingFalse(e)}queryByKeySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return e=null==s?e:this.entityChangeTracker.mergeQueryResults([s],e,r),this.setLoadingFalse(e)}queryLoad(e){return this.setLoadingTrue(e)}queryLoadError(e,t){return this.setLoadingFalse(e)}queryLoadSuccess(e,t){const s=this.extractData(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}queryMany(e,t){return this.setLoadingTrue(e)}queryManyError(e,t){return this.setLoadingFalse(e)}queryManySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}saveAddMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddMany(s,e,r),e=this.adapter.addMany(s,e)}return this.setLoadingTrue(e)}saveAddManyError(e,t){return this.setLoadingFalse(e)}saveAddManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.isOptimistic(t)?this.entityChangeTracker.mergeSaveUpserts(s,e,r):this.entityChangeTracker.mergeSaveAdds(s,e,r),this.setLoadingFalse(e)}saveAddOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddOne(s,e,r),e=this.adapter.addOne(s,e)}return this.setLoadingTrue(e)}saveAddOneError(e,t){return this.setLoadingFalse(e)}saveAddOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);if(this.isOptimistic(t)){const a=this.toUpdate(s);e=this.entityChangeTracker.mergeSaveUpdates([a],e,r,!1)}else e=this.entityChangeTracker.mergeSaveAdds([s],e,r);return this.setLoadingFalse(e)}saveDeleteOne(e,t){const s=this.extractData(t),r="object"==typeof s?this.selectId(s):s,a=e.changeState[r];if(a&&(a.changeType===J.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e)),this.isOptimistic(t)){const c=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteOne(r,e,c),e=this.adapter.removeOne(r,e)}return this.setLoadingTrue(e)}saveDeleteOneError(e,t){return this.setLoadingFalse(e)}saveDeleteOneSuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes([s],e,r)}else e=this.adapter.removeOne(s,e),e=this.entityChangeTracker.commitOne(s,e);return this.setLoadingFalse(e)}saveDeleteMany(e,t){const s=this.extractData(t).map(r=>"object"==typeof r?this.selectId(r):r);if(s.forEach(r=>{const a=e.changeState[r];a&&(a.changeType===J.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e))}),this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteMany(s,e,r),e=this.adapter.removeMany(s,e)}return this.setLoadingTrue(e)}saveDeleteManyError(e,t){return this.setLoadingFalse(e)}saveDeleteManySuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes(s,e,r)}else e=this.adapter.removeMany(s,e),e=this.entityChangeTracker.commitMany(s,e);return this.setLoadingFalse(e)}saveUpdateOne(e,t){const s=this.guard.mustBeUpdate(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateOne(s,e,r),e=this.adapter.updateOne(s,e)}return this.setLoadingTrue(e)}saveUpdateOneError(e,t){return this.setLoadingFalse(e)}saveUpdateOneSuccess(e,t){const s=this.guard.mustBeUpdateResponse(t),r=this.isOptimistic(t),a=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpdates([s],e,a,r),this.setLoadingFalse(e)}saveUpdateMany(e,t){const s=this.guard.mustBeUpdates(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateMany(s,e,r),e=this.adapter.updateMany(s,e)}return this.setLoadingTrue(e)}saveUpdateManyError(e,t){return this.setLoadingFalse(e)}saveUpdateManySuccess(e,t){const s=this.guard.mustBeUpdateResponses(t),a=(this.isOptimistic(t),this.extractMergeStrategy(t));return e=this.entityChangeTracker.mergeSaveUpdates(s,e,a,!1),this.setLoadingFalse(e)}saveUpsertOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertOne(s,e,r),e=this.adapter.upsertOne(s,e)}return this.setLoadingTrue(e)}saveUpsertOneError(e,t){return this.setLoadingFalse(e)}saveUpsertOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts([s],e,r),this.setLoadingFalse(e)}saveUpsertMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertMany(s,e,r),e=this.adapter.upsertMany(s,e)}return this.setLoadingTrue(e)}saveUpsertManyError(e,t){return this.setLoadingFalse(e)}saveUpsertManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts(s,e,r),this.setLoadingFalse(e)}addAll(e,t){const s=this.guard.mustBeEntities(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}addMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddMany(s,e,r),this.adapter.addMany(s,e)}addOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddOne(s,e,r),this.adapter.addOne(s,e)}removeMany(e,t){const s=this.guard.mustBeKeys(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteMany(s,e,r),this.adapter.removeMany(s,e)}removeOne(e,t){const s=this.guard.mustBeKey(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteOne(s,e,r),this.adapter.removeOne(s,e)}removeAll(e,t){return Object.assign(Object.assign({},this.adapter.removeAll(e)),{loaded:!1,loading:!1,changeState:{}})}updateMany(e,t){const s=this.guard.mustBeUpdates(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateMany(s,e,r),this.adapter.updateMany(s,e)}updateOne(e,t){const s=this.guard.mustBeUpdate(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateOne(s,e,r),this.adapter.updateOne(s,e)}upsertMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertMany(s,e,r),this.adapter.upsertMany(s,e)}upsertOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertOne(s,e,r),this.adapter.upsertOne(s,e)}commitAll(e){return this.entityChangeTracker.commitAll(e)}commitMany(e,t){return this.entityChangeTracker.commitMany(this.extractData(t),e)}commitOne(e,t){return this.entityChangeTracker.commitOne(this.extractData(t),e)}undoAll(e){return this.entityChangeTracker.undoAll(e)}undoMany(e,t){return this.entityChangeTracker.undoMany(this.extractData(t),e)}undoOne(e,t){return this.entityChangeTracker.undoOne(this.extractData(t),e)}setChangeState(e,t){const s=this.extractData(t);return e.changeState===s?e:Object.assign(Object.assign({},e),{changeState:s})}setCollection(e,t){const s=this.extractData(t);return e===s?e:s}setFilter(e,t){const s=this.extractData(t);return e.filter===s?e:Object.assign(Object.assign({},e),{filter:s})}setLoaded(e,t){const s=!0===this.extractData(t)||!1;return e.loaded===s?e:Object.assign(Object.assign({},e),{loaded:s})}setLoading(e,t){return this.setLoadingFlag(e,this.extractData(t))}setLoadingFalse(e){return this.setLoadingFlag(e,!1)}setLoadingTrue(e){return this.setLoadingFlag(e,!0)}setLoadingFlag(e,t){return e.loading===(t=!0===t)?e:Object.assign(Object.assign({},e),{loading:t})}extractData(e){return e.payload&&e.payload.data}extractMergeStrategy(e){return this.isChangeTracking?e.payload&&e.payload.mergeStrategy:W.IgnoreChanges}isOptimistic(e){return e.payload&&!0===e.payload.isOptimistic}}let Zt=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService.getDefinition(t);return new Me(t,s).methods}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(ct))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Jt=(()=>{class n{constructor(t){this.methodsFactory=t}create(t){const s=this.methodsFactory.create(t);return function(a,c){const l=s[c.payload.entityOp];return l?l(a,c):a}}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Zt))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Xt=(()=>{class n{constructor(t,s){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=o.qC.apply(null,s||[])}getOrCreateReducer(t){let s=this.entityCollectionReducers[t];return s||(s=this.entityCollectionReducerFactory.create(t),s=this.registerReducer(t,s),this.entityCollectionReducers[t]=s),s}registerReducer(t,s){return s=this.entityCollectionMetaReducer(s),this.entityCollectionReducers[t.trim()]=s}registerReducers(t){(t?Object.keys(t):[]).forEach(r=>this.registerReducer(r,t[r]))}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Jt),d.LFG(Dt,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),qt=(()=>{class n{constructor(t,s,r){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=s,this.logger=r}create(){return function t(s={},r){switch(r.type){case B.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(s,r);case B.LOAD_COLLECTIONS:return this.loadCollectionsReducer(s,r);case B.MERGE_QUERY_SET:return this.mergeQuerySetReducer(s,r);case B.SAVE_ENTITIES:return this.saveEntitiesReducer(s,r);case B.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(s,r);case B.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(s,r);case B.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(s,r);case B.SET_ENTITY_CACHE:return r.payload.cache}const a=r.payload;return a&&a.entityName&&a.entityOp&&!a.error?this.applyCollectionReducer(s,r):s}.bind(this)}clearCollectionsReducer(t,s){let{collections:r}=s.payload;const c=y.REMOVE_ALL;return r||(r=Object.keys(t)),r.reduce((l,v)=>this.applyCollectionReducer(l,{type:`[${v}] ${s.type}`,payload:{entityName:v,entityOp:c}}),t)}loadCollectionsReducer(t,s){const{collections:r}=s.payload,c=y.ADD_ALL;return Object.keys(r).reduce((v,_)=>this.applyCollectionReducer(v,{type:`[${_}] ${s.type}`,payload:{entityName:_,entityOp:c,data:r[_]}}),t)}mergeQuerySetReducer(t,s){let{mergeStrategy:r,querySet:a}=s.payload;r=null===r?W.PreserveChanges:r;const l=y.QUERY_MANY_SUCCESS;return Object.keys(a).reduce((_,C)=>this.applyCollectionReducer(_,{type:`[${C}] ${s.type}`,payload:{entityName:C,entityOp:l,data:a[C],mergeStrategy:r}}),t)}saveEntitiesReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:c,mergeStrategy:l,tag:v}=s.payload;try{r.changes.forEach(C=>{const U=C.entityName,G={entityName:U,entityOp:_(C),data:C.entities,correlationId:a,isOptimistic:c,mergeStrategy:l,tag:v},rt={type:`[${U}] ${s.type}`,payload:G};if(t=this.applyCollectionReducer(t,rt),rt.payload.error)throw rt.payload.error})}catch(C){s.payload.error=C}return t;function _(C){switch(C.op){case tt.Add:return y.SAVE_ADD_MANY;case tt.Delete:return y.SAVE_DELETE_MANY;case tt.Update:return y.SAVE_UPDATE_MANY;case tt.Upsert:return y.SAVE_UPSERT_MANY}}}saveEntitiesCancelReducer(t,s){return this.clearLoadingFlags(t,s.payload.entityNames||[])}saveEntitiesErrorReducer(t,s){const c=s.payload.originalAction.payload.changeSet.changes.map(l=>l.entityName);return this.clearLoadingFlags(t,c)}saveEntitiesSuccessReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:c,mergeStrategy:l,tag:v}=s.payload;return r.changes.forEach(C=>{const U=C.entityName,G={entityName:U,entityOp:_(C),data:C.entities,correlationId:a,isOptimistic:c,mergeStrategy:l,tag:v};t=this.applyCollectionReducer(t,{type:`[${U}] ${s.type}`,payload:G})}),t;function _(C){switch(C.op){case tt.Add:return y.SAVE_ADD_MANY_SUCCESS;case tt.Delete:return y.SAVE_DELETE_MANY_SUCCESS;case tt.Update:return y.SAVE_UPDATE_MANY_SUCCESS;case tt.Upsert:return y.SAVE_UPSERT_MANY_SUCCESS}}}applyCollectionReducer(t={},s){const r=s.payload.entityName,a=t[r],c=this.entityCollectionReducerRegistry.getOrCreateReducer(r);let l;try{l=c(a||this.entityCollectionCreator.create(r),s)}catch(v){this.logger.error(v),s.payload.error=v}return s.payload.error||a===l?t:Object.assign(Object.assign({},t),{[r]:l})}clearLoadingFlags(t,s){let r=!1;return s.forEach(a=>{const c=t[a];c.loading&&(r||(t=Object.assign({},t),r=!0),t[a]=Object.assign(Object.assign({},c),{loading:!1}))}),t}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(gt),d.LFG(Xt),d.LFG(lt))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),De=(()=>{class n{error(t,s){t&&(s?console.error(t,s):console.error(t))}log(t,s){t&&(s?console.log(t,s):console.log(t))}warn(t,s){t&&(s?console.warn(t,s):console.warn(t))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})();const Te=["equipment","information","money","series"];let be=(()=>{class n{constructor(t){this.pluralNames={},t&&t.forEach(s=>this.registerPluralNames(s))}pluralize(t){return this.pluralNames[t]||(Te.indexOf(t.toLowerCase())>=0?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substr(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")}registerPluralNames(t){this.pluralNames=Object.assign(Object.assign({},this.pluralNames),t||{})}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(mt,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),Re=(()=>{class n{constructor(t,s,r,a,c,l){this.reducerManager=t,this.injector=r,this.entityCacheName=a,this.initialState=c,this.metaReducers=l;const v=a||yt;c="function"==typeof c?c():c;const _=(l||[]).map(C=>C instanceof d.OlP?r.get(C):C);this.entityCacheFeature={key:v,reducers:s.create(),reducerFactory:o.UY,initialState:c||{},metaReducers:_},t.addFeature(this.entityCacheFeature)}static forRoot(t){return{ngModule:n,providers:[{provide:Mt,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Dt,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:mt,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}ngOnDestroy(){this.reducerManager.removeFeature(this.entityCacheFeature)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(o.PB),d.LFG(qt),d.LFG(d.zs3),d.LFG(Ot,8),d.LFG(Se,8),d.LFG(Mt,8))},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({providers:[At,Ct,f,Ee,qt,_e,gt,Jt,Zt,Xt,kt,Wt,ct,Tt,zt,bt,Ht,{provide:Ot,useValue:yt},{provide:Ce,useClass:Ae},{provide:lt,useClass:De}],imports:[[o.Aw]]}),n})(),Ue=(()=>{class n{constructor(t,s,r){this.effectSources=t,this.addEffects(s),this.addEffects(r)}static forRoot(t){return{ngModule:n,providers:[{provide:Ft,multi:!0,useValue:t.entityMetadata?t.entityMetadata:[]},{provide:Mt,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Dt,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:mt,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}addEffects(t){this.effectSources.addEffects(t)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(i.Ll),d.LFG(Gt),d.LFG(Kt))},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({providers:[It,Yt,jt,Gt,Kt,{provide:Nt,useClass:he},{provide:$t,useClass:ge},{provide:xt,useClass:be}],imports:[[Re,i.sQ]]}),n})()},12834:(at,H,u)=>{u.d(H,{H:()=>Q});var d=u(22051),p=u(60105),g=(()=>{return(M=g||(g={}))[M.EntitiesOnly=0]="EntitiesOnly",M[M.Both=1]="Both",M[M.None=2]="None",g;var M})();function b(M){return function(j,O){const m={ids:[...O.ids],entities:Object.assign({},O.entities)},I=M(j,m);return I===g.Both?Object.assign({},O,m):I===g.EntitiesOnly?Object.assign(Object.assign({},O),{entities:m.entities}):O}}function R(M,T){const j=T(M);return(0,p.X6Q)()&&void 0===j&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",M,"The `selectId` implementation:",T.toString()),j}function w(M){function T(k,E){const S=R(k,M);return S in E.entities?g.None:(E.ids.push(S),E.entities[S]=k,g.Both)}function j(k,E){let S=!1;for(const o of k)S=T(o,E)!==g.None||S;return S?g.Both:g.None}function m(k,E){const S=R(k,M);return S in E.entities?(E.entities[S]=k,g.EntitiesOnly):(E.ids.push(S),E.entities[S]=k,g.Both)}function K(k,E){const o=(k instanceof Array?k:E.ids.filter(i=>k(E.entities[i]))).filter(i=>i in E.entities).map(i=>delete E.entities[i]).length>0;return o&&(E.ids=E.ids.filter(i=>i in E.entities)),o?g.Both:g.None}function V(k,E){return Z([k],E)}function Z(k,E){const S={};return(k=k.filter(i=>i.id in E.entities)).length>0?k.filter(f=>function N(k,E,S){const i=Object.assign({},S.entities[E.id],E.changes),f=R(i,M),A=f!==E.id;return A&&(k[E.id]=f,delete S.entities[E.id]),S.entities[f]=i,A}(S,f,E)).length>0?(E.ids=E.ids.map(f=>S[f]||f),g.Both):g.EntitiesOnly:g.None}function st(k,E){const S=[],o=[];for(const A of k){const P=R(A,M);P in E.entities?o.push({id:P,changes:A}):S.push(A)}const i=Z(o,E),f=j(S,E);switch(!0){case f===g.None&&i===g.None:return g.None;case f===g.Both||i===g.Both:return g.Both;default:return g.EntitiesOnly}}return{removeAll:function D(k){return Object.assign({},k,{ids:[],entities:{}})},addOne:b(T),addMany:b(j),setAll:b(function O(k,E){return E.ids=[],E.entities={},j(k,E),g.Both}),setOne:b(m),setMany:b(function I(k,E){const S=k.map(o=>m(o,E));switch(!0){case S.some(o=>o===g.Both):return g.Both;case S.some(o=>o===g.EntitiesOnly):return g.EntitiesOnly;default:return g.None}}),updateOne:b(V),updateMany:b(Z),upsertOne:b(function it(k,E){return st([k],E)}),upsertMany:b(st),removeOne:b(function x(k,E){return K([k],E)}),removeMany:b(K),map:b(function q(k,E){return Z(E.ids.reduce((i,f)=>{const A=k(E.entities[f]);return A!==E.entities[f]&&i.push({id:f,changes:A}),i},[]).filter(({id:i})=>i in E.entities),E)}),mapOne:b(function et({map:k,id:E},S){const o=S.entities[E];return o?V({id:E,changes:k(o)},S):g.None})}}function Q(M={}){const{selectId:T,sortComparer:j}=Object.assign({sortComparer:!1,selectId:x=>x.id},M),O=function h(){return{getInitialState:function M(T={}){return Object.assign({ids:[],entities:{}},T)}}}(),m=function $(){return{getSelectors:function M(T){const j=x=>x.ids,O=x=>x.entities,m=(0,d.P1)(j,O,(x,K)=>x.map(D=>K[D])),I=(0,d.P1)(j,x=>x.length);return T?{selectIds:(0,d.P1)(T,j),selectEntities:(0,d.P1)(T,O),selectAll:(0,d.P1)(T,m),selectTotal:(0,d.P1)(T,I)}:{selectIds:j,selectEntities:O,selectAll:m,selectTotal:I}}}}(),I=j?function Y(M,T){const{removeOne:j,removeMany:O,removeAll:m}=w(M);function I(S,o){return x([S],o)}function x(S,o){const i=S.filter(f=>!(R(f,M)in o.entities));return 0===i.length?g.None:(E(i,o),g.Both)}function D(S,o){const i=R(S,M);return i in o.entities?(o.ids=o.ids.filter(f=>f!==i),E([S],o),g.Both):I(S,o)}function V(S,o){return q([S],o)}function q(S,o){const i=[],f=S.filter(A=>function Z(S,o,i){if(!(o.id in i.entities))return!1;const A=Object.assign({},i.entities[o.id],o.changes),P=R(A,M);return delete i.entities[o.id],S.push(A),P!==o.id}(i,A,o)).length>0;if(0===i.length)return g.None;{const A=o.ids,P=[];return o.ids=o.ids.filter((X,nt)=>X in o.entities||(P.push(nt),!1)),E(i,o),!f&&P.every(X=>o.ids[X]===A[X])?g.EntitiesOnly:g.Both}}function k(S,o){const i=[],f=[];for(const X of S){const nt=R(X,M);nt in o.entities?f.push({id:nt,changes:X}):i.push(X)}const A=q(f,o),P=x(i,o);switch(!0){case P===g.None&&A===g.None:return g.None;case P===g.Both||A===g.Both:return g.Both;default:return g.EntitiesOnly}}function E(S,o){S.sort(T);const i=[];let f=0,A=0;for(;f<S.length&&A<o.ids.length;){const P=S[f],X=R(P,M),nt=o.ids[A];T(P,o.entities[nt])<=0?(i.push(X),f++):(i.push(nt),A++)}o.ids=i.concat(f<S.length?S.slice(f).map(M):o.ids.slice(A)),S.forEach((P,X)=>{o.entities[M(P)]=P})}return{removeOne:j,removeMany:O,removeAll:m,addOne:b(I),updateOne:b(V),upsertOne:b(function st(S,o){return k([S],o)}),setAll:b(function K(S,o){return o.entities={},o.ids=[],x(S,o),g.Both}),setOne:b(D),setMany:b(function N(S,o){const i=S.map(f=>D(f,o));switch(!0){case i.some(f=>f===g.Both):return g.Both;case i.some(f=>f===g.EntitiesOnly):return g.EntitiesOnly;default:return g.None}}),addMany:b(x),updateMany:b(q),upsertMany:b(k),map:b(function et(S,o){return q(o.ids.reduce((f,A)=>{const P=S(o.entities[A]);return P!==o.entities[A]&&f.push({id:A,changes:P}),f},[]),o)}),mapOne:b(function it({map:S,id:o},i){const f=i.entities[o];return f?V({id:o,changes:S(f)},i):g.None})}}(T,j):w(T);return Object.assign(Object.assign(Object.assign({selectId:T,sortComparer:j},O),m),I)}}}]);