"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[70],{48070:(rt,J,h)=>{h.r(J),h.d(J,{SubtasksComponent:()=>j.b,TasksAppComponent:()=>w,TasksAppModule1:()=>b,TasksContainer:()=>G.W,TasksEngineComponent:()=>_.A,TasksEngineModule:()=>p.c,TasksEngineService:()=>V.u});var c=h(5311),_=h(78374);let w=(()=>{class P{constructor(){}ngOnInit(){}}return P.\u0275fac=function(k){return new(k||P)},P.\u0275cmp=c.Xpm({type:P,selectors:[["app-tasks-app"]],decls:1,vars:0,template:function(k,$){1&k&&c._UZ(0,"app-tasks-engine")},directives:[_.A],styles:[""]}),P})();var u=h(40789),N=h(98087),p=h(46389);const M=[{path:"",component:w}];let b=(()=>{class P{}return P.\u0275fac=function(k){return new(k||P)},P.\u0275mod=c.oAB({type:P}),P.\u0275inj=c.cJS({imports:[[u.ez,N.Bz.forChild(M),p.c.forRoot()]]}),P})();var V=h(60933),j=h(68735),G=h(95447)},68735:(rt,J,h)=>{h.d(J,{b:()=>Y});var c=h(80402),_=h(5311),u=(h(66544),h(23877)),N=h(46659),p=h(60933),M=h(60634),b=h(31298),V=h(40789),j=h(12916),G=h(2808),P=h(75457),D=h(99078),k=h(12257);function $(x,W){1&x&&_._UZ(0,"mat-progress-bar",4)}function O(x,W){if(1&x){const U=_.EpF();_.TgZ(0,"app-task",8),_.NdJ("remove",function(){const Z=_.CHM(U).$implicit;return _.oxw(2).onRemove(Z)})("isDone",function(F){const tt=_.CHM(U).$implicit;return _.oxw(2).onSave(F,tt)})("saveName",function(F){const tt=_.CHM(U).$implicit;return _.oxw(2).onSaveName(F,tt)}),_.qZA()}2&x&&_.Q6J("task",W.$implicit)("isSubtask",!0)("editable",!0)}function C(x,W){if(1&x){const U=_.EpF();_.YNc(0,O,1,3,"app-task",5),_.ALo(1,"async"),_.TgZ(2,"mat-form-field",6)(3,"input",7),_.NdJ("ngModelChange",function(F){return _.CHM(U),_.oxw().tempSubtask=F})("keypress",function(F){return _.CHM(U),_.oxw().onNewSubtask(F)},!1,_.Jf7),_.ALo(4,"async"),_.qZA()(),_._UZ(5,"br")}if(2&x){const U=_.oxw();_.Q6J("ngForOf",_.lcZ(1,3,U.subtasks$)),_.xp6(3),_.Q6J("disabled",_.lcZ(4,5,U.isAddingSubtask$))("ngModel",U.tempSubtask)}}let Y=(()=>{class x{constructor(U){this.engine=U,this.close=new _.vpe,this.removeTask=new _.vpe,this.removeSubtask=new _.vpe,this.newSubtask=new _.vpe,this.tasksLoaded=!1,this.isLoadingSubtasks$=this.engine.isProcessingSubtaskRequestSelector,this.isAddingSubtask$=this.engine.isProcessingSubtaskRequestSelector,this.subtasks$=this.engine.allSubtasks(this).pipe((0,u.U)(I=>this.taskId?I.filter(F=>F.taskId===this.taskId):[]),(0,N.b)(()=>{this.tasksLoaded=!0}))}ngOnChanges(U){this.taskId&&(this.tasksLoaded=!1,this.engine.fetchSubtaskAction(this.taskId))}onSaveName(U,I){this.engine.onSaveSubTaskAction({name:U},I)}onNewSubtask(U){this.engine.addSubTaskAction(U,this)}onRemove(U){var I=this;return(0,c.Z)(function*(){I.engine.removeSubTaskAction(U)})()}onSave(U,I){this.engine.onSaveSubTaskAction({isDone:U},I)}ngOnInit(){}}return x.\u0275fac=function(U){return new(U||x)(_.Y36(p.u))},x.\u0275cmp=_.Xpm({type:x,selectors:[["app-subtasks"]],inputs:{taskId:"taskId"},outputs:{close:"close",removeTask:"removeTask",removeSubtask:"removeSubtask",newSubtask:"newSubtask"},features:[_.TTD],decls:11,vars:4,consts:[["mat-icon-button","",3,"click"],["mat-icon-button","",1,"delete",3,"click"],["mode","indeterminate",4,"ngIf","ngIfElse"],["tasksList",""],["mode","indeterminate"],[3,"task","isSubtask","editable","remove","isDone","saveName",4,"ngFor","ngForOf"],[1,"new-subtask-input"],["matInput","","placeholder","+ Add new subtask..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isSubtask","editable","remove","isDone","saveName"]],template:function(U,I){if(1&U&&(_.TgZ(0,"button",0),_.NdJ("click",function(){return I.close.emit()}),_.TgZ(1,"mat-icon"),_._uU(2,"close"),_.qZA()(),_.TgZ(3,"button",1),_.NdJ("click",function(){return I.removeTask.emit(I.taskId)}),_.TgZ(4,"mat-icon"),_._uU(5," delete_forever "),_.qZA()(),_._UZ(6,"br"),_.YNc(7,$,1,0,"mat-progress-bar",2),_.ALo(8,"async"),_.YNc(9,C,6,7,"ng-template",null,3,_.W1O)),2&U){const F=_.MAs(10);_.xp6(7),_.Q6J("ngIf",!I.tasksLoaded&&_.lcZ(8,2,I.isLoadingSubtasks$))("ngIfElse",F)}},directives:[M.lW,b.Hw,V.O5,j.pW,V.sg,G.m,P.KE,D.Nt,k.Fj,k.JJ,k.On],pipes:[V.Ov],styles:["[_nghost-%COMP%]{width:400px;display:block;padding:5px}.new-subtask-input[_ngcontent-%COMP%]{width:100%}.delete[_ngcontent-%COMP%]{float:right}"]}),x})()},95447:(rt,J,h)=>{h.d(J,{W:()=>T});var c=h(80402),_=h(66544),w=h(60933),u=h(5311),N=h(18420),p=h(46044),M=h(40789),b=h(68735),V=h(67710),j=h(81553),G=h(60634),P=h(31298),D=h(38493);function k(g,E){1&g&&(u.TgZ(0,"button",3)(1,"mat-icon"),u._uU(2,"sync"),u.qZA()())}function $(g,E){1&g&&(u.TgZ(0,"button",4)(1,"mat-icon"),u._uU(2,"sync_problem"),u.qZA()())}function O(g,E){1&g&&(u.TgZ(0,"button",4),u._UZ(1,"mat-spinner",5),u.qZA()),2&g&&(u.xp6(1),u.Q6J("diameter",20))}function C(g,E){1&g&&(u.TgZ(0,"button",4)(1,"mat-icon"),u._uU(2,"done"),u.qZA()())}function Y(g,E){if(1&g&&(u.ynx(0),u.YNc(1,k,3,0,"button",1),u.YNc(2,$,3,0,"button",2),u.YNc(3,O,2,1,"button",2),u.YNc(4,C,3,0,"button",2),u.BQk()),2&g){const d=E.ngIf;u.xp6(1),u.Q6J("ngIf","idle"===d),u.xp6(1),u.Q6J("ngIf","sync-problem"===d),u.xp6(1),u.Q6J("ngIf","syncing"===d),u.xp6(1),u.Q6J("ngIf","syncing-done"===d)}}let x=(()=>{class g{constructor(d){this.engine=d,this.state$=this.engine.synchonizationSateSelector()}}return g.\u0275fac=function(d){return new(d||g)(u.Y36(w.u))},g.\u0275cmp=u.Xpm({type:g,selectors:[["app-synchonization"]],decls:2,vars:3,consts:[[4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer",4,"ngIf"],["mat-icon-button","","mat-raised-button","","class","sync-button pointer-blocked",4,"ngIf"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer"],["mat-icon-button","","mat-raised-button","",1,"sync-button","pointer-blocked"],[3,"diameter"]],template:function(d,i){1&d&&(u.YNc(0,Y,5,4,"ng-container",0),u.ALo(1,"async")),2&d&&u.Q6J("ngIf",u.lcZ(1,1,i.state$))},directives:[M.O5,G.lW,P.Hw,D.Ou],pipes:[M.Ov],styles:["[_nghost-%COMP%]{position:absolute;right:20px}.pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:pointer}.pointer-blocked[_ngcontent-%COMP%]{pointer-events:none;cursor:not-allowed}.pointer-blocked[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{cursor:not-allowed}.sync-button[_ngcontent-%COMP%]{z-index:999;float:right;opacity:.7}.sync-button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{left:10px}.sync-button[_ngcontent-%COMP%]:hover{opacity:1}  .mat-progress-spinner circle, .mat-spinner[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke:gray}"]}),g})();var W=h(75457),U=h(99078),I=h(12257),F=h(2808);const Z=["drawer"];function tt(g,E){if(1&g){const d=u.EpF();u.TgZ(0,"app-subtasks",9),u.NdJ("close",function(){return u.CHM(d),u.oxw().onCloseSubtaskMenu()})("removeTask",function(S){return u.CHM(d),u.oxw().onRemoveTask(S)}),u.qZA()}if(2&g){const d=u.oxw();u.Q6J("taskId",d.toogled.id)}}function st(g,E){if(1&g){const d=u.EpF();u.TgZ(0,"app-task",10),u.NdJ("isDone",function(S){const R=u.CHM(d).$implicit;return u.oxw().onSave(S,R)})("click",function(S){const R=u.CHM(d).$implicit;return u.oxw().toogle(S,R)})("focused",function(S){const R=u.CHM(d).$implicit;return u.oxw().focus(S,R)})("saveName",function(S){const R=u.CHM(d).$implicit;return u.oxw().onSaveName(S,R)}),u.qZA()}2&g&&u.Q6J("task",E.$implicit)}let T=(()=>{class g{constructor(d,i){this.engine=d,this.breakpointObserver=i,this.tasks$=this.engine.allTasksSelector(),this.title$=this.engine.title(),this.isAddingTasks$=this.engine.isProcessingTaskRequestSelector,this.focusFired=0}ngOnInit(){var d=this;return(0,c.Z)(function*(){d.engine.initAction()})()}onRemoveTask(d){var i;null===(i=this.drawer)||void 0===i||i.close(),this.engine.removeTaskAction(d)}onRemoveSubTask(d){this.engine.removeSubTaskAction(d)}onCloseSubtaskMenu(){var d;null===(d=this.drawer)||void 0===d||d.close()}ngAfterViewInit(){}add(d){this.engine.addTaskAction(d,this)}onSave(d,i){this.engine.onSaveTaskAction({isDone:d},i)}onSaveName(d,i){this.engine.onSaveTaskAction({name:d},i)}focus(){this.focusFired=2}toogle(d,i){setTimeout(()=>{this.focusFired>0?(this.focusFired--,d.stopImmediatePropagation(),d.stopPropagation(),0===this.focusFired&&this.tasks.find(m=>m.task.id===i.id).focusTriggered.next()):this.engine.toogleSubtasksAction(d,i,this)},200)}}return g.\u0275fac=function(d){return new(d||g)(u.Y36(w.u),u.Y36(N.Yg))},g.\u0275cmp=u.Xpm({type:g,selectors:[["app-tasks"]],viewQuery:function(d,i){if(1&d&&(u.Gf(Z,5),u.Gf(_.mk,5)),2&d){let S;u.iGM(S=u.CRH())&&(i.drawer=S.first),u.iGM(S=u.CRH())&&(i.tasks=S)}},decls:18,vars:14,consts:[[1,"container",3,"hasBackdrop"],["position","end",3,"mode"],["drawer",""],[3,"taskId","close","removeTask",4,"ngIf"],["grow","",1,"title"],[1,"background",3,"width"],[1,"new-task-input"],["matInput","","autocomplete","off","placeholder","+ Add new task..",3,"disabled","ngModel","ngModelChange","keypress"],[3,"task","isDone","click","focused","saveName",4,"ngFor","ngForOf"],[3,"taskId","close","removeTask"],[3,"task","isDone","click","focused","saveName"]],template:function(d,i){1&d&&(u.TgZ(0,"mat-drawer-container",0)(1,"mat-drawer",1,2),u.YNc(3,tt,1,1,"app-subtasks",3),u.qZA(),u.TgZ(4,"mat-drawer-content")(5,"mat-card")(6,"columns-container")(7,"column",4),u._uU(8),u.ALo(9,"async"),u.qZA(),u.TgZ(10,"column",5),u._UZ(11,"app-synchonization"),u.qZA()(),u.TgZ(12,"mat-form-field",6)(13,"input",7),u.NdJ("ngModelChange",function(m){return i.newTaskModel=m})("keypress",function(m){return i.add(m)},!1,u.Jf7),u.ALo(14,"async"),u.qZA()(),u._UZ(15,"br"),u.YNc(16,st,1,1,"app-task",8),u.ALo(17,"async"),u.qZA()()()),2&d&&(u.Q6J("hasBackdrop",!1),u.xp6(1),u.Q6J("mode","side"),u.xp6(2),u.Q6J("ngIf",i.toogled),u.xp6(5),u.hij(" ",u.lcZ(9,8,i.title$)," "),u.xp6(2),u.Q6J("width",60),u.xp6(3),u.Q6J("disabled",u.lcZ(14,10,i.isAddingTasks$))("ngModel",i.newTaskModel),u.xp6(3),u.Q6J("ngForOf",u.lcZ(17,12,i.tasks$)))},directives:[p.kh,p.jA,M.O5,b.b,p.LW,V.a8,j.a_,j.bg,j.iB,x,W.KE,U.Nt,I.Fj,I.JJ,I.On,M.sg,F.m],pipes:[M.Ov],styles:["[_nghost-%COMP%]{--max-container-size: 1200px;white-space:nowrap}.container[_ngcontent-%COMP%]{height:100%}.new-task-input[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{text-align:center;margin:0}.title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.background[_ngcontent-%COMP%]{background-color:#fff}"]}),g})()},78374:(rt,J,h)=>{h.d(J,{A:()=>b});var c=h(44777),_=h(21583),w=h(71773),u=h(60933),N=h(5311),p=h(25803),M=h(95447);let b=(()=>{class V{constructor(G,P,D){this.engine=G,this.store=P,this.actionListener$=D,this.destroy$=new c.x}ngOnDestroy(){this.destroy$.next(void 0),this.destroy$.unsubscribe()}ngOnInit(){this.message=this.engine.helloWorld(),this.activeteSynchonization()}activeteSynchonization(){this.actionListener$.pipe((0,_.T)(1),(0,w.R)(this.destroy$)).subscribe(G=>{})}}return V.\u0275fac=function(G){return new(G||V)(N.Y36(u.u),N.Y36(p.yh),N.Y36(p.UO))},V.\u0275cmp=N.Xpm({type:V,selectors:[["app-tasks-engine"]],decls:1,vars:0,template:function(G,P){1&G&&N._UZ(0,"app-tasks")},directives:[M.W],styles:[""]}),V})()},46389:(rt,J,h)=>{h.d(J,{c:()=>d});var c=h(40789),_=h(60933),w=h(82832),u=h(21868),N=h(12257),p=h(66544),M=h(91869),b=h(5311);let V=(()=>{class i{}return i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=b.oAB({type:i}),i.\u0275inj=b.cJS({imports:[[c.ez,p.qX,p.hd,N.u5]]}),i})();var j=h(25803),G=h(91086),P=h(59701),D=h(18620);const k={Task:{},SubTask:{}},$={entityHttpResourceUrls:{Task:p.iQ.URLS,SubTask:p.Mp.URLS},timeout:3e3};let O=(()=>{class i{}return i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=b.oAB({type:i}),i.\u0275inj=b.cJS({providers:[{provide:D.jh,useValue:$}],imports:[[D.ov.forRoot({entityMetadata:k})]]}),i})();const C=(0,j.PH)("[tasks] sync"),Y=(0,j.PH)("[tasks] sync idle"),x=(0,j.PH)("[tasks] sync success",(0,j.Ky)()),W=(0,j.PH)("[tasks] sync problem"),F=(0,j.Lq)({syncState:"idle"},(0,j.on)(C,i=>Object.assign(Object.assign({},i),{syncState:"syncing"})),(0,j.on)(Y,i=>Object.assign(Object.assign({},i),{syncState:"idle"})),(0,j.on)(x,i=>Object.assign(Object.assign({},i),{syncState:"syncing-done"})),(0,j.on)(W,i=>Object.assign(Object.assign({},i),{syncState:"sync-problem"})));var tt=h(23877);let st=(()=>{class i{constructor(m,R){this.actions$=m,this.engine=R,this.syncingDone=(0,G.GW)(()=>this.actions$.pipe((0,G.l4)(x),(0,tt.U)(()=>Y())))}}return i.\u0275fac=function(m){return new(m||i)(b.LFG(G.eX),b.LFG(_.u))},i.\u0275prov=b.Yz7({token:i,factory:i.\u0275fac}),i})();const Q=[function Z(i){return function(S,m){return i(S,m)}}];let X=(()=>{class i{}return i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=b.oAB({type:i}),i.\u0275inj=b.cJS({imports:[[j.Aw.forRoot({},{metaReducers:Q}),G.sQ.forRoot([st]),j.Aw.forFeature("appConfig",F),P.FT.instrument(),O]]}),i})(),T=(()=>{class i{}return i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=b.oAB({type:i}),i.\u0275inj=b.cJS({imports:[[c.ez,p.qX]]}),i})();var g=h(81553);let E=(()=>{class i{}return i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=b.oAB({type:i}),i.\u0275inj=b.cJS({imports:[[c.ez,N.u5,p.qX,g.m0,V,p.hd,M.JF,X,T]]}),i})(),d=(()=>{class i{static forRoot(m){return{ngModule:i,providers:[{provide:_.u,useClass:m&&m.customEngineService||_.u}]}}}return i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=b.oAB({type:i}),i.\u0275inj=b.cJS({providers:[w.x,u.C,_.u],imports:[[c.ez,E]]}),i})()},60933:(rt,J,h)=>{h.d(J,{u:()=>D});var c=h(80402),_=h(43208),w=h(52540),N=h(66544),p=h(14104),M=h(58784),b=h(23877),V=h(88313),j=h(82832),G=h(21868),P=h(5311);let D=(()=>{class k{constructor(O,C){this.subtasksService=O,this.tasksService=C}helloWorld(){return"Hello from ngrx/data application"}title(){return(0,p.of)('TASKS ("ngrx/data" application)')}allTasksSelector(){return this.tasksService.entities$}get isProcessingSubtaskRequestSelector(){return this.subtasksService.loading$}get isProcessingTaskRequestSelector(){return this.tasksService.loading$}allSubtasks(O){return this.subtasksService.entities$}synchonizationSateSelector(){return this.tasksService.loading$.pipe((0,M.M)(this.subtasksService.loading$),(0,b.U)(([O,C])=>O||C?"syncing":"idle"))}initAction(){var O=this;return(0,c.Z)(function*(){if(_.ZH.isWebSQL){const C=yield N.iQ.ctrl.getAll().received;O.tasksService.addManyToCache(C.body.json)}else O.tasksService.getAll()})()}fetchSubtaskAction(O){var C=this;return(0,c.Z)(function*(){if(_.ZH.isWebSQL){const Y=yield N.Mp.ctrl.getAll(O).received;C.subtasksService.clearCache(),C.subtasksService.addManyToCache(Y.body.json)}else C.subtasksService.getWithQuery({taskId:null==O?void 0:O.toString()})})()}addTaskAction(O,C){var Y=this;return(0,c.Z)(function*(){"Enter"===O.code&&C.newTaskModel&&(yield(0,V.z)(Y.tasksService.add(N.iQ.from({name:C.newTaskModel}))),C.newTaskModel="")})()}addSubTaskAction(O,C){if(O.stopImmediatePropagation(),O.stopPropagation(),"Enter"===O.code&&C.tempSubtask){const Y=N.Mp.from({name:C.tempSubtask,taskId:C.taskId}),x=w.cloneDeep(Y);this.subtasksService.add(x),C.tempSubtask=""}}removeTaskAction(O){this.tasksService.delete({id:O})}removeSubTaskAction(O){this.subtasksService.delete(w.cloneDeep(O))}onSaveTaskAction(O,C){C=w.cloneDeep(C),w.merge(C,O),this.tasksService.update(C)}onSaveSubTaskAction(O,C){C=w.cloneDeep(C),w.merge(C,O),this.subtasksService.update(C)}toogleSubtasksAction(O,C,Y){var x=this;Y.toogled=C,setTimeout((0,c.Z)(function*(){var W,U;(C=w.cloneDeep(C)).selected=!C.selected,x.tasksService.updateManyInCache((yield(0,V.z)(x.tasksService.entities$)).map(I=>((I=w.cloneDeep(I)).selected=!1,I))),C.selected?(x.tasksService.updateOneInCache(C),null===(W=Y.drawer)||void 0===W||W.open()):null===(U=Y.drawer)||void 0===U||U.close(),O.stopPropagation()}))}}return k.\u0275fac=function(O){return new(O||k)(P.LFG(j.x),P.LFG(G.C))},k.\u0275prov=P.Yz7({token:k,factory:k.\u0275fac}),k})()},82832:(rt,J,h)=>{h.d(J,{x:()=>N});var c=h(66544),_=h(18620),w=h(46547),u=h(5311);let N=(()=>{class p extends _.c8{constructor(b){super(w._i.getName(c.Mp),b)}}return p.\u0275fac=function(b){return new(b||p)(u.LFG(_.yV))},p.\u0275prov=u.Yz7({token:p,factory:p.\u0275fac}),p})()},21868:(rt,J,h)=>{h.d(J,{C:()=>N});var c=h(18620),_=h(46547),w=h(66544),u=h(5311);let N=(()=>{class p extends c.c8{constructor(b){super(_._i.getName(w.iQ),b)}}return p.\u0275fac=function(b){return new(b||p)(u.LFG(c.yV))},p.\u0275prov=u.Yz7({token:p,factory:p.\u0275fac}),p})()},18620:(rt,J,h)=>{h.d(J,{jh:()=>St,c8:()=>Vt,yV:()=>bt,ov:()=>Te});var c=h(5311),_=h(20754),w=h(72291);function u(n,e,t){let s,r=!1;return n&&"object"==typeof n?({bufferSize:s=1/0,windowTime:e=1/0,refCount:r=!1,scheduler:t}=n):s=null!=n?n:1/0,(0,w.B)({connector:()=>new _.t(s,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}var N=h(89364),p=h(23877),M=h(91404),b=h(99258),V=h(90545),j=h(72156),G=h(64614),P=h(58784),D=h(26595),k=h(91869),$=h(37818),O=h(20219);const{isArray:C}=Array;var x=h(1600);function W(...n){return 1===(n=function Y(n){return 1===n.length&&C(n[0])?n[0]:n}(n)).length?(0,O.Xf)(n[0]):new $.y(function U(n){return e=>{let t=[];for(let s=0;t&&!e.closed&&s<n.length;s++)t.push((0,O.Xf)(n[s]).subscribe((0,x.x)(e,r=>{if(t){for(let a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(r)})))}}(n))}var I=h(66718),F=h(14104),Z=h(57171),tt=h(32755),st=h(24120),Q=h(25803),X=h(91086);let T=(()=>{class n{create(t,s,r,a){const o="string"==typeof t?Object.assign(Object.assign({},a||{}),{entityName:t,entityOp:s,data:r}):t;return this.createCore(o)}createCore(t){const{entityName:s,entityOp:r,tag:a}=t;if(!s)throw new Error("Missing entity name for new action");if(null==r)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(r,a||s),payload:t}}createFromAction(t,s){return this.create(Object.assign(Object.assign({},t.payload),s))}formatActionType(t,s){return`[${s}] ${t}`}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class g{constructor(e,t){this.entityName=e,this.selectId=t}mustBeEntity(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should have a single entity.");const s=this.selectId(t);return this.isNotKeyType(s)&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeEntities(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const a=this.selectId(s);this.isNotKeyType(a)&&this.throwError(e,`, item ${r+1}, does not have a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entities")}mustBeKey(e){const t=this.extractData(e);if(!t)throw new Error("should be a single entity key");if(this.isNotKeyType(t))throw new Error("is not a valid key (id)");return t}mustBeKeys(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{this.isNotKeyType(s)&&this.throwError(e,`${this.entityName} ', item ${r+1}, is not a valid entity key (id)`)}),t):this.throwError(e,"should be an array of entity keys (id)")}mustBeUpdate(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdates(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:o}=s,l=this.selectId(o);(this.isNotKeyType(a)||this.isNotKeyType(l))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}mustBeUpdateResponse(e){const t=this.extractData(e);if(!t)return this.throwError(e,"should be a single entity update");const{id:s,changes:r}=t,a=this.selectId(r);return(this.isNotKeyType(s)||this.isNotKeyType(a))&&this.throwError(e,"has a missing or invalid entity key (id)"),t}mustBeUpdateResponses(e){const t=this.extractData(e);return Array.isArray(t)?(t.forEach((s,r)=>{const{id:a,changes:o}=s,l=this.selectId(o);(this.isNotKeyType(a)||this.isNotKeyType(l))&&this.throwError(e,`, item ${r+1}, has a missing or invalid entity key (id)`)}),t):this.throwError(e,"should be an array of entity updates")}extractData(e){return e.payload&&e.payload.data}isNotKeyType(e){return"string"!=typeof e&&"number"!=typeof e}throwError(e,t){throw new Error(`${this.entityName} EntityAction guard for "${e.type}": payload ${t}`)}}function E(n){return null==n?void 0:n.id}function d(n){if(null==n)return[];if(Array.isArray(n[0])){const[e,...t]=n;n=[...e,...t]}return n}function i(n){return n=n||E,function(t){const s=n(t);if(null==s)throw new Error("Primary key may not be null/undefined.");return t&&{id:s,changes:t}}}function S(...n){const e=d(n);switch(e.length){case 0:return(0,N.h)(s=>s.payload&&null!=s.payload.entityOp);case 1:const t=e[0];return(0,N.h)(s=>s.payload&&t===s.payload.entityOp);default:return(0,N.h)(s=>{const r=s.payload&&s.payload.entityOp;return r&&e.some(a=>a===r)})}}function m(...n){const e=d(n);switch(e.length){case 0:return(0,N.h)(s=>s.payload&&null!=s.payload.entityName);case 1:const t=e[0];return(0,N.h)(s=>s.payload&&t===s.payload.entityName);default:return(0,N.h)(s=>{const r=s.payload&&s.payload.entityName;return!!r&&e.some(a=>a===r)})}}var R=(()=>{return(n=R||(R={})).Add="Add",n.Delete="Delete",n.Update="Update",n.Upsert="Upsert",R;var n})();function ut(n){const e=(n=n&&n.changes?n:{changes:[]}).changes.filter(t=>null!=t&&t.entities&&t.entities.length>0);return Object.assign(Object.assign({},n),{changes:e})}new class et{add(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:R.Add,entities:t}}delete(e,t){const s=Array.isArray(t)?t:t?[t]:[];return{entityName:e,op:R.Delete,entities:s}}update(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:R.Update,entities:t}}upsert(e,t){return t=Array.isArray(t)?t:t?[t]:[],{entityName:e,op:R.Upsert,entities:t}}};var H=(()=>{return(n=H||(H={}))[n.IgnoreChanges=0]="IgnoreChanges",n[n.PreserveChanges=1]="PreserveChanges",n[n.OverwriteChanges=2]="OverwriteChanges",H;var n})(),B=(()=>{return(n=B||(B={})).CLEAR_COLLECTIONS="@ngrx/data/entity-cache/clear-collections",n.LOAD_COLLECTIONS="@ngrx/data/entity-cache/load-collections",n.MERGE_QUERY_SET="@ngrx/data/entity-cache/merge-query-set",n.SET_ENTITY_CACHE="@ngrx/data/entity-cache/set-cache",n.SAVE_ENTITIES="@ngrx/data/entity-cache/save-entities",n.SAVE_ENTITIES_CANCEL="@ngrx/data/entity-cache/save-entities-cancel",n.SAVE_ENTITIES_CANCELED="@ngrx/data/entity-cache/save-entities-canceled",n.SAVE_ENTITIES_ERROR="@ngrx/data/entity-cache/save-entities-error",n.SAVE_ENTITIES_SUCCESS="@ngrx/data/entity-cache/save-entities-success",B;var n})();class Jt{constructor(e,t){this.type=B.CLEAR_COLLECTIONS,this.payload={collections:e,tag:t}}}class Xt{constructor(e,t){this.type=B.LOAD_COLLECTIONS,this.payload={collections:e,tag:t}}}class qt{constructor(e,t,s){this.type=B.MERGE_QUERY_SET,this.payload={querySet:e,mergeStrategy:null===t?H.PreserveChanges:t,tag:s}}}class te{constructor(e,t){this.cache=e,this.type=B.SET_ENTITY_CACHE,this.payload={cache:e,tag:t}}}class ee{constructor(e,t,s){this.type=B.SAVE_ENTITIES,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}class se{constructor(e,t,s,r){this.type=B.SAVE_ENTITIES_CANCEL,this.payload={correlationId:e,reason:t,entityNames:s,tag:r}}}class ne{constructor(e,t,s){this.type=B.SAVE_ENTITIES_CANCELED,this.payload={correlationId:e,reason:t,tag:s}}}class re{constructor(e,t){this.type=B.SAVE_ENTITIES_ERROR,this.payload={error:e,originalAction:t,correlationId:t.payload.correlationId}}}class Et{constructor(e,t,s){this.type=B.SAVE_ENTITIES_SUCCESS,s=s||{},e&&(e.tag=e.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:e,url:t},s),{tag:e.tag})}}var y=(()=>{return(n=y||(y={})).CANCEL_PERSIST="@ngrx/data/cancel-persist",n.CANCELED_PERSIST="@ngrx/data/canceled-persist",n.QUERY_ALL="@ngrx/data/query-all",n.QUERY_ALL_SUCCESS="@ngrx/data/query-all/success",n.QUERY_ALL_ERROR="@ngrx/data/query-all/error",n.QUERY_LOAD="@ngrx/data/query-load",n.QUERY_LOAD_SUCCESS="@ngrx/data/query-load/success",n.QUERY_LOAD_ERROR="@ngrx/data/query-load/error",n.QUERY_MANY="@ngrx/data/query-many",n.QUERY_MANY_SUCCESS="@ngrx/data/query-many/success",n.QUERY_MANY_ERROR="@ngrx/data/query-many/error",n.QUERY_BY_KEY="@ngrx/data/query-by-key",n.QUERY_BY_KEY_SUCCESS="@ngrx/data/query-by-key/success",n.QUERY_BY_KEY_ERROR="@ngrx/data/query-by-key/error",n.SAVE_ADD_MANY="@ngrx/data/save/add-many",n.SAVE_ADD_MANY_ERROR="@ngrx/data/save/add-many/error",n.SAVE_ADD_MANY_SUCCESS="@ngrx/data/save/add-many/success",n.SAVE_ADD_ONE="@ngrx/data/save/add-one",n.SAVE_ADD_ONE_ERROR="@ngrx/data/save/add-one/error",n.SAVE_ADD_ONE_SUCCESS="@ngrx/data/save/add-one/success",n.SAVE_DELETE_MANY="@ngrx/data/save/delete-many",n.SAVE_DELETE_MANY_SUCCESS="@ngrx/data/save/delete-many/success",n.SAVE_DELETE_MANY_ERROR="@ngrx/data/save/delete-many/error",n.SAVE_DELETE_ONE="@ngrx/data/save/delete-one",n.SAVE_DELETE_ONE_SUCCESS="@ngrx/data/save/delete-one/success",n.SAVE_DELETE_ONE_ERROR="@ngrx/data/save/delete-one/error",n.SAVE_UPDATE_MANY="@ngrx/data/save/update-many",n.SAVE_UPDATE_MANY_SUCCESS="@ngrx/data/save/update-many/success",n.SAVE_UPDATE_MANY_ERROR="@ngrx/data/save/update-many/error",n.SAVE_UPDATE_ONE="@ngrx/data/save/update-one",n.SAVE_UPDATE_ONE_SUCCESS="@ngrx/data/save/update-one/success",n.SAVE_UPDATE_ONE_ERROR="@ngrx/data/save/update-one/error",n.SAVE_UPSERT_MANY="@ngrx/data/save/upsert-many",n.SAVE_UPSERT_MANY_SUCCESS="@ngrx/data/save/upsert-many/success",n.SAVE_UPSERT_MANY_ERROR="@ngrx/data/save/upsert-many/error",n.SAVE_UPSERT_ONE="@ngrx/data/save/upsert-one",n.SAVE_UPSERT_ONE_SUCCESS="@ngrx/data/save/upsert-one/success",n.SAVE_UPSERT_ONE_ERROR="@ngrx/data/save/upsert-one/error",n.ADD_ALL="@ngrx/data/add-all",n.ADD_MANY="@ngrx/data/add-many",n.ADD_ONE="@ngrx/data/add-one",n.REMOVE_ALL="@ngrx/data/remove-all",n.REMOVE_MANY="@ngrx/data/remove-many",n.REMOVE_ONE="@ngrx/data/remove-one",n.UPDATE_MANY="@ngrx/data/update-many",n.UPDATE_ONE="@ngrx/data/update-one",n.UPSERT_MANY="@ngrx/data/upsert-many",n.UPSERT_ONE="@ngrx/data/upsert-one",n.COMMIT_ALL="@ngrx/data/commit-all",n.COMMIT_MANY="@ngrx/data/commit-many",n.COMMIT_ONE="@ngrx/data/commit-one",n.UNDO_ALL="@ngrx/data/undo-all",n.UNDO_MANY="@ngrx/data/undo-many",n.UNDO_ONE="@ngrx/data/undo-one",n.SET_CHANGE_STATE="@ngrx/data/set-change-state",n.SET_COLLECTION="@ngrx/data/set-collection",n.SET_FILTER="@ngrx/data/set-filter",n.SET_LOADED="@ngrx/data/set-loaded",n.SET_LOADING="@ngrx/data/set-loading",y;var n})();const ft="/success",_t="/error";function kt(n){return n+ft}class it{constructor(e,t){this.error=e,this.requestData=t,this.message="string"==typeof e?e:function ie(n){const{error:e,body:t,message:s}=n;let r=null;return e?r="string"==typeof e?e:e.message:s?r=s:t&&(r="string"==typeof t?t:t.error),"string"==typeof r?r:r?JSON.stringify(r):null}(e)}}class St{}class ht{}const vt=new c.OlP("@ngrx/data Plural Names");class Rt{}class Ut{}let oe=(()=>{class n{constructor(t){this.pluralizer=t,this.knownHttpResourceUrls={}}getResourceUrls(t,s){let r=this.knownHttpResourceUrls[t];if(!r){const a=function ce(n){return n.replace(/^[/\s]+|[/\s]+$/g,"")}(s);r={entityResourceUrl:`${a}/${t}/`.toLowerCase(),collectionResourceUrl:`${a}/${this.pluralizer.pluralize(t)}/`.toLowerCase()},this.registerHttpResourceUrls({[t]:r})}return r}entityResource(t,s){return this.getResourceUrls(t,s).entityResourceUrl}collectionResource(t,s){return this.getResourceUrls(t,s).collectionResourceUrl}registerHttpResourceUrls(t){this.knownHttpResourceUrls=Object.assign(Object.assign({},this.knownHttpResourceUrls),t||{})}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Rt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class de{constructor(e,t,s,r){this.http=t,this.httpUrlGenerator=s,this.getDelay=0,this.saveDelay=0,this.timeout=0,this._name=`${e} DefaultDataService`,this.entityName=e;const{root:a="api",delete404OK:o=!0,getDelay:l=0,saveDelay:v=0,timeout:f=0}=r||{};this.delete404OK=o,this.entityUrl=s.entityResource(e,a),this.entitiesUrl=s.collectionResource(e,a),this.getDelay=l,this.saveDelay=v,this.timeout=f}get name(){return this._name}add(e){const t=e||new Error(`No "${this.entityName}" entity to add`);return this.execute("POST",this.entityUrl,t)}delete(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to delete`)),this.execute("DELETE",this.entityUrl+e,t).pipe((0,p.U)(s=>e))}getAll(){return this.execute("GET",this.entitiesUrl)}getById(e){let t;return null==e&&(t=new Error(`No "${this.entityName}" key to get`)),this.execute("GET",this.entityUrl+e,t)}getWithQuery(e){const s=new k.LE("string"==typeof e?{fromString:e}:{fromObject:e});return this.execute("GET",this.entitiesUrl,void 0,{params:s})}update(e){const t=e&&e.id,s=null==t?new Error(`No "${this.entityName}" update data or id`):e.changes;return this.execute("PUT",this.entityUrl+t,s)}upsert(e){const t=e||new Error(`No "${this.entityName}" entity to upsert`);return this.execute("POST",this.entityUrl,t)}execute(e,t,s,r){const a={method:e,url:t,data:s,options:r};if(s instanceof Error)return this.handleError(a)(s);let o;switch(e){case"DELETE":o=this.http.delete(t,r),this.saveDelay&&(o=o.pipe((0,M.g)(this.saveDelay)));break;case"GET":o=this.http.get(t,r),this.getDelay&&(o=o.pipe((0,M.g)(this.getDelay)));break;case"POST":o=this.http.post(t,s,r),this.saveDelay&&(o=o.pipe((0,M.g)(this.saveDelay)));break;case"PUT":o=this.http.put(t,s,r),this.saveDelay&&(o=o.pipe((0,M.g)(this.saveDelay)));break;default:{const l=new Error("Unimplemented HTTP method, "+e);o=(0,I._)(l)}}return this.timeout&&(o=o.pipe((0,b.V)(this.timeout+this.saveDelay))),o.pipe((0,V.K)(this.handleError(a)))}handleError(e){return t=>{const s=this.handleDelete404(t,e);if(s)return s;const r=new it(t,e);return(0,I._)(r)}}handleDelete404(e,t){if(404===e.status&&"DELETE"===t.method&&this.delete404OK)return(0,F.of)({})}}let Lt=(()=>{class n{constructor(t,s,r){this.http=t,this.httpUrlGenerator=s,this.config=r,s.registerHttpResourceUrls((r=r||{}).entityHttpResourceUrls)}create(t){return new de(t,this.http,this.httpUrlGenerator,this.config)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(k.eN),c.LFG(Ut),c.LFG(St,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const xt=new c.OlP("@ngrx/data Entity Metadata");let ot=(()=>{class n{constructor(t){this.definitions={},t&&t.forEach(s=>this.registerMetadataMap(s))}getDefinition(t,s=!0){t=t.trim();const r=this.definitions[t];if(!r&&s)throw new Error(`No EntityDefinition for entity type "${t}".`);return r}registerMetadata(t){if(t){const s=function ue(n){let e=n.entityName;if(!e)throw new Error("Missing required entityName");n.entityName=e=e.trim();const t=n.selectId||E,s=n.sortComparer=n.sortComparer||!1,r=(0,st.H)({selectId:t,sortComparer:s}),a=n.entityDispatcherOptions||{},o=r.getInitialState(Object.assign({entityName:e,filter:"",loaded:!1,loading:!1,changeState:{}},n.additionalCollectionState||{}));return{entityName:e,entityAdapter:r,entityDispatcherOptions:a,initialState:o,metadata:n,noChangeTracking:!0===n.noChangeTracking,selectId:t,sortComparer:s}}(t);this.registerDefinition(s)}}registerMetadataMap(t={}){Object.keys(t||{}).forEach(s=>this.registerMetadata(Object.assign({entityName:s},t[s])))}registerDefinition(t){this.definitions[t.entityName]=t}registerDefinitions(t){Object.assign(this.definitions,t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(xt,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const Nt=R.Update;let It=(()=>{class n{constructor(t,s,r){this.entityDefinitionService=t,this.http=s,this.idSelectors={},this.saveDelay=0,this.timeout=0;const{saveDelay:a=0,timeout:o=0}=r||{};this.saveDelay=a,this.timeout=o}saveEntities(t,s){t=this.filterChangeSet(t),t=this.flattenUpdates(t);let r=this.http.post(s,t).pipe((0,p.U)(a=>this.restoreUpdates(a)),(0,V.K)(this.handleError({method:"POST",url:s,data:t})));return this.timeout&&(r=r.pipe((0,b.V)(this.timeout))),this.saveDelay&&(r=r.pipe((0,M.g)(this.saveDelay))),r}handleError(t){return s=>{const r=new it(s,t);return(0,I._)(r)}}filterChangeSet(t){return ut(t)}flattenUpdates(t){let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>a.op===Nt&&a.entities.length>0?(r=!0,Object.assign(Object.assign({},a),{entities:a.entities.map(o=>o.changes)})):a),r?Object.assign(Object.assign({},t),{changes:s}):t}restoreUpdates(t){if(null==t)return t;let s=t.changes;if(0===s.length)return t;let r=!1;return s=s.map(a=>{if(a.op===Nt){r=!0;const o=this.getIdSelector(a.entityName);return Object.assign(Object.assign({},a),{entities:a.entities.map(l=>({id:o(l),changes:l}))})}return a}),r?Object.assign(Object.assign({},t),{changes:s}):t}getIdSelector(t){let s=this.idSelectors[t];return s||(s=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=s),s}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(ot),c.LFG(k.eN),c.LFG(St,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Ft=(()=>{class n{constructor(t){this.defaultDataServiceFactory=t,this.services={}}getService(t){t=t.trim();let s=this.services[t];return s||(s=this.defaultDataServiceFactory.create(t),this.services[t]=s),s}registerService(t,s){this.services[t.trim()]=s}registerServices(t){this.services=Object.assign(Object.assign({},this.services),t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Lt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class Pt{}let he=(()=>{class n{constructor(t,s){this.logger=t,this.entityActionFactory=s}handleSuccess(t){const s=kt(t.payload.entityOp);return r=>this.entityActionFactory.createFromAction(t,{entityOp:s,data:r})}handleError(t){const s=function ae(n){return n+_t}(t.payload.entityOp);return r=>{const o={error:r instanceof it?r:new it(r,null),originalAction:t};return this.logger.error(o),this.entityActionFactory.createFromAction(t,{entityOp:s,data:o})}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(ht),c.LFG(T))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class Yt{constructor(e){this.message=e,this.message=e||"Canceled by user"}}let mt=(()=>{class n{constructor(){this.seed=0,this.prefix="CRID"}next(){return this.seed+=1,this.prefix+this.seed}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),At=(()=>{class n{constructor(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),le=(()=>{class n{constructor(t,s,r,a){this.correlationIdGenerator=t,this.defaultDispatcherOptions=s,this.store=a,this.reducedActions$=r.pipe(u(1)),this.raSubscription=this.reducedActions$.subscribe()}dispatch(t){return this.store.dispatch(t),t}cancelSaveEntities(t,s,r,a){if(!t)throw new Error("Missing correlationId");const o=new se(t,s,r,a);this.dispatch(o)}clearCollections(t,s){this.dispatch(new Jt(t,s))}loadCollections(t,s){this.dispatch(new Xt(t,s))}mergeQuerySet(t,s,r){this.dispatch(new qt(t,s,r))}setEntityCache(t,s){this.dispatch(new te(t,s))}saveEntities(t,s,r){const a=Array.isArray(t)?{changes:t}:t,o=null==(r=r||{}).correlationId?this.correlationIdGenerator.next():r.correlationId,l=null==r.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===r.isOptimistic,v=r.tag||"Save Entities";r=Object.assign(Object.assign({},r),{correlationId:o,isOptimistic:l,tag:v});const f=new ee(a,s,r);return this.dispatch(f),this.getSaveEntitiesResponseData$(r.correlationId).pipe(u(1))}getSaveEntitiesResponseData$(t){return this.reducedActions$.pipe((0,N.h)(s=>s.type===B.SAVE_ENTITIES_SUCCESS||s.type===B.SAVE_ENTITIES_ERROR||s.type===B.SAVE_ENTITIES_CANCEL),(0,N.h)(s=>t===s.payload.correlationId),(0,j.q)(1),(0,G.z)(s=>s.type===B.SAVE_ENTITIES_CANCEL?(0,I._)(new Yt(s.payload.reason)):s.type===B.SAVE_ENTITIES_SUCCESS?(0,F.of)(s.payload.changeSet):(0,I._)(s.payload)))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(mt),c.LFG(At),c.LFG(Q.Y$),c.LFG(Q.yh))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class ye{constructor(e,t,s,r=E,a,o,l,v){this.entityName=e,this.entityActionFactory=t,this.store=s,this.selectId=r,this.defaultDispatcherOptions=a,this.reducedActions$=o,this.correlationIdGenerator=v,this.guard=new g(e,r),this.toUpdate=i(r);const f=(0,Q.P1)(l,A=>A[e]);this.entityCollection$=s.select(f)}createEntityAction(e,t,s){return this.entityActionFactory.create(Object.assign({entityName:this.entityName,entityOp:e,data:t},s))}createAndDispatch(e,t,s){const r=this.createEntityAction(e,t,s);return this.dispatch(r),r}dispatch(e){return this.store.dispatch(e),e}add(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticAdd);const s=this.createEntityAction(y.SAVE_ADD_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,p.U)(([r,a])=>a.entities[this.selectId(r)]),u(1))}cancel(e,t,s){if(!e)throw new Error("Missing correlationId");this.createAndDispatch(y.CANCEL_PERSIST,t,{correlationId:e})}delete(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticDelete);const s=this.getKey(e),r=this.createEntityAction(y.SAVE_DELETE_ONE,s,t);return this.guard.mustBeKey(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,p.U)(()=>s),u(1))}getAll(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(y.QUERY_ALL,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe((0,P.M)(this.entityCollection$),(0,p.U)(([s,r])=>s.reduce((a,o)=>{const l=r.entities[this.selectId(o)];return l&&a.push(l),a},[])),u(1))}getByKey(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(y.QUERY_BY_KEY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,p.U)(([r,a])=>a.entities[this.selectId(r)]),u(1))}getWithQuery(e,t){t=this.setQueryEntityActionOptions(t);const s=this.createEntityAction(y.QUERY_MANY,e,t);return this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,p.U)(([r,a])=>r.reduce((o,l)=>{const v=a.entities[this.selectId(l)];return v&&o.push(v),o},[])),u(1))}load(e){e=this.setQueryEntityActionOptions(e);const t=this.createEntityAction(y.QUERY_LOAD,null,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(u(1))}update(e,t){const s=this.toUpdate(e);t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpdate);const r=this.createEntityAction(y.SAVE_UPDATE_ONE,s,t);return t.isOptimistic&&this.guard.mustBeUpdate(r),this.dispatch(r),this.getResponseData$(t.correlationId).pipe((0,p.U)(a=>a.changes),(0,P.M)(this.entityCollection$),(0,p.U)(([a,o])=>o.entities[this.selectId(a)]),u(1))}upsert(e,t){t=this.setSaveEntityActionOptions(t,this.defaultDispatcherOptions.optimisticUpsert);const s=this.createEntityAction(y.SAVE_UPSERT_ONE,e,t);return t.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(t.correlationId).pipe((0,P.M)(this.entityCollection$),(0,p.U)(([r,a])=>a.entities[this.selectId(r)]),u(1))}addAllToCache(e,t){this.createAndDispatch(y.ADD_ALL,e,t)}addOneToCache(e,t){this.createAndDispatch(y.ADD_ONE,e,t)}addManyToCache(e,t){this.createAndDispatch(y.ADD_MANY,e,t)}clearCache(e){this.createAndDispatch(y.REMOVE_ALL,void 0,e)}removeOneFromCache(e,t){this.createAndDispatch(y.REMOVE_ONE,this.getKey(e),t)}removeManyFromCache(e,t){if(!e||0===e.length)return;const s="object"==typeof e[0]?e.map(r=>this.getKey(r)):e;this.createAndDispatch(y.REMOVE_MANY,s,t)}updateOneInCache(e,t){const s=this.toUpdate(e);this.createAndDispatch(y.UPDATE_ONE,s,t)}updateManyInCache(e,t){if(!e||0===e.length)return;const s=e.map(r=>this.toUpdate(r));this.createAndDispatch(y.UPDATE_MANY,s,t)}upsertOneInCache(e,t){this.createAndDispatch(y.UPSERT_ONE,e,t)}upsertManyInCache(e,t){!e||0===e.length||this.createAndDispatch(y.UPSERT_MANY,e,t)}setFilter(e){this.createAndDispatch(y.SET_FILTER,e)}setLoaded(e){this.createAndDispatch(y.SET_LOADED,!!e)}setLoading(e){this.createAndDispatch(y.SET_LOADING,!!e)}getKey(e){return"object"==typeof e?this.selectId(e):e}getResponseData$(e){return this.reducedActions$.pipe((0,N.h)(t=>!!t.payload),(0,N.h)(t=>{const{correlationId:s,entityName:r,entityOp:a}=t.payload;return r===this.entityName&&s===e&&(a.endsWith(ft)||a.endsWith(_t)||a===y.CANCEL_PERSIST)}),(0,j.q)(1),(0,G.z)(t=>{const{entityOp:s}=t.payload;return s===y.CANCEL_PERSIST?(0,I._)(new Yt(t.payload.data)):s.endsWith(ft)?(0,F.of)(t.payload.data):(0,I._)(t.payload.data.error)}))}setQueryEntityActionOptions(e){const t=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId;return Object.assign(Object.assign({},e),{correlationId:t})}setSaveEntityActionOptions(e,t){const s=null==(e=e||{}).correlationId?this.correlationIdGenerator.next():e.correlationId,r=null==e.isOptimistic?t||!1:!0===e.isOptimistic;return Object.assign(Object.assign({},e),{correlationId:s,isOptimistic:r})}}const lt="entityCache",Ct=new c.OlP("@ngrx/data Entity Cache Name"),Ot=new c.OlP("@ngrx/data Entity Cache Meta Reducers"),Mt=new c.OlP("@ngrx/data Entity Collection Meta Reducers"),pe=new c.OlP("@ngrx/data Initial Entity Cache State"),yt=new c.OlP("@ngrx/data Entity Cache Selector"),ge={provide:yt,useFactory:jt,deps:[[new c.FiY,Ct]]};function jt(n){return(0,Q.ZF)(n=n||lt)}let Dt=(()=>{class n{constructor(t,s,r,a,o,l){this.entityActionFactory=t,this.store=s,this.entityDispatcherDefaultOptions=r,this.entityCacheSelector=o,this.correlationIdGenerator=l,this.reducedActions$=a.pipe(u(1)),this.raSubscription=this.reducedActions$.subscribe()}create(t,s=E,r={}){const a=Object.assign(Object.assign({},this.entityDispatcherDefaultOptions),r);return new ye(t,this.entityActionFactory,this.store,s,a,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)}ngOnDestroy(){this.raSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(T),c.LFG(Q.yh),c.LFG(At),c.LFG(Q.Y$),c.LFG(yt),c.LFG(mt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const $t=new c.OlP("@ngrx/data Entity Effects Scheduler");let wt=(()=>{class n{constructor(t,s,r,a,o){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.logger=a,this.scheduler=o,this.responseDelay=10,this.saveEntitiesCancel$=(0,X.GW)(()=>this.actions.pipe((0,X.l4)(B.SAVE_ENTITIES_CANCEL),(0,N.h)(l=>null!=l.payload.correlationId)),{dispatch:!1}),this.saveEntities$=(0,X.GW)(()=>this.actions.pipe((0,X.l4)(B.SAVE_ENTITIES),(0,G.z)(l=>this.saveEntities(l))))}saveEntities(t){const s=t.payload.error;if(s)return this.handleSaveEntitiesError$(t)(s);try{const r=ut(t.payload.changeSet),{correlationId:a,mergeStrategy:o,tag:l,url:v}=t.payload,f={correlationId:a,mergeStrategy:o,tag:l};if(0===r.changes.length)return(0,F.of)(new Et(r,v,f));return W(this.saveEntitiesCancel$.pipe((0,N.h)(K=>a===K.payload.correlationId),(0,p.U)(K=>new ne(a,K.payload.reason,K.payload.tag))),this.dataService.saveEntities(r,v).pipe((0,D.b)(K=>this.handleSaveEntitiesSuccess$(t,this.entityActionFactory)(K)),(0,V.K)(this.handleSaveEntitiesError$(t))))}catch(r){return this.handleSaveEntitiesError$(t)(r)}}handleSaveEntitiesError$(t){return s=>{const r=s instanceof it?s:new it(s,null);return(0,F.of)(new re(r,t)).pipe((0,M.g)(this.responseDelay,this.scheduler||Z.z))}}handleSaveEntitiesSuccess$(t,s){const{url:r,correlationId:a,mergeStrategy:o,tag:l}=t.payload,v={correlationId:a,mergeStrategy:o,tag:l};return f=>{if(f)return(0,F.of)(new Et(f,r,v));if(f=t.payload.changeSet,!t.payload.isOptimistic)return(0,F.of)(new Et(f,r,v));const A=f.changes.reduce((L,K)=>-1===L.indexOf(K.entityName)?L.concat(K.entityName):L,[]);return(0,tt.T)(A.map(L=>s.create(L,y.SET_LOADING,!1)))}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(X.eX),c.LFG(It),c.LFG(T),c.LFG(ht),c.LFG($t,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const Ee=[y.QUERY_ALL,y.QUERY_LOAD,y.QUERY_BY_KEY,y.QUERY_MANY,y.SAVE_ADD_ONE,y.SAVE_DELETE_ONE,y.SAVE_UPDATE_ONE,y.SAVE_UPSERT_ONE];let Bt=(()=>{class n{constructor(t,s,r,a,o){this.actions=t,this.dataService=s,this.entityActionFactory=r,this.resultHandler=a,this.scheduler=o,this.responseDelay=10,this.cancel$=(0,X.GW)(()=>this.actions.pipe(S(y.CANCEL_PERSIST),(0,p.U)(l=>l.payload.correlationId),(0,N.h)(l=>null!=l)),{dispatch:!1}),this.persist$=(0,X.GW)(()=>this.actions.pipe(S(Ee),(0,G.z)(l=>this.persist(l))))}persist(t){if(t.payload.skip)return this.handleSkipSuccess$(t);if(t.payload.error)return this.handleError$(t)(t.payload.error);try{return W(this.cancel$.pipe((0,N.h)(a=>t.payload.correlationId===a),(0,p.U)(a=>this.entityActionFactory.createFromAction(t,{entityOp:y.CANCELED_PERSIST}))),this.callDataService(t).pipe((0,p.U)(this.resultHandler.handleSuccess(t)),(0,V.K)(this.handleError$(t))))}catch(s){return this.handleError$(t)(s)}}callDataService(t){const{entityName:s,entityOp:r,data:a}=t.payload,o=this.dataService.getService(s);switch(r){case y.QUERY_ALL:case y.QUERY_LOAD:return o.getAll();case y.QUERY_BY_KEY:return o.getById(a);case y.QUERY_MANY:return o.getWithQuery(a);case y.SAVE_ADD_ONE:return o.add(a);case y.SAVE_DELETE_ONE:return o.delete(a);case y.SAVE_UPDATE_ONE:const{id:l,changes:v}=a;return o.update(a).pipe((0,p.U)(f=>f&&Object.keys(f).length>0?{id:l,changes:Object.assign(Object.assign({},v),f),changed:!0}:{id:l,changes:v,changed:!1}));case y.SAVE_UPSERT_ONE:return o.upsert(a).pipe((0,p.U)(f=>f&&Object.keys(f).length>0?f:a));default:throw new Error(`Persistence action "${r}" is not implemented.`)}}handleError$(t){return s=>(0,F.of)(this.resultHandler.handleError(t)(s)).pipe((0,M.g)(this.responseDelay,this.scheduler||Z.z))}handleSkipSuccess$(t){const s=kt(t.payload.entityOp),r=this.entityActionFactory.createFromAction(t,{entityOp:s});return(0,F.of)(r).pipe((0,M.g)(this.responseDelay,this.scheduler||Z.z))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(X.eX),c.LFG(Ft),c.LFG(T),c.LFG(Pt),c.LFG($t,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class Vt{constructor(e,t){this.entityName=e,e=e.trim();const{dispatcher:s,selectors:r,selectors$:a}=t.create(e);this.entityName=e,this.dispatcher=s,this.guard=s.guard,this.selectId=s.selectId,this.toUpdate=s.toUpdate,this.selectors=r,this.selectors$=a,this.collection$=a.collection$,this.count$=a.count$,this.entities$=a.entities$,this.entityActions$=a.entityActions$,this.entityMap$=a.entityMap$,this.errors$=a.errors$,this.filter$=a.filter$,this.filteredEntities$=a.filteredEntities$,this.keys$=a.keys$,this.loaded$=a.loaded$,this.loading$=a.loading$,this.changeState$=a.changeState$}createEntityAction(e,t,s){return this.dispatcher.createEntityAction(e,t,s)}createAndDispatch(e,t,s){return this.dispatcher.createAndDispatch(e,t,s)}dispatch(e){return this.dispatcher.dispatch(e)}get store(){return this.dispatcher.store}add(e,t){return this.dispatcher.add(e,t)}cancel(e,t,s){this.dispatcher.cancel(e,t,s)}delete(e,t){return this.dispatcher.delete(e,t)}getAll(e){return this.dispatcher.getAll(e)}getByKey(e,t){return this.dispatcher.getByKey(e,t)}getWithQuery(e,t){return this.dispatcher.getWithQuery(e,t)}load(e){return this.dispatcher.load(e)}update(e,t){return this.dispatcher.update(e,t)}upsert(e,t){return this.dispatcher.upsert(e,t)}addAllToCache(e,t){this.dispatcher.addAllToCache(e,t)}addOneToCache(e,t){this.dispatcher.addOneToCache(e,t)}addManyToCache(e,t){this.dispatcher.addManyToCache(e,t)}clearCache(){this.dispatcher.clearCache()}removeOneFromCache(e,t){this.dispatcher.removeOneFromCache(e,t)}removeManyFromCache(e,t){this.dispatcher.removeManyFromCache(e,t)}updateOneInCache(e,t){this.dispatcher.updateOneInCache(e,t)}updateManyInCache(e,t){this.dispatcher.updateManyInCache(e,t)}upsertOneInCache(e,t){this.dispatcher.upsertOneInCache(e,t)}upsertManyInCache(e,t){this.dispatcher.upsertManyInCache(e,t)}setFilter(e){this.dispatcher.setFilter(e)}setLoaded(e){this.dispatcher.setLoaded(!!e)}setLoading(e){this.dispatcher.setLoading(!!e)}}let pt=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return s&&s.initialState||function fe(n){return{entityName:n,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}(t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(ot,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Gt=(()=>{class n{constructor(t,s){this.entityCollectionCreator=t||new pt,this.selectEntityCache=s||jt(lt)}createCollectionSelector(t){return(0,Q.P1)(this.selectEntityCache,(r={})=>r[t]||this.entityCollectionCreator.create(t))}createCollectionSelectors(t){const s="string"==typeof t?{entityName:t}:t,r=z=>z.ids,a=z=>z.entities,o=(0,Q.P1)(r,a,(z,dt)=>z.map(be=>dt[be])),l=(0,Q.P1)(r,z=>z.length),v=z=>z.filter,f=s.filterFn,A=f?(0,Q.P1)(o,v,(z,dt)=>f(z,dt)):o,ct={};return Object.keys(s.additionalCollectionState||{}).forEach(z=>{ct["select"+z[0].toUpperCase()+z.slice(1)]=dt=>dt[z]}),Object.assign({selectCount:l,selectEntities:o,selectEntityMap:a,selectFilter:v,selectFilteredEntities:A,selectKeys:r,selectLoaded:z=>z.loaded,selectLoading:z=>z.loading,selectChangeState:z=>z.changeState},ct)}create(t){const s="string"==typeof t?{entityName:t}:t,r=s.entityName,a=this.createCollectionSelector(r),o=this.createCollectionSelectors(s),l={};return Object.keys(o).forEach(v=>{l[v]=(0,Q.P1)(a,o[v])}),Object.assign({entityName:r,selectCollection:a,selectEntityCache:this.selectEntityCache},l)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(pt,8),c.LFG(yt,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Tt=(()=>{class n{constructor(t,s,r){this.store=t,this.actions=s,this.selectEntityCache=r,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=s.pipe((0,N.h)(a=>a.payload&&a.payload.entityOp&&a.payload.entityOp.endsWith(_t)),u(1))}create(t,s){const r={entityName:t};return Object.keys(s).forEach(a=>{if(a.startsWith("select")){const o=a[6].toLowerCase()+a.substr(7)+"$";r[o]=this.store.select(s[a])}}),r.entityActions$=this.actions.pipe(m(t)),r.errors$=this.entityActionErrors$.pipe(m(t)),r}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Q.yh),c.LFG(X.eX),c.LFG(yt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),bt=(()=>{class n{constructor(t,s,r,a){this.entityDispatcherFactory=t,this.entityDefinitionService=s,this.entitySelectorsFactory=r,this.entitySelectors$Factory=a}create(t){t=t.trim();const s=this.entityDefinitionService.getDefinition(t),r=this.entityDispatcherFactory.create(t,s.selectId,s.entityDispatcherOptions),a=this.entitySelectorsFactory.create(s.metadata);return{dispatcher:r,entityName:t,selectors:a,selectors$:this.entitySelectors$Factory.create(t,a)}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Dt),c.LFG(ot),c.LFG(Gt),c.LFG(Tt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Kt=(()=>{class n{constructor(t){this.entityCollectionServiceElementsFactory=t}create(t){return new Vt(t,this.entityCollectionServiceElementsFactory)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(bt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Qt=(()=>{class n{constructor(t,s,r,a){this.entityCollectionServiceFactory=t,this.store=a,this.entityActionErrors$=r.entityActionErrors$,this.entityCache$=r.entityCache$,this.reducedActions$=s.reducedActions$}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Kt),c.LFG(Dt),c.LFG(Tt),c.LFG(Q.yh))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),_e=(()=>{class n{constructor(t){this.entityServicesElements=t,this.EntityCollectionServices={}}get entityActionErrors$(){return this.entityServicesElements.entityActionErrors$}get entityCache$(){return this.entityServicesElements.entityCache$}get entityCollectionServiceFactory(){return this.entityServicesElements.entityCollectionServiceFactory}get reducedActions$(){return this.entityServicesElements.reducedActions$}get store(){return this.entityServicesElements.store}dispatch(t){this.store.dispatch(t)}createEntityCollectionService(t){return this.entityCollectionServiceFactory.create(t)}getEntityCollectionService(t){let s=this.EntityCollectionServices[t];return s||(s=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=s),s}registerEntityCollectionService(t,s){this.EntityCollectionServices[s||t.entityName]=t}registerEntityCollectionServices(t){Array.isArray(t)?t.forEach(s=>this.registerEntityCollectionService(s)):Object.keys(t||{}).forEach(s=>{this.registerEntityCollectionService(t[s],s)})}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Qt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class Se{}var q=(()=>{return(n=q||(q={}))[n.Unchanged=0]="Unchanged",n[n.Added=1]="Added",n[n.Deleted=2]="Deleted",n[n.Updated=3]="Updated",q;var n})();class ve{constructor(e,t){this.adapter=e,this.selectId=t,this.selectId=t||E}commitAll(e){return 0===Object.keys(e.changeState).length?e:Object.assign(Object.assign({},e),{changeState:{}})}commitMany(e,t){if(null==e||0===e.length)return t;let s=!1;const r=e.reduce((a,o)=>{const l="object"==typeof o?this.selectId(o):o;return a[l]&&(s||(a=Object.assign({},a),s=!0),delete a[l]),a},t.changeState);return s?Object.assign(Object.assign({},t),{changeState:r}):t}commitOne(e,t){return null==e?t:this.commitMany([e],t)}mergeQueryResults(e,t,s){return this.mergeServerUpserts(e,t,H.PreserveChanges,s)}mergeSaveAdds(e,t,s){return this.mergeServerUpserts(e,t,H.OverwriteChanges,s)}mergeSaveDeletes(e,t,s){const r=e;return t=(s=null==s?H.OverwriteChanges:s)===H.IgnoreChanges?t:this.commitMany(r,t),this.adapter.removeMany(r,t)}mergeSaveUpdates(e,t,s,r=!1){if(null==e||0===e.length)return t;let l,a=!1,o=t.changeState;switch(s=null==s?H.OverwriteChanges:s){case H.IgnoreChanges:return l=v(e),this.adapter.updateMany(l,t);case H.OverwriteChanges:return o=e.reduce((f,A)=>{const L=A.id;return f[L]&&(a||(f=Object.assign({},f),a=!0),delete f[L]),f},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:o}):t,l=v(e),this.adapter.updateMany(l,t);case H.PreserveChanges:{const f=[];return o=e.reduce((A,L)=>{const K=L.id,nt=A[K];if(nt){a||(A=Object.assign({},A),a=!0);const gt=this.selectId(L.changes),ct=nt;gt!==K&&delete A[K];const z=Object.assign(Object.assign({},ct.originalValue),L.changes);A[gt]=Object.assign(Object.assign({},ct),{originalValue:z})}else f.push(L);return A},t.changeState),t=a?Object.assign(Object.assign({},t),{changeState:o}):t,l=v(f),this.adapter.updateMany(l,t)}}function v(f){return!0===r&&(f=f.filter(A=>!0===A.changed)),f.map(A=>({id:A.id,changes:A.changes}))}}mergeSaveUpserts(e,t,s){return this.mergeServerUpserts(e,t,H.OverwriteChanges,s)}mergeServerUpserts(e,t,s,r){if(null==e||0===e.length)return t;let a=!1,o=t.changeState;switch(r=null==r?s:r){case H.IgnoreChanges:return this.adapter.upsertMany(e,t);case H.OverwriteChanges:return t=this.adapter.upsertMany(e,t),o=e.reduce((l,v)=>{const f=this.selectId(v);return l[f]&&(a||(l=Object.assign({},l),a=!0),delete l[f]),l},t.changeState),a?Object.assign(Object.assign({},t),{changeState:o}):t;case H.PreserveChanges:{const l=[];return o=e.reduce((v,f)=>{const A=this.selectId(f);return v[A]?a||(v=Object.assign(Object.assign({},v),{[A]:Object.assign(Object.assign({},v[A]),{originalValue:f})}),a=!0):l.push(f),v},t.changeState),t=this.adapter.upsertMany(l,t),a?Object.assign(Object.assign({},t),{changeState:o}):t}}}trackAddMany(e,t,s){if(s===H.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=e.reduce((o,l)=>{const v=this.selectId(l);if(null==v||""===v)throw new Error(`${t.entityName} entity add requires a key to be tracked`);return o[v]||(r||(r=!0,o=Object.assign({},o)),o[v]={changeType:q.Added}),o},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:a}):t}trackAddOne(e,t,s){return null==e?t:this.trackAddMany([e],t,s)}trackDeleteMany(e,t,s){if(s===H.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((l,v)=>{const f=a[v];if(f){const L=l[v];L?L.changeType===q.Added?(A(),delete l[v]):L.changeType===q.Updated&&(A(),l[v]=Object.assign(Object.assign({},l[v]),{changeType:q.Deleted})):(A(),l[v]={changeType:q.Deleted,originalValue:f})}return l;function A(){r||(r=!0,l=Object.assign({},l))}},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackDeleteOne(e,t,s){return null==e?t:this.trackDeleteMany([e],t,s)}trackUpdateMany(e,t,s){if(s===H.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((l,v)=>{const{id:f}=v;if(null==f||""===f)throw new Error(`${t.entityName} entity update requires a key to be tracked`);const L=a[f];return L&&(l[f]||(r||(r=!0,l=Object.assign({},l)),l[f]={changeType:q.Updated,originalValue:L})),l},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackUpdateOne(e,t,s){return null==e?t:this.trackUpdateMany([e],t,s)}trackUpsertMany(e,t,s){if(s===H.IgnoreChanges||null==e||0===e.length)return t;let r=!1;const a=t.entities,o=e.reduce((l,v)=>{const f=this.selectId(v);if(null==f||""===f)throw new Error(`${t.entityName} entity upsert requires a key to be tracked`);if(!l[f]){r||(r=!0,l=Object.assign({},l));const L=a[f];l[f]=null==L?{changeType:q.Added}:{changeType:q.Updated,originalValue:L}}return l},t.changeState);return r?Object.assign(Object.assign({},t),{changeState:o}):t}trackUpsertOne(e,t,s){return null==e?t:this.trackUpsertMany([e],t,s)}undoAll(e){const t=Object.keys(e.changeState),{remove:s,upsert:r}=t.reduce((a,o)=>{const l=a.chgState[o];switch(l.changeType){case q.Added:a.remove.push(o);break;case q.Deleted:const v=l.originalValue;v&&a.upsert.push(v);break;case q.Updated:a.upsert.push(l.originalValue)}return a},{remove:[],upsert:[],chgState:e.changeState});return e=this.adapter.removeMany(s,e),e=this.adapter.upsertMany(r,e),Object.assign(Object.assign({},e),{changeState:{}})}undoMany(e,t){if(null==e||0===e.length)return t;let s=!1;const{changeState:r,remove:a,upsert:o}=e.reduce((l,v)=>{let f=l.changeState;const A="object"==typeof v?this.selectId(v):v,L=f[A];if(L)switch(s||(f=Object.assign({},f),s=!0),delete f[A],l.changeState=f,L.changeType){case q.Added:l.remove.push(A);break;case q.Deleted:const K=L.originalValue;K&&l.upsert.push(K);break;case q.Updated:l.upsert.push(L.originalValue)}return l},{remove:[],upsert:[],changeState:t.changeState});return t=this.adapter.removeMany(a,t),t=this.adapter.upsertMany(o,t),s?Object.assign(Object.assign({},t),{changeState:r}):t}undoOne(e,t){return null==e?t:this.undoMany([e],t)}}class me{constructor(e,t,s){this.entityName=e,this.definition=t,this.methods={[y.CANCEL_PERSIST]:this.cancelPersist.bind(this),[y.QUERY_ALL]:this.queryAll.bind(this),[y.QUERY_ALL_ERROR]:this.queryAllError.bind(this),[y.QUERY_ALL_SUCCESS]:this.queryAllSuccess.bind(this),[y.QUERY_BY_KEY]:this.queryByKey.bind(this),[y.QUERY_BY_KEY_ERROR]:this.queryByKeyError.bind(this),[y.QUERY_BY_KEY_SUCCESS]:this.queryByKeySuccess.bind(this),[y.QUERY_LOAD]:this.queryLoad.bind(this),[y.QUERY_LOAD_ERROR]:this.queryLoadError.bind(this),[y.QUERY_LOAD_SUCCESS]:this.queryLoadSuccess.bind(this),[y.QUERY_MANY]:this.queryMany.bind(this),[y.QUERY_MANY_ERROR]:this.queryManyError.bind(this),[y.QUERY_MANY_SUCCESS]:this.queryManySuccess.bind(this),[y.SAVE_ADD_MANY]:this.saveAddMany.bind(this),[y.SAVE_ADD_MANY_ERROR]:this.saveAddManyError.bind(this),[y.SAVE_ADD_MANY_SUCCESS]:this.saveAddManySuccess.bind(this),[y.SAVE_ADD_ONE]:this.saveAddOne.bind(this),[y.SAVE_ADD_ONE_ERROR]:this.saveAddOneError.bind(this),[y.SAVE_ADD_ONE_SUCCESS]:this.saveAddOneSuccess.bind(this),[y.SAVE_DELETE_MANY]:this.saveDeleteMany.bind(this),[y.SAVE_DELETE_MANY_ERROR]:this.saveDeleteManyError.bind(this),[y.SAVE_DELETE_MANY_SUCCESS]:this.saveDeleteManySuccess.bind(this),[y.SAVE_DELETE_ONE]:this.saveDeleteOne.bind(this),[y.SAVE_DELETE_ONE_ERROR]:this.saveDeleteOneError.bind(this),[y.SAVE_DELETE_ONE_SUCCESS]:this.saveDeleteOneSuccess.bind(this),[y.SAVE_UPDATE_MANY]:this.saveUpdateMany.bind(this),[y.SAVE_UPDATE_MANY_ERROR]:this.saveUpdateManyError.bind(this),[y.SAVE_UPDATE_MANY_SUCCESS]:this.saveUpdateManySuccess.bind(this),[y.SAVE_UPDATE_ONE]:this.saveUpdateOne.bind(this),[y.SAVE_UPDATE_ONE_ERROR]:this.saveUpdateOneError.bind(this),[y.SAVE_UPDATE_ONE_SUCCESS]:this.saveUpdateOneSuccess.bind(this),[y.SAVE_UPSERT_MANY]:this.saveUpsertMany.bind(this),[y.SAVE_UPSERT_MANY_ERROR]:this.saveUpsertManyError.bind(this),[y.SAVE_UPSERT_MANY_SUCCESS]:this.saveUpsertManySuccess.bind(this),[y.SAVE_UPSERT_ONE]:this.saveUpsertOne.bind(this),[y.SAVE_UPSERT_ONE_ERROR]:this.saveUpsertOneError.bind(this),[y.SAVE_UPSERT_ONE_SUCCESS]:this.saveUpsertOneSuccess.bind(this),[y.ADD_ALL]:this.addAll.bind(this),[y.ADD_MANY]:this.addMany.bind(this),[y.ADD_ONE]:this.addOne.bind(this),[y.REMOVE_ALL]:this.removeAll.bind(this),[y.REMOVE_MANY]:this.removeMany.bind(this),[y.REMOVE_ONE]:this.removeOne.bind(this),[y.UPDATE_MANY]:this.updateMany.bind(this),[y.UPDATE_ONE]:this.updateOne.bind(this),[y.UPSERT_MANY]:this.upsertMany.bind(this),[y.UPSERT_ONE]:this.upsertOne.bind(this),[y.COMMIT_ALL]:this.commitAll.bind(this),[y.COMMIT_MANY]:this.commitMany.bind(this),[y.COMMIT_ONE]:this.commitOne.bind(this),[y.UNDO_ALL]:this.undoAll.bind(this),[y.UNDO_MANY]:this.undoMany.bind(this),[y.UNDO_ONE]:this.undoOne.bind(this),[y.SET_CHANGE_STATE]:this.setChangeState.bind(this),[y.SET_COLLECTION]:this.setCollection.bind(this),[y.SET_FILTER]:this.setFilter.bind(this),[y.SET_LOADED]:this.setLoaded.bind(this),[y.SET_LOADING]:this.setLoading.bind(this)},this.adapter=t.entityAdapter,this.isChangeTracking=!0!==t.noChangeTracking,this.selectId=t.selectId,this.guard=new g(e,this.selectId),this.toUpdate=i(this.selectId),this.entityChangeTracker=s||new ve(this.adapter,this.selectId)}cancelPersist(e){return this.setLoadingFalse(e)}queryAll(e){return this.setLoadingTrue(e)}queryAllError(e,t){return this.setLoadingFalse(e)}queryAllSuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}queryByKey(e,t){return this.setLoadingTrue(e)}queryByKeyError(e,t){return this.setLoadingFalse(e)}queryByKeySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return e=null==s?e:this.entityChangeTracker.mergeQueryResults([s],e,r),this.setLoadingFalse(e)}queryLoad(e){return this.setLoadingTrue(e)}queryLoadError(e,t){return this.setLoadingFalse(e)}queryLoadSuccess(e,t){const s=this.extractData(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}queryMany(e,t){return this.setLoadingTrue(e)}queryManyError(e,t){return this.setLoadingFalse(e)}queryManySuccess(e,t){const s=this.extractData(t),r=this.extractMergeStrategy(t);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,e,r)),{loaded:!0,loading:!1})}saveAddMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddMany(s,e,r),e=this.adapter.addMany(s,e)}return this.setLoadingTrue(e)}saveAddManyError(e,t){return this.setLoadingFalse(e)}saveAddManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.isOptimistic(t)?this.entityChangeTracker.mergeSaveUpserts(s,e,r):this.entityChangeTracker.mergeSaveAdds(s,e,r),this.setLoadingFalse(e)}saveAddOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackAddOne(s,e,r),e=this.adapter.addOne(s,e)}return this.setLoadingTrue(e)}saveAddOneError(e,t){return this.setLoadingFalse(e)}saveAddOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);if(this.isOptimistic(t)){const a=this.toUpdate(s);e=this.entityChangeTracker.mergeSaveUpdates([a],e,r,!1)}else e=this.entityChangeTracker.mergeSaveAdds([s],e,r);return this.setLoadingFalse(e)}saveDeleteOne(e,t){const s=this.extractData(t),r="object"==typeof s?this.selectId(s):s,a=e.changeState[r];if(a&&(a.changeType===q.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e)),this.isOptimistic(t)){const o=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteOne(r,e,o),e=this.adapter.removeOne(r,e)}return this.setLoadingTrue(e)}saveDeleteOneError(e,t){return this.setLoadingFalse(e)}saveDeleteOneSuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes([s],e,r)}else e=this.adapter.removeOne(s,e),e=this.entityChangeTracker.commitOne(s,e);return this.setLoadingFalse(e)}saveDeleteMany(e,t){const s=this.extractData(t).map(r=>"object"==typeof r?this.selectId(r):r);if(s.forEach(r=>{const a=e.changeState[r];a&&(a.changeType===q.Added?(e=this.adapter.removeOne(r,e),e=this.entityChangeTracker.commitOne(r,e),t.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(r,e))}),this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackDeleteMany(s,e,r),e=this.adapter.removeMany(s,e)}return this.setLoadingTrue(e)}saveDeleteManyError(e,t){return this.setLoadingFalse(e)}saveDeleteManySuccess(e,t){const s=this.extractData(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.mergeSaveDeletes(s,e,r)}else e=this.adapter.removeMany(s,e),e=this.entityChangeTracker.commitMany(s,e);return this.setLoadingFalse(e)}saveUpdateOne(e,t){const s=this.guard.mustBeUpdate(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateOne(s,e,r),e=this.adapter.updateOne(s,e)}return this.setLoadingTrue(e)}saveUpdateOneError(e,t){return this.setLoadingFalse(e)}saveUpdateOneSuccess(e,t){const s=this.guard.mustBeUpdateResponse(t),r=this.isOptimistic(t),a=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpdates([s],e,a,r),this.setLoadingFalse(e)}saveUpdateMany(e,t){const s=this.guard.mustBeUpdates(t);if(this.isOptimistic(t)){const r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpdateMany(s,e,r),e=this.adapter.updateMany(s,e)}return this.setLoadingTrue(e)}saveUpdateManyError(e,t){return this.setLoadingFalse(e)}saveUpdateManySuccess(e,t){const s=this.guard.mustBeUpdateResponses(t),a=(this.isOptimistic(t),this.extractMergeStrategy(t));return e=this.entityChangeTracker.mergeSaveUpdates(s,e,a,!1),this.setLoadingFalse(e)}saveUpsertOne(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertOne(s,e,r),e=this.adapter.upsertOne(s,e)}return this.setLoadingTrue(e)}saveUpsertOneError(e,t){return this.setLoadingFalse(e)}saveUpsertOneSuccess(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts([s],e,r),this.setLoadingFalse(e)}saveUpsertMany(e,t){if(this.isOptimistic(t)){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);e=this.entityChangeTracker.trackUpsertMany(s,e,r),e=this.adapter.upsertMany(s,e)}return this.setLoadingTrue(e)}saveUpsertManyError(e,t){return this.setLoadingFalse(e)}saveUpsertManySuccess(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.mergeSaveUpserts(s,e,r),this.setLoadingFalse(e)}addAll(e,t){const s=this.guard.mustBeEntities(t);return Object.assign(Object.assign({},this.adapter.setAll(s,e)),{loading:!1,loaded:!0,changeState:{}})}addMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddMany(s,e,r),this.adapter.addMany(s,e)}addOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackAddOne(s,e,r),this.adapter.addOne(s,e)}removeMany(e,t){const s=this.guard.mustBeKeys(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteMany(s,e,r),this.adapter.removeMany(s,e)}removeOne(e,t){const s=this.guard.mustBeKey(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackDeleteOne(s,e,r),this.adapter.removeOne(s,e)}removeAll(e,t){return Object.assign(Object.assign({},this.adapter.removeAll(e)),{loaded:!1,loading:!1,changeState:{}})}updateMany(e,t){const s=this.guard.mustBeUpdates(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateMany(s,e,r),this.adapter.updateMany(s,e)}updateOne(e,t){const s=this.guard.mustBeUpdate(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpdateOne(s,e,r),this.adapter.updateOne(s,e)}upsertMany(e,t){const s=this.guard.mustBeEntities(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertMany(s,e,r),this.adapter.upsertMany(s,e)}upsertOne(e,t){const s=this.guard.mustBeEntity(t),r=this.extractMergeStrategy(t);return e=this.entityChangeTracker.trackUpsertOne(s,e,r),this.adapter.upsertOne(s,e)}commitAll(e){return this.entityChangeTracker.commitAll(e)}commitMany(e,t){return this.entityChangeTracker.commitMany(this.extractData(t),e)}commitOne(e,t){return this.entityChangeTracker.commitOne(this.extractData(t),e)}undoAll(e){return this.entityChangeTracker.undoAll(e)}undoMany(e,t){return this.entityChangeTracker.undoMany(this.extractData(t),e)}undoOne(e,t){return this.entityChangeTracker.undoOne(this.extractData(t),e)}setChangeState(e,t){const s=this.extractData(t);return e.changeState===s?e:Object.assign(Object.assign({},e),{changeState:s})}setCollection(e,t){const s=this.extractData(t);return e===s?e:s}setFilter(e,t){const s=this.extractData(t);return e.filter===s?e:Object.assign(Object.assign({},e),{filter:s})}setLoaded(e,t){const s=!0===this.extractData(t)||!1;return e.loaded===s?e:Object.assign(Object.assign({},e),{loaded:s})}setLoading(e,t){return this.setLoadingFlag(e,this.extractData(t))}setLoadingFalse(e){return this.setLoadingFlag(e,!1)}setLoadingTrue(e){return this.setLoadingFlag(e,!0)}setLoadingFlag(e,t){return e.loading===(t=!0===t)?e:Object.assign(Object.assign({},e),{loading:t})}extractData(e){return e.payload&&e.payload.data}extractMergeStrategy(e){return this.isChangeTracking?e.payload&&e.payload.mergeStrategy:H.IgnoreChanges}isOptimistic(e){return e.payload&&!0===e.payload.isOptimistic}}let Wt=(()=>{class n{constructor(t){this.entityDefinitionService=t}create(t){const s=this.entityDefinitionService.getDefinition(t);return new me(t,s).methods}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(ot))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),zt=(()=>{class n{constructor(t){this.methodsFactory=t}create(t){const s=this.methodsFactory.create(t);return function(a,o){const l=s[o.payload.entityOp];return l?l(a,o):a}}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Wt))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Ht=(()=>{class n{constructor(t,s){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=Q.qC.apply(null,s||[])}getOrCreateReducer(t){let s=this.entityCollectionReducers[t];return s||(s=this.entityCollectionReducerFactory.create(t),s=this.registerReducer(t,s),this.entityCollectionReducers[t]=s),s}registerReducer(t,s){return s=this.entityCollectionMetaReducer(s),this.entityCollectionReducers[t.trim()]=s}registerReducers(t){(t?Object.keys(t):[]).forEach(r=>this.registerReducer(r,t[r]))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(zt),c.LFG(Mt,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Zt=(()=>{class n{constructor(t,s,r){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=s,this.logger=r}create(){return function t(s={},r){switch(r.type){case B.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(s,r);case B.LOAD_COLLECTIONS:return this.loadCollectionsReducer(s,r);case B.MERGE_QUERY_SET:return this.mergeQuerySetReducer(s,r);case B.SAVE_ENTITIES:return this.saveEntitiesReducer(s,r);case B.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(s,r);case B.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(s,r);case B.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(s,r);case B.SET_ENTITY_CACHE:return r.payload.cache}const a=r.payload;return a&&a.entityName&&a.entityOp&&!a.error?this.applyCollectionReducer(s,r):s}.bind(this)}clearCollectionsReducer(t,s){let{collections:r}=s.payload;const o=y.REMOVE_ALL;return r||(r=Object.keys(t)),r.reduce((l,v)=>this.applyCollectionReducer(l,{type:`[${v}] ${s.type}`,payload:{entityName:v,entityOp:o}}),t)}loadCollectionsReducer(t,s){const{collections:r}=s.payload,o=y.ADD_ALL;return Object.keys(r).reduce((v,f)=>this.applyCollectionReducer(v,{type:`[${f}] ${s.type}`,payload:{entityName:f,entityOp:o,data:r[f]}}),t)}mergeQuerySetReducer(t,s){let{mergeStrategy:r,querySet:a}=s.payload;r=null===r?H.PreserveChanges:r;const l=y.QUERY_MANY_SUCCESS;return Object.keys(a).reduce((f,A)=>this.applyCollectionReducer(f,{type:`[${A}] ${s.type}`,payload:{entityName:A,entityOp:l,data:a[A],mergeStrategy:r}}),t)}saveEntitiesReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:v}=s.payload;try{r.changes.forEach(A=>{const L=A.entityName,K={entityName:L,entityOp:f(A),data:A.entities,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:v},nt={type:`[${L}] ${s.type}`,payload:K};if(t=this.applyCollectionReducer(t,nt),nt.payload.error)throw nt.payload.error})}catch(A){s.payload.error=A}return t;function f(A){switch(A.op){case R.Add:return y.SAVE_ADD_MANY;case R.Delete:return y.SAVE_DELETE_MANY;case R.Update:return y.SAVE_UPDATE_MANY;case R.Upsert:return y.SAVE_UPSERT_MANY}}}saveEntitiesCancelReducer(t,s){return this.clearLoadingFlags(t,s.payload.entityNames||[])}saveEntitiesErrorReducer(t,s){const o=s.payload.originalAction.payload.changeSet.changes.map(l=>l.entityName);return this.clearLoadingFlags(t,o)}saveEntitiesSuccessReducer(t,s){const{changeSet:r,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:v}=s.payload;return r.changes.forEach(A=>{const L=A.entityName,K={entityName:L,entityOp:f(A),data:A.entities,correlationId:a,isOptimistic:o,mergeStrategy:l,tag:v};t=this.applyCollectionReducer(t,{type:`[${L}] ${s.type}`,payload:K})}),t;function f(A){switch(A.op){case R.Add:return y.SAVE_ADD_MANY_SUCCESS;case R.Delete:return y.SAVE_DELETE_MANY_SUCCESS;case R.Update:return y.SAVE_UPDATE_MANY_SUCCESS;case R.Upsert:return y.SAVE_UPSERT_MANY_SUCCESS}}}applyCollectionReducer(t={},s){const r=s.payload.entityName,a=t[r],o=this.entityCollectionReducerRegistry.getOrCreateReducer(r);let l;try{l=o(a||this.entityCollectionCreator.create(r),s)}catch(v){this.logger.error(v),s.payload.error=v}return s.payload.error||a===l?t:Object.assign(Object.assign({},t),{[r]:l})}clearLoadingFlags(t,s){let r=!1;return s.forEach(a=>{const o=t[a];o.loading&&(r||(t=Object.assign({},t),r=!0),t[a]=Object.assign(Object.assign({},o),{loading:!1}))}),t}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(pt),c.LFG(Ht),c.LFG(ht))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Ae=(()=>{class n{error(t,s){t&&(s?console.error(t,s):console.error(t))}log(t,s){t&&(s?console.log(t,s):console.log(t))}warn(t,s){t&&(s?console.warn(t,s):console.warn(t))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const Ce=["equipment","information","money","series"];let Oe=(()=>{class n{constructor(t){this.pluralNames={},t&&t.forEach(s=>this.registerPluralNames(s))}pluralize(t){return this.pluralNames[t]||(Ce.indexOf(t.toLowerCase())>=0?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substr(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")}registerPluralNames(t){this.pluralNames=Object.assign(Object.assign({},this.pluralNames),t||{})}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(vt,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),De=(()=>{class n{constructor(t,s,r,a,o,l){this.reducerManager=t,this.injector=r,this.entityCacheName=a,this.initialState=o,this.metaReducers=l;const v=a||lt;o="function"==typeof o?o():o;const f=(l||[]).map(A=>A instanceof c.OlP?r.get(A):A);this.entityCacheFeature={key:v,reducers:s.create(),reducerFactory:Q.UY,initialState:o||{},metaReducers:f},t.addFeature(this.entityCacheFeature)}static forRoot(t){return{ngModule:n,providers:[{provide:Ot,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Mt,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:vt,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}ngOnDestroy(){this.reducerManager.removeFeature(this.entityCacheFeature)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Q.PB),c.LFG(Zt),c.LFG(c.zs3),c.LFG(Ct,8),c.LFG(pe,8),c.LFG(Ot,8))},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[mt,At,T,le,Zt,ge,pt,zt,Wt,Ht,bt,Kt,ot,Dt,Gt,Tt,Qt,{provide:Ct,useValue:lt},{provide:Se,useClass:_e},{provide:ht,useClass:Ae}],imports:[[Q.Aw]]}),n})(),Te=(()=>{class n{constructor(t,s,r){this.effectSources=t,this.addEffects(s),this.addEffects(r)}static forRoot(t){return{ngModule:n,providers:[{provide:xt,multi:!0,useValue:t.entityMetadata?t.entityMetadata:[]},{provide:Ot,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:Mt,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:vt,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}}addEffects(t){this.effectSources.addEffects(t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(X.Ll),c.LFG(wt),c.LFG(Bt))},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[Lt,It,Ft,wt,Bt,{provide:Ut,useClass:oe},{provide:Pt,useClass:he},{provide:Rt,useClass:Oe}],imports:[[De,X.sQ]]}),n})()},24120:(rt,J,h)=>{h.d(J,{H:()=>G});var c=h(25803),_=h(5311),p=(()=>{return(D=p||(p={}))[D.EntitiesOnly=0]="EntitiesOnly",D[D.Both=1]="Both",D[D.None=2]="None",p;var D})();function M(D){return function($,O){const C={ids:[...O.ids],entities:Object.assign({},O.entities)},Y=D($,C);return Y===p.Both?Object.assign({},O,C):Y===p.EntitiesOnly?Object.assign(Object.assign({},O),{entities:C.entities}):O}}function b(D,k){const $=k(D);return(0,_.X6Q)()&&void 0===$&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",D,"The `selectId` implementation:",k.toString()),$}function V(D){function k(T,g){const E=b(T,D);return E in g.entities?p.None:(g.ids.push(E),g.entities[E]=T,p.Both)}function $(T,g){let E=!1;for(const d of T)E=k(d,g)!==p.None||E;return E?p.Both:p.None}function C(T,g){const E=b(T,D);return E in g.entities?(g.entities[E]=T,p.EntitiesOnly):(g.ids.push(E),g.entities[E]=T,p.Both)}function W(T,g){const d=(T instanceof Array?T:g.ids.filter(i=>T(g.entities[i]))).filter(i=>i in g.entities).map(i=>delete g.entities[i]).length>0;return d&&(g.ids=g.ids.filter(i=>i in g.entities)),d?p.Both:p.None}function F(T,g){return Z([T],g)}function Z(T,g){const E={};return(T=T.filter(i=>i.id in g.entities)).length>0?T.filter(S=>function I(T,g,E){const i=Object.assign({},E.entities[g.id],g.changes),S=b(i,D),m=S!==g.id;return m&&(T[g.id]=S,delete E.entities[g.id]),E.entities[S]=i,m}(E,S,g)).length>0?(g.ids=g.ids.map(S=>E[S]||S),p.Both):p.EntitiesOnly:p.None}function X(T,g){const E=[],d=[];for(const m of T){const R=b(m,D);R in g.entities?d.push({id:R,changes:m}):E.push(m)}const i=Z(d,g),S=$(E,g);switch(!0){case S===p.None&&i===p.None:return p.None;case S===p.Both||i===p.Both:return p.Both;default:return p.EntitiesOnly}}return{removeAll:function U(T){return Object.assign({},T,{ids:[],entities:{}})},addOne:M(k),addMany:M($),setAll:M(function O(T,g){return g.ids=[],g.entities={},$(T,g),p.Both}),setOne:M(C),setMany:M(function Y(T,g){const E=T.map(d=>C(d,g));switch(!0){case E.some(d=>d===p.Both):return p.Both;case E.some(d=>d===p.EntitiesOnly):return p.EntitiesOnly;default:return p.None}}),updateOne:M(F),updateMany:M(Z),upsertOne:M(function Q(T,g){return X([T],g)}),upsertMany:M(X),removeOne:M(function x(T,g){return W([T],g)}),removeMany:M(W),map:M(function tt(T,g){return Z(g.ids.reduce((i,S)=>{const m=T(g.entities[S]);return m!==g.entities[S]&&i.push({id:S,changes:m}),i},[]).filter(({id:i})=>i in g.entities),g)}),mapOne:M(function st({map:T,id:g},E){const d=E.entities[g];return d?F({id:g,changes:T(d)},E):p.None})}}function G(D={}){const{selectId:k,sortComparer:$}=Object.assign({sortComparer:!1,selectId:x=>x.id},D),O=function u(){return{getInitialState:function D(k={}){return Object.assign({ids:[],entities:{}},k)}}}(),C=function N(){return{getSelectors:function D(k){const $=x=>x.ids,O=x=>x.entities,C=(0,c.P1)($,O,(x,W)=>x.map(U=>W[U])),Y=(0,c.P1)($,x=>x.length);return k?{selectIds:(0,c.P1)(k,$),selectEntities:(0,c.P1)(k,O),selectAll:(0,c.P1)(k,C),selectTotal:(0,c.P1)(k,Y)}:{selectIds:$,selectEntities:O,selectAll:C,selectTotal:Y}}}}(),Y=$?function j(D,k){const{removeOne:$,removeMany:O,removeAll:C}=V(D);function Y(E,d){return x([E],d)}function x(E,d){const i=E.filter(S=>!(b(S,D)in d.entities));return 0===i.length?p.None:(g(i,d),p.Both)}function U(E,d){const i=b(E,D);return i in d.entities?(d.ids=d.ids.filter(S=>S!==i),g([E],d),p.Both):Y(E,d)}function F(E,d){return tt([E],d)}function tt(E,d){const i=[],S=E.filter(m=>function Z(E,d,i){if(!(d.id in i.entities))return!1;const m=Object.assign({},i.entities[d.id],d.changes),R=b(m,D);return delete i.entities[d.id],E.push(m),R!==d.id}(i,m,d)).length>0;if(0===i.length)return p.None;{const m=d.ids,R=[];return d.ids=d.ids.filter((et,at)=>et in d.entities||(R.push(at),!1)),g(i,d),!S&&R.every(et=>d.ids[et]===m[et])?p.EntitiesOnly:p.Both}}function T(E,d){const i=[],S=[];for(const et of E){const at=b(et,D);at in d.entities?S.push({id:at,changes:et}):i.push(et)}const m=tt(S,d),R=x(i,d);switch(!0){case R===p.None&&m===p.None:return p.None;case R===p.Both||m===p.Both:return p.Both;default:return p.EntitiesOnly}}function g(E,d){E.sort(k);const i=[];let S=0,m=0;for(;S<E.length&&m<d.ids.length;){const R=E[S],et=b(R,D),at=d.ids[m];k(R,d.entities[at])<=0?(i.push(et),S++):(i.push(at),m++)}d.ids=i.concat(S<E.length?E.slice(S).map(D):d.ids.slice(m)),E.forEach((R,et)=>{d.entities[D(R)]=R})}return{removeOne:$,removeMany:O,removeAll:C,addOne:M(Y),updateOne:M(F),upsertOne:M(function X(E,d){return T([E],d)}),setAll:M(function W(E,d){return d.entities={},d.ids=[],x(E,d),p.Both}),setOne:M(U),setMany:M(function I(E,d){const i=E.map(S=>U(S,d));switch(!0){case i.some(S=>S===p.Both):return p.Both;case i.some(S=>S===p.EntitiesOnly):return p.EntitiesOnly;default:return p.None}}),addMany:M(x),updateMany:M(tt),upsertMany:M(T),map:M(function st(E,d){return tt(d.ids.reduce((S,m)=>{const R=E(d.entities[m]);return R!==d.entities[m]&&S.push({id:m,changes:R}),S},[]),d)}),mapOne:M(function Q({map:E,id:d},i){const S=i.entities[d];return S?F({id:d,changes:E(S)},i):p.None})}}(k,$):V(k);return Object.assign(Object.assign(Object.assign({selectId:k,sortComparer:$},O),C),Y)}}}]);