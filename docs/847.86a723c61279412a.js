"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[847],{14847:(ee,W,f)=>{f.r(W),f.d(W,{RealtimeProcessAppComponent:()=>k,RealtimeProcessAppModule:()=>le});var R=f(40789),D=f(95461),A=f(91086),Q=f(239),l=f(25803),r=f(59701);const Z=(0,l.Lq)({loggedUser:""});var u=f(5311);const G=(0,l.PH)("[processes] INIT"),J=(0,l.PH)("[processes] FETCH_PROCESSES"),p=(0,l.PH)("[processes] FETCH_PROCESSES_SUCCESS",(0,l.Ky)()),m=((0,l.PH)("[processes] FETCH_PROCESSES_ERROR",(0,l.Ky)()),(0,l.PH)("[processes] REALTIME_CHANGES_SUBSCRIBE",(0,l.Ky)())),C=((0,l.PH)("[processes] REALTIME_CHANGES_NEW_DATA",(0,l.Ky)()),(0,l.PH)("[processes] START_PROCESS",(0,l.Ky)())),b=(0,l.PH)("[processes] START_PROCESS_SUCCESS"),O=(0,l.PH)("[processes] STOP_PROCESS",(0,l.Ky)()),j=(0,l.PH)("[processes] STOP_PROCESS_SUCCESS"),B=(0,l.PH)("[processes] UPDATE_PROCESS",(0,l.Ky)());var F=f(66544);const x="processes";var I=f(52540);const N=(0,f(24120).H)(),z=N.getInitialState({backgroundOperation:"nothing"}),w=(0,l.Lq)(z,(0,l.on)(G,(o,y)=>N.setAll([],Object.assign(Object.assign({},o),{isLoadingProcesses:!1}))),(0,l.on)(J,(o,y)=>N.setAll([],Object.assign(Object.assign({},o),{isLoadingProcesses:!0}))),(0,l.on)(p,(o,{processes:y})=>N.setAll(y,Object.assign(Object.assign({},o),{isLoadingProcesses:!1}))),(0,l.on)(B,(o,y)=>{const a=I.cloneDeep(y.process);let E=[];const H=o.entities[y.process.id];return"killing"===H&&(E=["killed","ended-with-error","ended-ok"]),"starting"===H&&(E=["active"]),E.length>0&&a.changes.state&&!E.includes(a.changes.state)&&(console.warn(`Changing state to ${H.state}... `),a.changes.state=H.state),N.updateOne(a,Object.assign({},o))})),{selectAll:t}=N.getSelectors(),s=(0,l.ZF)(x),i=(0,l.P1)(s,t),d=(0,l.P1)(i,o=>o.map(y=>F.An.from(y)));(0,l.P1)(s,o=>"loading-processes"===o.backgroundOperation),(0,l.P1)(s,o=>"syncing-with-db"===o.backgroundOperation);var U=f(67710),X=f(46831);function te(o,y){if(1&o){const a=u.EpF();u.TgZ(0,"app-process",1),u.NdJ("processAction",function(H){const K=u.CHM(a).$implicit;return u.oxw().onProcessAction(H,K)})("subscribeRealtime",function(){const P=u.CHM(a).$implicit;return u.oxw().onProcessRealtimeSubscribe(P)}),u._uU(1),u.qZA()}if(2&o){const a=y.$implicit;u.Q6J("process",a),u.xp6(1),u.hij(" ",a.id," ")}}let ne=(()=>{class o{constructor(a){this.store=a,this.processes$=this.store.select(d)}ngOnInit(){this.store.dispatch(G())}onProcessRealtimeSubscribe(a){this.store.dispatch(m({process:a}))}onProcessAction(a,E){"start"===a&&this.store.dispatch(C({process:E})),"stop"===a&&this.store.dispatch(O({process:E}))}trackByMethod(a,E){return E.id}}return o.\u0275fac=function(a){return new(a||o)(u.Y36(l.yh))},o.\u0275cmp=u.Xpm({type:o,selectors:[["app-processes"]],decls:6,vars:4,consts:[[3,"process","processAction","subscribeRealtime",4,"ngFor","ngForOf","ngForTrackBy"],[3,"process","processAction","subscribeRealtime"]],template:function(a,E){1&a&&(u.TgZ(0,"mat-card")(1,"h2"),u._uU(2,"Processes"),u.qZA(),u._UZ(3,"br"),u.YNc(4,te,2,2,"app-process",0),u.ALo(5,"async"),u.qZA()),2&a&&(u.xp6(4),u.Q6J("ngForOf",u.lcZ(5,2,E.processes$))("ngForTrackBy",E.trackByMethod))},directives:[U.a8,R.sg,X.H],pipes:[R.Ov],styles:[""]}),o})(),k=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(a){return new(a||o)},o.\u0275cmp=u.Xpm({type:o,selectors:[["app-realtime-process-app"]],decls:1,vars:0,template:function(a,E){1&a&&u._UZ(0,"app-processes")},directives:[ne],styles:[""]}),o})(),V=(()=>{class o{constructor(a){this.ctrl=a}}return o.\u0275fac=function(a){return new(a||o)(u.LFG(F.$8))},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac}),o})();var _=f(23239),se=f(14104),$=f(23877),q=f(46659),Y=f(64614),oe=f(36275),re=f(69186),ie=f(95314);let ce=(()=>{class o{constructor(a,E,H){this.actions$=a,this.service=E,this.store=H,this.init=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(G),(0,_.w)(()=>(0,se.of)(J())))),this.fetchProcesses=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(J),(0,_.w)(()=>this.service.ctrl.getAll().received.observable.pipe((0,$.U)(P=>P.body.rawJson),(0,$.U)(P=>p({processes:P})))))),this.startProcess=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(C),(0,q.b)(P=>{this.store.dispatch(B({process:{id:P.process.id,changes:{state:"starting"}}}))}),(0,Y.z)(P=>P.process.start().pipe((0,$.U)(()=>b()))))),this.stopProcess=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(O),(0,q.b)(P=>{this.store.dispatch(B({process:{id:P.process.id,changes:{state:"killing"}}}))}),(0,Y.z)(P=>P.process.stop().pipe((0,$.U)(()=>j()))))),this.realtimeChanges=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(m),(0,Y.z)(P=>ie.i.Realtime.Browser.listenChangesEntityObj(P.process).pipe((0,oe.b)(500),(0,re.z)(()=>F.An.ctrl.getBy(P.process.id).received.observable.pipe((0,$.U)(K=>K.body.rawJson))),(0,$.U)(K=>B({process:{id:K.id,changes:K}}))))))}}return o.\u0275fac=function(a){return new(a||o)(u.LFG(A.eX),u.LFG(V),u.LFG(l.yh))},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac}),o})(),ae=(()=>{class o{}return o.\u0275fac=function(a){return new(a||o)},o.\u0275mod=u.oAB({type:o}),o.\u0275inj=u.cJS({providers:[V,F.$8],imports:[[R.ez,F.JT,F.qX,l.Aw.forFeature(x,w),A.sQ.forFeature([ce])]]}),o})();const ue=[{path:"",component:k}];let le=(()=>{class o{}return o.\u0275fac=function(a){return new(a||o)},o.\u0275mod=u.oAB({type:o}),o.\u0275inj=u.cJS({imports:[[R.ez,l.Aw.forRoot(Z,{}),A.sQ.forRoot([]),Q.Qi.forRoot(),r.FT.instrument({maxAge:25}),D.Bz.forChild(ue),ae]]}),o})()},24120:(ee,W,f)=>{f.d(W,{H:()=>G});var R=f(25803),D=f(5311),r=(()=>{return(p=r||(r={}))[p.EntitiesOnly=0]="EntitiesOnly",p[p.Both=1]="Both",p[p.None=2]="None",r;var p})();function h(p){return function(m,M){const C={ids:[...M.ids],entities:Object.assign({},M.entities)},b=p(m,C);return b===r.Both?Object.assign({},M,C):b===r.EntitiesOnly?Object.assign(Object.assign({},M),{entities:C.entities}):M}}function T(p,g){const m=g(p);return(0,D.X6Q)()&&void 0===m&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",p,"The `selectId` implementation:",g.toString()),m}function Z(p){function g(c,n){const t=T(c,p);return t in n.entities?r.None:(n.ids.push(t),n.entities[t]=c,r.Both)}function m(c,n){let t=!1;for(const e of c)t=g(e,n)!==r.None||t;return t?r.Both:r.None}function C(c,n){const t=T(c,p);return t in n.entities?(n.entities[t]=c,r.EntitiesOnly):(n.ids.push(t),n.entities[t]=c,r.Both)}function j(c,n){const e=(c instanceof Array?c:n.ids.filter(s=>c(n.entities[s]))).filter(s=>s in n.entities).map(s=>delete n.entities[s]).length>0;return e&&(n.ids=n.ids.filter(s=>s in n.entities)),e?r.Both:r.None}function x(c,n){return I([c],n)}function I(c,n){const t={};return(c=c.filter(s=>s.id in n.entities)).length>0?c.filter(i=>function F(c,n,t){const s=Object.assign({},t.entities[n.id],n.changes),i=T(s,p),d=i!==n.id;return d&&(c[n.id]=i,delete t.entities[n.id]),t.entities[i]=s,d}(t,i,n)).length>0?(n.ids=n.ids.map(i=>t[i]||i),r.Both):r.EntitiesOnly:r.None}function w(c,n){const t=[],e=[];for(const d of c){const S=T(d,p);S in n.entities?e.push({id:S,changes:d}):t.push(d)}const s=I(e,n),i=m(t,n);switch(!0){case i===r.None&&s===r.None:return r.None;case i===r.Both||s===r.Both:return r.Both;default:return r.EntitiesOnly}}return{removeAll:function B(c){return Object.assign({},c,{ids:[],entities:{}})},addOne:h(g),addMany:h(m),setAll:h(function M(c,n){return n.ids=[],n.entities={},m(c,n),r.Both}),setOne:h(C),setMany:h(function b(c,n){const t=c.map(e=>C(e,n));switch(!0){case t.some(e=>e===r.Both):return r.Both;case t.some(e=>e===r.EntitiesOnly):return r.EntitiesOnly;default:return r.None}}),updateOne:h(x),updateMany:h(I),upsertOne:h(function z(c,n){return w([c],n)}),upsertMany:h(w),removeOne:h(function O(c,n){return j([c],n)}),removeMany:h(j),map:h(function L(c,n){return I(n.ids.reduce((s,i)=>{const d=c(n.entities[i]);return d!==n.entities[i]&&s.push({id:i,changes:d}),s},[]).filter(({id:s})=>s in n.entities),n)}),mapOne:h(function N({map:c,id:n},t){const e=t.entities[n];return e?x({id:n,changes:c(e)},t):r.None})}}function G(p={}){const{selectId:g,sortComparer:m}=Object.assign({sortComparer:!1,selectId:O=>O.id},p),M=function Q(){return{getInitialState:function p(g={}){return Object.assign({ids:[],entities:{}},g)}}}(),C=function l(){return{getSelectors:function p(g){const m=O=>O.ids,M=O=>O.entities,C=(0,R.P1)(m,M,(O,j)=>O.map(B=>j[B])),b=(0,R.P1)(m,O=>O.length);return g?{selectIds:(0,R.P1)(g,m),selectEntities:(0,R.P1)(g,M),selectAll:(0,R.P1)(g,C),selectTotal:(0,R.P1)(g,b)}:{selectIds:m,selectEntities:M,selectAll:C,selectTotal:b}}}}(),b=m?function u(p,g){const{removeOne:m,removeMany:M,removeAll:C}=Z(p);function b(t,e){return O([t],e)}function O(t,e){const s=t.filter(i=>!(T(i,p)in e.entities));return 0===s.length?r.None:(n(s,e),r.Both)}function B(t,e){const s=T(t,p);return s in e.entities?(e.ids=e.ids.filter(i=>i!==s),n([t],e),r.Both):b(t,e)}function x(t,e){return L([t],e)}function L(t,e){const s=[],i=t.filter(d=>function I(t,e,s){if(!(e.id in s.entities))return!1;const d=Object.assign({},s.entities[e.id],e.changes),S=T(d,p);return delete s.entities[e.id],t.push(d),S!==e.id}(s,d,e)).length>0;if(0===s.length)return r.None;{const d=e.ids,S=[];return e.ids=e.ids.filter((v,U)=>v in e.entities||(S.push(U),!1)),n(s,e),!i&&S.every(v=>e.ids[v]===d[v])?r.EntitiesOnly:r.Both}}function c(t,e){const s=[],i=[];for(const v of t){const U=T(v,p);U in e.entities?i.push({id:U,changes:v}):s.push(v)}const d=L(i,e),S=O(s,e);switch(!0){case S===r.None&&d===r.None:return r.None;case S===r.Both||d===r.Both:return r.Both;default:return r.EntitiesOnly}}function n(t,e){t.sort(g);const s=[];let i=0,d=0;for(;i<t.length&&d<e.ids.length;){const S=t[i],v=T(S,p),U=e.ids[d];g(S,e.entities[U])<=0?(s.push(v),i++):(s.push(U),d++)}e.ids=s.concat(i<t.length?t.slice(i).map(p):e.ids.slice(d)),t.forEach((S,v)=>{e.entities[p(S)]=S})}return{removeOne:m,removeMany:M,removeAll:C,addOne:h(b),updateOne:h(x),upsertOne:h(function w(t,e){return c([t],e)}),setAll:h(function j(t,e){return e.entities={},e.ids=[],O(t,e),r.Both}),setOne:h(B),setMany:h(function F(t,e){const s=t.map(i=>B(i,e));switch(!0){case s.some(i=>i===r.Both):return r.Both;case s.some(i=>i===r.EntitiesOnly):return r.EntitiesOnly;default:return r.None}}),addMany:h(O),updateMany:h(L),upsertMany:h(c),map:h(function N(t,e){return L(e.ids.reduce((i,d)=>{const S=t(e.entities[d]);return S!==e.entities[d]&&i.push({id:d,changes:S}),i},[]),e)}),mapOne:h(function z({map:t,id:e},s){const i=s.entities[e];return i?x({id:e,changes:t(i)},s):r.None})}}(g,m):Z(g);return Object.assign(Object.assign(Object.assign({selectId:g,sortComparer:m},M),C),b)}}}]);